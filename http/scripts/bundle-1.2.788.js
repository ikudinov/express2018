webpackJsonp([0],{"./app/api/authentication.js":function(e,t,n){"use strict";function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){a(e,t,n[t])})}return e}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t,n){var r="https://".concat(e,"/api/v1/authentication/register"),a=(0,p.jsonContentType)(),o=JSON.stringify({phone:t,udid:n,platform:"web",app_version:"1.2.788"});return(0,f.advancedFetch)(r,{method:"POST",body:o,headers:a}).catch(function(e){return e.json()})}function s(e,t,n){var r="https://".concat(e,"/api/v1/authentication/resend"),a=(0,p.jsonContentType)(),o=JSON.stringify({phone:t,udid:n,platform:"web",app_version:"1.2.788"});return(0,f.advancedFetch)(r,{method:"POST",body:o,headers:a}).catch(function(e){return e.json()})}function i(e,t,n,a,o){var s="https://".concat(e,"/api/v1/authentication/confirm"),i=(0,p.jsonContentType)(),c={phone:t,udid:a,confirmation_code:n};return c=void 0!==o?r({},c,{logout_cts:o}):c,(0,f.advancedFetch)(s,{method:"POST",body:JSON.stringify(c),headers:i}).then(function(e){return"error"===e.status?Promise.reject(e.result):e}).catch(function(e){return e.json()})}function c(e,t){var n="https://".concat(e,"/api/v1/authentication/token/active");return(0,f.advancedFetch)(n,{method:"GET",authToken:t,encrypt:!0,connType:"rts"}).catch(function(e){return e})}function u(e,t,n,r){var a="https://".concat(e,"/api/v1/authentication/activation"),o=JSON.stringify({app_version:n,locale:r});return(0,f.advancedFetch)(a,{method:"PUT",authToken:t,encrypt:!0,connType:"rts",body:o}).catch(function(e){return e})}function l(e,t,n){var r="https://".concat(e,"/api/v1/authentication/register_request"),a={status:"error"},o=JSON.stringify({registration_id:t}),s=null,i=setTimeout(function(){return s(a)},n),c=new Promise(function(e){s=e});return(0,f.advancedFetch)(r,{method:"POST",encrypt:!0,connType:"rts",body:o}).then(s).catch(s),c.then(function(e){return i&&(clearTimeout(i),i=null),e})}function d(e,t,n,r,a,o){var s="https://".concat(e,"/api/v1/authentication/register_confirm"),i=JSON.stringify({registration_id:t,registration_token:n,phone:r,udid:a,platform:"web",app_version:"1.2.788",locale:o});return(0,f.advancedFetch)(s,{method:"POST",encrypt:!0,connType:"rts",body:i}).catch(function(e){return e})}Object.defineProperty(t,"__esModule",{value:!0}),t.register=o,t.resend=s,t.confirm=i,t.checkTokenActive=c,t.activation=u,t.registerRequest=l,t.registerConfirm=d;var p=n("./app/helpers/api.js"),f=n("./lib/advancedFetch.js")},"./app/api/cts.js":function(e,t,n){"use strict";function r(e,t,n,r,a,o){var s="https://".concat(e,"/api/v1/ad_integration/authenticate"),i=(0,p.jsonContentType)(),c=btoa((0,d.makeNtlmNegotiate)()),u=JSON.stringify({login:r,huid:t,udid:n,negotiate:c});return(0,f.advancedFetch)(s,{method:"POST",body:u,headers:i}).then(function(e){var c=atob(e.challenge),u=btoa((0,d.parseNtlmChallenge)(r,o||"",a,c,"python")),l=JSON.stringify({login:r,huid:t,udid:n,authenticate:u});return(0,f.advancedFetch)(s,{method:"POST",body:l,headers:i})}).catch(function(e){return e.json()})}function a(e,t,n,r){var a="https://".concat(e,"/api/v2/ad_integration/authenticate_ctsweb"),o=(0,p.jsonContentType)(),s=btoa((0,d.makeNtlmNegotiate)()),i=JSON.stringify({login:n,udid:t,negotiate:s});return(0,f.advancedFetch)(a,{method:"POST",body:i,headers:o}).then(function(e){var s=atob(e.challenge),i=btoa((0,d.parseNtlmChallenge)(n,"",r,s,"python")),c=JSON.stringify({login:n,user_huid:e.user_huid,udid:t,authenticate:i});return(0,f.advancedFetch)(a,{method:"POST",body:c,headers:o})}).catch(function(e){return e.json()})}function o(e,t,n,r,a,o,s,i){var c="https://".concat(e,"/api/v2/ad_integration/ctsweb_push_token"),u=JSON.stringify({token:n,user_huid:r,locale:o,udid:a,encryption_key:s,auth_key:i});return(0,f.advancedFetch)(c,{method:"PUT",body:u,authToken:t})}function s(e,t,n){var r="https://".concat(e,"/api/v2/ad_integration/ctsweb_push_token"),a=JSON.stringify({token:n});return(0,f.advancedFetch)(r,{method:"DELETE",body:a,authToken:t})}function i(e,t){var n="https://".concat(e,"/api/v2/ad_integration/logout");return(0,f.advancedFetch)(n,{method:"DELETE",authToken:t}).catch(function(e){return e.json()})}function c(e,t){var n="https://".concat(e,"/api/v1/ad_integration/token/active?token=").concat(t),r=(0,p.jsonContentType)();return(0,f.advancedFetch)(n,{method:"GET",headers:r}).catch(function(e){return e})}function u(e,t){var n="https://".concat(e,"/api/v1/authentication/confirm_cts_logout");return(0,f.advancedFetch)(n,{method:"POST",authToken:t}).catch(function(e){return e.json()})}function l(e,t,n,r){var a="https://".concat(e,"/api/v1/ad_integration/register_confirm"),o=JSON.stringify({registration_id:t,registration_token:n,udid:r});return(0,f.advancedFetch)(a,{method:"POST",encrypt:!0,connType:"cts",body:o}).catch(function(e){return e})}Object.defineProperty(t,"__esModule",{value:!0}),t.authenticate=r,t.authenticateCtsWeb=a,t.uploadPushTokenCtsWeb=o,t.deletePushTokenCtsWeb=s,t.logout=i,t.checkTokenActive=c,t.confirmCtsLogout=u,t.registerConfirm=l;var d=n("./lib/ntlm.js"),p=n("./app/helpers/api.js"),f=n("./lib/advancedFetch.js")},"./app/api/fileService.js":function(e,t,n){"use strict";function r(e,t,n){var r="https://".concat(e,"/api/v1/file_service/files/").concat(n.chat_id),a={authorization:"Bearer ".concat(t)},o=new FormData;return o.append("sync_id",n.sync_id),o.append("filename",n.filename),o.append("preview_file",n.preview_file),o.append("mimetype",n.mimetype),o.append("filedata",n.filedata),(0,s.advancedFetch)(r,{method:"POST",headers:a,body:o})}function a(e,t,n){var r="https://".concat(e,"/api/v1/file_service/files/").concat(n);return(0,s.advancedFetch)(r,{method:"GET",authToken:t}).then(function(e){return e.result})}function o(e,t){var n=t?"https://".concat(t,"/").concat(e):e;return(0,s.advancedFetch)(n,{method:"GET"}).then(i.responseBLOB).then(function(e){return new Promise(function(t){var n=new FileReader;n.readAsArrayBuffer(e),n.onload=function(){t(new Uint8Array(n.result))}})})}Object.defineProperty(t,"__esModule",{value:!0}),t.saveChatFile=r,t.fetchChatFiles=a,t.fetchBinaryData=o;var s=n("./lib/advancedFetch.js"),i=n("./app/helpers/api.js")},"./app/api/kdc.js":function(e,t,n){"use strict";function r(e,t,n,r,a,o,s){var i="https://".concat(e,"/api/v1/kdc/private_keys"),c=JSON.stringify({key:n,kind:r,public_key_id:a,algo:o});return(0,d.advancedFetch)(i,{method:"POST",authToken:t,body:c,encrypt:!0,connType:s})}function a(e,t,n){var r="https://".concat(e,"/api/v1/kdc/keys/?ids=").concat(t.join(","));return(0,d.advancedFetch)(r,{method:"GET",authToken:n,encrypt:!0,connType:"rts"})}function o(e,t,n,r,a,o){var s="https://".concat(e,"/api/v2/kdc/keys/").concat(n),i=JSON.stringify({rts_pub_key:r,cts_pub_key:a,algo:o});return(0,d.advancedFetch)(s,{method:"POST",authToken:t,body:i,encrypt:!0,connType:"rts"})}function s(e,t,n,r){var a="https://".concat(e,"/api/v1/kdc/keys/?user_huids=").concat(t);return(0,d.advancedFetch)(a,{method:"GET",encrypt:!0,connType:n,authToken:r})}function i(e,t,n,r){var a="https://".concat(e,"/api/v1/kdc/private_keys/").concat(n);return(0,d.advancedFetch)(a,{method:"GET",authToken:t,encrypt:!0,connType:r})}function c(e,t,n,r,a,o,s){var i="https://".concat(o,"/api/v2/kdc/keys/").concat(e),c=JSON.stringify({key:t,kind:n,algo:r,id:a});return(0,d.advancedFetch)(i,{method:"POST",authToken:s,body:c,encrypt:!0,connType:"cts"})}function u(e){var t="https://".concat(e,"/api/v1/kdc/start");return(0,d.advancedFetch)(t,{method:"GET"}).then(function(e){return(0,l.fromBase64)(e.result)})}Object.defineProperty(t,"__esModule",{value:!0}),t.uploadPrivateKey=r,t.fetchPublicKeysByIds=a,t.uploadUserPublicKeys=o,t.fetchUserPublicKeys=s,t.fetchPrivateKeyByPubId=i,t.uploadUserPublicKey=c,t.fetchServerPublicKey=u;var l=n("./lib/encryption.js"),d=n("./lib/advancedFetch.js")},"./app/api/phonebook.js":function(e,t,n){"use strict";function r(e,t,n,r){var a="https://".concat(e,"/api/v1/phonebook/profiles/").concat(t);return(0,l.advancedFetch)(a,{method:"GET",authToken:n,encrypt:!0,connType:r})}function a(e,t,n){var r="https://".concat(e,"/api/v1/phonebook/profiles/self");return(0,l.advancedFetch)(r,{method:"GET",authToken:t,encrypt:!0,connType:n})}function o(e,t,n,r){var a="https://".concat(e,"/api/v1/phonebook/profiles/self"),o=(0,d.getMultipartFormData)({name:t,avatar:n}),s=o.contentType,i=o.body,c={authorization:"Bearer ".concat(r),"content-type":s};return(0,l.advancedFetch)(a,{method:"POST",headers:c,body:i})}function s(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,o="version=".concat(n,"&active_at_least_one=").concat(!a,"&udid=latest_mobile&with_deleted=true"),s="https://".concat(e,"/api/v3/phonebook?").concat(o);return(0,l.advancedFetch)(s,{method:"GET",authToken:t,encrypt:!0,connType:r}).then(function(e){return e.result}).catch(function(e){return e})}function i(e,t,n){var r="https://".concat(e,"/api/v3/phonebook/contacts"),a=JSON.stringify({contacts:[n]}),o={method:"POST",authToken:t,body:a,encrypt:!0,connType:"rts"};return(0,l.advancedFetch)(r,o).then(function(e){return e.result})}function c(e,t,n){var r="https://".concat(e,"/api/v3/phonebook"),a=JSON.stringify({phonebook:[n]}),o={method:"POST",authToken:t,body:a,encrypt:!0,connType:"rts"};return(0,l.advancedFetch)(r,o).then(function(e){return e.result})}function u(e,t,n,r){var a="https://".concat(e,"/api/v2/phonebook/profiles?user_huids=").concat(n);return(0,l.advancedFetch)(a,{method:"GET",authToken:t,encrypt:!0,connType:r}).then(function(e){return e.result})}Object.defineProperty(t,"__esModule",{value:!0}),t.fetchProfile=r,t.fetchSelfProfile=a,t.uploadProfile=o,t.getPhonebook=s,t.postContacts=i,t.postPhonebook=c,t.fetchProfiles=u;var l=n("./lib/advancedFetch.js"),d=n("./app/helpers/api.js")},"./app/api/push.js":function(e,t,n){"use strict";function r(e,t,n,r,a,s,i,c,u){var l="https://".concat(e,"/api/v1/push_service/protected/token"),d=JSON.stringify({phone:t,token:r,platform:"web",user_huid:a,locale:i,udid:s,encryption_key:c,auth_key:u});return(0,o.advancedFetch)(l,{method:"PUT",body:d,authToken:n})}function a(e,t,n){var r="https://".concat(e,"/api/v1/push_service/protected/token"),a=JSON.stringify({token:n});return(0,o.advancedFetch)(r,{method:"DELETE",body:a,authToken:t})}Object.defineProperty(t,"__esModule",{value:!0}),t.registerPushToken=r,t.deletePushToken=a;var o=n("./lib/advancedFetch.js")},"./app/api/settings.js":function(e,t,n){"use strict";function r(e,t,n){var r="https://".concat(e,"/api/v1/settings/users/").concat(t);return(0,a.advancedFetch)(r,{method:"GET",authToken:n})}Object.defineProperty(t,"__esModule",{value:!0}),t.fetchUserSettings=r;var a=n("./lib/advancedFetch.js")},"./app/api/update.js":function(e,t,n){"use strict";function r(){return fetch("/api/v1/web_client/version",{method:"GET"}).then(function(e){return e.ok?e.json():Promise.reject(e)}).then(function(e){return null===e||void 0===e?void 0:e.version})}function a(){var e=(new Date).getTime(),t="/index.html?v=".concat(e);return fetch(t,{method:"GET"})}Object.defineProperty(t,"__esModule",{value:!0}),t.fetchAppVersion=r,t.fetchIndex=a},"./app/api/voex.js":function(e,t,n){"use strict";function r(e,t,n){var r="https://".concat(e,"/api/v1/voex/start_session");return(0,s.advancedFetch)(r,{method:"POST",authToken:t,encrypt:!0,connType:n}).catch(function(){return!1})}function a(e,t,n,r,a){var o="https://".concat(e,"/api/v1/voex/start_session"),i=JSON.stringify({call_id:r,offer_secret:a});return(0,s.advancedFetch)(o,{method:"POST",authToken:t,body:i,encrypt:!0,connType:n}).catch(function(){return!1})}function o(e,t,n,r,a){var o="https://".concat(e,"/api/v1/voex/stop_session"),i=JSON.stringify({call_id:n,offer_secret:r});return(0,s.advancedFetch)(o,{method:"POST",authToken:t,body:i,encrypt:!0,connType:a}).catch(function(e){return e})}Object.defineProperty(t,"__esModule",{value:!0}),t.createSession=r,t.startSession=a,t.stopSession=o;var s=n("./lib/advancedFetch.js")},"./app/components/App/ChatPresence.js":function(e,t,n){"use strict";function r(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!r(e,t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}function c(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?u(e):t}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var d=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),p=n("./node_modules/react-intl/lib/index.es.js"),f=function(e){function t(){return o(this,t),c(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return l(t,e),i(t,[{key:"render",value:function(){var e=this.props,t=e.className,n=e.chat,r=n.statuses.filter(function(e){return"online"===e.status});return d.default.createElement("div",{className:t},d.default.createElement(p.FormattedMessage,{id:"[chat presence] members online",defaultMessage:"{count} members, {online} online",values:{count:n.members.length,online:r.length}}))}}]),t}(d.Component);t.default=f},"./app/components/App/ChatTyping.js":function(e,t,n){"use strict";function r(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!r(e,t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}function c(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?u(e):t}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var d=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),p=n("./node_modules/react-intl/lib/index.es.js"),f=function(e){function t(){return o(this,t),c(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return l(t,e),i(t,[{key:"render",value:function(){var e=this.props,t=e.chat,n=e.className,r=e.namesNumber,a=t.typing,o=d.default.createElement("span",{className:"".concat(n,"__loader")},"...");if("chat"===t.chat_type)return d.default.createElement("div",{className:n},d.default.createElement(p.FormattedMessage,{id:"[chat typing comp] typing",defaultMessage:"{loader}typing",values:{loader:o}}));if(1===a.length)return d.default.createElement("div",{className:n},d.default.createElement(p.FormattedMessage,{id:"[chat typing comp] is typing",defaultMessage:"{typing} is typing{loader}",values:{typing:a,loader:o}}));var s=a.length<r+1?a.join(", "):a.slice(0,r).join(", "),i=a.length<r+1?d.default.createElement(p.FormattedMessage,{id:"[chat typing comp] are typing",defaultMessage:"{typingNames} are typing{loader}",values:{typingNames:s,loader:o}}):d.default.createElement(p.FormattedMessage,{id:"[chat typing comp] many are typing",defaultMessage:"{typingNames} and {others} others are typing{loader}",values:{typingNames:s,others:a.length-r,loader:o}});return d.default.createElement("div",{className:n},i)}}]),t}(d.Component);t.default=f},"./app/components/App/ConnTypeIcon.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){if(!a(e,t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function u(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?l(e):t}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),f=r(n("./app/assets/icons/chat-conn-rts.svg")),m=r(n("./app/assets/icons/chat-conn-cts.svg")),h=r(n("./app/assets/icons/chat-conn-hyb.svg")),y=r(n("./app/assets/icons/botx.svg")),_=function(e){function t(){return s(this,t),u(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return d(t,e),c(t,[{key:"render",value:function(){var e=this.props,t=e.connType,n=e.isBot,r=e.className,a=e.name,o=e.width,s=e.height;return n?p.default.createElement("div",{className:"".concat(r," ").concat(r,"--").concat(a)},p.default.createElement(y.default,{width:o,height:s,className:"".concat(r,"__icon ").concat(r,"__icon--").concat(t)})):"cts"===t?p.default.createElement("div",{className:"".concat(r," ").concat(r,"--").concat(a)},p.default.createElement(m.default,{width:o,height:s,className:"".concat(r,"__icon ").concat(r,"__icon--cts")})):"rts"===t?p.default.createElement("div",{className:"".concat(r," ").concat(r,"--").concat(a)},p.default.createElement(f.default,{width:o,height:s,className:"".concat(r,"__icon ").concat(r,"__icon--rts")})):p.default.createElement("div",{className:"".concat(r," ").concat(r,"--").concat(a)},p.default.createElement(h.default,{width:o,height:s,className:"".concat(r,"__icon ").concat(r,"__icon--hyb")}))}}]),t}(p.PureComponent);t.default=_},"./app/components/App/DropdownMenu.js":function(e,t,n){"use strict";function r(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!r(e,t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}function c(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?l(e):t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var d=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),p=n("./app/helpers/reactHelpers.js"),f=n("./lib/deepEqual.js"),m=function(e){function t(e){var n;return o(this,t),n=c(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),Object.defineProperty(l(n),"handleOutsideClick",{configurable:!0,enumerable:!0,writable:!0,value:function(e){for(var t=e.target;t.parentNode;){if(t===n.menuDiv)return;t=t.parentNode}n.handleTriggerClick(!1)}}),Object.defineProperty(l(n),"calculateAlign",{configurable:!0,enumerable:!0,writable:!0,value:function(e){var t;if(!n.state.isOpen)return{};var r=n.props,a=r.parentClassName,o=r.contentSize;if(!a||!o)return{};var s,i,c=(null===(t=document.getElementsByClassName(a)[0])||void 0===t?void 0:t.getBoundingClientRect())||{},u=(null===e||void 0===e?void 0:e.getBoundingClientRect())||{},l=u.bottom,d=u.top,p=u.right,f=u.left,m=o.width,h=o.height;return c.bottom-l<h&&(i="top"),d-c.top<h&&(i="bottom"),c.right-p<m&&(s="left"),f-c.left<m&&(s="right"),{x:s,y:i}}}),n.state={isOpen:!1},n.menuDiv=null,n}return u(t,e),i(t,[{key:"componentDidMount",value:function(){document.addEventListener("click",this.handleOutsideClick)}},{key:"shouldComponentUpdate",value:function(e,t){var n=["className","children","trigger","align","display"];return(0,p.isShouldComponentUpdate)(this.props,e,n)||!(0,f.equal)(this.state,t)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("click",this.handleOutsideClick)}},{key:"handleTriggerClick",value:function(e){this.setState({isOpen:e}),this.props.onTriggerClick&&this.props.onTriggerClick(e)}},{key:"render",value:function(){var e=this,t=this.props,n=t.children,r=t.trigger,a=t.className,o=t.name,s=t.align,i=t.display,c=this.state.isOpen,u=this.calculateAlign(this.menuDiv).x||(null===s||void 0===s?void 0:s.x),l=this.calculateAlign(this.menuDiv).y||(null===s||void 0===s?void 0:s.y),p=u?"dropdown__wrapper--".concat(u):"",f=l?"dropdown__wrapper--".concat(l):"",m=c?"dropdown__wrapper--opened":"dropdown__wrapper--closed",h="dropdown__wrapper ".concat(p," ").concat(f," ").concat(m);return d.default.createElement("div",{style:{display:!1===i?"none":"block"},ref:function(t){e.menuDiv=t},className:"dropdown ".concat(o?"dropdown--".concat(o):"")},d.default.createElement("div",{className:"dropdown__trigger",onClick:function(){return e.handleTriggerClick(!c)}},r),d.default.createElement("div",{className:h,onClick:function(){return e.handleTriggerClick(!1)}},d.default.createElement("div",{className:a},n)))}}]),t}(d.Component);t.default=m},"./app/components/App/MainMenu.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){if(!a(e,t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function u(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?l(e):t}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),f=n("./node_modules/react-intl/lib/index.es.js"),m=n("./node_modules/react-router-dom/es/index.js"),h=r(n("./app/components/App/DropdownMenu.js")),y=r(n("./app/assets/icons/main-menu.svg")),_=r(n("./app/assets/icons/chats.svg")),b=r(n("./app/assets/icons/contacts.svg")),v=r(n("./app/assets/icons/settings.svg")),g=function(e){function t(){return s(this,t),u(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return d(t,e),c(t,[{key:"render",value:function(){var e=p.default.createElement("button",{className:"btn btn--layout-menu"},p.default.createElement(y.default,{width:"24",height:"24",className:"btn__icon"}));return p.default.createElement(h.default,{className:"dropdown-menu",trigger:e},p.default.createElement(m.NavLink,{className:"dropdown-menu__item",activeClassName:"dropdown-menu__item--active",to:"/chats"},p.default.createElement(_.default,{width:"16",height:"16",className:"dropdown-menu__icon"}),p.default.createElement("strong",null,p.default.createElement(f.FormattedMessage,{id:"[main menu] chats",defaultMessage:"Chats"}))),p.default.createElement(m.NavLink,{className:"dropdown-menu__item",activeClassName:"dropdown-menu__item--active",to:"/contacts"},p.default.createElement(b.default,{width:"16",height:"16",className:"dropdown-menu__icon"}),p.default.createElement("strong",null,p.default.createElement(f.FormattedMessage,{id:"[main menu] contacts",defaultMessage:"Contacts"}))),p.default.createElement(m.NavLink,{className:"dropdown-menu__item",activeClassName:"dropdown-menu__item--active",to:"/settings"},p.default.createElement(v.default,{width:"16",height:"16",className:"dropdown-menu__icon"}),p.default.createElement("strong",null,p.default.createElement(f.FormattedMessage,{id:"[main menu] settings",defaultMessage:"Settings"}))))}}]),t}(p.PureComponent),E=(0,f.injectIntl)(g);t.default=E},"./app/components/App/Modal.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){if(!a(e,t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function u(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?l(e):t}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),f=r(n("./node_modules/react-modal/lib/index.js")),m=r(n("./app/assets/icons/cross.svg")),h=function(e){function t(){return s(this,t),u(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return d(t,e),c(t,[{key:"componentWillMount",value:function(){f.default.setAppElement("body")}},{key:"render",value:function(){var e=this.props,t=e.name,n=e.isOpen,r=e.onClose,a=e.caption,o=e.children,s=e.shouldCloseOnOverlayClick,i=e.shouldCloseOnEsc;return n?p.default.createElement(f.default,{portalClassName:"modal",overlayClassName:"modal modal--".concat(t),className:"modal__inner modal__inner--".concat(t),isOpen:n,onRequestClose:r,shouldCloseOnOverlayClick:s,shouldCloseOnEsc:i},a&&p.default.createElement("div",{className:"modal__header"},p.default.createElement("strong",{className:"modal__title"},a),p.default.createElement("button",{className:"btn modal__btn-close",onClick:r},p.default.createElement(m.default,{width:"24",height:"24",className:"btn__icon"}))),p.default.createElement("div",{className:"modal__body modal__body--".concat(t)},o)):null}}]),t}(p.Component);t.default=h},"./app/components/App/Toggler.js":function(e,t,n){"use strict";function r(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!r(e,t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}function c(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?u(e):t}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var d=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),p=function(e){function t(){return o(this,t),c(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return l(t,e),i(t,[{key:"render",value:function(){var e=this.props,t=e.id,n=e.checked,r=e.onChange;return d.default.createElement("div",{className:"form-toggler"},d.default.createElement("input",{className:"form-toggler__input",id:t,type:"checkbox",htmlFor:t,checked:n,onChange:r}),d.default.createElement("span",{className:"form-toggler__checker"}))}}]),t}(d.PureComponent);t.default=p},"./app/components/App/UserPresence.js":function(e,t,n){"use strict";function r(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!r(e,t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}function c(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?u(e):t}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var d=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),p=n("./node_modules/react-intl/lib/index.es.js"),f=function(e){return e&&e.__esModule?e:{default:e}}(n("./node_modules/moment/moment.js")),m=n("./lib/timestamps.js"),h=function(e){function t(){return o(this,t),c(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return l(t,e),i(t,[{key:"render",value:function(){var e=this.props,t=e.className,n=e.status,r=e.statusChanged,a=e.connType;if(!n)return null;var o=(0,m.convert)(r),s=o.isBefore((0,f.default)())?o.fromNow():(0,f.default)().fromNow(),i="online"===n?d.default.createElement(p.FormattedMessage,{id:"[user presence] online",defaultMessage:"online"}):d.default.createElement(p.FormattedMessage,{id:"[user presence] online from now",defaultMessage:"online {fromNow}",values:{fromNow:s}}),c="".concat(t,"--").concat(n),u=a&&"online"===n?"".concat(t,"--").concat(a):null;return d.default.createElement("div",{className:[t,c,u].join(" ")},i)}}]),t}(d.PureComponent);t.default=h},"./app/components/AttachManager.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(){return s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},s.apply(this,arguments)}function i(e,t){if(!a(e,t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t,n){return t&&c(e.prototype,t),n&&c(e,n),e}function l(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?p(e):t}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function p(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var f=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),m=n("./node_modules/react-intl/lib/index.es.js"),h=r(n("./app/components/InputFileLoader.js")),y=r(n("./app/components/Chats/ChatContactPicker.js")),_=r(n("./app/components/App/Modal.js")),b=n("./lib/constants.js"),v=r(n("./app/assets/icons/photo.svg")),g=r(n("./app/assets/icons/video.svg")),E=r(n("./app/assets/icons/document.svg")),S=r(n("./app/assets/icons/contact.svg")),O=function(e){function t(e){var n;return i(this,t),n=l(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),Object.defineProperty(p(n),"toggleContactModal",{configurable:!0,enumerable:!0,writable:!0,value:function(e){n.setState({contactModalIsOpen:e})}}),Object.defineProperty(p(n),"handleCheckFile",{configurable:!0,enumerable:!0,writable:!0,value:function(e){return!b.DOCUMENT_DECLINE.includes(e.type)}}),n.state={contactModalIsOpen:!1},n}return d(t,e),u(t,[{key:"render",value:function(){var e=this,t=this.props.onSuccess,n=this.state.contactModalIsOpen;return f.default.createElement("div",{className:"dropdown-menu__inner"},f.default.createElement("label",{className:"dropdown-menu__item",htmlFor:"image-input"},f.default.createElement(h.default,{id:"image-input",accept:b.IMAGE_ACCEPT,preview:!0,onSuccess:function(e){return t("image",e)}}),f.default.createElement(v.default,{width:"16",height:"16",className:"dropdown-menu__icon"}),f.default.createElement(m.FormattedMessage,{id:"[attach] photo",defaultMessage:"Photo"})),f.default.createElement("label",{className:"dropdown-menu__item",htmlFor:"video-input"},f.default.createElement(h.default,{id:"video-input",accept:b.VIDEO_ACCEPT,preview:!0,onSuccess:function(e){return t("video",e)}}),f.default.createElement(g.default,{width:"16",height:"16",className:"dropdown-menu__icon"}),f.default.createElement(m.FormattedMessage,{id:"[attach] video",defaultMessage:"Video"})),f.default.createElement("label",{className:"dropdown-menu__item",htmlFor:"document-input"},f.default.createElement(h.default,{id:"document-input",onCheckFile:this.handleCheckFile,onSuccess:function(e){return t("document",e)}}),f.default.createElement(E.default,{width:"16",height:"16",className:"dropdown-menu__icon"}),f.default.createElement(m.FormattedMessage,{id:"[attach] doc",defaultMessage:"Document"})),f.default.createElement("span",{className:"dropdown-menu__item",onClick:function(){return e.toggleContactModal(!0)}},f.default.createElement(S.default,{width:"16",height:"16",className:"dropdown-menu__icon"}),f.default.createElement(m.FormattedMessage,{id:"[attach] contact",defaultMessage:"Contact"})),f.default.createElement(_.default,{name:"attach-contact",caption:f.default.createElement(m.FormattedMessage,{id:"[attach dialog] send contact",defaultMessage:"Send contact"}),isOpen:n,onClose:function(){return e.toggleContactModal(!1)}},f.default.createElement(y.default,s({},this.props,{toggleModal:this.toggleContactModal}))))}}]),t}(f.Component);t.default=O},"./app/components/Auth/Confirm.js":function(e,t,n){"use strict";function r(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!r(e,t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}function c(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?l(e):t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var d=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),p=n("./node_modules/formsy-react/lib/main.js"),f=n("./node_modules/react-intl/lib/index.es.js"),m=n("./node_modules/libphonenumber-js/index.es6.js"),h=function(e){return e&&e.__esModule?e:{default:e}}(n("./app/components/MaskedInput.js")),y=n("./lib/constants.js"),_=function(e){function t(e){var n;return o(this,t),n=c(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),Object.defineProperty(l(n),"enableButton",{configurable:!0,enumerable:!0,writable:!0,value:function(){n.setState({canSubmit:!0})}}),Object.defineProperty(l(n),"disableButton",{configurable:!0,enumerable:!0,writable:!0,value:function(){n.setState({canSubmit:!1})}}),Object.defineProperty(l(n),"timerTick",{configurable:!0,enumerable:!0,writable:!0,value:function(){var e=n.props.user||{},t=e.registerTimestamp;if(null!==t){var r=Math.floor((y.RESEND_SMS_DELAY-((new Date).getTime()-t))/1e3);r=r>=0?r:0,n.state.timeToResend!==r&&n.setState({timeToResend:r})}}}),Object.defineProperty(l(n),"handleChange",{configurable:!0,enumerable:!0,writable:!0,value:function(e,t){if(e!==t&&e.length===y.CONFIRMATION_CODE_LENGTH&&n.state.canSubmit){var r=n.props,a=r.user;(0,r.onSubmit)(a.rtsHost,e),n.setState({canSubmit:!1})}}}),Object.defineProperty(l(n),"handleResendClick",{configurable:!0,enumerable:!0,writable:!0,value:function(){var e=n.props.resendConfirmationCode,t=n.props.user,r=t.rtsHost,a=t.phone;n.refs.form.reset(),n.refs.code.input.focus(),e(r,a)}}),n.state={canSubmit:!1,timeToResend:y.RESEND_SMS_DELAY/1e3},n.interval=setInterval(n.timerTick,1e3),n}return u(t,e),i(t,[{key:"componentDidMount",value:function(){this.timerTick()}},{key:"componentWillUnmount",value:function(){clearInterval(this.interval)}},{key:"renderResend",value:function(){var e=this.state.timeToResend;return 0===e?d.default.createElement("p",{className:"registration__desc"},d.default.createElement("span",{className:"registration__desc-link",onClick:this.handleResendClick},d.default.createElement(f.FormattedMessage,{id:"[confirm] resend",defaultMessage:"Resend confirmation code"}))):d.default.createElement("p",{className:"registration__desc"},d.default.createElement(f.FormattedMessage,{id:"[confirm] resend in",defaultMessage:"Confirmation code can be resent in {count} seconds",values:{count:e}}))}},{key:"render",value:function(){var e=this,t=this.props.user,n=(0,m.parse)("+".concat(t.phone)),r=n.country,a=n.phone,o=(0,f.defineMessages)({codeError:{id:"[confirm] code error",defaultMessage:"Please enter valid code"}});return d.default.createElement("div",{className:"registration__step",key:"confirm"},d.default.createElement("p",{className:"registration__desc registration__desc--first"},d.default.createElement(f.FormattedMessage,{id:"[confirm] desc",defaultMessage:"An SMS with a code was sent to the number {number}",values:{number:d.default.createElement("strong",null,(0,m.format)(a,r,"International"))}})),d.default.createElement("h2",{className:"registration__title"},d.default.createElement(f.FormattedMessage,{id:"[confirm] enter",defaultMessage:"Enter a code"})),d.default.createElement("section",{className:"registration__form-wrapper"},d.default.createElement("div",{className:"registration__form"},d.default.createElement(p.Form,{ref:"form",onValid:function(){return e.setState({canSubmit:!0})},onInvalid:function(){return e.setState({canSubmit:!1})},onValidSubmit:this.handleSubmit},d.default.createElement(h.default,{ref:"code",className:"registration__form-row",labelClassName:"form-field registration__form-field",inputClassName:"form-field__input",errorClassName:"registration__desc registration__desc--warning",autoFocus:!0,autoComplete:"off",name:"code",id:"code-input",type:"text",placeholder:"1234",validations:"isNumeric",required:!0,validationError:this.props.intl.formatMessage(o.codeError),tabIndex:"1",onChange:this.handleChange,disabled:t.confirmationLimitExceeded}),this.renderResend(),d.default.createElement("p",{className:"registration__desc"},d.default.createElement("span",{className:"registration__desc-link",onClick:this.props.onResetAuth},d.default.createElement(f.FormattedMessage,{id:"[confirm] wrong",defaultMessage:"Wrong number?"})))))))}}]),t}(d.Component),b=(0,f.injectIntl)(_);t.default=b},"./app/components/Auth/CtsLogin.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){if(!a(e,t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function u(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?d(e):t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),f=n("./node_modules/formsy-react/lib/main.js"),m=n("./node_modules/react-intl/lib/index.es.js"),h=n("./node_modules/libphonenumber-js/index.es6.js"),y=n("./app/modules/user.js"),_=r(n("./app/components/Input.js")),b=r(n("./app/components/Button.js")),v=function(e){function t(e){var n;return s(this,t),n=u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),Object.defineProperty(d(n),"enableButton",{configurable:!0,enumerable:!0,writable:!0,value:function(){n.setState({canSubmit:!0})}}),Object.defineProperty(d(n),"disableButton",{configurable:!0,enumerable:!0,writable:!0,value:function(){n.setState({canSubmit:!1})}}),Object.defineProperty(d(n),"handleCtsLogin",{configurable:!0,enumerable:!0,writable:!0,value:function(){var e=n.state.form.getCurrentValues(),t=e.server,r=e.login,a=e.password,o=e.domain;n.props.onCtsLogin(t,r,a,o)}}),Object.defineProperty(d(n),"handleCtsLogout",{configurable:!0,enumerable:!0,writable:!0,value:function(){var e=n.props.user,t=e.authToken,r=e.rtsHost,a=e.code;n.props.onCtsLogout(t,r,a)}}),Object.defineProperty(d(n),"handleFormRef",{configurable:!0,enumerable:!0,writable:!0,value:function(e){n.state.form||n.setState({form:e})}}),n.state={canSubmit:!1,form:null},n}return l(t,e),c(t,[{key:"renderCtsLogoutMessage",value:function(){var e=this.props.user,t=e.ctsAdminInfo,n=e.authStatus,r=(0,h.parse)("+".concat(e.phone)),a=r.country,o=r.phone;if(t){var s;return p.default.createElement("div",{className:"registration__desc registration__desc--first"},p.default.createElement("strong",{className:"registration__title"},p.default.createElement(m.FormattedMessage,{id:"[cts login] admin contacts",defaultMessage:"Wait for cts logout. Admin contacts:"})),p.default.createElement("div",{className:"registration__desc registration__desc--logout"},p.default.createElement(m.FormattedMessage,{id:"[cts login] admin name",defaultMessage:"Name:"})," ",t.full_name,p.default.createElement("br",null),p.default.createElement(m.FormattedMessage,{id:"[cts login] admin phone",defaultMessage:"Phone:"})," ",t.phone,p.default.createElement("br",null),"Email: ",null===(s=t.emails)||void 0===s?void 0:s.join(),p.default.createElement("br",null)),p.default.createElement("strong",{className:"registration__title"},p.default.createElement(m.FormattedMessage,{id:"[cts login] user contacts",defaultMessage:"You can relogin to corporate server, just fill data:"})))}return[y.authStatusEnum.ctsRegular,y.authStatusEnum.ctsMultidevice].includes(n)?p.default.createElement("h4",{className:"registration__desc registration__desc--first registration__desc--justify"},p.default.createElement(m.FormattedMessage,{id:"[cts login] previous login warning",defaultMessage:"During the previous login you ({number}) were also logged in on the corporate server.",values:{number:p.default.createElement("strong",null,(0,h.format)(o,a,"International"))}}),p.default.createElement("br",null),p.default.createElement("br",null),p.default.createElement(m.FormattedMessage,{id:"[cts login] enter data",defaultMessage:"To continue you must enter corporate data to connect."}),p.default.createElement("br",null),p.default.createElement("br",null),p.default.createElement(m.FormattedMessage,{id:"[cts login] encryption warning",defaultMessage:"If you press logout you will lose access to all corporate chat rooms, channels, and workspaces."})):p.default.createElement("h4",{className:"registration__desc registration__desc--first"},p.default.createElement(m.FormattedMessage,{id:"[cts login] skippable login",defaultMessage:"Please, connect to your corporate server"}))}},{key:"renderSecondButton",value:function(){var e=this,t=this.props,n=t.fetching,r=t.user,a=r.authStatus;return a===y.authStatusEnum.ctsForce?null:a===y.authStatusEnum.ctsOffer?p.default.createElement("button",{type:"button",className:"btn btn--default registration__form-btn",onClick:function(){return e.props.onCtsSkip()},tabIndex:"5",disabled:n},p.default.createElement(m.FormattedMessage,{id:"[cts login] skip",defaultMessage:"Skip"})):p.default.createElement("button",{className:"btn btn--default registration__form-btn",onClick:this.handleCtsLogout,tabIndex:"5",disabled:n},p.default.createElement(m.FormattedMessage,{id:"[cts login] logout",defaultMessage:"Logout"}))}},{key:"render",value:function(){var e=this.props,t=e.fetching,n=e.user,r=(0,m.defineMessages)({url:{id:"[auth] url",defaultMessage:"URL-address"},login:{id:"[auth] login",defaultMessage:"Login"},password:{id:"[auth] password",defaultMessage:"Password"},urlError:{id:"[auth] url error",defaultMessage:"Invalid domain name, example server.com"},domain:{id:"[auth] ad_domain",defaultMessage:"Domain (optional)"}});return p.default.createElement("section",{className:"registration__form-wrapper"},this.renderCtsLogoutMessage(),p.default.createElement("div",{className:"registration__form",key:"cts"},p.default.createElement(f.Form,{ref:this.handleFormRef,onValid:this.enableButton,onInvalid:this.disableButton},p.default.createElement(_.default,{name:"server",type:"text",value:n.ctsServer,disabled:!!n.ctsServer&&n.authStatus===y.authStatusEnum.ctsForce,placeholder:this.props.intl.formatMessage(r.url),className:"registration__form-row",labelClassName:"form-field registration__form-field",inputClassName:"form-field__input",errorClassName:"registration__desc registration__desc--warning",autoFocus:!0,validations:"isDomainName",required:!0,validationError:this.props.intl.formatMessage(r.urlError),showValidationErrorOnBlur:!0,tabIndex:"1"}),p.default.createElement(_.default,{name:"login",type:"text",placeholder:this.props.intl.formatMessage(r.login),className:"registration__form-row",labelClassName:"form-field registration__form-field",inputClassName:"form-field__input",errorClassName:"registration__desc registration__desc--warning",validations:"isExisty",required:!0,tabIndex:"2"}),p.default.createElement(_.default,{name:"password",type:"password",placeholder:this.props.intl.formatMessage(r.password),className:"registration__form-row",labelClassName:"form-field registration__form-field",inputClassName:"form-field__input",errorClassName:"registration__desc registration__desc--warning",validations:"isExisty",required:!0,tabIndex:"3"}),p.default.createElement(_.default,{name:"domain",type:"text",placeholder:this.props.intl.formatMessage(r.domain),className:"registration__form-row",labelClassName:"form-field registration__form-field",inputClassName:"form-field__input",errorClassName:"registration__desc registration__desc--warning",tabIndex:"4"}),p.default.createElement("div",{className:"registration__form-row registration__form-row--button"},p.default.createElement(b.default,{className:"btn btn--default registration__form-btn",type:"submit",disabled:!this.state.canSubmit,tabIndex:"5",isLoading:t,onClick:this.handleCtsLogin},p.default.createElement(m.FormattedMessage,{id:"[cts login] connect",defaultMessage:"Connect"}))),p.default.createElement("div",{className:"registration__form-row registration__form-row--button"},this.renderSecondButton()))))}}]),t}(p.Component),g=(0,m.injectIntl)(v);t.default=g},"./app/components/Auth/CtsWebLogin.js":function(e,t,n){"use strict";function r(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!r(e,t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}function c(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?l(e):t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var d=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),p=n("./node_modules/formsy-react/lib/main.js"),f=n("./node_modules/react-intl/lib/index.es.js"),m=function(e){return e&&e.__esModule?e:{default:e}}(n("./app/components/Input.js")),h=function(e){function t(e){var n;return o(this,t),n=c(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),Object.defineProperty(l(n),"handleCtsWebLogin",{configurable:!0,enumerable:!0,writable:!0,value:function(e){var t=e.login,r=e.password;n.props.onCtsWebLogin(t,r)}}),n.state={canSubmit:!1},n}return u(t,e),i(t,[{key:"render",value:function(){var e=this;return d.default.createElement("section",{className:"registration__form-wrapper"},d.default.createElement("div",{className:"registration__form",key:"cts"},d.default.createElement(p.Form,{onValidSubmit:this.handleCtsWebLogin,onValid:function(){return e.setState({canSubmit:!0})},onInvalid:function(){return e.setState({canSubmit:!1})}},d.default.createElement(m.default,{name:"login",type:"text",placeholder:this.props.intl.formatMessage({id:"[cts login] login"}),className:"registration__form-row",labelClassName:"form-field registration__form-field",inputClassName:"form-field__input",errorClassName:"registration__desc registration__desc--warning",validations:"isExisty",required:!0,tabIndex:"2"}),d.default.createElement(m.default,{name:"password",type:"password",placeholder:this.props.intl.formatMessage({id:"[auth] password",defaultMessage:"Password"}),className:"registration__form-row",labelClassName:"form-field registration__form-field",inputClassName:"form-field__input",errorClassName:"registration__desc registration__desc--warning",validations:"isExisty",required:!0,tabIndex:"3"}),d.default.createElement("div",{className:"registration__form-row registration__form-row--button"},d.default.createElement("button",{className:"btn btn--default registration__form-btn",type:"submit",disabled:!this.state.canSubmit,tabIndex:"4"},d.default.createElement(f.FormattedMessage,{id:"[cts login] connect",defaultMessage:"Connect"}))))))}}]),t}(d.Component),y=(0,f.injectIntl)(h);t.default=y},"./app/components/Auth/KeysDecrypt.js":function(e,t,n){"use strict";function r(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!r(e,t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}function c(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?l(e):t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var d=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),p=n("./node_modules/formsy-react/lib/main.js"),f=n("./node_modules/react-intl/lib/index.es.js"),m=function(e){return e&&e.__esModule?e:{default:e}}(n("./app/components/Input.js")),h=n("./lib/constants.js"),y=function(e){function t(e){var n;return o(this,t),n=c(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),Object.defineProperty(l(n),"enableButton",{configurable:!0,enumerable:!0,writable:!0,value:function(){n.setState({canSubmit:!0})}}),Object.defineProperty(l(n),"disableButton",{configurable:!0,enumerable:!0,writable:!0,value:function(){n.setState({canSubmit:!1})}}),Object.defineProperty(l(n),"handleSubmit",{configurable:!0,enumerable:!0,writable:!0,value:function(e){n.setState({canSubmit:!1}),n.props.onSubmit(e.password)}}),n.state={canSubmit:!1},n}return u(t,e),i(t,[{key:"componentWillUpdate",value:function(e){var t=this.props.user.keysDecryptAttempts;e.user.keysDecryptAttempts<t&&this.refs.form.reset()}},{key:"render",value:function(){var e=this.props.user,t=e.keysDecryptAttempts<h.PRIVATE_KEYS_DECRYPT_ATTEMPTS?d.default.createElement("h2",{className:"registration__title"},d.default.createElement(f.FormattedMessage,{id:"[keysDecrypt] wrong password",defaultMessage:"Wrong password. You got {count} more attempts",values:{count:e.keysDecryptAttempts}})):d.default.createElement("h2",{className:"registration__title"},d.default.createElement(f.FormattedMessage,{id:"[keysDecrypt] caption",defaultMessage:"You got private keys. Enter password"}));return d.default.createElement("div",{className:"registration__step",key:"keys-fetched"},t,d.default.createElement("section",{className:"registration__form-wrapper"},d.default.createElement("div",{className:"registration__form"},d.default.createElement(p.Form,{ref:"form",onValidSubmit:this.handleSubmit,onValid:this.enableButton,onInvalid:this.disableButton},d.default.createElement(m.default,{className:"registration__form-row",labelClassName:"form-field registration__form-field",inputClassName:"form-field__input",errorClassName:"registration__desc registration__desc--warning",autoFocus:!0,autoComplete:"off",name:"password",id:"password-input",type:"password",maxLength:h.MAX_PASSWORD_LENGTH,placeholder:this.props.intl.formatMessage({id:"[auth] password",defaultMessage:"Password"}),required:!0,tabIndex:"1"}),d.default.createElement("div",{className:"registration__form-row registration__form-row--button"},d.default.createElement("button",{className:"btn btn--default registration__form-btn",type:"submit",disabled:!this.state.canSubmit,tabIndex:"2"},d.default.createElement(f.FormattedMessage,{id:"[keysDecrypt] submit",defaultMessage:"Submit"})))))))}}]),t}(d.Component),_=(0,f.injectIntl)(y);t.default=_},"./app/components/Auth/KeysNew.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){if(!a(e,t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function u(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?d(e):t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),f=n("./node_modules/formsy-react/lib/main.js"),m=n("./node_modules/react-intl/lib/index.es.js"),h=r(n("./app/components/Input.js")),y=r(n("./app/components/Button.js")),_=n("./lib/constants.js"),b=function(e){function t(e){var n;return s(this,t),n=u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),Object.defineProperty(d(n),"getConfirmError",{configurable:!0,enumerable:!0,writable:!0,value:function(){var e,t,r=null===(e=n.refs.password)||void 0===e?void 0:e.getValue(),a=null===(t=n.refs.confirm)||void 0===t?void 0:t.getValue(),o=(0,m.defineMessages)({passwordError:{id:"[keysNew] password equal error",defaultMessage:"Passwords should be equal"}});return(null===a||void 0===a?void 0:a.length)>=(null===r||void 0===r?void 0:r.length)-1?n.props.intl.formatMessage(o.passwordError):void 0}}),Object.defineProperty(d(n),"enableButton",{configurable:!0,enumerable:!0,writable:!0,value:function(){n.setState({canSubmit:!0})}}),Object.defineProperty(d(n),"disableButton",{configurable:!0,enumerable:!0,writable:!0,value:function(){n.setState({canSubmit:!1})}}),Object.defineProperty(d(n),"handleSubmit",{configurable:!0,enumerable:!0,writable:!0,value:function(e){n.setState({canSubmit:!1}),n.props.onSubmit(e.password)}}),Object.defineProperty(d(n),"handlePasswordKeyUp",{configurable:!0,enumerable:!0,writable:!0,value:function(){var e=n.refs.password,t=e.refs.password.value,r=t.length>=8?"registration-password-info__item--checked":"",a=/[a-z]/.test(t)?"registration-password-info__item--checked":"",o=/[A-Z]/.test(t)?"registration-password-info__item--checked":"",s=/\d/.test(t)?"registration-password-info__item--checked":"";n.setState({passwordLengthClass:r,passwordLowerClass:a,passwordUpperClass:o,passwordNumericClass:s})}}),n.state={passwordLengthClass:"invalid",passwordLowerClass:"invalid",passwordUpperClass:"invalid",passwordNumericClass:"invalid",canSubmit:!1},n}return l(t,e),c(t,[{key:"render",value:function(){var e=this.props,t=e.keysDecryptAttempts,n=e.fetching,r=this.state,a=r.passwordLengthClass,o=r.passwordLowerClass,s=r.passwordUpperClass,i=r.passwordNumericClass,c=this.getConfirmError(),u=t?p.default.createElement("h2",{className:"registration__title"},p.default.createElement(m.FormattedMessage,{id:"[keysNew] caption generate",defaultMessage:"Seems like you dont have private keys. Lets generate it"})):p.default.createElement("h2",{className:"registration__title"},p.default.createElement(m.FormattedMessage,{id:"[keysNew] caption warning",defaultMessage:"We can generate new private keys. All chats history will be lost!"})),l=(0,m.defineMessages)({confirm:{id:"[keysNew] confirm password",defaultMessage:"Confirm password"}});return p.default.createElement("div",{className:"registration__step",key:"keys-new"},u,p.default.createElement("div",{className:"registration__password-info"},p.default.createElement("ul",{className:"registration-password-info"},p.default.createElement("li",{className:"registration-password-info__item ".concat(a)},p.default.createElement("span",null,p.default.createElement(m.FormattedMessage,{id:"[keysNew] requirements 8 symbols",defaultMessage:"must have at least 8 symbols"}))),p.default.createElement("li",{className:"registration-password-info__item ".concat(o)},p.default.createElement("span",null,p.default.createElement(m.FormattedMessage,{id:"[keysNew] requirements lowercase",defaultMessage:"must have at least one latin lowercase"}))),p.default.createElement("li",{className:"registration-password-info__item ".concat(s)},p.default.createElement("span",null,p.default.createElement(m.FormattedMessage,{id:"[keysNew] requirements uppercase",defaultMessage:"must have at least one latin uppercase"}))),p.default.createElement("li",{className:"registration-password-info__item ".concat(i)},p.default.createElement("span",null,p.default.createElement(m.FormattedMessage,{id:"[keysNew] requirements numeric",defaultMessage:"must have at least one numeric"}))))),p.default.createElement("section",{className:"registration__form-wrapper"},p.default.createElement("div",{className:"registration__form"},p.default.createElement(f.Form,{onValidSubmit:this.handleSubmit,onValid:this.enableButton,onInvalid:this.disableButton},p.default.createElement(h.default,{className:"registration__form-row",labelClassName:"form-field registration__form-field",inputClassName:"form-field__input",errorClassName:"registration__desc registration__desc--warning",autoFocus:!0,autoComplete:"off",name:"password",id:"password-input",type:"password",maxLength:_.MAX_PASSWORD_LENGTH,placeholder:this.props.intl.formatMessage({id:"[auth] password",defaultMessage:"Password"}),validations:"isPrivateKeysPassword",required:!0,ref:"password",tabIndex:"1",onKeyUp:this.handlePasswordKeyUp}),p.default.createElement(h.default,{className:"registration__form-row",labelClassName:"form-field registration__form-field",inputClassName:"form-field__input",errorClassName:"registration__desc registration__desc--warning",autoComplete:"off",name:"confirm",id:"confirm-input",type:"password",maxLength:_.MAX_PASSWORD_LENGTH,placeholder:this.props.intl.formatMessage(l.confirm),validations:"isPasswordConfirmation",required:!0,ref:"confirm",validationError:c,tabIndex:"2"}),p.default.createElement("div",{className:"registration__form-row registration__form-row--button"},p.default.createElement(y.default,{className:"btn btn--default registration__form-btn",type:"submit",disabled:!this.state.canSubmit,tabIndex:"3",isLoading:n},p.default.createElement(m.FormattedMessage,{id:"[keysNew] generate",defaultMessage:"Generate"})))))))}}]),t}(p.Component),v=(0,m.injectIntl)(b);t.default=v},"./app/components/Auth/Locale.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){if(!a(e,t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function u(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?l(e):t}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),f=r(n("./node_modules/flag-icon-css/flags/1x1/ru.svg")),m=r(n("./node_modules/flag-icon-css/flags/1x1/gb.svg")),h=function(e){function t(){return s(this,t),u(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return d(t,e),c(t,[{key:"getFlags",value:function(e,t){var n=this;return Object.keys(e).map(function(r){var a="registration-lang__item ".concat(r===t?"registration-lang__item--selected":"");return p.default.createElement("button",{className:a,key:r,tabIndex:"-1",onClick:function(){return n.props.setLocale(r)}},p.default.createElement("img",{className:"registration-lang__icon",src:e[r],alt:t}))})}},{key:"render",value:function(){var e=this.props.locale,t={ru:f.default,en:m.default};return p.default.createElement("div",{className:"registration-lang"},this.getFlags(t,e))}}]),t}(p.Component),y=h;t.default=y},"./app/components/Auth/Pagination.js":function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}function a(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){if(!a(e,t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function u(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?d(e):t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var p=r(n("./node_modules/react/index.js")),f=r(n("./app/modules/user.js")),m=function(e){function t(){var e,n,r;s(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return u(r,(n=r=u(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),Object.defineProperty(d(r),"renderStepClass",{configurable:!0,enumerable:!0,writable:!0,value:function(e){var t=r.props.user||{},n=t.authStatus,a=t.ctsAuthToken;switch(n){case f.authStatusEnum.unregistered:return 1===e?"registration-navigation__step--current":"";case f.authStatusEnum.confirm:return 2===e?"registration-navigation__step--current":e<2?"registration-navigation__step--ready":"";case f.authStatusEnum.ctsRegular:case f.authStatusEnum.ctsMultidevice:case f.authStatusEnum.ctsRequestLogout:case f.authStatusEnum.emptyKeysPass:case f.authStatusEnum.newKeysPass:return 3===e?"registration-navigation__step--current":e<3?"registration-navigation__step--ready":"";case f.authStatusEnum.keysPassDecrypt:return a&&4===e||!a&&3===e?"registration-navigation__step--current":a&&e<4||!a&&e<3?"registration-navigation__step--ready":"";case f.authStatusEnum.profile:return 4===e?"registration-navigation__step--current":e<4?"registration-navigation__step--ready":"";case f.authStatusEnum.ctsOffer:case f.authStatusEnum.ctsForce:return 5===e?"registration-navigation__step--current":e<5?"registration-navigation__step--ready":"";default:return""}}}),Object.defineProperty(d(r),"renderSteps",{configurable:!0,enumerable:!0,writable:!0,value:function(){var e=r.props.user||{},t=e.authStatus,n=e.active,a=e.wasOnCts,o=[1,2,3];return[f.authStatusEnum.qrCode,f.authStatusEnum.qrMultidevice].includes(t)?null:((![f.authStatusEnum.unregistered,f.authStatusEnum.confirm].includes(t)&&!n||a)&&o.push(4),[f.authStatusEnum.unregistered,f.authStatusEnum.confirm,f.authStatusEnum.ctsRegular,f.authStatusEnum.emptyKeysPass].includes(t)||n||!a||o.push(5),o.map(function(e){return p.default.createElement("div",{key:e,className:"registration-navigation__step ".concat(r.renderStepClass(e))},e)}))}}),n))}return l(t,e),c(t,[{key:"render",value:function(){return p.default.createElement("div",{className:"registration-navigation"},this.renderSteps())}}]),t}(p.Component),h=m;t.default=h},"./app/components/Auth/Phone.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){if(!a(e,t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function u(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?d(e):t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),f=n("./node_modules/formsy-react/lib/main.js"),m=n("./node_modules/react-intl/lib/index.es.js"),h=n("./node_modules/libphonenumber-js/index.es6.js"),y=r(n("./app/components/MaskedInput.js")),_=r(n("./app/components/Button.js")),b=r(n("./lib/config.js")),v=function(e){function t(e){var n;return s(this,t),n=u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),Object.defineProperty(d(n),"enableButton",{configurable:!0,enumerable:!0,writable:!0,value:function(){n.setState({canSubmit:!0})}}),Object.defineProperty(d(n),"disableButton",{configurable:!0,enumerable:!0,writable:!0,value:function(){n.setState({canSubmit:!1})}}),Object.defineProperty(d(n),"handleSubmit",{configurable:!0,enumerable:!0,writable:!0,value:function(e){if(n.state.canSubmit){var t=n.props.user,r=b.default.regions[t.region].prefix,a=r+(0,h.parse)(e.phone,t.region.toUpperCase()).phone;n.props.onSubmit(t.rtsHost,a)}}}),Object.defineProperty(d(n),"handleRegionChange",{configurable:!0,enumerable:!0,writable:!0,value:function(e){n.props.regionChanged(e.target.value),n.refs.form.reset(),n.props.loadServerPublicKeys()}}),Object.defineProperty(d(n),"handleButtonClick",{configurable:!0,enumerable:!0,writable:!0,value:function(){n.setState({validate:!0})}}),Object.defineProperty(d(n),"placeholder",{configurable:!0,enumerable:!0,writable:!0,value:function(e){return"ae"===e?"8 765 4321":"us"===e?"800-765-4321":"988 765-43-21"}}),n.state={canSubmit:!1,validate:!1},n}return l(t,e),c(t,[{key:"componentWillMount",value:function(){this.props.onComponentMount()}},{key:"render",value:function(){var e=this,t=this.props,n=t.user,r=t.fetching,a=b.default.regions[n.region].prefix;return p.default.createElement("div",{className:"registration__step",key:"auth"},p.default.createElement("h2",{className:"registration__title"},p.default.createElement(m.FormattedMessage,{id:"[auth] phone",defaultMessage:"Enter phone number"})),p.default.createElement("section",{className:"registration__form-wrapper"},p.default.createElement("div",{className:"registration__form"},p.default.createElement(f.Form,{ref:"form",onValidSubmit:this.handleSubmit,onValid:this.enableButton,onInvalid:this.disableButton},p.default.createElement("div",{className:"registration__form-row"},p.default.createElement("label",{className:"form-field form-field--select registration__form-field",htmlFor:"region-select"},p.default.createElement("select",{className:"form-field__input",value:n.region,onChange:this.handleRegionChange,tabIndex:"1",id:"region-select",title:n.region},b.default.regions.ru&&p.default.createElement(m.FormattedMessage,{id:"[auth] region russia",defaultMessage:"Russia"},function(e){return p.default.createElement("option",{value:"ru"},e)}),b.default.regions.ae&&p.default.createElement(m.FormattedMessage,{id:"[auth] region ae",defaultMessage:"United Arab Emirates"},function(e){return p.default.createElement("option",{value:"ae"},e)}),b.default.regions.us&&p.default.createElement(m.FormattedMessage,{id:"[auth] region us",defaultMessage:"United States"},function(e){return p.default.createElement("option",{value:"us"},e)})))),p.default.createElement("div",{className:"registration__form-row"},p.default.createElement(y.default,{className:"form-field-tel__number",name:"phone",prefix:a,region:n.region,autoFocus:!0,showPlus:!0,tabIndex:"2",placeholder:this.placeholder(n.region),onKeyDown:function(){return e.setState({validate:!1})},validate:this.state.validate,validations:"isPhoneNumber:".concat(n.region),required:!0,validationError:p.default.createElement(m.FormattedMessage,{id:"[auth] invalid phone",defaultMessage:"Please enter valid phone number"})})),p.default.createElement("div",{className:"registration__form-row registration__form-row--button"},p.default.createElement(_.default,{className:"btn btn--default registration__form-btn",type:"submit",tabIndex:"3",onClick:function(){return e.setState({validate:!0})},isLoading:r},p.default.createElement(m.FormattedMessage,{id:"[auth] authenticate",defaultMessage:"Authenticate"})))))))}}]),t}(p.Component);t.default=v},"./app/components/Auth/Profile.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){if(!a(e,t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function u(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?d(e):t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),f=n("./node_modules/formsy-react/lib/main.js"),m=n("./node_modules/react-intl/lib/index.es.js"),h=r(n("./app/components/Input.js")),y=r(n("./app/components/AvatarUploader.js")),_=r(n("./app/components/Button.js")),b=n("./lib/constants.js"),v=function(e){function t(e){var n;return s(this,t),n=u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),Object.defineProperty(d(n),"enableButton",{configurable:!0,enumerable:!0,writable:!0,value:function(){n.setState({canSubmit:!0})}}),Object.defineProperty(d(n),"disableButton",{configurable:!0,enumerable:!0,writable:!0,value:function(){n.setState({canSubmit:!1})}}),Object.defineProperty(d(n),"handleAvatar",{configurable:!0,enumerable:!0,writable:!0,value:function(e){n.setState({avatar:e})}}),Object.defineProperty(d(n),"handleSubmit",{configurable:!0,enumerable:!0,writable:!0,value:function(){var e=n.state,t=e.name,r=e.avatar;n.setState({canSubmit:!1}),n.props.onSubmit({name:(t||"").trim(),avatar:r})}}),Object.defineProperty(d(n),"handleNameChange",{configurable:!0,enumerable:!0,writable:!0,value:function(e){n.setState({name:e})}}),n.state={avatar:void 0,canSubmit:!1,name:""},n}return l(t,e),c(t,[{key:"render",value:function(){var e=this.props.fetching,t=(0,m.defineMessages)({name:{id:"[profile] name",defaultMessage:"Name"}});return p.default.createElement("div",{className:"registration__step",key:"profile"},p.default.createElement("h2",{className:"registration__title"},p.default.createElement(m.FormattedMessage,{id:"[profile] caption",defaultMessage:"Please set up your name and avatar"})),p.default.createElement("section",{className:"registration__form-wrapper"},p.default.createElement("div",{className:"registration__form"},p.default.createElement(f.Form,{onValidSubmit:this.handleSubmit,onValid:this.enableButton,onInvalid:this.disableButton},p.default.createElement("div",{className:"registration__avatar"},p.default.createElement(y.default,{avatar:this.state.avatar,handleAvatar:this.handleAvatar,width:b.AVATAR_UPLOADER_WIDTH,height:b.AVATAR_UPLOADER_HEIGHT,placeholder:p.default.createElement(m.FormattedHTMLMessage,{id:"[avatar] upload profile",defaultMessage:"Load profile<br/>avatar"})})),p.default.createElement(h.default,{className:"registration__form-row",labelClassName:"form-field registration__form-field",inputClassName:"form-field__input",errorClassName:"registration__desc registration__desc--warning",autoFocus:!0,autoComplete:"off",name:"name",id:"name-input",type:"text",placeholder:this.props.intl.formatMessage(t.name),validations:"isName",required:!0,tabIndex:"1",onChange:this.handleNameChange}),p.default.createElement("div",{className:"registration__form-row registration__form-row--button"},p.default.createElement(_.default,{className:"btn btn--default registration__form-btn",type:"submit",disabled:!this.state.canSubmit,tabIndex:"2",isLoading:e},p.default.createElement(m.FormattedMessage,{id:"[profile] create",defaultMessage:"Create profile"})))))))}}]),t}(p.Component),g=(0,m.injectIntl)(v);t.default=g},"./app/components/Auth/QrCode.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){if(!a(e,t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function u(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?d(e):t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),f=n("./node_modules/react-intl/lib/index.es.js"),m=r(n("./node_modules/qrcode.react/lib/index.js")),h=n("./lib/encryption.js"),y=n("./lib/constants.js"),_=r(n("./app/assets/icons/registration-logo.svg")),b=function(e){function t(e){var n;return s(this,t),n=u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),Object.defineProperty(d(n),"handleGoBack",{configurable:!0,enumerable:!0,writable:!0,value:function(){n.props.onGoBack()}}),n.interval=null,n}return l(t,e),c(t,[{key:"componentDidMount",value:function(){this.props.onSendQrRegisterRequest(),this.interval=setInterval(this.props.onSendQrRegisterRequest,y.REGISTER_REQUEST_LONG_POOL_TIMEOUT)}},{key:"componentWillUnmount",value:function(){this.interval&&clearInterval(this.interval)}},{key:"renderQrCode",value:function(){var e,t=this.props.user.registrationId,n=null===(e=this.props.keys)||void 0===e?void 0:e.public;if(!t||!n)return null;var r={reg_id:t,reg_key:(0,h.toBase64)(n)};return p.default.createElement("div",{className:"registration__qrcode-code"},p.default.createElement(m.default,{value:JSON.stringify(r),level:"L",size:250,renderAs:"svg"}))}},{key:"render",value:function(){return p.default.createElement("div",{className:"registration__step registration__step--qrcode",key:"qrcode"},p.default.createElement("div",{className:"registration__step--qrcode__logo"},p.default.createElement(_.default,{width:"195",height:"168",className:"registration__logo"})),p.default.createElement("div",{className:"registration__step--qrcode__qr"},this.renderQrCode()),p.default.createElement("div",{className:"registration__step--qrcode__text"},p.default.createElement("h2",{className:"registration__title"},p.default.createElement(f.FormattedMessage,{id:"[auth qrcode] title",defaultMessage:"Follow next three steps to authorize with QR code"})),p.default.createElement("div",{className:"registration__desc registration__desc--steps"},p.default.createElement(f.FormattedMessage,{id:"[auth qrcode] 1 step",defaultMessage:"1. Open Express app on your mobile device"}),p.default.createElement(f.FormattedMessage,{id:"[auth qrcode] 2 step",defaultMessage:'2. Open "Settings" page and choose "Express Web"'}),p.default.createElement(f.FormattedMessage,{id:"[auth qrcode] 3 step",defaultMessage:"3. Scan QR code to the right"}))),p.default.createElement("div",{className:"registration__qrcode-wrapper"},p.default.createElement("div",{className:"registration__qrcode-link registration__qrcode-link--back",onClick:this.handleGoBack},p.default.createElement(f.FormattedMessage,{id:"[auth qrcode] back to phone",defaultMessage:"Auth with phone number"}))))}}]),t}(p.Component),v=(0,f.injectIntl)(b);t.default=v},"./app/components/Avatar.js":function(e,t,n){"use strict";function r(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!r(e,t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}function c(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?u(e):t}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var d=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),p=n("./app/helpers/chatsHelpers.js"),f=function(e){function t(){return o(this,t),c(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return l(t,e),i(t,[{key:"render",value:function(){var e=this.props,t=e.avatar,n=e.name,r=e.type,a=e.status,o=t?d.default.createElement("img",{className:"chat-avatar__img",alt:n,src:t}):d.default.createElement("span",{className:"chat-avatar__text chat-avatar__text--".concat(r)},(0,p.getChatShortName)(n));return d.default.createElement("div",{className:"chat-avatar"},d.default.createElement("div",{className:"chat-avatar__inner"},o),"online"===a?d.default.createElement("i",{className:"chat-avatar__status chat-avatar__status--online-".concat(r)}):null)}}]),t}(d.PureComponent);t.default=f},"./app/components/AvatarUploader.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){if(!a(e,t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function u(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?d(e):t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),f=r(n("./node_modules/react-avatar-editor/dist/index.js")),m=r(n("./app/components/InputFileLoader.js")),h=r(n("./app/assets/icons/avatar-uploader.svg")),y=r(n("./app/assets/icons/avatar-uploader-plus.svg")),_=r(n("./app/assets/icons/avatar-uploader-minus.svg")),b=r(n("./app/assets/icons/cross.svg")),v=function(e){function t(){var e,n,r;s(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return u(r,(n=r=u(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),Object.defineProperty(d(r),"state",{configurable:!0,enumerable:!0,writable:!0,value:{width:r.props.width||300,height:r.props.height||300,scale:1.2,border:0,avatar:null,showEditor:!1,borderRadius:200}}),Object.defineProperty(d(r),"handleInput",{configurable:!0,enumerable:!0,writable:!0,value:function(e){r.setState({avatar:e.file,showEditor:!0})}}),Object.defineProperty(d(r),"handleScale",{configurable:!0,enumerable:!0,writable:!0,value:function(){var e=parseFloat(r.refs.scale.value);r.setState({scale:e})}}),Object.defineProperty(d(r),"handleRemove",{configurable:!0,enumerable:!0,writable:!0,value:function(){r.setState({avatar:null,showEditor:!1}),r.props.handleAvatar(void 0)}}),Object.defineProperty(d(r),"handleAvatarChange",{configurable:!0,enumerable:!0,writable:!0,value:function(){var e,t,n=r.state.showEditor,a=n&&(null===(e=r.refs.avatar)||void 0===e?void 0:null===(t=e.getImageScaledToCanvas())||void 0===t?void 0:t.toDataURL());a&&r.props.handleAvatar(a)}}),n))}return l(t,e),c(t,[{key:"componentDidMount",value:function(){this.props.avatar&&this.setState({avatar:this.props.avatar})}},{key:"componentWillReceiveProps",value:function(e){this.props.avatar!==e.avatar&&e.avatar&&!this.state.showEditor&&this.setState({avatar:e.avatar,showEditor:!1})}},{key:"renderAvatar",value:function(e){return[p.default.createElement("div",{key:1,className:"remove-btn remove-btn--fill",onClick:this.handleRemove},p.default.createElement("div",{className:"remove-btn__overlay"}),p.default.createElement(b.default,{className:"btn__icon",width:"46",height:"46"})),p.default.createElement("img",{key:2,className:"avatar-uploader__img avatar-uploader__img--edit",role:"presentation",src:e})]}},{key:"renderEmpty",value:function(){return p.default.createElement("label",{className:"avatar-uploader__label",htmlFor:"avatar-input"},p.default.createElement(h.default,{width:"50",height:"50",className:"avatar-uploader__icon"}),p.default.createElement("span",{className:"avatar-uploader__text"},this.props.placeholder),p.default.createElement(m.default,{id:"avatar-input",className:"avatar-input",accept:"image/*",onSuccess:this.handleInput,output:"base64"}))}},{key:"renderPreview",value:function(){var e=this.state.avatar;return p.default.createElement("div",{className:"avatar-uploader"},e?this.renderAvatar(e):this.renderEmpty())}},{key:"renderEditor",value:function(){return p.default.createElement("div",{className:"registration__avatar chat-avatar-editor"},p.default.createElement(f.default,{ref:"avatar",image:this.state.avatar,width:this.state.width,height:this.state.height,scale:this.state.scale,color:[255,255,255,.6],border:this.state.border,borderRadius:this.state.borderRadius,onImageReady:this.handleAvatarChange,onImageChange:this.handleAvatarChange}),p.default.createElement("button",{className:"btn chat-avatar-editor__remove",onClick:this.handleRemove},p.default.createElement(b.default,{className:"btn__icon",width:"24",height:"24"})),p.default.createElement("div",{className:"chat-avatar-editor__rage"},p.default.createElement("div",{className:"chat-avatar-range"},p.default.createElement(_.default,{width:"50",height:"50",className:"chat-avatar-range__icon chat-avatar-range__icon--minus"}),p.default.createElement("input",{className:"chat-avatar-range__scale",type:"range",ref:"scale",onChange:this.handleScale,min:"1",max:"2",step:"0.01",defaultValue:"1.2"}),p.default.createElement(y.default,{width:"50",height:"50",className:"chat-avatar-range__icon chat-avatar-range__icon--plus"}))))}},{key:"render",value:function(){return this.state.showEditor?this.renderEditor():this.renderPreview()}}]),t}(p.Component);t.default=v},"./app/components/Button.js":function(e,t,n){"use strict";function r(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(){return o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},o.apply(this,arguments)}function s(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function i(e,t){if(!r(e,t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t,n){return t&&c(e.prototype,t),n&&c(e,n),e}function l(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?d(e):t}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var f=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),m=function(e){return e&&e.__esModule?e:{default:e}}(n("./app/assets/icons/loader.svg")),h=function(e){function t(){return i(this,t),l(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p(t,e),u(t,[{key:"render",value:function(){var e=this.props,t=e.overlayClassName,n=e.isLoading,r=e.children,a=e.disabled,i=s(e,["overlayClassName","isLoading","children","disabled"]);return f.default.createElement("button",o({},i,{disabled:n||a}),r,n&&f.default.createElement("div",{className:t||"btn__loader-overlay"},f.default.createElement(m.default,{className:"btn__loader-icon",width:"17",height:"17"})))}}]),t}(f.PureComponent);t.default=h},"./app/components/Chats/Botx/BotMessageEntry.js":function(e,t,n){"use strict";function r(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!r(e,t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}function c(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?u(e):t}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var d=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),p=function(e){return e&&e.__esModule?e:{default:e}}(n("./node_modules/sanitize-html/dist/index.js")),f=n("./node_modules/react-contextmenu/es6/index.js"),m=n("./app/helpers/reactHelpers.js"),h=n("./app/helpers/appHelpers.js"),y=n("./app/helpers/messagesHelpers.js"),_=function(e){function t(){return o(this,t),c(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return l(t,e),i(t,[{key:"shouldComponentUpdate",value:function(e){var t=["message","locale","showDateSplitter","active"];return(0,m.isShouldComponentUpdate)(this.props,e,t)}},{key:"renderDateSplitter",value:function(){var e=this.props.message;return d.default.createElement("div",{className:"chat-message__date-splitter"},(0,h.formatDateSplitter)(e.payload.timestamp,this.props.locale))}},{key:"renderBotxMessageBubble",value:function(){var e=this.props,t=e.message,n=e.botxContextMenuId,r=e.botxContextMenuOnItemClick,a=t.payload.timestamp.locale(this.props.locale),o=(0,y.hasBotActions)(t)?"chat-message__bubble--link":"",s=d.default.createElement("div",{className:["chat-message__bubble",o].join(" ")},d.default.createElement("div",{className:"chat-message-botx",dangerouslySetInnerHTML:{__html:(0,p.default)(t.payload.body)}}),d.default.createElement("div",{className:"chat-message__meta"},d.default.createElement("span",{className:"chat-message__timestamp",title:a.format("Do MMMM YYYY, HH:mm:ss")},a.format("HH:mm"))));return(0,y.hasBotActions)(t)?d.default.createElement(f.ContextMenuTrigger,{id:n,key:t.sync_id,holdToDisplay:0,collect:function(){return{message:t,onItemClick:r}}},s):s}},{key:"render",value:function(){var e=this.props,t=e.showDateSplitter,n=e.active,r=n?"chat-message--active":"";return d.default.createElement("div",{className:"chat-message-row"},t?d.default.createElement("div",{className:"chat-message-row__splitter"},this.renderDateSplitter()):null,d.default.createElement("div",{className:["chat-message",r].join(" ")},this.renderBotxMessageBubble()))}}]),t}(d.Component);t.default=_},"./app/components/Chats/Botx/BotxContextMenu.js":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectedBotxContextMenu=t.BOTX_CONTEXT_MENU=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(n("./node_modules/react/index.js")),a=n("./node_modules/react-contextmenu/es6/index.js");t.BOTX_CONTEXT_MENU="BOTX_CONTEXT_MENU";var o=function(e){var t,n,o=e.id,s=e.trigger,i=e.onShow,c=e.onHide,u=s||{},l=u.message,d=u.onItemClick,p=null===l||void 0===l?void 0:null===(t=l.payload)||void 0===t?void 0:null===(n=t.actions)||void 0===n?void 0:n.map(function(e,t){return r.default.createElement(a.MenuItem,{key:t,onClick:d,data:{action:e}},r.default.createElement("div",{className:"dropdown-menu__item"},r.default.createElement("span",null,e.label)))});return r.default.createElement(a.ContextMenu,{className:"dropdown-menu",id:o,onShow:i,onHide:c},p||r.default.createElement("div",null))},s=(0,a.connectMenu)("BOTX_CONTEXT_MENU")(o);t.ConnectedBotxContextMenu=s},"./app/components/Chats/ChatContactPicker.js":function(e,t,n){"use strict";(function(e){function r(e){return e&&e.__esModule?e:{default:e}}function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}function o(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){c(e,t,n[t])})}return e}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e,t){if(!o(e,t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e,t,n){return t&&l(e.prototype,t),n&&l(e,n),e}function p(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?m(e):t}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function m(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var h=a(n("./node_modules/react/index.js")),y=n("./node_modules/react-intl/lib/index.es.js"),_=a(n("./node_modules/text-encoding/index.js")),b=n("./app/helpers/phonebookHelpers.js"),v=r(n("./app/components/SearchFiltersPanel.js")),g=r(n("./app/components/Contacts/PhonebookEntry.js")),E=n("./lib/reactIntl.js"),S=n("./app/helpers/appHelpers.js"),O=function(t){function n(t){var r;return u(this,n),r=p(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t)),Object.defineProperty(m(r),"handleSendEntry",{configurable:!0,enumerable:!0,writable:!0,value:function(t){var n=(0,b.entryToVcard)(t),a=e.TextEncoder||_.TextEncoder,o=new a("utf-8").encode(n),s={contact:t,vcard:{name:"".concat(t.entry_id,".vcard"),type:"text/vcard",file:o}};r.props.onSuccess("contact",s),r.props.toggleModal(!1)}}),Object.defineProperty(m(r),"handleSearchChange",{configurable:!0,enumerable:!0,writable:!0,value:function(e){var t=e.target.value.trim().toLowerCase();r.setState(i({},r.state,{searchText:t}))}}),Object.defineProperty(m(r),"renderEntry",{configurable:!0,enumerable:!0,writable:!0,value:function(e){return h.default.createElement(g.default,{entry:e,key:e.entry_id},h.default.createElement("button",{className:"btn btn--submit phonebook-entry__btn phonebook-entry__btn--".concat(e.conn_type),onClick:function(){return r.handleSendEntry(e)}},h.default.createElement(y.FormattedMessage,{id:"[send contact dlg] send",defaultMessage:"SEND"})))}}),r.state={searchText:"",filter:"all"},r}return f(n,t),d(n,[{key:"renderEntries",value:function(){var e=this.props.phonebook,t=this.state,n=t.searchText,r=t.filter;return e.filter(function(e){return(0,S.matchMultiText)(e.name,n)||e.contact&&e.contact.includes(null===n||void 0===n?void 0:n.replace("+",""))}).filter(function(e){return"all"===r||r===e.conn_type}).map(this.renderEntry)}},{key:"render",value:function(){var e=this,t=(0,y.defineMessages)({data:{id:"[send contact dlg] placeholder",defaultMessage:"Find contact"}});return h.default.createElement("div",{className:"contact-picker"},h.default.createElement("div",{className:"contact-picker__header"},h.default.createElement(v.default,{name:"contact-picker",placeholder:(0,E.formatMessage)(t.data),onButtonClick:function(t){return e.setState({filter:t})},onInputChange:function(t){return e.setState({searchText:t})}})),h.default.createElement("div",{className:"contact-picker__body"},h.default.createElement("div",{className:"chat__infinite-scroll chat__infinite-scroll--contact-picker chat__infinite-scroll--overflow"},this.renderEntries())))}}]),n}(h.Component);t.default=O}).call(t,n("./node_modules/webpack/buildin/global.js"))},"./app/components/Chats/ChatDocumentFile.js":function(e,t,n){"use strict";function r(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!r(e,t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}function c(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?l(e):t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var d=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),p=n("./node_modules/react-intl/lib/index.es.js"),f=function(e){return e&&e.__esModule?e:{default:e}}(n("./app/assets/icons/loader.svg")),m=n("./app/helpers/attachmentHelpers.js"),h=function(e){function t(e){var n;return o(this,t),n=c(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),Object.defineProperty(l(n),"handleLoadAttachement",{configurable:!0,enumerable:!0,writable:!0,value:function(){var e=n.props,t=e.file,r=e.loadAttachment;t.isLoaded||(n.setState({isLoading:!0}),r())}}),n.state={isLoading:!1},n}return u(t,e),i(t,[{key:"render",value:function(){var e=this.props.file,t=this.state.isLoading,n=(0,m.getFileIcon)(e.mimetype);return d.default.createElement("div",{className:"attachment-document",onClick:this.handleLoadAttachement},d.default.createElement("div",{className:"attachment-document__icon"},d.default.createElement(n,null)),d.default.createElement("div",{className:"attachment-document__filename"},e.filename),t&&!e.isLoaded&&d.default.createElement("div",{className:"attachment-document__loader"},d.default.createElement(f.default,{className:"btn__loader-icon",width:"16",height:"16"})),e.isLoaded&&d.default.createElement("a",{className:"attachment-document__download",href:e.url,download:e.filename},d.default.createElement(p.FormattedMessage,{id:"[attachment] download",defaultMessage:"download"})))}}]),t}(d.Component);t.default=h},"./app/components/Chats/ChatHeader.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){if(!a(e,t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function u(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?d(e):t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),f=n("./node_modules/react-router-dom/es/index.js"),m=n("./node_modules/react-intl/lib/index.es.js"),h=r(n("./node_modules/history/createHashHistory.js")),y=r(n("./app/components/Avatar.js")),_=r(n("./app/components/App/UserPresence.js")),b=r(n("./app/components/App/ChatPresence.js")),v=r(n("./app/components/App/ChatTyping.js")),g=r(n("./app/assets/icons/phone.svg")),E=r(n("./app/assets/icons/search.svg")),S=n("./app/helpers/reactHelpers.js"),O=(0,h.default)(),C=function(e){function t(){var e,n,r;s(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return u(r,(n=r=u(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),Object.defineProperty(d(r),"isChatActive",{configurable:!0,enumerable:!0,writable:!0,value:function(e){return e.active&&!e.left}}),Object.defineProperty(d(r),"handleChatClick",{configurable:!0,enumerable:!0,writable:!0,value:function(){var e=r.props.chat;r.isChatActive(e)&&O.push("/chats/".concat(e.group_chat_id,"/settings"))}}),n))}return l(t,e),c(t,[{key:"shouldComponentUpdate",value:function(e){var t=["chat","user.huid","callOfferAllowed"];return(0,S.isShouldComponentUpdate)(this.props,e,t)}},{key:"renderChatInfo",value:function(){var e=this.props,t=e.chat,n=e.user;if(t.typing)return p.default.createElement(v.default,{className:"chat-user-typing",chat:t});var r=t.statuses.find(function(e){return e.user_huid!==n.huid});return p.default.createElement(_.default,{className:"user-status",status:null===r||void 0===r?void 0:r.status,statusChanged:null===r||void 0===r?void 0:r.status_changed})}},{key:"renderGroupchatInfo",value:function(){var e=this.props.chat;return e.typing?p.default.createElement(v.default,{className:"chat-user-typing",chat:e,namesNumber:3}):p.default.createElement(b.default,{className:"user-status",chat:e})}},{key:"renderInfo",value:function(){var e=this.props.chat;return"botx"===e.chat_type?p.default.createElement(m.FormattedMessage,{id:"[chat header] bot",defaultMessage:"Bot"}):"chat"===e.chat_type?this.renderChatInfo():this.renderGroupchatInfo()}},{key:"renderTitle",value:function(){var e=this.props.chat,t=p.default.createElement(y.default,{name:e.name,avatar:e.avatar,type:e.members_type}),n=p.default.createElement("div",{className:this.isChatActive(e)?"chat__title chat__title--link":"chat__title",title:e.name,onClick:this.handleChatClick},e.name);return this.isChatActive(e)?p.default.createElement(f.Link,{className:"chat__title-wrapper",to:"/chats/".concat(e.group_chat_id,"/settings")},t,n):p.default.createElement("div",{className:"chat__title-wrapper"},t,n)}},{key:"renderActions",value:function(){var e=this.props,t=e.chat,n=e.onCallClick,r=e.callOfferAllowed,a=e.onToggleSearchChatHistory,o="chat"===t.chat_type&&this.isChatActive(t);return p.default.createElement("span",null,p.default.createElement("button",{className:"btn btn--layout-call",onClick:a},p.default.createElement(E.default,{width:"24",height:"24",className:"btn__icon"})),o&&p.default.createElement("button",{className:"btn btn--layout-call",disabled:!r,onClick:function(){return n({video:!1,audio:!0})}},p.default.createElement(g.default,{width:"24",height:"24",className:"btn__icon"})))}},{key:"render",value:function(){return this.props.chat?p.default.createElement("div",{className:"chat__header"},this.renderTitle(),p.default.createElement("div",{className:"chat__info"},this.renderInfo()),p.default.createElement("div",{className:"chat__settings"},this.renderActions())):null}}]),t}(p.Component);t.default=C},"./app/components/Chats/ChatHistorySearch.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){if(!a(e,t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function u(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?d(e):t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),f=r(n("./node_modules/moment/moment.js")),m=r(n("./app/components/SearchInput.js")),h=r(n("./app/components/Avatar.js")),y=r(n("./app/components/App/ConnTypeIcon.js")),_=n("./app/helpers/appHelpers.js"),b=function(e){function t(){var e,n,r;s(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return u(r,(n=r=u(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),Object.defineProperty(d(r),"renderResult",{configurable:!0,enumerable:!0,writable:!0,value:function(){var e=r.props.locale,t="Angelina Jolie";return p.default.createElement("div",{className:"chat-entry"},p.default.createElement(h.default,{name:t,type:"cts",avatar:"https://c.tribune.com.pk/2017/11/angelina-1512029120.jpg"}),p.default.createElement("div",{className:"chat-entry__info"},p.default.createElement("div",{className:"chat-entry__info-row"},p.default.createElement(y.default,{className:"conn-type-icon",name:"entry",width:"12",height:"12",connType:"cts",isBot:!1}),p.default.createElement("span",{className:"chat-entry__title chat-entry__title--name"},t),p.default.createElement("span",{className:"chat-entry__time"},(0,_.formatDateTime)((0,f.default)(),e))),p.default.createElement("div",{className:"chat-entry__info-row"},p.default.createElement("div",{className:"chat-entry__event chat-entry__event--multiline"},p.default.createElement("span",null,"   ",p.default.createElement("span",{className:"chat-entry__event--highlight"},"  "),"         ")))))}}),n))}return l(t,e),c(t,[{key:"componentDidMount",value:function(){var e;null===(e=document.getElementById("search-input"))||void 0===e||e.focus()}},{key:"componentWillUnmount",value:function(){this.props.onTextChange("")}},{key:"render",value:function(){var e=this.props,t=e.chat,n=e.text,r=e.onTextChange,a=e.onClose;return p.default.createElement("div",{className:"layout-pane__body layout-pane__body--br"},p.default.createElement("div",{className:"layout-pane__search"},p.default.createElement(m.default,{chips:null===t||void 0===t?void 0:t.name,text:n,onInputChange:r,onRemoveChips:a})),p.default.createElement("div",{className:"layout-pane__chat-list"},this.renderResult(),this.renderResult()))}}]),t}(p.Component);t.default=b},"./app/components/Chats/ChatInput.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){if(!a(e,t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function u(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?d(e):t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),f=r(n("./node_modules/lodash/debounce.js")),m=n("./node_modules/react-intl/lib/index.es.js"),h=r(n("./app/components/AttachManager.js")),y=n("./lib/constants.js"),_=n("./app/modules/ui.js"),b=r(n("./app/components/App/DropdownMenu.js")),v=r(n("./app/assets/icons/attachment.svg")),g=r(n("./app/assets/icons/send.svg")),E=r(n("./app/assets/icons/botx.svg")),S=n("./app/helpers/reactHelpers.js"),O=n("./app/helpers/chatsHelpers.js"),C=n("./lib/deepEqual.js"),w=n("./lib/reactIntl.js"),j=function(e){function t(e){var n;return s(this,t),n=u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),Object.defineProperty(d(n),"clearTypingTimeout",{configurable:!0,enumerable:!0,writable:!0,value:function(){n.typingTimeout&&(clearTimeout(n.typingTimeout),n.typingTimeout=null)}}),Object.defineProperty(d(n),"handleInput",{configurable:!0,enumerable:!0,writable:!0,value:function(e){var t=e.target.innerText.trim(),r=n.props,a=r.chat,o=r.onMemberTyping,s=0===t.length;if(s||n.resetTypingTimeout(),!s&&!n.isTyping)return n.isTyping=!0,void o(a.group_chat_id,n.isTyping);s&&n.isTyping&&(n.isTyping=!1,n.clearTypingTimeout(),o(a.group_chat_id,n.isTyping))}}),Object.defineProperty(d(n),"textChangedDebouncer",{configurable:!0,enumerable:!0,writable:!0,value:(0,f.default)(function(e){n.props.onInputTextChanged(e)},200)}),Object.defineProperty(d(n),"handleKeyUp",{configurable:!0,enumerable:!0,writable:!0,value:function(){var e,t;n.textChangedDebouncer(null===(e=n.input)||void 0===e?void 0:null===(t=e.innerText)||void 0===t?void 0:t.trim())}}),Object.defineProperty(d(n),"handleKeyDown",{configurable:!0,enumerable:!0,writable:!0,value:function(e){13!==e.keyCode||e.shiftKey||(e.preventDefault(),n.handleSendMessage())}}),Object.defineProperty(d(n),"handleSendMessage",{configurable:!0,enumerable:!0,writable:!0,value:function(){var e,t,r=null===(e=n.input)||void 0===e?void 0:null===(t=e.innerText)||void 0===t?void 0:t.trim(),a=n.props,o=a.onMessage,s=a.onMemberTyping,i=a.chat;r&&""!==r&&(n.isTyping=!1,n.input.innerText="",n.clearTypingTimeout(),s(i.group_chat_id,n.isTyping),o(r))}}),Object.defineProperty(d(n),"handleSendAttachment",{configurable:!0,enumerable:!0,writable:!0,value:function(e,t){n.props.onAttachment(e,t)}}),Object.defineProperty(d(n),"handleInputRef",{configurable:!0,enumerable:!0,writable:!0,value:function(e){e&&(n.input=e,n.input.focus())}}),Object.defineProperty(d(n),"resetTypingTimeout",{configurable:!0,enumerable:!0,writable:!0,value:function(){var e=n.props,t=e.chat,r=e.onMemberTyping;n.clearTypingTimeout(),n.typingTimeout=setTimeout(function(){n.isTyping=!1,n.typingTimeout=null,r(t.group_chat_id,!1)},y.STILL_TYPING_TIMEOUT)}}),Object.defineProperty(d(n),"handleBotxHelper",{configurable:!0,enumerable:!0,writable:!0,value:function(e){n.setState({botxHelperOpened:!1}),n.props.onMessage(e)}}),n.state={botxHelperOpened:!1},n.isTyping=!1,n.typingTimeout=null,n.input=null,n}return l(t,e),c(t,[{key:"componentDidMount",value:function(){this.input&&(this.input.innerText=this.props.chat.draft||"",(0,O.appendCaret)(this.input))}},{key:"componentWillReceiveProps",value:function(e){var t,n=e.chat,r=e.chatUi,a=r.state===_.chatState.switchChat&&n.group_chat_id!==this.props.chat.group_chat_id,o=!(null===(t=this.input)||void 0===t?void 0:t.innerText)&&[_.chatState.initLoading,_.chatState.idle].includes(r.state);this.input&&(a||o)&&(this.input.innerText=n.draft||"",(0,O.appendCaret)(this.input)),this.input&&a&&this.input.focus()}},{key:"shouldComponentUpdate",value:function(e,t){return(0,S.isShouldComponentUpdate)(this.props,e,["chat","chatUi.state"])||!(0,C.equal)(this.state,t)}},{key:"renderAttachMenu",value:function(){var e=this.props,t=e.chat,n=e.phonebook,r=e.user;return t&&p.default.createElement(h.default,{onSuccess:this.handleSendAttachment,phonebook:n,user:r})}},{key:"renderBotxHelper",value:function(){var e=this;return this.state.botxHelperOpened?p.default.createElement("div",{className:"botx-helper"},p.default.createElement("div",{className:"botx-helper__item",onClick:function(){return e.handleBotxHelper("start")}},p.default.createElement("strong",{className:"botx-helper__title"},"start"),p.default.createElement(m.FormattedMessage,{id:"[chat input] chat with bot",defaultMessage:"Begin chat with bot"})),p.default.createElement("div",{className:"botx-helper__item",onClick:function(){return e.handleBotxHelper("help")}},p.default.createElement("strong",{className:"botx-helper__title"},"help"),p.default.createElement(m.FormattedMessage,{id:"[chat input] help",defaultMessage:"Help"}))):null}},{key:"render",value:function(){var e=this,t=this.props.chat,n=p.default.createElement("button",{className:"btn btn--chat-input"},p.default.createElement(v.default,{className:"btn__icon",width:"24",height:"24"}));if(t&&(t.left||!t.active))return p.default.createElement("div",{className:"chat-input chat-input--inactive"},p.default.createElement(m.FormattedMessage,{id:"[chat input] disabled",defaultMessage:"You can't send messages because you are not member of this chat anymore"}));var r=(0,m.defineMessages)({data:{id:"[chat input] placeholder",defaultMessage:"Message"}});return p.default.createElement("div",{className:"chat-input-wrapper"},this.renderBotxHelper(),p.default.createElement("div",{className:"chat-input"},p.default.createElement("span",{className:"chat-input__attach-btn"},p.default.createElement(b.default,{className:"dropdown-menu dropdown-menu--chat-attach",trigger:n,align:{y:"top"}},this.renderAttachMenu())),p.default.createElement("div",{className:"chat-input__message-field ".concat("botx"===t.chat_type?"chat-input__message-field--multiple":""),contentEditable:!0,ref:this.handleInputRef,placeholder:(0,w.formatMessage)(r.data),onKeyDown:this.handleKeyDown,onKeyUp:this.handleKeyUp,onInput:this.handleInput}),p.default.createElement("div",{className:"chat-input__actions"},"botx"===t.chat_type?p.default.createElement("button",{className:"btn btn--chat-input chat-input__action-btn",onClick:function(){return e.setState({botxHelperOpened:!e.state.botxHelperOpened})}},p.default.createElement(E.default,{className:"btn__icon",width:"24",height:"24"})):null,p.default.createElement("button",{className:"btn btn--chat-input chat-input__action-btn chat-input__action-btn--primary",onClick:function(){return e.handleSendMessage()}},p.default.createElement(g.default,{className:"btn__icon",width:"24",height:"24"})))))}}]),t}(p.Component);t.default=j},"./app/components/Chats/ChatListEntry.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){if(!a(e,t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function u(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?d(e):t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),f=n("./node_modules/react-router-dom/es/index.js"),m=n("./node_modules/react-intl/lib/index.es.js"),h=r(n("./app/components/Chats/List/LastEvent.js")),y=n("./app/helpers/reactHelpers.js"),_=n("./app/helpers/appHelpers.js"),b=r(n("./app/components/Avatar.js")),v=r(n("./app/components/App/ConnTypeIcon.js")),g=r(n("./app/components/App/ChatTyping.js")),E=r(n("./app/assets/icons/mute-on.svg")),S=function(e){function t(){var e,n,r;s(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return u(r,(n=r=u(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),Object.defineProperty(d(r),"chatTimestamp",{configurable:!0,enumerable:!0,writable:!0,value:function(){var e,t=r.props.chat,n=t.lastEvent;return n?(null===(e=n.payload)||void 0===e?void 0:e.timestamp)||n.inserted_at:t.inserted_at}}),n))}return l(t,e),c(t,[{key:"shouldComponentUpdate",value:function(e){var t=["locale","active","contextMenuShowed","chat.typing","chat.unreadCounter","chat.members_type","chat.name","chat.avatar","chat.lastEvent","chat.draft","chat.chat_settings","chat.statuses"];return(0,y.isShouldComponentUpdate)(this.props,e,t)}},{key:"render",value:function(){var e,t,n=this.props,r=n.chat,a=n.locale,o=n.active,s=n.contextMenuShowed,i=o?"chat-entry--active":"",c=r.unreadCounter?"chat-entry__time--".concat(r.connType,"-unread"):"",u=s?"chat-entry--focus":null,l="chat"===r.chat_type?null===(e=r.statuses)||void 0===e?void 0:null===(t=e[0])||void 0===t?void 0:t.status:null,d=r.unreadCounter?p.default.createElement("span",{className:"chat-entry__counter chat-entry__counter--".concat(r.members_type)},r.unreadCounter):null;return p.default.createElement(f.Link,{className:["chat-entry",i,u].join(" "),to:"/chats/".concat(r.group_chat_id),onClick:this.props.onClick},p.default.createElement(b.default,{name:r.name,type:r.members_type,avatar:r.avatar,status:l}),p.default.createElement("div",{className:"chat-entry__info"},p.default.createElement("div",{className:"chat-entry__info-row"},p.default.createElement(v.default,{className:"conn-type-icon",name:"entry",width:"12",height:"12",connType:r.members_type,isBot:"botx"===r.chat_type}),"group_chat"===r.chat_type?p.default.createElement("span",{className:"chat-entry__title chat-entry__title--type"},p.default.createElement(m.FormattedMessage,{id:"[chat entry] groupchat",defaultMessage:"Group chat"})):p.default.createElement("span",{className:"chat-entry__title chat-entry__title--name"},r.name),p.default.createElement("span",{className:"chat-entry__time ".concat(c)},(0,_.formatDateTime)(this.chatTimestamp(),a))),"group_chat"===r.chat_type?p.default.createElement("div",{className:"chat-entry__info-row"},p.default.createElement("span",{className:"chat-entry__title chat-entry__title--name"},r.name)):null,p.default.createElement("div",{className:"chat-entry__info-row"},r.typing?p.default.createElement(g.default,{className:"chat-entry-typing",chat:r,namesNumber:2}):p.default.createElement(h.default,this.props),r.chat_settings.dnd?p.default.createElement(E.default,{width:"12",height:"12",className:"chat-entry__mute"}):null,d)))}}]),t}(p.Component);t.default=S},"./app/components/Chats/ChatMediaGallery.js":function(e,t,n){"use strict";function r(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){return c(e)||i(e,t)||s()}function s(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function i(e,t){var n=[],r=!0,a=!1,o=void 0;try{for(var s,i=e[Symbol.iterator]();!(r=(s=i.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==i.return||i.return()}finally{if(a)throw o}}return n}function c(e){if(Array.isArray(e))return e}function u(e,t){if(!r(e,t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e,t,n){return t&&l(e.prototype,t),n&&l(e,n),e}function p(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?m(e):t}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function m(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var h=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),y=function(e){return e&&e.__esModule?e:{default:e}}(n("./node_modules/react-image-lightbox/dist/main.js")),_=function(e){function t(e){var n;return u(this,t),n=p(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),Object.defineProperty(m(n),"getMediaType",{configurable:!0,enumerable:!0,writable:!0,value:function(e){return o(e.mimetype.match("^([^/]+)")||[],2)[1]||"image"}}),Object.defineProperty(m(n),"closeModal",{configurable:!0,enumerable:!0,writable:!0,value:function(){n.setState({modalIsOpen:!1})}}),Object.defineProperty(m(n),"openModal",{configurable:!0,enumerable:!0,writable:!0,value:function(e){n.setState({modalIsOpen:!0,mediaIndex:e})}}),Object.defineProperty(m(n),"loadAttachment",{configurable:!0,enumerable:!0,writable:!0,value:function(e){e.isLoaded||n.props.loadAttachment(e.sync_id)}}),n.state={modalIsOpen:!1,mediaIndex:0},n}return f(t,e),d(t,[{key:"render",value:function(){var e=this,t=this.props.files,n=this.state.mediaIndex,r=(n+1)%t.length,a=(n+t.length-1)%t.length,o=t[r]||{},s=t[a]||{},i=t[n],c=(null===i||void 0===i?void 0:i.isLoaded)?i.url:"",u=this.getMediaType,l="media-lightbox ".concat((null===i||void 0===i?void 0:i.isLoaded)?" media-lightbox--loaded":"");return h.default.createElement("div",{className:"attachment"},t.map(function(t,n){return h.default.createElement("div",{className:"attachment__item",key:t.sync_id},h.default.createElement("div",{className:"attachment-media attachment-media--".concat(t.mimetype.includes("video")?"video":"image"),onClick:function(){return e.openModal(n)},style:{backgroundImage:"url(".concat(t.preview_url,")")}}))}),this.state.modalIsOpen&&h.default.createElement(y.default,{wrapperClassName:l,enableZoom:!1,mainSrc:c,prevSrc:i.preview_url,nextSrc:i.preview_url,mainType:u(i),prevType:u(s),nextType:u(o),onAfterOpen:function(){return e.loadAttachment(i)},onCloseRequest:this.closeModal,onMovePrevRequest:function(){e.loadAttachment(s),e.setState({mediaIndex:a})},onMoveNextRequest:function(){e.loadAttachment(o),e.setState({mediaIndex:r})}}))}}]),t}(h.Component);t.default=_},"./app/components/Chats/InfiniteScroll.js":function(e,t,n){"use strict";function r(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!r(e,t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}function c(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?l(e):t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var d=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),p=n("./node_modules/lodash/lodash.js"),f=n("./lib/constants.js"),m=function(e){function t(e){var n;return o(this,t),n=c(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),Object.defineProperty(l(n),"isScrolledFromBottom",{configurable:!0,enumerable:!0,writable:!0,value:function(){var e=n.scrollDiv;return e.scrollHeight-e.offsetHeight-(n.scrollPosition||0)>f.CHAT_SCROLL_FROM_BOTTOM_OFFSET&&null!==n.scrollPosition}}),Object.defineProperty(l(n),"clearListeners",{configurable:!0,enumerable:!0,writable:!0,value:function(e,t){e.removeEventListener("load",t),e.removeEventListener("error",t)}}),Object.defineProperty(l(n),"handleImgsLoaded",{configurable:!0,enumerable:!0,writable:!0,value:function(){var e=n.props.chatId,t=n.scrollDiv.getElementsByTagName("img"),r=[];return 0===t.length?Promise.reject():((0,p.forEach)(t,function(e){!e.attributes.loaded&&e.src&&(e.setAttribute("loaded",1),r.push(new Promise(function(t){var r=function r(){n.clearListeners(e,r),t()};e.addEventListener("load",r),e.addEventListener("error",r)})))}),0===r.length?Promise.reject():Promise.all(r).then(function(){var t=n.props.chatId;return e&&t&&e!==t?Promise.reject():Promise.resolve()}))}}),Object.defineProperty(l(n),"handleScroll",{configurable:!0,enumerable:!0,writable:!0,value:function(e){var t=n.props,r=t.loadPrevious,a=t.disableScroll,o=t.onScroll,s=e.target,i=s.scrollTop,c=s.scrollHeight,u=s.offsetHeight;n.scrollPosition=c-u-i<f.CHAT_SCROLL_FROM_BOTTOM_OFFSET?null:i,!a&&i<f.CHAT_BEGIN_LOADING_OFFSET&&r(),o(n.isScrolledFromBottom()?e.target.scrollTop:"bottom")}}),Object.defineProperty(l(n),"handleRefScrollDiv",{configurable:!0,enumerable:!0,writable:!0,value:function(e){n.scrollDiv=e}}),n.scrollDiv=null,n.scrollPosition=null,n.hasNewChildren=!1,n}return u(t,e),i(t,[{key:"componentWillReceiveProps",value:function(e){if(this.props.chatId!==e.chatId)return void(this.scrollPosition=null);this.props.children.length<e.children.length&&this.scrollDiv.scrollTop<150&&(this.hasNewChildren=!0,this.scrollDiv.scrollTop=150)}},{key:"componentDidUpdate",value:function(){var e=this,t=this.props.scrollPosition,n=this.scrollDiv.scrollHeight,r=this.isScrolledFromBottom();this.hasNewChildren&&(this.scrollDiv.scrollTop-=150,this.hasNewChildren=!1),"bottom"===t&&r||(r||"bottom"!==t||this.handleImgsLoaded().then(function(){"bottom"===t&&(e.scrollDiv.scrollTop=e.scrollDiv.scrollHeight)}).catch(function(){}),t&&this.scrollDiv&&(this.scrollDiv.scrollTop="bottom"===t?n:t))}},{key:"render",value:function(){return d.default.createElement("div",{className:"infinite-scroll",onScroll:this.handleScroll,ref:this.handleRefScrollDiv},this.props.children)}}]),t}(d.Component);t.default=m},"./app/components/Chats/List/LastEvent.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){if(!a(e,t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function u(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?l(e):t}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),f=r(n("./node_modules/html-to-text/index.js")),m=n("./node_modules/react-intl/lib/index.es.js"),h=n("./app/helpers/messagesHelpers.js"),y=r(n("./app/components/Chats/SystemEventEntryBody.js")),_=function(e){function t(){return s(this,t),u(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return d(t,e),c(t,[{key:"renderMessageType",value:function(e){switch(e){case"image":return p.default.createElement(m.FormattedMessage,{id:"[message] type image",defaultMessage:"image"});case"document":return p.default.createElement(m.FormattedMessage,{id:"[message] type document",defaultMessage:"document"});case"contact":return p.default.createElement(m.FormattedMessage,{id:"[message] type contact",defaultMessage:"contact"});case"location":return p.default.createElement(m.FormattedMessage,{id:"[message] type location",defaultMessage:"location"});default:return e}}},{key:"render",value:function(){var e=this.props.chat,t=e.lastEvent,n=e.draft;if(n)return p.default.createElement("div",{className:"chat-entry__event"},p.default.createElement("span",{className:"chat-entry__event-name chat-entry__event-name--draft"},p.default.createElement(m.FormattedMessage,{id:"[message] draft",defaultMessage:"Draft:"})),p.default.createElement("span",null,n));if(!t)return null;var r="message_new"===t.event_type?[t.sender]:t.profiles;if(!(null===r||void 0===r?void 0:r[0])&&"voex"!==t.event_type)return null;switch(t.event_type){case"message_new":if((0,h.isBotMessage)(t))return p.default.createElement("div",{className:"chat-entry__event"},p.default.createElement("span",null,f.default.fromString(t.payload.body)));var a=["text","link"].includes(t.payload.type)?t.payload.body:this.renderMessageType(t.payload.type),o=r[0].isMe?p.default.createElement(m.FormattedMessage,{id:"[app] you",defaultMessage:"You"}):r[0].name,s="chat"!==this.props.chat.chat_type||r[0].isMe?p.default.createElement("span",{className:"chat-entry__event-name"},o,": "):null;return p.default.createElement("div",{className:"chat-entry__event"},s,p.default.createElement("span",null,a));case"added_to_chat":case"deleted_from_chat":case"admin_added_to_chat":case"left_from_chat":case"kicked_by_cts_logout":case"chat_name_changed":case"chat_avatar_changed":case"voex":return p.default.createElement("div",{className:"chat-entry__event chat-entry__event-system"},p.default.createElement(y.default,{event:t,chat:this.props.chat}));default:return null}}}]),t}(p.Component);t.default=_},"./app/components/Chats/Markdown/Markdown.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){if(!a(e,t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function u(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?l(e):t}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),f=r(n("./node_modules/react-markdown/lib/react-markdown.js")),m=r(n("./app/components/Chats/Markdown/MarkdownCodeBlock.js")),h=r(n("./app/components/Chats/Markdown/MarkdownTextBlock.js")),y=r(n("./app/components/Chats/Markdown/MarkdownLinkBlock.js")),_=r(n("./app/components/Chats/Markdown/MarkdownTableBlock.js")),b=r(n("./app/components/Chats/Markdown/MarkdownImageBlock.js")),v=r(n("./app/components/Chats/Markdown/MarkdownInlineCodeBlock.js")),g=function(e){function t(){return s(this,t),u(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return d(t,e),c(t,[{key:"render",value:function(){var e=this.props.children;return p.default.createElement(f.default,{escapeHtml:!0,source:e,className:"markdown",renderers:{code:m.default,text:h.default,link:y.default,table:_.default,image:b.default,inlineCode:v.default}})}}]),t}(p.PureComponent);t.default=g},"./app/components/Chats/Markdown/MarkdownCodeBlock.js":function(e,t,n){"use strict";function r(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!r(e,t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}function c(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?l(e):t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var d=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),p=function(e){return e&&e.__esModule?e:{default:e}}(n("./node_modules/highlight.js/lib/index.js"));n("./node_modules/highlight.js/styles/github.css");var f=function(e){function t(){var e,n,r;o(this,t);for(var a=arguments.length,s=new Array(a),i=0;i<a;i++)s[i]=arguments[i];return c(r,(n=r=c(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),Object.defineProperty(l(r),"setRef",{configurable:!0,enumerable:!0,writable:!0,value:function(e){r.codeBlock=e}}),n))}return u(t,e),i(t,[{key:"componentDidMount",value:function(){this.highlightCode()}},{key:"componentDidUpdate",value:function(){this.highlightCode()}},{key:"highlightCode",value:function(){p.default.highlightBlock(this.codeBlock)}},{key:"render",value:function(){return d.default.createElement("pre",null,d.default.createElement("code",{ref:this.setRef,className:"markdown-code language-".concat(this.props.language)},this.props.value))}}]),t}(d.PureComponent);t.default=f},"./app/components/Chats/Markdown/MarkdownImageBlock.js":function(e,t,n){"use strict";function r(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!r(e,t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}function c(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?u(e):t}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var d=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),p=function(e){function t(){return o(this,t),c(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return l(t,e),i(t,[{key:"render",value:function(){return d.default.createElement("a",{href:this.props.src,target:"_blank",rel:"noopener noreferrer"},d.default.createElement("img",{className:"markdown-image",src:this.props.src,alt:this.props.alt||this.props.src}))}}]),t}(d.PureComponent);t.default=p},"./app/components/Chats/Markdown/MarkdownInlineCodeBlock.js":function(e,t,n){"use strict";function r(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!r(e,t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}function c(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?u(e):t}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var d=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),p=function(e){function t(){return o(this,t),c(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return l(t,e),i(t,[{key:"render",value:function(){return d.default.createElement("code",{className:"markdown-inline-code"},this.props.value)}}]),t}(d.PureComponent);t.default=p},"./app/components/Chats/Markdown/MarkdownLinkBlock.js":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(n("./node_modules/react/index.js")),a=function(e){var t,n=e.href,a=e.children,o=/:\/\//.test(n)?n:"http://".concat(n);return(null===a||void 0===a?void 0:null===(t=a[0])||void 0===t?void 0:t.find(function(e){return"a"===e.type}))?a:r.default.createElement("a",{href:o,target:"_blank",rel:"noopener noreferrer",className:"chat-message-link__url chat-message-link__url--inline"},a)},o=a;t.default=o},"./app/components/Chats/Markdown/MarkdownTableBlock.js":function(e,t,n){"use strict";function r(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!r(e,t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}function c(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?u(e):t}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var d=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),p=function(e){function t(){return o(this,t),c(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return l(t,e),i(t,[{key:"render",value:function(){return d.default.createElement("div",{className:"markdown-table"},d.default.createElement("table",null,this.props.children))}}]),t}(d.PureComponent);t.default=p},"./app/components/Chats/Markdown/MarkdownTextBlock.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e){var t=['(([^<>()\\[\\]\\\\.,;:\\s@"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@"]+)*)|(".+"))@',"((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))"].join(""),n=new RegExp(t),r=e.match(n);if(!r)return[e];var a=new RegExp("(".concat(r.join("|"),")"));return e.split(a).map(function(e){return n.test(e)?i.default.createElement("a",{className:"chat-message-link__url chat-message-link__url--inline",href:"mailto:".concat(e),key:(0,c.default)()},e):e})}function o(e){return e.reduce(function(e,t){return"string"!=typeof t?e.concat(t):e.concat(s(t))},[])}function s(e){var t=(0,u.parseUrls)(e);if(!t)return e;var n=new RegExp("(".concat(t.join("|"),")"));return e.split(n).map(function(e){if(!(0,u.isUrl)(e))return e;var t=/:\/\//.test(e)?e:"http://".concat(e);return i.default.createElement("a",{className:"chat-message-link__url chat-message-link__url--inline",target:"_blank",rel:"noopener noreferrer",href:t,key:(0,c.default)()},e)})}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(n("./node_modules/react/index.js")),c=r(n("./lib/uuid5.js")),u=n("./app/helpers/messagesHelpers.js"),l=function(e){var t,n;return n=e,t=a(n),o(t)},d=l;t.default=d},"./app/components/Chats/MessageEntry.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){if(!a(e,t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function u(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?l(e):t}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),f=n("./node_modules/react-router-dom/es/index.js"),m=n("./node_modules/react-intl/lib/index.es.js"),h=r(n("./app/components/Chats/MessageEntryBody.js")),y=r(n("./app/components/Avatar.js")),_=n("./app/helpers/reactHelpers.js"),b=n("./app/helpers/appHelpers.js"),v=r(n("./app/assets/icons/status-sent.svg")),g=r(n("./app/assets/icons/status-received.svg")),E=r(n("./app/assets/icons/status-read.svg")),S=r(n("./app/assets/icons/status-local.svg")),O=r(n("./app/components/App/ConnTypeIcon.js")),C=r(n("./app/components/Chats/MessageMenu.js")),w=n("./lib/deepEqual.js"),j=function(e){function t(e){var n;return s(this,t),n=u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),n.state={isMessageHovered:!1,isMessageMenuOpened:!1},n}return d(t,e),c(t,[{key:"shouldComponentUpdate",value:function(e,t){var n=["message","user","showDateSplitter","showPositionSplitter"];return(0,_.isShouldComponentUpdate)(this.props,e,n)||!(0,w.equal)(this.state,t)}},{key:"renderDateSplitter",value:function(){var e=this.props,t=e.message,n=e.locale;return p.default.createElement("div",{className:"chat-message__date-splitter"},(0,b.formatDateSplitter)(t.payload.timestamp,n))}},{key:"renderStatus",value:function(){var e,t,n=this.props.message;return n.sender.isMe?n.payload.isLocal?p.default.createElement("span",{className:"chat-message__status chat-message__status--local"},p.default.createElement(S.default,{width:"16",height:"16"})):(null===(e=n.read_by)||void 0===e?void 0:e.length)>0?p.default.createElement("span",{className:"chat-message__status chat-message__status--read"},p.default.createElement(E.default,{width:"16",height:"16"})):(null===(t=n.received_by)||void 0===t?void 0:t.length)>0?p.default.createElement("span",{className:"chat-message__status chat-message__status--received"},p.default.createElement(g.default,{width:"16",height:"16"})):p.default.createElement("span",{className:"chat-message__status chat-message__status--sent"},p.default.createElement(v.default,{width:"16",height:"16"})):null}},{key:"render",value:function(){var e=this,t=this.props,n=t.message,r=t.user,a=t.chat,o=t.showDateSplitter,s=t.showPositionSplitter,i=t.messageRef,c=t.loadAttachment,u=t.locale,l=t.showSenderProfile,d=t.hideActions,_=n.sender;if(!n||!_)return null;var b=l?p.default.createElement(y.default,{avatar:_.avatar,name:_.name,type:n.kind}):null,v=_.isPhonebookUser?p.default.createElement(f.Link,{to:"/contacts/".concat(_.entry_id)},b):p.default.createElement(f.Link,{to:"/chats/member/".concat(_.user_huid)},b),g=l?p.default.createElement("div",{className:"chat-message__title"},p.default.createElement(O.default,{className:"conn-type-icon",name:"message",width:"12",height:"12",connType:"message_new"===n.event_type?n.kind:n.connType,isBot:"botx"===a.chat_type}),p.default.createElement("strong",null,_.name)):null,E=_.isMe?"chat-message__bubble--my":"",S="chat-message__bubble--".concat(n.kind),w="chat-message__meta--".concat(n.payload.type),j=n.payload.timestamp.locale(u),k=p.default.createElement("div",{className:"chat-message"},p.default.createElement("div",{className:"chat-message__avatar"},d?b:v),p.default.createElement("div",{className:["chat-message__bubble",E,S].join(" ")},g,p.default.createElement(h.default,{message:n.payload,kind:n.kind,sender:n.sender,user:r,chat:a,loadAttachment:c,locale:u,hideActions:d}),p.default.createElement("div",{className:"chat-message__meta ".concat(w)},p.default.createElement("span",{className:"chat-message__timestamp",title:j.format("Do MMMM YYYY, HH:mm:ss")},j.format("HH:mm")),this.renderStatus()),!d&&p.default.createElement(C.default,{display:this.state.isMessageHovered||this.state.isMessageMenuOpened,message:n,align:{x:_.isMe?"left":"right"},onTriggerClick:function(t){return e.setState({isMessageMenuOpened:t})}})));return p.default.createElement("div",{className:"chat-message-row ".concat(_.isMe?"chat-message-row--my":""," ").concat(l?"":"chat-message-row--no-profile"),ref:i,onMouseOut:function(){return e.setState({isMessageHovered:!1})},onMouseOver:function(){return e.setState({isMessageHovered:!0})}},o?p.default.createElement("div",{className:"chat-message-row__splitter"},this.renderDateSplitter()):null,k,s&&p.default.createElement("div",{className:"chat-message-row__new-msg-splitter"},p.default.createElement(m.FormattedMessage,{id:"[message bubble] unread splitter",defaultMessage:"Unread messages"})))}}]),t}(p.Component);t.default=j},"./app/components/Chats/MessageEntryBody.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){if(!a(e,t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function u(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?d(e):t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),f=r(n("./node_modules/react-image-lightbox/dist/main.js")),m=n("./node_modules/react-intl/lib/index.es.js"),h=r(n("./app/components/App/Modal.js")),y=r(n("./app/assets/images/ccs_user.png")),_=r(n("./app/components/VCardLoader.js")),b=r(n("./app/components/Chats/Markdown/Markdown.js")),v=r(n("./app/assets/icons/file-doc.svg")),g=r(n("./app/assets/icons/file-file.svg")),E=r(n("./app/assets/icons/file-pdf.svg")),S=r(n("./app/assets/icons/file-txt.svg")),O=r(n("./app/assets/icons/file-xls.svg")),C=r(n("./app/assets/icons/loader.svg")),w=n("./app/helpers/attachmentHelpers.js"),j=n("./lib/constants.js"),k=function(e){function t(){var e,n,r;s(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return u(r,(n=r=u(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),Object.defineProperty(d(r),"state",{configurable:!0,enumerable:!0,writable:!0,value:{modalIsOpen:!1,loadingAttachment:!1}}),Object.defineProperty(d(r),"closeModal",{configurable:!0,enumerable:!0,writable:!0,value:function(){r.setState({modalIsOpen:!1})}}),Object.defineProperty(d(r),"openModal",{configurable:!0,enumerable:!0,writable:!0,value:function(){r.setState({modalIsOpen:!0})}}),Object.defineProperty(d(r),"isMessageUnloadable",{configurable:!0,enumerable:!0,writable:!0,value:function(e){return r.props.hideActions||e.isLocal||!e.payload.chunk_size&&e.payload.file_size>j.UNCHUNKED_DECRYPTION_SIZE_LIMIT}}),Object.defineProperty(d(r),"handleLoadAttachment",{configurable:!0,enumerable:!0,writable:!0,value:function(e){r.setState({loadingAttachment:!0}),r.props.loadAttachment(e)}}),n))}return l(t,e),c(t,[{key:"renderUnsignedMessage",value:function(){return p.default.createElement("div",{className:"chat-message__text chat-message__text--unsigned"},p.default.createElement(m.FormattedMessage,{id:"[message] unsigned",defaultMessage:"Can't decrypt!"}))}},{key:"renderTextMessage",value:function(){var e=this.props.message;return p.default.createElement("div",{className:"chat-message__text"},p.default.createElement(b.default,null,e.body))}},{key:"renderImageMessage",value:function(){var e=this.props,t=e.message,n=e.sender,r=e.locale,a=!/blob:https?:\/\//.test(t.payload.file_preview),o=a?t.payload.file_blur_preview:t.payload.file_preview,s={width:"".concat(t.payload.file_preview_width,"px"),height:"".concat(t.payload.file_preview_height,"px"),filter:a?"blur(3px)":"none"},i=p.default.createElement("div",{className:"media-lightbox__caption"},p.default.createElement("strong",null,n.name),", ",t.timestamp.locale(r).format("lll"),","," ",(0,w.bytesToSize)(t.payload.file_size)),c=t.isLocal?"chat-message__img--local":"chat-message__img--modal",u=t.isLocal?"chat-message__picture--local":"chat-message__picture--modal",l="media-lightbox ".concat(t.attachmentLoaded?" media-lightbox--loaded":""),d=t.attachmentLoaded?t.payload.file:"";return p.default.createElement("div",{className:"chat-message__picture chat-message__picture--shadow ".concat(u),onClick:this.isMessageUnloadable(t)?null:this.openModal},p.default.createElement("img",{className:"chat-message__img ".concat(c),src:o,role:"presentation",style:s}),this.state.modalIsOpen&&p.default.createElement(f.default,{wrapperClassName:l,enableZoom:!1,mainSrc:d,mainType:"image",imageCaption:i,onAfterOpen:this.props.loadAttachment,onCloseRequest:this.closeModal}))}},{key:"renderVideoMessage",value:function(){var e=this.props,t=e.message,n=e.sender,r=!/blob:https?:\/\//.test(t.payload.file_preview),a=r?t.payload.file_blur_preview:t.payload.file_preview,o={width:"".concat(t.payload.file_preview_width,"px"),height:"".concat(t.payload.file_preview_height,"px"),filter:r?"blur(3px)":"none"},s=p.default.createElement("div",{className:"media-lightbox__caption"},p.default.createElement("strong",null,n.name),", ",t.timestamp.locale("ru").format("lll")),i=t.isLocal?"chat-message__img--local":"chat-message__img--modal",c=t.attachmentLoaded?t.payload.file:"";return p.default.createElement("div",{className:"chat-message__video chat-message__video--shadow chat-message__video--play"},p.default.createElement("img",{className:"chat-message__img ".concat(i),src:a,role:"presentation",onClick:this.isMessageUnloadable(t)?null:this.openModal,style:o}),this.state.modalIsOpen&&p.default.createElement(f.default,{wrapperClassName:"media-lightbox",mainSrc:c,mainType:"video",onAfterOpen:this.props.loadAttachment,onCloseRequest:this.closeModal,imageCaption:s}))}},{key:"renderLinkMessage",value:function(){var e,t=this.props.message;if(t.isLocal||!(null===t||void 0===t?void 0:null===(e=t.payload)||void 0===e?void 0:e.url_title)){var n;return(null===t||void 0===t?void 0:null===(n=t.payload)||void 0===n?void 0:n.url_preview)?this.renderLinkImageMessage():this.renderTextMessage()}return p.default.createElement("div",{className:"chat-message__link"},p.default.createElement("span",{className:"chat-message__text chat-message__text--first"},p.default.createElement(b.default,null,t.body)),p.default.createElement("a",{className:"chat-message-link",target:"_blank",rel:"noopener noreferrer",href:t.payload.url},t.payload.url_preview?p.default.createElement("span",{className:"chat-message-link__preview"},p.default.createElement("img",{className:"chat-message-link__img",src:t.payload.url_preview,role:"presentation"})):null,p.default.createElement("span",{className:"chat-message-link__meta"},p.default.createElement("strong",{className:"chat-message-link__title"},t.payload.url_title),p.default.createElement("span",{className:"chat-message-link__url"},t.payload.url),p.default.createElement("span",{className:"chat-message-link__text"},t.payload.url_text))))}},{key:"renderLinkImageMessage",value:function(){var e=this.props.message;return p.default.createElement("div",{className:"chat-message__link"},p.default.createElement("span",{className:"chat-message__text chat-message__text--first"},p.default.createElement(b.default,null,e.body)),p.default.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:e.payload.url},p.default.createElement("img",{className:"chat-message-link__preview-full",src:e.payload.url_preview,role:"presentation"})))}},{key:"renderContactMessage",value:function(){var e=this.props.message,t=e.payload.contact_image||y.default,n=e.attachmentLoaded?p.default.createElement("a",{className:"chat-message-contact__link",href:e.payload.contact_file,download:"".concat(e.payload.contact_name,".vcf")},p.default.createElement(m.FormattedMessage,{id:"[message] download",defaultMessage:"download"})):null,r=e.attachmentLoaded?p.default.createElement("span",{className:"chat-message-contact__link",onClick:this.openModal},p.default.createElement(m.FormattedMessage,{id:"[message] contact show",defaultMessage:"show"})):null;return p.default.createElement("div",{className:"chat-message__contact"},p.default.createElement("div",{className:"chat-message-contact",target:"_blank",onClick:e.isLocal?null:this.props.loadAttachment},p.default.createElement("span",{className:"chat-message-contact__preview"},p.default.createElement("img",{className:"chat-message-contact__img",src:t,role:"presentation"})),p.default.createElement("span",{className:"chat-message-contact__meta"},p.default.createElement("strong",{className:"chat-message-contact__title"},e.payload.contact_name),n,r)),p.default.createElement(h.default,{name:"message-contact",caption:p.default.createElement(m.FormattedMessage,{id:"[message] contact",defaultMessage:"Contact"}),isOpen:this.state.modalIsOpen,onClose:this.closeModal},p.default.createElement(_.default,{url:e.payload.contact_file,name:e.payload.contact_name,avatar:t})))}},{key:"renderDocumentMessage",value:function(){var e=this.props.message,t=e.attachmentLoaded?p.default.createElement("a",{className:"chat-message-file__download",href:e.payload.file,download:e.payload.file_name},p.default.createElement(m.FormattedMessage,{id:"[message] download",defaultMessage:"download"})):null,n=e.payload.file_mime_type,r=this.state.loadingAttachment&&!e.attachmentLoaded,a=r?"chat-message-file__icon-pic chat-message-file__icon-pic--loading":"chat-message-file__icon-pic",o=p.default.createElement(g.default,{width:"22",height:"26",className:a});return(n.includes("msword")||n.includes("wordprocessingml"))&&(o=p.default.createElement(v.default,{width:"22",height:"26",className:a})),(n.includes("ms-excel")||n.includes("spreadsheetml"))&&(o=p.default.createElement(O.default,{width:"22",height:"26",className:a})),n.includes("pdf")&&(o=p.default.createElement(E.default,{width:"22",height:"26",className:a})),n.includes("text")&&(o=p.default.createElement(S.default,{width:"22",height:"26",className:a})),p.default.createElement("div",{className:"chat-message__document"},p.default.createElement("div",{className:"chat-message-file",onClick:this.isMessageUnloadable(e)?null:this.handleLoadAttachment},p.default.createElement("div",{className:"chat-message-file__icon"},o,r&&p.default.createElement(C.default,{className:"chat-message-file__icon-loader",width:"14",height:"14"})),p.default.createElement("div",{className:"chat-message-file__name"},e.payload.file_name),p.default.createElement("div",{className:"chat-message-file__size"},(0,w.bytesToSize)(e.payload.file_size)),t))}},{key:"render",value:function(){var e=this.props.message,t=null;switch(e.type){case"text":t=this.renderTextMessage();break;case"image":t=this.renderImageMessage();break;case"video":t=this.renderVideoMessage();break;case"link":t=this.renderLinkMessage();break;case"contact":t=this.renderContactMessage();break;case"document":t=this.renderDocumentMessage();break;default:t=this.renderUnsignedMessage()}return t}}]),t}(p.Component);t.default=k},"./app/components/Chats/MessageMenu.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){if(!a(e,t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function u(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?l(e):t}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),f=n("./node_modules/react-intl/lib/index.es.js"),m=n("./node_modules/react-router-dom/es/index.js"),h=r(n("./app/components/App/DropdownMenu.js")),y=r(n("./app/assets/icons/message-menu.svg")),_=function(e){function t(){return s(this,t),u(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return d(t,e),c(t,[{key:"render",value:function(){var e=this.props,t=e.message,n=e.align,r=e.display,a=e.onTriggerClick,o=p.default.createElement("button",{className:"btn btn--message-menu"},p.default.createElement(y.default,{width:"24",height:"24",className:"btn__icon"}));return p.default.createElement(h.default,{className:"dropdown-menu",name:"message-menu",trigger:o,align:n,display:r,onTriggerClick:a,parentClassName:"chat__infinite-scroll",contentSize:{width:165,height:80}},p.default.createElement(m.NavLink,{className:"dropdown-menu__item",to:"/chats/".concat(t.group_chat_id,"/message/").concat(t.sync_id)},p.default.createElement("span",null,p.default.createElement(f.FormattedMessage,{id:"[message menu] message status",defaultMessage:"Message's status"}))))}}]),t}(p.PureComponent),b=(0,f.injectIntl)(_);t.default=b},"./app/components/Chats/SystemEventEntry.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){if(!a(e,t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function u(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?l(e):t}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),f=r(n("./node_modules/moment/moment.js")),m=n("./node_modules/react-intl/lib/index.es.js"),h=n("./app/helpers/appHelpers.js"),y=r(n("./app/components/Chats/SystemEventEntryBody.js")),_=function(e){function t(){return s(this,t),u(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return d(t,e),c(t,[{key:"renderDateSplitter",value:function(){var e=this.props.event.payload.timestamp;return e.isSame((0,f.default)(),"day")?p.default.createElement("div",{className:"chat-message__date-splitter"},p.default.createElement(m.FormattedMessage,{id:"[datetime] today",defaultMessage:"Today"})):e.isSame((0,f.default)().subtract(1,"day"),"day")?p.default.createElement("div",{className:"chat-message__date-splitter"},p.default.createElement(m.FormattedMessage,{id:"[datetime] yesterday",defaultMessage:"Yesterday"})):p.default.createElement("div",{className:"chat-message__date-splitter"},(0,h.formatDateSplitter)(e,this.props.intl.locale))}},{key:"render",value:function(){var e=this.props,t=e.event,n=e.chat,r=e.showDateSplitter,a=p.default.createElement(y.default,{event:t,chat:n}),o=t.payload.timestamp.locale(this.props.intl.locale);return a?p.default.createElement("div",{className:"chat-message-row",key:t.sync_id},r?p.default.createElement("div",{className:"chat-message-row__splitter"},this.renderDateSplitter()):null,p.default.createElement("div",{className:"chat-message__event"},p.default.createElement("div",{className:"chat-message__event--text"},a),",",p.default.createElement("span",{title:o.format("Do MMMM YYYY, HH:mm:ss")},o.format("HH:mm")))):null}}]),t}(p.PureComponent),b=(0,m.injectIntl)(_);t.default=b},"./app/components/Chats/SystemEventEntryBody.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){if(!a(e,t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function u(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?l(e):t}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),f=n("./node_modules/react-intl/lib/index.es.js"),m=r(n("./node_modules/moment/moment.js")),h=n("./app/helpers/profilesHelpers.js"),y=r(n("./app/assets/icons/call-canceled-in.svg")),_=r(n("./app/assets/icons/call-canceled-out.svg")),b=r(n("./app/assets/icons/call-declined.svg")),v=r(n("./app/assets/icons/call-incoming.svg")),g=r(n("./app/assets/icons/call-missed.svg")),E=r(n("./app/assets/icons/call-outgoing.svg")),S=function(e){function t(){return s(this,t),u(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return d(t,e),c(t,[{key:"getSystemEventInfo",value:function(){var e,t,n=this.props.event,r=n.profiles,a=n.connType,o=null===r||void 0===r?void 0:r.map(function(e){return(0,h.getFlatProfile)(e,a).name}).join(", ");return{isIAmSender:null===(e=n.senderProfile)||void 0===e?void 0:e.isMe,isIAmInMembers:!!(null===r||void 0===r?void 0:r.find(function(e){return e.isMe})),count:null===r||void 0===r?void 0:r.length,memberNames:o,senderName:null===(t=n.senderProfile)||void 0===t?void 0:t.name}}},{key:"renderAddedToChat",value:function(e){var t=this.props.event,n=t.profiles,r=t.connType,a=e.isIAmSender,o=e.isIAmInMembers,s=e.count,i=e.memberNames,c=e.senderName;if(a)return p.default.createElement(f.FormattedMessage,{id:"[system event] user added by you",defaultMessage:"User {memberNames} added by {you}",values:{count:s,memberNames:p.default.createElement("strong",null,i),you:p.default.createElement("strong",null,"You")}});if(o){var u=n.filter(function(e){return!e.isMe}),l=u.map(function(e){return(0,h.getFlatProfile)(e,r).name}).join(", "),d=u.length;return 0===d?p.default.createElement(f.FormattedMessage,{id:"[system event] you added by user",defaultMessage:"{you} added by User {senderName}",values:{senderName:p.default.createElement("strong",null,c),you:p.default.createElement("strong",null,"You")}}):p.default.createElement(f.FormattedMessage,{id:"[system event] user and you added by user",defaultMessage:"User {memberNamesWithoutMe} and {you} added by {senderName}",values:{count:d,memberNamesWithoutMe:p.default.createElement("strong",null,l),you:p.default.createElement("strong",null,"You"),senderName:p.default.createElement("strong",null,c)}})}return p.default.createElement(f.FormattedMessage,{id:"[system event] user added by user",defaultMessage:"User {memberNames} added by {senderName}",values:{count:s,memberNames:p.default.createElement("strong",null,i),senderName:p.default.createElement("strong",null,c)}})}},{key:"renderDeletedFromChat",value:function(e){var t=e.isIAmSender,n=e.isIAmInMembers,r=e.memberNames,a=e.senderName,o=e.count;return t?p.default.createElement(f.FormattedMessage,{id:"[system event] user removed by you",defaultMessage:"User {memberNames} removed by {you}",values:{memberNames:p.default.createElement("strong",null,r),you:p.default.createElement("strong",null,"You"),count:o}}):n?p.default.createElement(f.FormattedMessage,{id:"[system event] you removed by user",defaultMessage:"{you} removed by {senderName}",values:{senderName:p.default.createElement("strong",null,a),you:p.default.createElement("strong",null,"You")}}):p.default.createElement(f.FormattedMessage,{id:"[system event] user removed by user",defaultMessage:"User {memberNames} removed by User {senderName}",values:{count:o,memberNames:p.default.createElement("strong",null,r),senderName:p.default.createElement("strong",null,a)}})}},{key:"renderAdminAddedToChat",value:function(e){var t=e.isIAmSender,n=e.isIAmInMembers,r=e.memberNames,a=e.senderName;return t?p.default.createElement(f.FormattedMessage,{id:"[system event] user assigned as admin by you",defaultMessage:"User {memberNames} assigned as admin by {you}",values:{memberNames:p.default.createElement("strong",null,r),you:p.default.createElement("strong",null,"You")}}):n?p.default.createElement(f.FormattedMessage,{id:"[system event] you assigned as admin by user",defaultMessage:"{you} assigned as admin by User {senderName}",values:{senderName:p.default.createElement("strong",null,a),you:p.default.createElement("strong",null,"You")}}):p.default.createElement(f.FormattedMessage,{id:"[system event] user assigned as admin by user",defaultMessage:"User {memberNames} assigned as admin by User {senderName}",values:{memberNames:p.default.createElement("strong",null,r),senderName:p.default.createElement("strong",null,a)}})}},{key:"renderRoutingChanged",value:function(){var e,t=this.props,n=t.event,r=t.chat,a="group_chat"===r.chat_type?p.default.createElement(f.FormattedMessage,{id:"[system event] rc public",defaultMessage:"Chat is now public"}):p.default.createElement(f.FormattedMessage,{id:"[system event] rc private",defaultMessage:"Chat is now private"}),o=p.default.createElement(f.FormattedMessage,{id:"[system event] rc corporate",defaultMessage:"Chat is now corporate"});return"rts"===(null===(e=n.payload.forward[0])||void 0===e?void 0:e.conn_type)?a:o}},{key:"renderVoex",value:function(){var e=this.props.event,t=e.payload.event.duration,n=e.isIncomingCall,r=e.isHangedUpByMe;if(!t)return n?r?p.default.createElement("span",{className:"phonecall-status"},p.default.createElement(y.default,{className:"phonecall-status__icon",width:"14",height:"14"}),p.default.createElement(f.FormattedMessage,{id:"[system event] call canceled",defaultMessage:"Canceled call"})):p.default.createElement("span",{className:"phonecall-status"},p.default.createElement(g.default,{className:"phonecall-status__icon",width:"12",height:"12"}),p.default.createElement(f.FormattedMessage,{id:"[system event] call missed",defaultMessage:"Missed call"})):r?p.default.createElement("span",{className:"phonecall-status"},p.default.createElement(_.default,{className:"phonecall-status__icon",width:"14",height:"14"}),p.default.createElement(f.FormattedMessage,{id:"[system event] call canceled",defaultMessage:"Canceled call"})):p.default.createElement("span",{className:"phonecall-status"},p.default.createElement(b.default,{className:"phonecall-status__icon",width:"12",height:"12"}),p.default.createElement(f.FormattedMessage,{id:"[system event] call declined",defaultMessage:"Declined call"}));var a=m.default.duration(t,"seconds").format();return n?p.default.createElement("span",{className:"phonecall-status"},p.default.createElement(v.default,{className:"phonecall-status__icon",width:"12",height:"12"}),p.default.createElement(f.FormattedMessage,{id:"[system event] call incoming",defaultMessage:"Incoming call ({callDuration})",values:{callDuration:a}})):p.default.createElement("span",{className:"phonecall-status"},p.default.createElement(E.default,{className:"phonecall-status__icon",width:"12",height:"12"}),p.default.createElement(f.FormattedMessage,{id:"[system event] call outgoing",defaultMessage:"Outgoing call ({callDuration})",values:{callDuration:a}}))}},{key:"render",value:function(){var e,t,n=this.props.event,r=this.getSystemEventInfo(),a=r.isIAmInMembers,o=r.memberNames,s=null===(e=n.payload)||void 0===e?void 0:e.name;switch(n.event_type){case"added_to_chat":t=this.renderAddedToChat(r);break;case"deleted_from_chat":t=this.renderDeletedFromChat(r);break;case"admin_added_to_chat":t=this.renderAdminAddedToChat(r);break;case"left_from_chat":t=a?p.default.createElement(f.FormattedMessage,{id:"[system event] you left the chat",defaultMessage:"{you} left the chat",values:{you:p.default.createElement("strong",null,"You")}}):p.default.createElement(f.FormattedMessage,{id:"[system event] user left the chat",defaultMessage:"User {memberNames} left the chat",values:{memberNames:p.default.createElement("strong",null,o)}});break;case"kicked_by_cts_logout":t=a?p.default.createElement(f.FormattedMessage,{id:"[system event] you removed from chat by corporate permissions",defaultMessage:"{you} removed from chat by corporate permissions",values:{you:p.default.createElement("strong",null,"You")}}):p.default.createElement(f.FormattedMessage,{id:"[system event] user removed from chat by corporate permissions",defaultMessage:"User {memberNames} removed from chat by corporate permissions",values:{memberNames:p.default.createElement("strong",null,o)}});break;case"chat_name_changed":t=a?p.default.createElement(f.FormattedMessage,{id:"[system event] you changed topic to",defaultMessage:"{you} changed topic to {chatName}",values:{you:p.default.createElement("strong",null,"You"),chatName:p.default.createElement("strong",null,s)}}):p.default.createElement(f.FormattedMessage,{id:"[system event] user changed topic to",defaultMessage:"User {memberNames} changed topic to {chatName}",values:{memberNames:p.default.createElement("strong",null,o),chatName:p.default.createElement("strong",null,s)}});break;case"chat_avatar_changed":t=a?p.default.createElement(f.FormattedMessage,{id:"[system event] you changed chat avatar",defaultMessage:"{you} changed chat avatar",values:{you:p.default.createElement("strong",null,"You")}}):p.default.createElement(f.FormattedMessage,{id:"[system event] user changed chat avatar",defaultMessage:"User {memberNames} changed chat avatar",values:{memberNames:p.default.createElement("strong",null,o)}});break;case"routing_changed":t=this.renderRoutingChanged();break;case"voex":t=this.renderVoex()}return t}}]),t}(p.PureComponent);t.default=S},"./app/components/Contacts/ContactList.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){if(!o(e,t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t,n){return t&&c(e.prototype,t),n&&c(e,n),e}function l(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?d(e):t}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var f=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),m=n("./node_modules/react-intl/lib/index.es.js"),h=n("./node_modules/libphonenumber-js/index.es6.js"),y=r(n("./app/assets/icons/phone.svg")),_=r(n("./app/assets/icons/mail.svg")),b=r(n("./app/assets/icons/connect-cts.svg")),v=r(n("./app/assets/icons/message.svg")),g=function(e){function t(){return i(this,t),l(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p(t,e),u(t,[{key:"renderPhone",value:function(e){var t=(0,h.parse)("+"===e[0]?e:"+".concat(e)),n=t.country,r=t.phone;return f.default.createElement("li",s({className:"profile-info__item",key:e.id_uuid||e.contact},"key",r),f.default.createElement("div",{className:"profile-info__icon"},f.default.createElement(y.default,{width:"24",height:"24"})),f.default.createElement("div",{className:"profile-info__value"},r&&n?(0,h.format)(r,n,"International"):e.contact),f.default.createElement("div",{className:"profile-info__title"},f.default.createElement(m.FormattedMessage,{id:"[contact list] phone",defaultMessage:"Phone"})))}},{key:"renderPhones",value:function(e){var t=this;return(o(null===e||void 0===e?void 0:e.contact,Array)?e.contact:[e.contact]).map(function(e){return t.renderPhone("".concat(e).replace(/^tel:/,""))})}},{key:"renderEmail",value:function(e){return f.default.createElement("li",{className:"profile-info__item",key:e.id_uuid},f.default.createElement("div",{className:"profile-info__icon"},f.default.createElement(_.default,{width:"24",height:"24"})),f.default.createElement("div",{className:"profile-info__value"},e.contact),f.default.createElement("div",{className:"profile-info__title"},"e-mail"))}},{key:"renderConnectionCts",value:function(e){return f.default.createElement("li",{className:"profile-info__item",key:e.contact_type},f.default.createElement("div",{className:"profile-info__icon"},f.default.createElement(b.default,{width:"24",height:"24"})),f.default.createElement("div",{className:"profile-info__value"},e.contact),f.default.createElement("div",{className:"profile-info__title"},f.default.createElement(m.FormattedMessage,{id:"[contact list] corp server",defaultMessage:"Corporate server connection"})))}},{key:"renderCtsContact",value:function(e){return f.default.createElement("li",{className:"profile-info__item",key:e.contact},f.default.createElement("div",{className:"profile-info__icon"},f.default.createElement(v.default,{width:"24",height:"24"})),f.default.createElement("div",{className:"profile-info__value"},e.server_name),f.default.createElement("div",{className:"profile-info__title"},f.default.createElement(m.FormattedMessage,{id:"[contact list] cts",defaultMessage:"CTS server"})))}},{key:"renderDefault",value:function(e){return f.default.createElement("li",{className:"profile-info__item",key:e.contact},f.default.createElement("div",{className:"profile-info__icon"},f.default.createElement(v.default,{width:"24",height:"24"})),f.default.createElement("div",{className:"profile-info__value"},e.contact),f.default.createElement("div",{className:"profile-info__title"},e.contact_type))}},{key:"renderContact",value:function(e){if(!e.contact)return null;switch(e.contact_type){case"phone":return this.renderPhones(e);case"email":return this.renderEmail(e);case"cts_connection":return this.renderConnectionCts(e);case"ad_login":return this.renderCtsContact(e);default:return this.renderDefault(e)}}},{key:"render",value:function(){var e=this,t=this.props.contacts;return f.default.createElement("ul",{className:"profile-info profile-info--phonebook"},t.map(function(t){return e.renderContact(t)}))}}]),t}(f.Component);t.default=g},"./app/components/Contacts/PhonebookEntry.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){if(!a(e,t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function u(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?l(e):t}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),f=r(n("./app/components/Avatar.js")),m=r(n("./app/components/App/ConnTypeIcon.js")),h=r(n("./app/components/App/UserPresence.js")),y=n("./lib/reactIntl.js"),_=function(e){function t(){return s(this,t),u(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return d(t,e),c(t,[{key:"render",value:function(){var e=this.props,t=e.entry,n=e.onClick,r=e.children,a=e.isActive,o=a?"phonebook-entry--active":null,s=n?"phonebook-entry__inner--link":null;return p.default.createElement("div",{className:["phonebook-entry",o].join(" ")},p.default.createElement("div",{className:["phonebook-entry__inner",s].join(" "),onClick:n},p.default.createElement(f.default,{name:t.name,avatar:t.avatar,type:t.conn_type,status:status}),p.default.createElement("div",{className:"phonebook-entry__info"},p.default.createElement("div",{className:"phonebook-entry__info-row"},p.default.createElement(m.default,{className:"conn-type-icon",name:"phonebook",width:"12",height:"12",connType:t.conn_type,isBot:t.isBot}),p.default.createElement("span",{className:"phonebook-entry__title phonebook-entry__title--name"},t.isMe?(0,y.formatMessage)({id:"[app] you",defaultMessage:"You"}):t.name)),p.default.createElement("div",{className:"phonebook-entry__info-row"},p.default.createElement(h.default,{className:"phonebook-entry__event",status:t.status,statusChanged:t.status_changed,connType:t.conn_type})))),r)}}]),t}(p.Component),b=_;t.default=b},"./app/components/Contacts/PhonebookEntryCard.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){i(e,t,n[t])})}return e}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){if(!a(e,t))throw new TypeError("Cannot call a class as a function")}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t,n){return t&&u(e.prototype,t),n&&u(e,n),e}function d(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?p(e):t}function p(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var m=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),h=r(n("./app/components/Avatar.js")),y=r(n("./app/components/Contacts/PhonebookEntry.js")),_=r(n("./app/components/GoBackButton.js")),b=r(n("./app/components/Contacts/ContactList.js")),v=r(n("./app/assets/icons/create-personal-chat.svg")),g=r(n("./app/assets/icons/phone.svg")),E=function(e){function t(){return c(this,t),d(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return f(t,e),l(t,[{key:"renderContacts",value:function(){var e=this.props,t=e.entry,n=e.onCreatePersonalChat,r=e.onCall,a=e.callOfferAllowed;return m.default.createElement("div",{className:"chat__pane-wrapper"},t.contactsGroups.map(function(e){var o=e[0]||{},i=o.conn_type,c=o.user_huid;return m.default.createElement("div",{className:"chat__pane chat__pane--splitter chat__pane--border-bottom chat__pane--profile ".concat(i),key:c},m.default.createElement(y.default,{entry:s({},o,{connType:i}),key:c},m.default.createElement("div",{className:"phonebook-entry__actions"},m.default.createElement("button",{className:"btn phonebook-entry__create-chat phonebook-entry__create-chat--".concat(i),onClick:function(){return n(t.user_huid)}},m.default.createElement(v.default,{width:"24",height:"22",className:"btn__icon"})),!t.isBot&&m.default.createElement("button",{className:"btn phonebook-entry__create-call phonebook-entry__create-call--".concat(i),disabled:!a,onClick:function(){return r(t,{video:!1,audio:!0})}},m.default.createElement(g.default,{width:"24",height:"24",className:"btn__icon"})))),m.default.createElement(b.default,{contacts:e}))}))}},{key:"renderCompany",value:function(e){var t=[],n=e.company,r=e.connType;return n&&t.push(n),e.company_position&&t.push(e.company_position),"cts"!==r||0===t.length?null:m.default.createElement("div",null,t.join(", "))}},{key:"render",value:function(){var e=this.props.entry;return e?m.default.createElement("div",{className:"layout-pane__phonebook-entry"},m.default.createElement("div",{className:"layout-pane__header"},m.default.createElement("div",{className:"layout-pane__action layout-pane__action--back"},m.default.createElement(_.default,null)),m.default.createElement("div",{className:"chat__title"},e.name)),m.default.createElement("div",{className:"layout-pane__body layout-pane__body--overflow"},m.default.createElement("div",{className:"infinite-scroll"},m.default.createElement("div",{className:"chat__pane-wrapper"},m.default.createElement("div",{className:"chat__pane chat__pane--border-bottom"},m.default.createElement("div",{className:"chat-settings__header"},m.default.createElement(h.default,{name:e.name,avatar:e.avatar,type:e.conn_type}),m.default.createElement("h2",{className:"chat-settings__title"},e.name),this.renderCompany(e)))),e.isBot?null:this.renderContacts()))):null}}]),t}(m.Component);t.default=E},"./app/components/DragNDropDialog.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e){return u(e)||c(e)||i()}function i(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function c(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function u(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}function l(e,t){if(!a(e,t))throw new TypeError("Cannot call a class as a function")}function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e,t,n){return t&&d(e.prototype,t),n&&d(e,n),e}function f(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?h(e):t}function m(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var y=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),_=n("./node_modules/react-intl/lib/index.es.js"),b=r(n("./app/components/App/Modal.js")),v=r(n("./app/assets/icons/cross.svg")),g=n("./lib/constants.js"),E=n("./app/helpers/attachmentHelpers.js"),S=function(e){function t(e){var n;return l(this,t),n=f(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),Object.defineProperty(h(n),"handleClose",{configurable:!0,enumerable:!0,writable:!0,value:function(){var e,t;n.setState({isDialogOpen:!1,files:[]}),null===(e=(t=n.props).onCancel)||void 0===e||e.call(t)}}),Object.defineProperty(h(n),"handleSubmit",{configurable:!0,enumerable:!0,writable:!0,value:function(){var e=n.state.files.reduce(function(e,t){return g.DOCUMENT_DECLINE.includes(t.type)?e:(n.imageRegex.test(t.type)?e.push((0,E.readImageFile)(t,!0)):n.videoRegex.test(t.type)?e.push((0,E.readVideoFile)(t,!0)):e.push((0,E.readFileArray)(t)),e)},[]);n.setState({isDialogOpen:!1,files:[]}),Promise.all(e).then(function(e){return e.map(function(e){var t="document";return n.imageRegex.test(e.type)&&(t="image"),n.videoRegex.test(e.type)&&(t="video"),{type:t,message:e}})}).then(function(e){var t,r;return null===(t=(r=n.props).onSubmit)||void 0===t?void 0:t.call(r,e)})}}),Object.defineProperty(h(n),"handleRemove",{configurable:!0,enumerable:!0,writable:!0,value:function(e){var t=n.state.files.filter(function(t){return t!==e}),r=t.length>0;n.setState({files:t,isDialogOpen:r})}}),Object.defineProperty(h(n),"handleSubmitRef",{configurable:!0,enumerable:!0,writable:!0,value:function(e){e&&e.focus()}}),Object.defineProperty(h(n),"renderFile",{configurable:!0,enumerable:!0,writable:!0,value:function(e){var t=n.imageRegex.test(e.type),r=(0,E.bytesToSize)(e.size),a=(0,E.getFileIcon)(e.type);return y.default.createElement("div",{key:e.preview,className:"attachment-row"},t&&y.default.createElement("div",{className:"attachment-row__image"},y.default.createElement("img",{src:e.preview,alt:e.name})),!t&&y.default.createElement("div",{className:"attachment-row__icon"},y.default.createElement(a,{width:"30",height:"30"})),y.default.createElement("div",{className:"attachment-row__desc"},y.default.createElement("div",{className:"attachment-row__desc--inner"},y.default.createElement("div",{className:"attachment-row__desc--name"},e.name),y.default.createElement("div",{className:"attachment-row__desc--size"},r))),y.default.createElement("div",{className:"attachment-row__remove"},y.default.createElement(v.default,{className:"btn__icon",width:"21",height:"21",onClick:function(){return n.handleRemove(e)}})))}}),n.imageRegex=/image\/(jpg|jpeg|png|gif|tif|tiff|bmp|webp|ico)/i,n.videoRegex=/video\//i,n.state={isDialogOpen:!1,files:[]},n}return m(t,e),p(t,[{key:"componentWillReceiveProps",value:function(e){var t=this.state.files,n=e.files;if(n){var r=n.filter(function(e){return!t.includes(e)});r.length&&this.setState({isDialogOpen:!0,files:s(t).concat(s(r))})}}},{key:"render",value:function(){var e=this,t=this.state,n=t.isDialogOpen,r=t.files;return y.default.createElement(b.default,{name:"dragndrop",caption:y.default.createElement(_.FormattedMessage,{id:"[upload dlg] title",defaultMessage:"Send files"}),isOpen:n,onClose:function(){return e.handleClose()}},y.default.createElement("div",{className:"modal__body--overflow"},r.map(function(t){return e.renderFile(t)})),y.default.createElement("div",{className:"modal__actions modal__actions--dragndrop"},y.default.createElement("button",{className:"btn btn--submit",onClick:this.handleSubmit,ref:this.handleSubmitRef},y.default.createElement(_.FormattedMessage,{id:"[upload dlg] send",defaultMessage:"Send"}))))}}]),t}(y.Component);t.default=S},"./app/components/GoBackButton.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){if(!a(e,t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function u(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?l(e):t}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),f=r(n("./node_modules/history/createHashHistory.js")),m=r(n("./app/assets/icons/arrow-left.svg")),h=(0,f.default)(),y=function(e){function t(){return s(this,t),u(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return d(t,e),c(t,[{key:"render",value:function(){return p.default.createElement("button",{className:"btn btn--layout-back",onClick:function(){return h.goBack()}},p.default.createElement(m.default,{width:"24",height:"24",className:"btn__icon"}))}}]),t}(p.Component);t.default=y},"./app/components/Input.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n("./node_modules/react/index.js")),o=r(n("./node_modules/create-react-class/index.js")),s=n("./node_modules/formsy-react/lib/main.js"),i=n("./node_modules/libphonenumber-js/index.es6.js"),c=n("./lib/constants.js");(0,s.addValidationRule)("isPhoneNumber",function(e,t,n){return!!t&&(0,i.isValidNumber)(t,n.toUpperCase())}),(0,s.addValidationRule)("isDomainName",function(e,t){return!!/^([a-z0-9]+\.)?[a-z0-9][a-z0-9-]*\.[a-z]{2,6}$/.test(t)}),(0,s.addValidationRule)("isPrivateKeysPassword",function(e,t){return new RegExp("(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?!.*\\s).{8,".concat(c.MAX_PASSWORD_LENGTH,"}$")).test(t)}),(0,s.addValidationRule)("isPasswordConfirmation",function(e){return e.password===e.confirm}),(0,s.addValidationRule)("isName",function(e,t){return!!/(?!^ +$)^.+$/.test(null===t||void 0===t?void 0:t.replace(/[\u0000-\u0009\u00A0\u1680\u180e\u2000-\u2009\u200a\u200b\u202f\u205f\u3000]/g,""))});var u=(0,o.default)({displayName:"Input",mixins:[s.Mixin],getInitialState:function(){return{focused:!0}},changeValue:function(e){this.setValue(e.currentTarget.value),this.props.onChange&&this.props.onChange(e.currentTarget.value)},render:function(){var e=this,t=this.props,n=t.showValidationErrorOnBlur,r=t.maxLength,o=this.showError()?this.props.errorClassName:null,s=this.getErrorMessage(),i=!s||n&&this.state.focused?null:a.default.createElement("p",{className:o},s);return a.default.createElement("div",{className:this.props.className},a.default.createElement("label",{className:this.props.labelClassName,htmlFor:this.props.id},a.default.createElement("input",{className:this.props.inputClassName,autoComplete:this.props.autoComplete,autoFocus:this.props.autoFocus,name:this.props.name,type:this.props.type,onChange:this.changeValue,maxLength:r,disabled:this.props.disabled,value:this.getValue()||"",placeholder:this.props.placeholder,onKeyUp:this.props.onKeyUp,onBlur:function(){return e.setState({focused:!1})},tabIndex:this.props.tabIndex,id:this.props.id,ref:this.props.name})),i)}}),l=u;t.default=l},"./app/components/InputFileLoader.js":function(e,t,n){"use strict";function r(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!r(e,t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}function c(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?l(e):t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var d=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),p=n("./app/helpers/attachmentHelpers.js"),f=function(e){function t(){var e,n,r;o(this,t);for(var a=arguments.length,s=new Array(a),i=0;i<a;i++)s[i]=arguments[i];return c(r,(n=r=c(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),Object.defineProperty(l(r),"handleOnChange",{configurable:!0,enumerable:!0,writable:!0,value:function(e){var t=r.props,n=t.output,a=t.preview,o=t.onSuccess,s=t.onCheckFile,i=e.target.files[0];i&&r.isAccepted(i.type)&&(s&&!s(i)||(i.type.match("image")?"base64"===n?(0,p.readFileBase64)(i).then(o):(0,p.readImageFile)(i,a).then(function(e){r.refs.in.value="",o(e)}):i.type.match("video")?(0,p.readVideoFile)(i,a).then(function(e){r.refs.in.value="",o(e)}):(0,p.readFileArray)(i).then(o)))}}),n))}return u(t,e),i(t,[{key:"isAccepted",value:function(e){var t=this.props.accept;return!t||t.split(",").find(function(t){return e.match(t)})}},{key:"render",value:function(){var e=this.props,t=e.id,n=e.className,r=e.accept;return d.default.createElement("input",{id:t,className:n,ref:"in",type:"file",accept:r||"*",onChange:this.handleOnChange,style:{display:"none"}})}}]),t}(d.Component);t.default=f},"./app/components/LoadingOverlay.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n("./node_modules/react/index.js")),o=r(n("./app/assets/icons/loader.svg")),s=function(){return a.default.createElement("div",{className:"loading-overlay"},a.default.createElement(o.default,{className:"loading-overlay__loader",width:"38",height:"38"}))},i=s;t.default=i},"./app/components/MaskedInput.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n("./node_modules/react/index.js")),o=r(n("./node_modules/create-react-class/index.js")),s=n("./node_modules/formsy-react/lib/main.js"),i=n("./node_modules/libphonenumber-js/index.es6.js");(0,s.addValidationRule)("isPhoneNumber",function(e,t,n){return!!t&&(0,i.isValidNumber)(t,n.toUpperCase())});var c=(s.Mixin.resetValue,function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}(s.Mixin,["resetValue"])),u=(0,o.default)({displayName:"MaskedInput",mixins:[c],getInitialState:function(){return{phone:"",caret:0}},componentDidUpdate:function(e,t){var n=this.state,r=n.caret,a=n.phone;!this.input||t.phone===a&&t.caret===r||(this.input.selectionStart=r,this.input.selectionEnd=r)},resetValue:function(){this.setState({phone:""})},getPhone:function(e,t){return e.replace(/[^\d]/g,"").split("").reduce(function(e,t){return e.replace("*",t)},t).replace(/(^.*\d)(.*)$/,"$1").replace(/^\*.*/,"")},handleChange:function(e){var t=e.target.value,n=this.props,r=n.placeholder,a=n.onChange,o=this.input.selectionStart,s=r.replace(/\d/g,"*"),i=this.getPhone(t,s),c=this.state.phone,u=i!==this.state.phone&&o===t.length?i.length:o;a&&a(i,c),this.setValue(i),this.setState({phone:i,caret:u})},render:function(){var e=this,t=this.props,n=t.validate,r=t.className,o=t.prefix,s=t.autoFocus,i=t.placeholder,c=t.tabIndex,u=t.onKeyDown,l=t.onKeyUp,d=t.name,p=t.showPlus,f=t.disabled,m=this.state.phone,h=this.showError()&&n?"form-field__input--error":null,y=n&&this.getErrorMessage();return a.default.createElement("div",{className:r},a.default.createElement("label",{className:"form-field-tel registration__form-field",htmlFor:"phone-input",disabled:!!f},p&&a.default.createElement("span",{className:"form-field-tel__code"},"+",o),a.default.createElement("input",{className:"form-field-tel__number",autoComplete:"off",id:"phone-input",type:"tel",name:d,value:m,autoFocus:s,placeholder:i,onChange:this.handleChange,onKeyDown:u,onKeyUp:l,tabIndex:c,ref:function(t){e.input=t},disabled:!!f}),a.default.createElement("i",{className:"form-field-tel__border ".concat(h)})),a.default.createElement("p",{className:"registration__desc registration__desc--warning"},y))}}),l=u;t.default=l},"./app/components/SearchFiltersPanel.js":function(e,t,n){"use strict";function r(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!r(e,t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}function c(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?l(e):t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var d=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),p=n("./node_modules/react-intl/lib/index.es.js"),f=function(e){return e&&e.__esModule?e:{default:e}}(n("./app/components/SearchInput.js")),m=function(e){function t(e){var n;return o(this,t),n=c(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),Object.defineProperty(l(n),"handleButtonClick",{configurable:!0,enumerable:!0,writable:!0,value:function(e){n.setState({filter:e}),n.props.onButtonClick(e)}}),n.state={filter:"all"},n}return u(t,e),i(t,[{key:"componentDidMount",value:function(){var e;(null===(e=this.props)||void 0===e?void 0:e.value)&&this.setState({filter:this.props.value})}},{key:"componentWillReceiveProps",value:function(e){(null===e||void 0===e?void 0:e.value)&&this.setState({filter:e.value})}},{key:"render",value:function(){var e=this,t=this.props,n=t.name,r=t.placeholder,a=t.onInputChange,o=t.children,s=t.text,i=this.state.filter,c="btn btn--filter search-filter-panel__filter-btn",u="btn btn--filter btn--filter-active search-filter-panel__filter-btn";return d.default.createElement("div",{className:"search-filter-panel search-filter-panel--".concat(n)},d.default.createElement(f.default,{onInputChange:a,placeholder:r,text:s}),o,d.default.createElement("div",{className:"search-filter-panel__filter"},d.default.createElement("button",{className:"all"===i?u:c,onClick:function(){return e.handleButtonClick("all")}},d.default.createElement(p.FormattedMessage,{id:"[filter] all",defaultMessage:"All"})),d.default.createElement("button",{className:"cts"===i?u:c,onClick:function(){return e.handleButtonClick("cts")}},d.default.createElement(p.FormattedMessage,{id:"[filter] corporate",defaultMessage:"Corporate"})),d.default.createElement("button",{className:"rts"===i?u:c,onClick:function(){return e.handleButtonClick("rts")}},d.default.createElement(p.FormattedMessage,{id:"[filter] personal",defaultMessage:"Personal"}))))}}]),t}(d.Component);t.default=m},"./app/components/SearchInput.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){if(!a(e,t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function u(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?d(e):t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),f=r(n("./app/assets/icons/search.svg")),m=r(n("./app/assets/icons/search-clear.svg")),h=n("./app/helpers/reactHelpers.js"),y=n("./lib/deepEqual.js"),_=function(e){function t(e){var n;return s(this,t),n=u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),Object.defineProperty(d(n),"getText",{configurable:!0,enumerable:!0,writable:!0,value:function(){var e=n.props.text,t=n.state.text;return void 0===e?t:e}}),Object.defineProperty(d(n),"handleInputChange",{configurable:!0,enumerable:!0,writable:!0,value:function(e){var t=e.target.value;n.setState({text:t}),n.props.onInputChange(t)}}),Object.defineProperty(d(n),"handleInputReset",{configurable:!0,enumerable:!0,writable:!0,value:function(){n.setState({text:""}),n.props.onInputChange("")}}),Object.defineProperty(d(n),"handleChipsDiv",{configurable:!0,enumerable:!0,writable:!0,value:function(e){n.chipsDiv=e,n.recalculateChips()}}),n.state={text:"",chipsWidth:0},n.chipsDiv=null,n}return l(t,e),c(t,[{key:"shouldComponentUpdate",value:function(e,t){var n=["name","placeholder","text","chips"];return(0,h.isShouldComponentUpdate)(this.props,e,n)||!(0,y.equal)(this.state,t)}},{key:"componentDidUpdate",value:function(e){e.chips!==this.props.chips&&this.recalculateChips()}},{key:"recalculateChips",value:function(){this.chipsDiv&&this.setState({chipsWidth:this.chipsDiv.clientWidth})}},{key:"render",value:function(){var e=this.props,t=e.placeholder,n=e.chips,r=e.onRemoveChips,a=this.state.chipsWidth,o=this.getText(),s=o?p.default.createElement(m.default,{width:"24",height:"24",className:"search-filter-panel__icon search-filter-panel__icon--clear",onClick:this.handleInputReset}):p.default.createElement(f.default,{width:"24",height:"24",className:"search-filter-panel__icon search-filter-panel__icon--search"});return p.default.createElement("div",{className:"form-field search-filter-panel__search"},n&&p.default.createElement("div",{className:"form-field__chips",ref:this.handleChipsDiv,onClick:r},p.default.createElement("span",{className:"form-field__chips-text"},n),p.default.createElement(m.default,{width:"16",height:"16",className:"form-field__chips-clear"})),p.default.createElement("input",{id:"search-input",className:"form-field__input search-filter-panel__input",placeholder:t,onChange:this.handleInputChange,value:o,style:{paddingLeft:a+20}}),s)}}]),t}(p.Component);t.default=_},"./app/components/UpdateDialog.js":function(e,t,n){"use strict";function r(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!r(e,t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}function c(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?u(e):t}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var d=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),p=n("./node_modules/react-intl/lib/index.es.js"),f=function(e){function t(){return o(this,t),c(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return l(t,e),i(t,[{key:"render",value:function(){var e=this.props.ui.availableAppVersion;return d.default.createElement("div",{className:"update-dialog"},d.default.createElement("div",{className:"update-dialog__popup"},d.default.createElement("p",{className:"update-dialog__message"},d.default.createElement(p.FormattedMessage,{id:"[update] caption",defaultMessage:"We proudly introduce you new app version {availableAppVersion}",values:{availableAppVersion:e}})),d.default.createElement("button",{className:"btn btn--submit update-dialog__btn",onClick:this.props.onAccept},d.default.createElement(p.FormattedMessage,{id:"[update] submit",defaultMessage:"Update"}))))}}]),t}(d.PureComponent);t.default=f},"./app/components/VCardLoader.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function s(e,t){if(!o(e,t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function u(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?l(e):t}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),f=r(n("./node_modules/vcf/lib/vcard.js")),m=r(n("./app/components/Contacts/ContactList.js")),h=function(e){function t(e){var n;return s(this,t),n=u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),n.state={vcard:void 0},n}return d(t,e),c(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props.url;fetch(t).then(function(e){return e.text()}).then(function(t){e.setState({vcard:f.default.parse(t)})})}},{key:"getData",value:function(e){var t=this.state.vcard,n=t.get(e);return o(n,Array)?n.map(function(e){return e.valueOf()}):null===n||void 0===n?void 0:n.valueOf()}},{key:"render",value:function(){var e=this.state.vcard,t=this.props,n=t.name,r=t.avatar;return e?p.default.createElement("div",{className:"vcard"},p.default.createElement("div",{className:"vcard__avatar"},p.default.createElement("img",{className:"vcard__avatar-img",src:r,role:"presentation"})),p.default.createElement("h4",{className:"vcard__name"},n),p.default.createElement("div",{className:"vcard__info"},p.default.createElement(m.default,{contacts:[{contact:this.getData("tel"),contact_type:"phone"},{contact:this.getData("email"),contact_type:"email"},{contact:this.getData("org"),contact_type:"org"}]}))):p.default.createElement("div",{className:"vcard"},"Loading...")}}]),t}(p.Component);t.default=h},"./app/containers/App.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}function o(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){if(!o(e,t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t,n){return t&&c(e.prototype,t),n&&c(e,n),e}function l(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?p(e):t}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function p(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var f=a(n("./node_modules/react/index.js")),m=n("./node_modules/react-router-dom/es/index.js"),h=n("./node_modules/react-redux/lib/index.js"),y=r(n("./node_modules/history/createHashHistory.js")),_=n("./app/modules/ui.js"),b=n("./app/modules/notifiers.js"),v=a(n("./app/modules/voex.js")),g=n("./app/modules/user.js"),E=r(n("./app/containers/Auth.js")),S=r(n("./app/containers/Contacts/EntryListContainer.js")),O=r(n("./app/containers/Chats/ChatsPageContainer.js")),C=r(n("./app/containers/Layout/UiAlert.js")),w=r(n("./app/containers/Settings/Settings.js")),j=r(n("./app/components/UpdateDialog.js")),k=r(n("./app/containers/Voex/Voex.js")),P=r(n("./app/components/LoadingOverlay.js")),T=r(n("./app/containers/Layout/Favicon.js")),x=r(n("./app/assets/icons/cross.svg")),M=(0,y.default)(),N=function(e){function t(){var e,n,r;i(this,t);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return l(r,(n=r=l(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),Object.defineProperty(p(r),"handleUpdateAccepted",{configurable:!0,enumerable:!0,writable:!0,value:function(){r.props.updateApp()}}),Object.defineProperty(p(r),"handleUpdateDeclined",{configurable:!0,enumerable:!0,writable:!0,value:function(){r.props.hideUpdateDialog()}}),n))}return d(t,e),u(t,[{key:"componentDidMount",value:function(){var e=this.props.user.authStatus;this.redirectToPageBasedOnAuth(void 0,e)}},{key:"componentDidUpdate",value:function(e){var t=e.user.authStatus,n=this.props.user.authStatus,r=this.props.ui.showUiAlert;this.redirectToPageBasedOnAuth(t,n,r)}},{key:"redirectToPageBasedOnAuth",value:function(e,t,n){if(n&&!this.isOnPage("/alert"))return void M.push("/alert");if(!1===n&&this.isOnPage("/alert"))return void M.push("/chats");if(e!==t)return t===g.authStatusEnum.registered||this.isOnPage("/auth")?t===g.authStatusEnum.registered&&(this.isOnPage("/")||this.isOnPage("/auth"))?void M.push("/chats"):void 0:void M.push("/auth")}},{key:"isOnPage",value:function(e){return this.props.location.pathname===e}},{key:"renderNotifiers",value:function(){var e=this;return this.props.notifiers.map(function(t,n){return f.default.createElement("div",{className:"notifier notifier--".concat(t.type),key:n},f.default.createElement("span",{className:"notifier__text"},t.text),f.default.createElement("button",{className:"btn notifier__close",onClick:function(){return e.props.dismissNotifier(n)}},f.default.createElement(x.default,{className:"btn__icon",width:"21",height:"21"})))})}},{key:"render",value:function(){var e=this.props,t=e.ui,n=e.user,r=e.activeVoexMinimized,a=n.authStatus===g.authStatusEnum.registered?f.default.createElement(m.Switch,null,f.default.createElement(m.Route,{path:"/contacts",component:S.default}),f.default.createElement(m.Route,{path:"/chats",component:O.default}),f.default.createElement(m.Route,{path:"/settings",component:w.default}),f.default.createElement(m.Route,{path:"/alert",component:C.default})):f.default.createElement(m.Route,{path:"/auth",component:E.default});return f.default.createElement("div",{className:"layout"},f.default.createElement(T.default,null),t.showUpdateDialog&&f.default.createElement(j.default,{ui:t,onAccept:this.handleUpdateAccepted,onDecline:this.handleUpdateDeclined}),t.showLoadingOverlay&&f.default.createElement(P.default,null),f.default.createElement("div",{className:"layout__app ".concat(r?"layout__app--voice-call":"")},f.default.createElement(k.default,null),a),this.renderNotifiers())}}]),t}(f.Component),A=function(e){return{user:e.user,notifiers:e.notifiers,ui:e.ui,activeVoexMinimized:e.voex.status!==v.callStatusEnum.idle&&e.voex.minimized}},R=(0,h.connect)(A,{dismissNotifier:b.dismissNotifier,hideUpdateDialog:_.hideUpdateDialog,updateApp:_.updateApp})(N);t.default=R},"./app/containers/Auth.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){if(!a(e,t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function u(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?d(e):t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),f=n("./node_modules/react-redux/lib/index.js"),m=n("./node_modules/react-intl/lib/index.es.js"),h=n("./app/modules/user.js"),y=n("./app/modules/encryptionKeys.js"),_=n("./app/modules/ui.js"),b=r(n("./app/components/Auth/KeysNew.js")),v=r(n("./app/components/Auth/Phone.js")),g=r(n("./app/components/Auth/KeysDecrypt.js")),E=r(n("./app/components/Auth/Profile.js")),S=r(n("./app/components/Auth/CtsLogin.js")),O=r(n("./app/components/Auth/CtsWebLogin.js")),C=r(n("./app/components/Auth/Confirm.js")),w=r(n("./app/components/Auth/Locale.js")),j=r(n("./app/components/Auth/QrCode.js")),k=r(n("./app/components/Auth/Pagination.js")),P=r(n("./app/assets/icons/registration-logo.svg")),T=r(n("./lib/config.js")),x=r(n("./app/assets/icons/qrcode.svg")),M=r(n("./lib/uuid5.js")),N=function(e){function t(){var e,n,r;s(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return u(r,(n=r=u(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),Object.defineProperty(d(r),"handleConfirmSubmit",{configurable:!0,enumerable:!0,writable:!0,value:function(e,t){r.props.confirm(e,t)}}),Object.defineProperty(d(r),"handleProfileSubmit",{configurable:!0,enumerable:!0,writable:!0,value:function(e){var t=e.name,n=e.avatar;r.props.uploadProfile(t,n)}}),Object.defineProperty(d(r),"handleKeysDecryptSubmit",{configurable:!0,enumerable:!0,writable:!0,value:function(e){r.props.decryptUserPrivateKeys(e)}}),Object.defineProperty(d(r),"handleCtsLogin",{configurable:!0,enumerable:!0,writable:!0,value:function(e,t,n,a){r.props.loginCts(e,t,n,a)}}),Object.defineProperty(d(r),"handleCtsSkip",{configurable:!0,enumerable:!0,writable:!0,value:function(){r.props.authStatusChanged(h.authStatusEnum.registered)}}),Object.defineProperty(d(r),"handleCtsWebLogin",{configurable:!0,enumerable:!0,writable:!0,value:function(e,t){r.props.loginCtsWeb(T.default.ccsHost,e,t)}}),Object.defineProperty(d(r),"handleCtsLogout",{configurable:!0,enumerable:!0,writable:!0,value:function(e,t,n){e?r.props.requestLogoutCts():r.props.confirm(t,n,!0)}}),Object.defineProperty(d(r),"handleKeysNewSubmit",{configurable:!0,enumerable:!0,writable:!0,value:function(e){r.props.uploadUserKeys(e)}}),Object.defineProperty(d(r),"handlePhoneSubmit",{configurable:!0,enumerable:!0,writable:!0,value:function(e,t){r.props.register(e,t)}}),Object.defineProperty(d(r),"handleSetLocale",{configurable:!0,enumerable:!0,writable:!0,value:function(e){r.props.setLocale(e)}}),Object.defineProperty(d(r),"handleAuthWithQrCode",{configurable:!0,enumerable:!0,writable:!0,value:function(){r.props.authStatusChanged(h.authStatusEnum.qrCode)}}),Object.defineProperty(d(r),"handleAuthWithPhone",{configurable:!0,enumerable:!0,writable:!0,value:function(){r.props.authStatusChanged(h.authStatusEnum.unregistered)}}),Object.defineProperty(d(r),"handleQrRegisterRequest",{configurable:!0,enumerable:!0,writable:!0,value:function(){r.props.qrRegisterRequest()}}),Object.defineProperty(d(r),"renderAuthComponent",{configurable:!0,enumerable:!0,writable:!0,value:function(){var e=r.props,t=e.fetching,n=e.user,a=e.qrRequestKeys,o=n.authStatus,s=n.keysDecryptAttempts;switch(o){case h.authStatusEnum.confirm:return p.default.createElement(C.default,{user:r.props.user,onSubmit:r.handleConfirmSubmit,resendConfirmationCode:r.props.resendConfirmationCode,onResetAuth:r.props.resetAuth});case h.authStatusEnum.ctsRegular:case h.authStatusEnum.ctsMultidevice:case h.authStatusEnum.ctsRequestLogout:case h.authStatusEnum.ctsOffer:case h.authStatusEnum.ctsForce:return p.default.createElement(S.default,{user:r.props.user,onCtsLogin:r.handleCtsLogin,onCtsLogout:r.handleCtsLogout,fetching:t,onLogoutRts:r.props.logoutRts,onCtsSkip:r.handleCtsSkip});case h.authStatusEnum.profile:return p.default.createElement(E.default,{onSubmit:r.handleProfileSubmit,fetching:t});case h.authStatusEnum.keysPassDecrypt:return p.default.createElement(g.default,{onSubmit:r.handleKeysDecryptSubmit,user:n});case h.authStatusEnum.emptyKeysPass:case h.authStatusEnum.newKeysPass:return p.default.createElement(b.default,{onSubmit:r.handleKeysNewSubmit,keysDecryptAttempts:s,fetching:t});case h.authStatusEnum.unregistered:return T.default.ctsWeb?p.default.createElement(O.default,{onCtsWebLogin:r.handleCtsWebLogin}):p.default.createElement(v.default,{user:r.props.user,regionChanged:r.props.regionChanged,onSubmit:r.handlePhoneSubmit,fetching:t,loadServerPublicKeys:r.props.loadServerPublicKeys,onComponentMount:function(){return r.props.setUserData({udid:(0,M.default)()})}});case h.authStatusEnum.qrCode:case h.authStatusEnum.qrMultidevice:return p.default.createElement(j.default,{user:n,keys:a,onSendQrRegisterRequest:r.handleQrRegisterRequest,onGoBack:r.handleAuthWithPhone});default:return null}}}),n))}return l(t,e),c(t,[{key:"componentDidUpdate",value:function(e){var t=e.user.ctsAuthToken,n=this.props.user.ctsAuthToken;this.handleCtsStatusChange(t,n)}},{key:"handleCtsStatusChange",value:function(e,t){var n=this.props.user,r=n.authToken,a=n.rtsHost,o=n.code;e||!t||r||this.props.confirm(a,o,!1)}},{key:"renderQrAuth",value:function(){return this.props.user.authStatus!==h.authStatusEnum.unregistered?null:p.default.createElement("div",{className:"registration__qrcode"},p.default.createElement("div",{className:"registration__qrcode-wrapper",onClick:this.handleAuthWithQrCode},p.default.createElement(x.default,{width:"30",height:"30",className:"registration__qrcode-icon"}),p.default.createElement("div",{className:"registration__qrcode-link"},p.default.createElement(m.FormattedMessage,{id:"[auth qrcode] link",defaultMessage:"Login with QR code"}))))}},{key:"render",value:function(){var e=this.props,t=e.locale,n=e.user;return p.default.createElement("div",{className:"registration"},p.default.createElement("div",{className:"registration__lang"},p.default.createElement(w.default,{setLocale:this.handleSetLocale,locale:t})),![h.authStatusEnum.qrCode,h.authStatusEnum.qrMultidevice].includes(n.authStatus)&&p.default.createElement("header",{className:"registration__header"},p.default.createElement(P.default,{width:"195",height:"168",className:"registration__logo"})),this.renderAuthComponent(),p.default.createElement("div",{className:"registration__pagination"},this.renderQrAuth(),p.default.createElement(k.default,{user:n})))}}]),t}(p.Component),A=function(e){return{user:e.user,locale:e.ui.locale,fetching:e.ui.authFetching,qrRequestKeys:e.encryptionKeys.qrRequest}},R=(0,f.connect)(A,{regionChanged:h.regionChanged,register:h.register,confirm:h.confirm,uploadProfile:h.uploadProfile,uploadUserKeys:y.uploadUserKeys,decryptUserPrivateKeys:y.decryptUserPrivateKeys,loginCts:h.loginCts,loginCtsWeb:h.loginCtsWeb,requestLogoutCts:h.requestLogoutCts,setLocale:_.setLocale,resendConfirmationCode:h.resendConfirmationCode,resetAuth:h.resetAuth,logoutRts:h.logoutRts,authStatusChanged:h.authStatusChanged,qrRegisterRequest:h.qrRegisterRequest,loadServerPublicKeys:y.loadServerPublicKeys,setUserData:h.setUserData})(N);t.default=R},"./app/containers/Chats/ChatContainer.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e){return i(e)||s(e)||o()}function o(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function s(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function i(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}function c(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){if(!c(e,t))throw new TypeError("Cannot call a class as a function")}function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e,t,n){return t&&d(e.prototype,t),n&&d(e,n),e}function f(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?h(e):t}function m(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var y=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),_=r(n("./node_modules/react-dropzone/dist/es/index.js")),b=n("./node_modules/react-redux/lib/index.js"),v=n("./node_modules/lodash/lodash.js"),g=n("./node_modules/react-intl/lib/index.es.js"),E=n("./app/modules/messages.js"),S=n("./app/modules/chats.js"),O=n("./app/modules/ui.js"),C=n("./app/modules/membersTyping.js"),w=n("./app/modules/drafts.js"),j=n("./app/modules/voex.js"),k=n("./app/modules/botx.js"),P=n("./app/modules/notifiers.js"),T=n("./app/selectors/chatsSelectors.js"),x=n("./app/selectors/messagesSelectors.js"),M=n("./app/selectors/phonebookSelectors.js"),N=n("./app/helpers/messagesHelpers.js"),A=n("./app/helpers/reactHelpers.js"),R=n("./lib/deepEqual.js"),I=r(n("./app/components/Chats/ChatHeader.js")),D=r(n("./app/components/Chats/ChatInput.js")),L=r(n("./app/components/Chats/MessageEntry.js")),U=r(n("./app/components/Chats/Botx/BotMessageEntry.js")),F=r(n("./app/components/Chats/SystemEventEntry.js")),H=r(n("./app/components/Chats/InfiniteScroll.js")),K=r(n("./app/components/DragNDropDialog.js")),B=r(n("./app/components/App/Modal.js")),G=n("./app/components/Chats/Botx/BotxContextMenu.js"),Y=n("./lib/constants.js"),V=r(n("./app/assets/icons/loader.svg")),W=n("./lib/sockets.js"),q=n("./app/helpers/clipboardHelpers.js"),z=n("./app/helpers/attachmentHelpers.js"),Q=function(e){function t(e){var n;return l(this,t),n=f(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),X.call(h(n)),n.state={botxModalMessage:null,botxModalAction:null,botxContextMenuShowedFor:null,isDragNDrop:!1,sendFiles:null},n.botxInput=null,n.setScrollPosition=null,n.currScrollPosition="bottom",n.newMessages=[],n}return m(t,e),p(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.chatUi,n=e.chat,r=n||{},a=r.backward,o=r.group_chat_id,s=a&&t.prevState!==O.chatState.uninitialized&&t.prevState!==O.chatState.initLoading?O.chatState.idle:O.chatState.initLoading;this.props.setChatFsmState(o,s),document.body.addEventListener("paste",this.handlePaste)}},{key:"componentWillReceiveProps",value:function(e){var t=this.props.chatUi.state,n=e.chatUi.state;e.chatId&&t!==n&&this.handleFsmStateChanged(e),this.props.appInFocus!==e.appInFocus&&this.handleAppFocusChanged(e.appInFocus)}},{key:"shouldComponentUpdate",value:function(e,t){var n=["user","messages","chat","chatUi","phonebook","chatHistoryLoader","callOfferAllowed","isChatHistorySearchVisible"];return(0,A.isShouldComponentUpdate)(this.props,e,n)||!(0,R.equal)(this.state,t)}},{key:"componentWillUpdate",value:function(e){if(e.chatUi.state!==O.chatState.switchChat){var t=e.messages.length-this.props.messages.length;if(0===t)return;var n=e.messages.slice(e.messages.length-t);e.appInFocus?this.props.sendMessageMarkReadReports(n):this.newMessages=this.newMessages.concat(n)}}},{key:"componentWillUnmount",value:function(){this.props.showChatHistorySearch(!1),document.body.removeEventListener("paste",this.handlePaste)}},{key:"renderMessages",value:function(e,t,n){var r=this;return(null===t||void 0===t?void 0:t.length)?t.map(function(a,o){if((0,N.isBotMessage)(a))return y.default.createElement(U.default,{key:a.sync_id,message:a,chat:n,locale:r.props.locale,showDateSplitter:(0,N.showDateSplitter)(a,t[o-1]),botxContextMenuId:G.BOTX_CONTEXT_MENU,botxContextMenuOnItemClick:r.handleBotxContextMenuItemClick,active:r.state.botxContextMenuShowedFor===a.sync_id});if("message_new"===a.event_type){var s=o===t.length-1;return y.default.createElement(L.default,{key:a.sync_id,message:a,user:e,chat:n,locale:r.props.locale,showDateSplitter:(0,N.showDateSplitter)(a,t[o-1]),showPositionSplitter:a.sync_id===n.position_event_sync_id&&!s,showSenderProfile:(0,N.showSenderProfile)(a,t[o-1]),loadAttachment:r.handleLoadAttachment.bind(r,a)})}return y.default.createElement(F.default,{key:a.sync_id,event:a,chat:n,showDateSplitter:(0,N.showDateSplitter)(a,t[o-1])})}):this.props.chatHistoryLoader?y.default.createElement("div",{className:"chat-status"},y.default.createElement(V.default,{className:"chat-status__loader",width:"38",height:"38"})):y.default.createElement("div",{className:"chat-status"},y.default.createElement("strong",{className:"chat-status__message"},y.default.createElement(g.FormattedMessage,{id:"[chat] no messages",defaultMessage:"No messages yet"})))}},{key:"render",value:function(){var e,t=this,n=this.props,r=n.user,a=n.messages,o=n.chat,s=n.chatId,i=n.chatUi,c=n.phonebook,u=n.callOfferAllowed,l=this.state,d=l.botxModalMessage,p=l.botxModalAction,f=l.isDragNDrop,m=l.sendFiles;if(!o)return null;m&&this.setState({sendFiles:null});var h=i.state!==O.chatState.idle||i.fullHistoryLoaded,b=this.renderMessages(r,a,o),v=this.setScrollPosition;return this.setScrollPosition=null,y.default.createElement(_.default,{disableClick:!0,className:"chat",onDrop:this.handleDropFile,onDragEnter:this.handleDragStart,onDragLeave:this.handleDragEnd},f&&y.default.createElement("div",{className:"chat__drag-overlay"},y.default.createElement("div",{className:"chat__drag-overlay--text"},y.default.createElement(g.FormattedMessage,{id:"[chat] dropzone",defaultMessage:"Drop files here"}))),y.default.createElement(K.default,{files:m,onSubmit:this.handleSendDragNDropFiles}),y.default.createElement("div",{className:"layout-pane__header"},y.default.createElement(I.default,{chat:o,user:r,callOfferAllowed:u,onCallClick:function(e){var n;return t.props.sendCallOffer(null===(n=o.opponent)||void 0===n?void 0:n.user_huid,e)},onToggleSearchChatHistory:this.handleToggleSearchChatHistory})),y.default.createElement("div",{className:"layout-pane__body"},y.default.createElement("div",{className:"chat__infinite-scroll chat__infinite-scroll--".concat(o.connType)},y.default.createElement(H.default,{scrollPosition:v,onScroll:this.handleScroll,disableScroll:h,loadPrevious:this.handleLoadPrevious,chatId:s},b)),y.default.createElement("div",{className:"chat__input"},y.default.createElement(D.default,{chat:o,phonebook:c,chatUi:i,onMemberTyping:this.handleMemberTyping,onMessage:this.handleSendMessage,onAttachment:this.handleSendAttachment,onInputTextChanged:this.handleInputTextChanged}))),y.default.createElement(G.ConnectedBotxContextMenu,{onShow:function(e){return t.setState({botxContextMenuShowedFor:e.detail.data.message.sync_id})},onHide:function(){return t.setState({botxContextMenuShowedFor:null})}}),y.default.createElement(B.default,{name:"botx-input",caption:null===p||void 0===p?void 0:p.label,isOpen:null!==d,onClose:function(){return t.setState({botxModalMessage:null,botxModalAction:null})}},y.default.createElement("div",{className:"modal__body-title"},null===d||void 0===d?void 0:null===(e=d.payload)||void 0===e?void 0:e.preview),y.default.createElement("div",{className:"form-field"},y.default.createElement("div",{className:"form-field__input form-field__input--contenteditable",ref:function(e){t.botxInput=e},contentEditable:!0})),y.default.createElement("div",{className:"modal__actions modal__actions--submit"},y.default.createElement("button",{className:"btn btn--default modal__btn",onClick:function(){var e,n;t.props.handleBotxAction(d,p,{text:null===(e=t.botxInput)||void 0===e?void 0:null===(n=e.innerText)||void 0===n?void 0:n.trim()}),t.setState({botxModalMessage:null,botxModalAction:null})}},y.default.createElement(g.FormattedMessage,{id:"[chat] send msg",defaultMessage:"Send"})))))}}]),t}(y.Component),X=function(){var e=this;Object.defineProperty(this,"getScrollPosition",{configurable:!0,enumerable:!0,writable:!0,value:function(e){var t=e.chatUi.state,n=e.chatUi.prevState;return t===O.chatState.idle&&[O.chatState.initLoading,O.chatState.sendMessage,O.chatState.receiveMessage].includes(n)?"bottom":t===O.chatState.idle&&n===O.chatState.switchChat&&e.chatUi.scrollPosition}}),Object.defineProperty(this,"isChatActive",{configurable:!0,enumerable:!0,writable:!0,value:function(){var t=e.props.chat||{},n=t.left,r=t.active;return!n&&r}}),Object.defineProperty(this,"scrollDebouncer",{configurable:!0,enumerable:!0,writable:!0,value:(0,v.debounce)(function(t,n){e.props.setChatScrollPosition(t,n)},50)}),Object.defineProperty(this,"handleFsmStateChanged",{configurable:!0,enumerable:!0,writable:!0,value:function(t){var n=e.props.chatUi.state,r=t.chatUi.state,a=t.chatId,o=t.chat||{},s=o.backward;switch(r){case O.chatState.idle:e.setScrollPosition=e.getScrollPosition(t),e.handleFirstVisibleMessage(t),[O.chatState.initLoading,O.chatState.switchChat].includes(n)&&(e.props.sendMessageMarkReadReports(t.messages),e.props.cleanBadge(a));break;case O.chatState.initLoading:e.props.loadHistoryBackward(a,!0);break;case O.chatState.switchChat:var i=s?O.chatState.idle:O.chatState.initLoading;e.props.setChatFsmState(a,i)}}}),Object.defineProperty(this,"handleFirstVisibleMessage",{configurable:!0,enumerable:!0,writable:!0,value:function(t){var n=t.chatId,r=t.messages,a=t.chatUi,o=a.prevState,s=a.scrollPosition,i=[O.chatState.sendMessage,O.chatState.receiveMessage].includes(o)&&"bottom"===e.currScrollPosition,c=o===O.chatState.initLoading,u=O.chatState.switchChat===o&&"bottom"===s;if(i||c||u){var l=r.length>=Y.MAX_VISIBLE_MESSAGES?r[r.length-Y.MAX_VISIBLE_MESSAGES-1]:r[0];e.props.setChatFirstVisibleMessage(n,null===l||void 0===l?void 0:l.sync_id)}}}),Object.defineProperty(this,"handleAppFocusChanged",{configurable:!0,enumerable:!0,writable:!0,value:function(t){t&&e.newMessages.length&&(e.props.sendMessageMarkReadReports(e.newMessages),e.newMessages=[])}}),Object.defineProperty(this,"handleLoadAttachment",{configurable:!0,enumerable:!0,writable:!0,value:function(t){t.payload.attachmentLoaded||e.props.loadMessageFile(t.payload.msg_id)}}),Object.defineProperty(this,"handleLoadPrevious",{configurable:!0,enumerable:!0,writable:!0,value:function(){e.props.loadHistoryBackward(e.props.chatId,!1)}}),Object.defineProperty(this,"handleScroll",{configurable:!0,enumerable:!0,writable:!0,value:function(t){e.props.chatId&&(e.currScrollPosition=t,e.scrollDebouncer(e.props.chatId,t))}}),Object.defineProperty(this,"handleSendMessage",{configurable:!0,enumerable:!0,writable:!0,value:function(t){var n=e.props.chatId;e.props.chatsSearchTextChanged(""),e.props.draftMessageChanged(n,null),e.props.sendMessage(n,"text",t)}}),Object.defineProperty(this,"handleInputTextChanged",{configurable:!0,enumerable:!0,writable:!0,value:function(t){e.props.changeDraftMessage(e.props.chatId,t)}}),Object.defineProperty(this,"handleSendAttachment",{configurable:!0,enumerable:!0,writable:!0,value:function(t,n){e.props.sendMessage(e.props.chatId,t,n)}}),Object.defineProperty(this,"handleMemberTyping",{configurable:!0,enumerable:!0,writable:!0,value:function(t,n){n&&e.props.addMemberTyping(t),n||e.props.removeMemberTyping(t)}}),Object.defineProperty(this,"handleBotxContextMenuItemClick",{configurable:!0,enumerable:!0,writable:!0,value:function(t,n){var r=n.message,a=n.action;return"dialog_text"===a.type?e.setState({botxModalMessage:r,botxModalAction:a}):e.props.handleBotxAction(r,a)}}),Object.defineProperty(this,"handleDragStart",{configurable:!0,enumerable:!0,writable:!0,value:function(){e.isChatActive()&&e.setState({isDragNDrop:!0})}}),Object.defineProperty(this,"handleDragEnd",{configurable:!0,enumerable:!0,writable:!0,value:function(){e.setState({isDragNDrop:!1})}}),Object.defineProperty(this,"handleDropFile",{configurable:!0,enumerable:!0,writable:!0,value:function(t){e.isChatActive()&&e.setState({isDragNDrop:!1,sendFiles:t})}}),Object.defineProperty(this,"handleSendDragNDropFiles",{configurable:!0,enumerable:!0,writable:!0,value:function(t){t.forEach(function(t){return e.props.sendMessage(e.props.chatId,t.type,t.message)}),e.setState({sendFiles:null})}}),Object.defineProperty(this,"handlePasteImages",{configurable:!0,enumerable:!0,writable:!0,value:function(t){var n=e.state.sendFiles;Promise.all(t.map(function(e){return(0,z.readClipboardFile)(e)})).then(function(t){return e.setState({sendFiles:a(n||[]).concat(a(t))})})}}),Object.defineProperty(this,"handlePasteText",{configurable:!0,enumerable:!0,writable:!0,value:function(t){var n=t.clipboardData.getData("text/plain");document.execCommand("inserttext",!1,n),e.props.changeDraftMessage(e.props.chatId,n)}}),Object.defineProperty(this,"handlePaste",{configurable:!0,enumerable:!0,writable:!0,value:function(t){if(!e.isChatActive())return!0;var n=(0,q.getClipboardImages)(t);return n.length&&e.handlePasteImages(n),n.length||e.handlePasteText(t),t.preventDefault(),!1}}),Object.defineProperty(this,"handleToggleSearchChatHistory",{configurable:!0,enumerable:!0,writable:!0,value:function(){var t=e.props.isChatHistorySearchVisible;e.props.showChatHistorySearch(!t)}})},J=function(){var e=(0,T.makeGetCurrentChat)();return function(t,n){var r=e(t,n),a=(0,W.getGroupChannel)(null===r||void 0===r?void 0:r.group_chat_id);return{chat:r,chatId:null===r||void 0===r?void 0:r.group_chat_id,user:t.user,messages:(0,x.getChatEvents)(t,n),chatUi:r&&t.ui.chats[r.group_chat_id]||{},appInFocus:t.ui.appInFocus,phonebook:(0,M.getActivePhonebookEntryListWithStatuses)(t),locale:t.ui.locale,chatHistoryLoader:t.ui.chatHistoryLoader,callOfferAllowed:t.voex.status===j.callStatusEnum.idle&&(null===a||void 0===a?void 0:a.isJoined()),isChatHistorySearchVisible:t.ui.showChatHistorySearch}}},Z=(0,b.connect)(J,{sendMessage:E.sendMessage,loadHistoryBackward:S.loadHistoryBackward,addMemberTyping:C.addMemberTyping,removeMemberTyping:C.removeMemberTyping,sendMessageMarkReadReports:E.sendMessageMarkReadReports,loadMessageFile:E.loadMessageFile,setChatScrollPosition:O.setChatScrollPosition,setChatFsmState:O.setChatFsmState,cleanBadge:S.cleanBadge,changeDraftMessage:w.changeDraftMessage,draftMessageChanged:w.draftMessageChanged,sendCallOffer:j.sendCallOffer,handleBotxAction:k.handleBotxAction,showNotifier:P.showNotifier,chatsSearchTextChanged:O.chatsSearchTextChanged,setChatFirstVisibleMessage:O.setChatFirstVisibleMessage,showChatHistorySearch:O.showChatHistorySearch})(Q);t.default=Z},"./app/containers/Chats/ChatFilesContainer.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){if(!a(e,t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function u(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?d(e):t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),f=r(n("./node_modules/history/createHashHistory.js")),m=n("./node_modules/react-redux/lib/index.js"),h=n("./node_modules/react-router-dom/es/index.js"),y=n("./node_modules/react-intl/lib/index.es.js"),_=n("./app/selectors/chatsSelectors.js"),b=n("./app/selectors/attachmentsSelectors.js"),v=n("./app/modules/attachments.js"),g=r(n("./app/components/Chats/ChatMediaGallery.js")),E=r(n("./app/components/Chats/ChatDocumentFile.js")),S=r(n("./app/components/App/DropdownMenu.js")),O=n("./app/helpers/chatsHelpers.js"),C=r(n("./app/assets/icons/arrow-left.svg")),w=r(n("./app/assets/icons/photo.svg")),j=r(n("./app/assets/icons/document.svg")),k=r(n("./app/assets/icons/loader.svg")),P=n("./lib/reactIntl.js"),T=(0,f.default)(),x=function(e){function t(e){var n;return s(this,t),n=u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),Object.defineProperty(d(n),"loadAttachment",{configurable:!0,enumerable:!0,writable:!0,value:function(e){var t=n.props,r=t.chat,a=t.user,o=r.group_chat_id,s="cts"===(0,O.chatMemberConnType)(r,a)?a.ctsServer:a.rtsHost;n.props.decryptAttachmentFile(o,e,s)}}),Object.defineProperty(d(n),"handleMenuChange",{configurable:!0,enumerable:!0,writable:!0,value:function(e){n.setState({menu:e}),T.push("/chats/".concat(n.props.match.params.id,"/files/").concat(e))}}),Object.defineProperty(d(n),"renderFiles",{configurable:!0,enumerable:!0,writable:!0,value:function(e){switch(n.state.menu){case"media":return n.renderMedia(e.filter(function(e){return!!e.preview_url}));case"documents":return n.renderDocuments(e.filter(function(e){return!e.preview_url}));default:return null}}}),n.state={menu:"media"},n}return l(t,e),c(t,[{key:"componentWillMount",value:function(){var e=this.props,t=e.chat,n=e.match;t||T.push("/chats/".concat(n.params.id))}},{key:"componentDidMount",value:function(){this.props.chat?(this.setState({menu:"media"===this.props.match.params.type?"media":"documents"}),this.props.loadAttachments(this.props.match.params.id)):T.push("/chats/".concat(this.props.match.params.id))}},{key:"renderMenu",value:function(){var e=this,t=(0,y.defineMessages)({media:{id:"[files] media",defaultMessage:"Foto and video"},documents:{id:"[files] docs",defaultMessage:"Documents"}}),n=p.default.createElement("div",{className:"chat__title chat__title--dropdown"},(0,P.formatMessage)(t[this.state.menu]));return p.default.createElement(S.default,{className:"dropdown-menu",trigger:n},p.default.createElement("div",{className:"dropdown-menu__item",onClick:function(){return e.handleMenuChange("media")}},p.default.createElement(w.default,{width:"16",height:"16",className:"dropdown-menu__icon"}),p.default.createElement("span",null,(0,P.formatMessage)(t.media))),p.default.createElement("div",{className:"dropdown-menu__item",onClick:function(){return e.handleMenuChange("documents")}},p.default.createElement(j.default,{width:"16",height:"16",className:"dropdown-menu__icon"}),p.default.createElement("span",null,(0,P.formatMessage)(t.documents))))}},{key:"renderMedia",value:function(e){return p.default.createElement(g.default,{files:e,loadAttachment:this.loadAttachment})}},{key:"renderDocuments",value:function(e){var t=this;return e.map(function(e,n){return p.default.createElement(E.default,{file:e,key:n,loadAttachment:t.loadAttachment.bind(t,e.sync_id)})})}},{key:"render",value:function(){var e=this.props,t=e.chat,n=e.attachments;if(!t)return null;var r=(null===n||void 0===n?void 0:n.files)||[],a=(null===n||void 0===n?void 0:n.isLoaded)?p.default.createElement("strong",{className:"layout-pane__body-title"},p.default.createElement(y.FormattedMessage,{id:"[chat] no files",defaultMessage:"No files in this chat"})):p.default.createElement(k.default,{width:"32",height:"32",className:"chat-status__loader"});return p.default.createElement("div",{className:"layout-pane__files"},p.default.createElement("div",{className:"layout-pane__header"},p.default.createElement("div",{className:"layout-pane__action layout-pane__action--back"},p.default.createElement(h.Link,{className:"btn btn--layout-back",to:"/chats/".concat(t.group_chat_id,"/settings")},p.default.createElement(C.default,{width:"24",height:"24",className:"btn__icon"}))),this.renderMenu()),p.default.createElement("div",{className:"layout-pane__body layout-pane__body--overflow"},(null===r||void 0===r?void 0:r.length)?this.renderFiles(r):a))}}]),t}(p.Component),M=function(){var e=(0,_.makeGetCurrentChat)(),t=(0,b.makeGetCurrentChatAttachments)();return function(n,r){return{chat:e(n,r),attachments:t(n,r),user:n.user}}},N=(0,m.connect)(M,{decryptAttachmentFile:v.decryptAttachmentFile,loadAttachments:v.loadAttachments})(x);t.default=N},"./app/containers/Chats/ChatMemberContainer.js":function(e,t,n){"use strict";function r(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!r(e,t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}function c(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?l(e):t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var d=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),p=n("./node_modules/react-redux/lib/index.js"),f=n("./app/modules/chats.js"),m=n("./app/modules/voex.js"),h=n("./app/selectors/profilesSelectors.js"),y=n("./app/selectors/chatsSelectors.js"),_=function(e){return e&&e.__esModule?e:{default:e}}(n("./app/components/Contacts/PhonebookEntryCard.js")),b=function(e){function t(){var e,n,r;o(this,t);for(var a=arguments.length,s=new Array(a),i=0;i<a;i++)s[i]=arguments[i];return c(r,(n=r=c(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),Object.defineProperty(l(r),"handleCreateChat",{configurable:!0,enumerable:!0,writable:!0,value:function(e){return r.props.createChat({members:[e],chat_type:"chat",name:"personal chat"})}}),Object.defineProperty(l(r),"handleCall",{configurable:!0,enumerable:!0,writable:!0,value:function(e,t){r.props.sendCallOffer(e.user_huid,t)}}),n))}return u(t,e),i(t,[{key:"render",value:function(){var e=this.props,t=e.entry,n=e.callOfferAllowed;return d.default.createElement(_.default,{entry:t,onCreatePersonalChat:this.handleCreateChat,onCall:this.handleCall,callOfferAllowed:n})}}]),t}(d.Component),v=function(e){return{user:e.user,chats:(0,y.getChatList)(e),entry:(0,h.getVirtualEntry)(e),callOfferAllowed:e.voex.status===m.callStatusEnum.idle}},g=(0,p.connect)(v,{createChat:f.createChat,sendCallOffer:m.sendCallOffer})(b);t.default=g},"./app/containers/Chats/ChatMessageContainer.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){if(!a(e,t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function u(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?l(e):t}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),f=n("./node_modules/react-redux/lib/index.js"),m=n("./node_modules/react-intl/lib/index.es.js"),h=r(n("./node_modules/history/createHashHistory.js")),y=n("./app/selectors/messagesSelectors.js"),_=n("./app/selectors/chatsSelectors.js"),b=r(n("./app/components/GoBackButton.js")),v=r(n("./app/components/Chats/MessageEntry.js")),g=r(n("./app/components/Contacts/PhonebookEntry.js")),E=n("./app/helpers/appHelpers.js"),S=n("./lib/timestamps.js"),O=r(n("./app/assets/icons/status-received.svg")),C=r(n("./app/assets/icons/status-read.svg")),w=r(n("./app/assets/icons/validation.svg")),j=(0,h.default)(),k=function(e){function t(){return s(this,t),u(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return d(t,e),c(t,[{key:"componentDidMount",value:function(){this.props.message||j.push("/chats/".concat(this.props.match.params.id))}},{key:"render",value:function(){var e=this.props,t=e.message,n=e.user,r=e.chat,a=e.locale;if(!t)return null;var o="group_chat"===r.chat_type;return p.default.createElement("div",{className:"message-info"},p.default.createElement("div",{className:"layout-pane__header"},p.default.createElement("div",{className:"chat__header"},p.default.createElement("div",{className:"layout-pane__action layout-pane__action--back"},p.default.createElement(b.default,null)),p.default.createElement("div",{className:"chat__title"},p.default.createElement(m.FormattedMessage,{id:"[chat message] header",defaultMessage:"Message's status"})))),p.default.createElement("div",{className:"layout-pane__body layout-pane__body--overflow"},p.default.createElement("div",{className:"infinite-scroll"},p.default.createElement("div",{className:"chat__pane chat__pane--message-status chat__pane--border-bottom"},p.default.createElement("div",{className:"message-status"},p.default.createElement("div",{className:"message-status__message message-status__message--".concat(r.connType)},p.default.createElement(v.default,{key:t.sync_id,message:t,user:n,chat:r,locale:a,showDateSplitter:!1,showSenderProfile:!t.sender.isMe,hideActions:!0})),p.default.createElement("div",{className:"message-status__table"},p.default.createElement("table",{className:"message-status-table"},p.default.createElement("thead",{className:"message-status-table__header"},p.default.createElement("tr",null,o&&p.default.createElement("th",{className:"message-status-table__cell message-status-table__cell--wide"}),p.default.createElement("th",{className:"message-status-table__cell message-status-table__cell--head"},p.default.createElement(m.FormattedMessage,{id:"[chat message] received",defaultMessage:"Received"}),p.default.createElement(O.default,{className:"icon chat-message__status--received",width:"30",height:"20"})),p.default.createElement("th",{className:"message-status-table__cell message-status-table__cell--head ".concat(o?"":"message-status-table__cell--wide")},p.default.createElement(m.FormattedMessage,{id:"[chat message] read",defaultMessage:"Read"}),p.default.createElement(C.default,{className:"icon chat-message__status--read",width:"30",height:"20"})))),p.default.createElement("tbody",null,r.members.filter(function(e){var n;return e.user_huid!==(null===(n=t.payload)||void 0===n?void 0:n.from)}).map(function(e){var n,r,s,i,c=null===(n=t.received_by)||void 0===n?void 0:null===(r=n.find(function(t){return t.user_huid===e.user_huid}))||void 0===r?void 0:r.reported_at,u=null===(s=t.read_by)||void 0===s?void 0:null===(i=s.find(function(t){return t.user_huid===e.user_huid}))||void 0===i?void 0:i.reported_at;return p.default.createElement("tr",{key:e.user_huid},o&&p.default.createElement("td",{className:"message-status-table__cell"},p.default.createElement(g.default,{entry:e})),p.default.createElement("td",{className:"message-status-table__cell"},c?(0,E.formatDateMessageInfo)((0,S.convert)(c),a):"-"),p.default.createElement("td",{className:"message-status-table__cell"},u?(0,E.formatDateMessageInfo)((0,S.convert)(u),a):"-"))})))))),p.default.createElement("div",{className:"chat__pane-wrapper"},p.default.createElement("div",{className:"chat__pane chat__pane--splitter chat__pane--border-bottom"},p.default.createElement("div",{className:"message-signature"},p.default.createElement(w.default,{className:"message-signature__icon",width:"20",height:"20"}),p.default.createElement("div",{className:"message-signature__title"},p.default.createElement(m.FormattedMessage,{id:"[chat message] signature",defaultMessage:"Signature verification"})),p.default.createElement("div",{className:"message-signature__info"},t.payload.type?p.default.createElement(m.FormattedMessage,{id:"[chat message] verified",defaultMessage:"Verified"}):p.default.createElement(m.FormattedMessage,{id:"[chat message] not verified",defaultMessage:"Not verified"}))))))))}}]),t}(p.Component),P=function(){var e=(0,y.makeGetCurrentMessage)(),t=(0,_.makeGetCurrentChat)();return function(n,r){var a=e(n,r),o=t(n,r);return{message:a,user:n.user,chat:o,locale:n.ui.locale}}},T=(0,f.connect)(P)(k);t.default=T},"./app/containers/Chats/ChatSettingsContainer.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){o(e,t,n[t])})}return e}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){if(!s(e,t))throw new TypeError("Cannot call a class as a function")}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t,n){return t&&u(e.prototype,t),n&&u(e,n),e}function d(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?f(e):t}function p(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function f(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var m=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),h=r(n("./node_modules/history/createHashHistory.js")),y=n("./node_modules/react-redux/lib/index.js"),_=n("./node_modules/react-router-dom/es/index.js"),b=n("./node_modules/react-intl/lib/index.es.js"),v=n("./app/modules/chats.js"),g=n("./app/modules/attachments.js"),E=n("./app/selectors/chatsSelectors.js"),S=n("./app/selectors/profilesSelectors.js"),O=n("./app/selectors/attachmentsSelectors.js"),C=r(n("./app/components/AvatarUploader.js")),w=r(n("./app/components/Avatar.js")),j=r(n("./app/components/App/UserPresence.js")),k=r(n("./app/components/App/ChatPresence.js")),P=r(n("./app/components/SearchInput.js")),T=r(n("./app/components/Contacts/PhonebookEntry.js")),x=r(n("./app/components/App/ConnTypeIcon.js")),M=n("./app/helpers/chatsHelpers.js"),N=n("./app/helpers/appHelpers.js"),A=n("./lib/constants.js"),R=r(n("./app/assets/icons/arrow-left.svg")),I=r(n("./app/assets/icons/edit.svg")),D=r(n("./app/assets/icons/exit.svg")),L=r(n("./app/assets/icons/cross.svg")),U=r(n("./app/assets/icons/angle-up.svg")),F=r(n("./app/assets/icons/angle-down.svg")),H=r(n("./app/components/App/Toggler.js")),K=(0,h.default)(),B=function(e){function t(e){var n;return c(this,t),n=d(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),G.call(f(n)),n.state={avatar:void 0,name:"",canSubmit:!1,isAdmin:!1,isEditing:!1,hiddenServers:[],searchText:"",isOneToOneChat:!1,isBotxChat:!1},n}return p(t,e),l(t,[{key:"componentWillMount",value:function(){this.props.chat&&this.initChat(this.props)}},{key:"componentWillReceiveProps",value:function(e){!this.props.chat&&e.chat&&this.initChat(e)}},{key:"removeMember",value:function(e){var t=this.props,n=t.chat,r=t.user,a=(0,M.chatMemberConnType)(n,r);this.props.removeUser({user_huid:[e.user_huid],group_chat_id:n.group_chat_id},a),K.push("/chats/".concat(n.group_chat_id))}},{key:"handleLeaveChat",value:function(){var e=this.props.chat;this.props.leaveChat(e.group_chat_id),K.push("/chats/".concat(e.group_chat_id))}},{key:"makeMemberAdmin",value:function(e){var t=this.props,n=t.chat,r=t.user,a=(0,M.chatMemberConnType)(n,r);this.props.addAdmin({user_huid:[e.user_huid],group_chat_id:n.group_chat_id},a),K.push("/chats/".concat(n.group_chat_id))}},{key:"renderChatAvatar",value:function(){var e=this.props.chat,t=this.state,n=t.isAdmin,r=t.isEditing,a=t.isOneToOneChat,o=this.state.avatar||e.avatar,s=m.default.createElement(w.default,{name:e.name,avatar:o,type:e.members_type});return n&&r&&!a?m.default.createElement(C.default,{avatar:o,width:A.AVATAR_UPLOADER_WIDTH,height:A.AVATAR_UPLOADER_HEIGHT,handleAvatar:this.handleAvatar,placeholder:m.default.createElement(b.FormattedHTMLMessage,{id:"[avatar] upload chat",defaultMessage:"Load chat<br/>avatar"})}):s}},{key:"renderOneToOneLastSeen",value:function(){var e=this.props,t=e.chat,n=e.profilesGroupByServer,r=t.opponent.user_huid,a=n.reduce(function(e,t){return e||t.members.find(function(e){return e.user_huid===r})},null)||{};return m.default.createElement(j.default,{className:"user-status",status:a.status,statusChanged:a.status_changed,connType:t.connType})}},{key:"renderMembers",value:function(){var e=this,t=this.props,n=t.chat,r=t.profilesGroupByServer,a=this.state,o=a.hiddenServers,s=a.searchText,i=r.map(function(t){var n=t.name,r=t.server_id,a=o.includes(r),i=t.members.filter(function(e){return(0,N.matchMultiText)(e.name,s)}).sort(function(e,t){var n,r,a,o;return(null===(n=e.name)||void 0===n?void 0:n.toLowerCase())>(null===(r=t.name)||void 0===r?void 0:r.toLowerCase())?1:(null===(a=e.name)||void 0===a?void 0:a.toLowerCase())<(null===(o=t.name)||void 0===o?void 0:o.toLowerCase())?-1:0}).map(function(t){return m.default.createElement(T.default,{entry:t,key:t.user_huid,onClick:function(){return e.handleMemberClick(t)}},t.admin&&m.default.createElement("span",{className:"phonebook-entry__label phonebook-entry__label--admin"},m.default.createElement(b.FormattedMessage,{id:"[chat settings] admin",defaultMessage:"admin"})),e.renderMakeAdminLink(t),e.renderRemoveLink(t))});return m.default.createElement("div",{className:"chat-members-list",key:t.server_id},m.default.createElement("div",{className:"chat-members-list__header chat-members-list__header--toggler chat-members-list__header--pane",onClick:function(){return e.handleServerToggleClick(r)}},m.default.createElement("div",{className:"chat-members-list__title"},m.default.createElement("strong",null,n),"",m.default.createElement(b.FormattedMessage,{id:"[chat settings] members",defaultMessage:"({count} members)",values:{count:i.length}})),a?m.default.createElement(F.default,{width:"16",height:"16",className:"btn__icon chat-members-list__arrow"}):m.default.createElement(U.default,{width:"16",height:"16",className:"btn__icon chat-members-list__arrow"})),!a&&i)});return m.default.createElement("div",{className:"chat__pane chat__pane--splitter"},m.default.createElement(P.default,{onInputChange:this.handleSearchChange}),m.default.createElement("div",{className:"chat-settings__servers"},m.default.createElement(k.default,{className:"chat-settings__members-status",chat:n}),i))}},{key:"render",value:function(){var e=this.props,t=e.chat,n=e.locale,r=this.state,a=r.isAdmin,o=r.isEditing,s=r.canSubmit,i=r.name,c=r.isOneToOneChat,u=r.isBotxChat;return t?m.default.createElement("div",{className:"chat-settings"},m.default.createElement("div",{className:"layout-pane__header"},m.default.createElement("div",{className:"layout-pane__action layout-pane__action--back"},m.default.createElement(_.Link,{className:"btn btn--layout-back",to:"/chats/".concat(t.group_chat_id)},m.default.createElement(R.default,{width:"24",height:"24",className:"btn__icon"}))),m.default.createElement("div",{className:"chat__title"},m.default.createElement(b.FormattedMessage,{id:"[chat settings] title",defaultMessage:"Chat settings"})),!c&&!u&&a&&m.default.createElement("div",{className:"layout-pane__action layout-pane__action--edit"},m.default.createElement("button",{className:"btn btn--layout-edit",onClick:this.handleEditClick},m.default.createElement(I.default,{width:"24",height:"24",className:"btn__icon"})))),m.default.createElement("div",{className:"layout-pane__body layout-pane__body--overflow"},m.default.createElement("div",{className:"infinite-scroll"},m.default.createElement("div",{className:"chat__pane chat__pane--settings-chat chat__pane--border-bottom"},m.default.createElement("div",{className:"chat-settings__header"},this.renderChatAvatar(),a&&o?m.default.createElement("div",{className:"form-field form-field--chat-name"},m.default.createElement("input",{className:"form-field__input",ref:"name",type:"text",value:i||"",onChange:this.handleNameEdited})):m.default.createElement("h2",{className:"chat-settings__title"},m.default.createElement(x.default,{className:"conn-type-icon",name:"settings",width:"14",height:"14",connType:t.members_type,isBot:"botx"===t.chat_type}),i),a&&o&&m.default.createElement("button",{className:"btn btn--submit",disabled:!s,onClick:this.saveChat},m.default.createElement(b.FormattedMessage,{id:"[chat settings] save",defaultMessage:"Save"})),!c&&!u&&m.default.createElement("div",{className:"chat-settings__info"},m.default.createElement(b.FormattedMessage,{id:"[chat settings] creator",defaultMessage:"Creator: {name}",values:{name:t.creatorName}})),c&&m.default.createElement("div",{className:"chat-settings__info"},this.renderOneToOneLastSeen()),!u&&m.default.createElement("div",{className:"chat-settings__info"},m.default.createElement(b.FormattedMessage,{id:"[chat settings] created",defaultMessage:"Created: {date}",values:{date:(0,N.formatDate)(t.inserted_at,n)}}))),m.default.createElement(_.Link,{className:"chat-settings__row chat-settings__row--value chat-settings__row--link",to:"/chats/".concat(t.group_chat_id,"/files/media")},m.default.createElement(b.FormattedMessage,{id:"[chat settings] foto",defaultMessage:"Foto and video"}),m.default.createElement("span",{className:"chat-settings__info-count"},this.getAttachmentCount(!0))),m.default.createElement(_.Link,{className:"chat-settings__row chat-settings__row--value chat-settings__row--link",to:"/chats/".concat(t.group_chat_id,"/files/documents")},m.default.createElement(b.FormattedMessage,{id:"[chat settings] docs",defaultMessage:"Documents"}),m.default.createElement("span",{className:"chat-settings__info-count"},this.getAttachmentCount(!1))),!u&&m.default.createElement(_.Link,{className:"chat-settings__row chat-settings__row--link",to:"/chats/".concat(t.group_chat_id,"/routing")},m.default.createElement(b.FormattedMessage,{id:"[chat settings] routing",defaultMessage:"Routing"}))),m.default.createElement("div",{className:"chat__pane-wrapper"},m.default.createElement("div",{className:"chat__pane chat__pane--splitter chat__pane--border-bottom"},m.default.createElement("label",{className:"chat-settings__row chat-settings__row--value chat-settings__row--toggler",htmlFor:"dnd"},m.default.createElement(b.FormattedMessage,{id:"[chat settings] push",defaultMessage:"Push notifications"}),m.default.createElement(H.default,{id:"dnd",checked:!t.chat_settings.dnd,onChange:this.handleDndChange})),m.default.createElement("div",{className:"chat-settings__row"},t.settings),this.state.isAdmin&&!c&&!u&&m.default.createElement(_.Link,{className:"chat-settings__row chat-settings__row--link",to:"/chats/".concat(t.group_chat_id,"/invite")},m.default.createElement(b.FormattedMessage,{id:"[chat settings] invite",defaultMessage:"Invite members"}))),!c&&!u&&this.renderMembers())))):null}}]),t}(m.Component),G=function(){var e=this;Object.defineProperty(this,"getAttachmentCount",{configurable:!0,enumerable:!0,writable:!0,value:function(t){var n=e.props.attachments;return(null===n||void 0===n?void 0:n.files)?n.files.filter(function(e){return!!e.preview_url===t}).length:"..."}}),Object.defineProperty(this,"saveChat",{configurable:!0,enumerable:!0,writable:!0,value:function(){var t=e.props,n=t.chat,r=t.user,o=(0,M.chatMemberConnType)(n,r),s={};e.state.name.trim()!==n.name&&(s=a({},s,{name:e.state.name.trim()})),e.state.avatar&&(s=a({},s,{avatar:e.state.avatar})),e.props.updateChat({group_chat_id:n.group_chat_id,info:s},o),e.setState(a({},e.state,{canSubmit:!1,isEditing:!1}))}}),Object.defineProperty(this,"initChat",{configurable:!0,enumerable:!0,writable:!0,value:function(t){var n=t.chat,r=t.user;if(n){var a=n.members.find(function(e){return e.user_huid===r.huid}).admin;e.setState({isAdmin:a,name:n.name,isOneToOneChat:"chat"===n.chat_type,isBotxChat:"botx"===n.chat_type}),e.props.loadAttachments(e.props.match.params.id)}if(n&&!n.servers){var o=(0,M.chatMemberConnType)(n,r);e.props.chatInfo({connType:o,chatId:n.group_chat_id})}}}),Object.defineProperty(this,"handleAvatar",{configurable:!0,enumerable:!0,writable:!0,value:function(t){e.setState({avatar:t},e.validateEditChat)}}),Object.defineProperty(this,"handleNameEdited",{configurable:!0,enumerable:!0,writable:!0,value:function(t){e.setState({name:t.target.value},e.validateEditChat)}}),Object.defineProperty(this,"validateEditChat",{configurable:!0,enumerable:!0,writable:!0,value:function(){var t=e.props.chat,n=t.name,r=t.avatar,a=e.refs.name.value.trim(),o=(n!==a||r!==e.state.avatar)&&a;e.setState({canSubmit:o})}}),Object.defineProperty(this,"handleDndChange",{configurable:!0,enumerable:!0,writable:!0,value:function(t){var n=e.props.chat;e.props.setChatSettings(n.group_chat_id,{dnd:!t.target.checked})}}),Object.defineProperty(this,"handleServerToggleClick",{configurable:!0,enumerable:!0,writable:!0,value:function(t){var n=e.state.hiddenServers;if(n.includes(t)){var r=n.indexOf(t);n.splice(r,1)}else n.push(t);e.setState({hiddenServers:n})}}),Object.defineProperty(this,"handleEditClick",{configurable:!0,enumerable:!0,writable:!0,value:function(){var t=e.props.chat,n=e.state.isEditing;if(n)return void e.setState({isEditing:!1,avatar:t.avatar,name:t.name});e.setState({isEditing:!n})}}),Object.defineProperty(this,"handleSearchChange",{configurable:!0,enumerable:!0,writable:!0,value:function(t){e.setState({searchText:t})}}),Object.defineProperty(this,"handleMemberClick",{configurable:!0,enumerable:!0,writable:!0,value:function(e){e.isMe||K.push("/chats/member/".concat(e.user_huid))}}),Object.defineProperty(this,"renderRemoveLink",{configurable:!0,enumerable:!0,writable:!0,value:function(t){var n=e.props,r=n.chat,a=n.user;if(e.state.isAdmin){var o=r.members.find(function(e){return e.user_huid!==a.huid&&e.admin});return t.user_huid===a.huid?o?m.default.createElement("button",{className:"btn phonebook-entry__btn-action",onClick:e.handleLeaveChat.bind(e)},m.default.createElement(D.default,{width:"24",height:"24",className:"btn__icon"})):null:m.default.createElement("button",{className:"btn phonebook-entry__btn-action",onClick:e.removeMember.bind(e,t)},m.default.createElement(L.default,{width:"24",height:"24",className:"btn__icon"}))}return t.user_huid===a.huid?m.default.createElement("button",{className:"btn phonebook-entry__btn-action",onClick:e.handleLeaveChat.bind(e)},m.default.createElement(D.default,{width:"24",height:"24",className:"btn__icon"})):null}}),Object.defineProperty(this,"renderMakeAdminLink",{configurable:!0,enumerable:!0,writable:!0,value:function(t){return e.state.isAdmin&&!t.admin?m.default.createElement("a",{className:"btn btn--submit phonebook-entry__btn",onClick:e.makeMemberAdmin.bind(e,t)},m.default.createElement(b.FormattedMessage,{id:"[chat settings] make admin",defaultMessage:"Make admin"})):null}})},Y=function(){var e=(0,E.makeGetCurrentChat)(),t=(0,O.makeGetCurrentChatAttachments)();return function(n,r){return{chat:e(n,r),user:n.user,profilesGroupByServer:(0,S.getProfilesGroupByServer)(n,r),locale:n.ui.locale,attachments:t(n,r)}}},V=(0,y.connect)(Y,{updateChat:v.updateChat,removeUser:v.removeUser,leaveChat:v.leaveChat,addAdmin:v.addAdmin,setChatSettings:v.setChatSettings,chatInfo:v.chatInfo,loadAttachments:g.loadAttachments})(B);t.default=V},"./app/containers/Chats/ChatsPageContainer.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){if(!a(e,t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function u(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?d(e):t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),f=n("./node_modules/react-redux/lib/index.js"),m=n("./node_modules/react-router-dom/es/index.js"),h=n("./node_modules/react-contextmenu/es6/index.js"),y=n("./node_modules/react-intl/lib/index.es.js"),_=r(n("./app/containers/Chats/CreateChatContainer.js")),b=r(n("./app/containers/Chats/CreatePersonalChatContainer.js")),v=r(n("./app/containers/Chats/ChatContainer.js")),g=r(n("./app/containers/Chats/ChatSettingsContainer.js")),E=r(n("./app/containers/Chats/InviteToChatContainer.js")),S=r(n("./app/containers/Chats/RoutingContainer.js")),O=r(n("./app/containers/Chats/ChatFilesContainer.js")),C=r(n("./app/containers/Chats/ChatMemberContainer.js")),w=r(n("./app/containers/Chats/ChatMessageContainer.js")),j=r(n("./app/containers/Chats/SearchResultsPanel.js")),k=n("./app/selectors/chatsSelectors.js"),P=r(n("./app/components/Chats/ChatListEntry.js")),T=r(n("./app/components/App/DropdownMenu.js")),x=r(n("./app/components/App/MainMenu.js")),M=r(n("./app/components/SearchFiltersPanel.js")),N=r(n("./app/containers/Layout/StatusMessageContainer.js")),A=r(n("./app/components/Chats/ChatHistorySearch.js")),R=n("./app/modules/ui.js"),I=n("./app/modules/chats.js"),D=n("./app/helpers/reactHelpers.js"),L=n("./app/helpers/routing.js"),U=n("./lib/deepEqual.js"),F=r(n("./app/assets/icons/mute-on.svg")),H=r(n("./app/assets/icons/mute-off.svg")),K=r(n("./app/assets/icons/create-chat.svg")),B=r(n("./app/assets/icons/personal-chat.svg")),G=r(n("./app/assets/icons/group-chat.svg")),Y=function(e){var t,n=e.id,r=e.trigger,a=e.onShow,o=e.onHide,s=r||{},i=s.chat,c=s.onItemClick;return p.default.createElement(h.ContextMenu,{className:"dropdown-menu",id:n,onShow:a,onHide:o},p.default.createElement(h.MenuItem,{onClick:c,data:{action:"dnd"}},(null===i||void 0===i?void 0:null===(t=i.chat_settings)||void 0===t?void 0:t.dnd)?p.default.createElement("div",{className:"dropdown-menu__item"},p.default.createElement(H.default,{width:"16",height:"16",className:"dropdown-menu__icon"}),p.default.createElement(y.FormattedMessage,{id:"[chat] dnd off",defaultMessage:"Enable notifications"})):p.default.createElement("div",{className:"dropdown-menu__item"},p.default.createElement(F.default,{width:"16",height:"16",className:"dropdown-menu__icon"}),p.default.createElement(y.FormattedMessage,{id:"[chat] dnd on",defaultMessage:"Disable notifications"}))))},V=(0,h.connectMenu)("CHAT_CONTEXT_MENU")(Y),W=(0,y.defineMessages)({search:{id:"[chats] search placeholder",defaultMessage:"Search"}}),q=function(e){function t(e){var n;return s(this,t),n=u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),Object.defineProperty(d(n),"handleChatContextMenuItemClick",{configurable:!0,enumerable:!0,writable:!0,value:function(e,t){var r=t.chat;switch(t.action){case"dnd":n.props.setChatSettings(r.group_chat_id,{dnd:!r.chat_settings.dnd})}}}),Object.defineProperty(d(n),"handleCloseChatHistorySearch",{configurable:!0,enumerable:!0,writable:!0,value:function(){n.props.showChatHistorySearch(!1)}}),Object.defineProperty(d(n),"handleChatHistorySearchTextChange",{configurable:!0,enumerable:!0,writable:!0,value:function(e){n.props.chatHistorySearchTextChanged(e)}}),n.state={chatContextMenuFor:null},n}return l(t,e),c(t,[{key:"shouldComponentUpdate",value:function(e,t){var n=["chats","chatsFromFilter","location.pathname","locale","searchText","statusMessage","isChatHistorySearchVisible","chatHistorySearchText"];return(0,D.isShouldComponentUpdate)(this.props,e,n)||!(0,U.equal)(this.state,t)}},{key:"componentWillUnmount",value:function(){this.props.chatsSearchTextChanged("")}},{key:"renderCreateChat",value:function(){var e=this.props.statusMessage,t=null!==e,n=p.default.createElement("button",{className:"btn btn--layout-menu",disabled:t},p.default.createElement(K.default,{width:"24",height:"24",className:"btn__icon"}));return t?n:p.default.createElement(T.default,{className:"dropdown-menu",trigger:n},p.default.createElement(m.NavLink,{className:"dropdown-menu__item",to:"/chats/create/personal"},p.default.createElement(B.default,{width:"16",height:"16",className:"dropdown-menu__icon"}),p.default.createElement(y.FormattedMessage,{id:"[chats] personal",defaultMessage:"Personal chat"})),p.default.createElement(m.NavLink,{className:"dropdown-menu__item",to:"/chats/create"},p.default.createElement(G.default,{width:"16",height:"16",className:"dropdown-menu__icon"}),p.default.createElement(y.FormattedMessage,{id:"[chats] groupchat",defaultMessage:"Group chat"})))}},{key:"renderChat",value:function(){var e=this.props,t=e.chats,n=e.match;return n.isExact?p.default.createElement("div",{className:"layout-pane__choose-chat"},p.default.createElement("header",{className:"layout-pane__header"}),p.default.createElement("div",{className:"layout-pane__body"},p.default.createElement("strong",{className:"layout-pane__body-title"},t.length?p.default.createElement(y.FormattedMessage,{id:"[chats] choose",defaultMessage:"Choose chat from the list"}):null))):p.default.createElement(m.Switch,null,p.default.createElement(m.Route,{path:"".concat(n.url,"/create/personal"),component:b.default}),p.default.createElement(m.Route,{path:"".concat(n.url,"/create"),component:_.default}),p.default.createElement(m.Route,{exact:!0,path:"".concat(n.url,"/:id"),component:v.default}),p.default.createElement(m.Route,{exact:!0,path:"".concat(n.url,"/:id/settings"),component:g.default}),p.default.createElement(m.Route,{exact:!0,path:"".concat(n.url,"/:id/invite"),component:E.default}),p.default.createElement(m.Route,{exact:!0,path:"".concat(n.url,"/:id/routing"),component:S.default}),p.default.createElement(m.Route,{exact:!0,path:"".concat(n.url,"/:id/files/:type"),component:O.default}),p.default.createElement(m.Route,{path:"".concat(n.url,"/member/:huid"),component:C.default}),p.default.createElement(m.Route,{path:"".concat(n.url,"/:id/message/:sync"),component:w.default}))}},{key:"renderChatList",value:function(){var e=this,t=this.props,n=t.chats,r=t.location,a=t.locale;return(null===n||void 0===n?void 0:n.length)?n.map(function(t){var n=r.pathname.includes(t.group_chat_id);return p.default.createElement(h.ContextMenuTrigger,{id:"CHAT_CONTEXT_MENU",key:t.group_chat_id,holdToDisplay:-1,collect:function(){return{chat:t,onItemClick:e.handleChatContextMenuItemClick}}},p.default.createElement(P.default,{key:t.group_chat_id,chat:t,active:n,locale:a,contextMenuShowed:e.state.chatContextMenuFor===t.group_chat_id}))}):null}},{key:"renderLeftPanel",value:function(){var e=this,t=this.props,n=t.intl,r=t.chat,a=t.chatsFromFilter,o=t.searchText,s=t.isChatHistorySearchVisible,i=t.chatHistorySearchText,c=t.locale;return s?p.default.createElement(A.default,{onTextChange:this.handleChatHistorySearchTextChange,onClose:this.handleCloseChatHistorySearch,chat:r,text:i,locale:c}):p.default.createElement("div",{className:"layout-pane__body layout-pane__body--br"},p.default.createElement("div",{className:"layout-pane__search"},p.default.createElement(M.default,{name:"chat",value:a,text:o,onButtonClick:function(t){return e.props.chatsFromFilterChanged(t)},onInputChange:function(t){return e.props.chatsSearchTextChanged(t)},placeholder:n.formatMessage(W.search)})),p.default.createElement("div",{className:"layout-pane__chat-list"},o?p.default.createElement(j.default,this.props):this.renderChatList()))}},{key:"render",value:function(){var e=this,t=this.props.statusMessage;return p.default.createElement("div",{className:"layout-pane-wrapper"},p.default.createElement(V,{onShow:function(t){return e.setState({chatContextMenuFor:t.detail.data.chat.group_chat_id})},onHide:function(){return e.setState({chatContextMenuFor:null})}}),p.default.createElement("div",{className:"layout-pane"},p.default.createElement("div",{className:"layout-pane__left"},p.default.createElement("div",{className:"layout-pane__header"},p.default.createElement("div",{className:"layout-pane__action layout-pane__action--menu"},p.default.createElement(x.default,null)),p.default.createElement("div",{className:"layout-pane__title"},t?p.default.createElement(N.default,null):p.default.createElement(y.FormattedMessage,{id:"[chats] header",defaultMessage:"Chats"})),p.default.createElement("div",{className:"layout-pane__action layout-pane__action--create"},this.renderCreateChat())),this.renderLeftPanel()),p.default.createElement("div",{className:"layout-pane__right"},this.renderChat())))}}]),t}(p.Component),z=function(e){var t=(0,L.matchChatId)(window.location.hash),n=(0,k.getChatList)(e);return{chats:n,chat:t&&n.find(function(e){return e.group_chat_id===t}),chatsFromFilter:e.ui.chatsFromFilter,searchText:e.ui.chatsSearchText,locale:e.ui.locale,statusMessage:e.ui.statusMessage,isChatHistorySearchVisible:e.ui.showChatHistorySearch,chatHistorySearchText:e.ui.chatHistorySearchText}},Q=(0,f.connect)(z,{chatsFromFilterChanged:R.chatsFromFilterChanged,chatsSearchTextChanged:R.chatsSearchTextChanged,setChatSettings:I.setChatSettings,showChatHistorySearch:R.showChatHistorySearch,chatHistorySearchTextChanged:R.chatHistorySearchTextChanged})((0,y.injectIntl)(q));t.default=Q},"./app/containers/Chats/CreateChatContainer.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e){return u(e)||c(e)||i()}function i(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function c(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function u(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}function l(e,t){if(!a(e,t))throw new TypeError("Cannot call a class as a function")}function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e,t,n){return t&&d(e.prototype,t),n&&d(e,n),e}function f(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?h(e):t}function m(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var y=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),_=n("./node_modules/react-redux/lib/index.js"),b=n("./node_modules/lodash/lodash.js"),v=n("./node_modules/react-intl/lib/index.es.js"),g=n("./app/modules/chats.js"),E=n("./app/selectors/phonebookSelectors.js"),S=n("./lib/constants.js"),O=n("./lib/reactIntl.js"),C=r(n("./app/components/AvatarUploader.js")),w=r(n("./app/components/SearchFiltersPanel.js")),j=r(n("./app/components/GoBackButton.js")),k=r(n("./app/components/Contacts/PhonebookEntry.js")),P=r(n("./app/assets/icons/ok.svg")),T=n("./app/helpers/appHelpers.js"),x=function(e){function t(){var e,n,r;l(this,t);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return f(r,(n=r=f(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),Object.defineProperty(h(r),"state",{configurable:!0,enumerable:!0,writable:!0,value:{entries:[],chat_type:"group_chat",canSubmit:!1,avatar:null,name:"",searchText:"",filter:"all"}}),Object.defineProperty(h(r),"handleCreateChat",{configurable:!0,enumerable:!0,writable:!0,value:function(){var e=r.state,t=e.avatar,n=e.name,a=e.entries,o=e.chat_type,s=(0,b.uniq)(a.map(function(e){return e.user_huid}));r.props.createChat({members:s,chat_type:o,name:n,avatar:t})}}),Object.defineProperty(h(r),"validateCreateChat",{configurable:!0,enumerable:!0,writable:!0,value:function(e){var t=e?e.target.value.trim():r.state.name,n=r.state.entries,a=t&&n.length;r.setState({name:t,canSubmit:a})}}),Object.defineProperty(h(r),"handleAvatar",{configurable:!0,enumerable:!0,writable:!0,value:function(e){r.setState({avatar:e})}}),n))}return m(t,e),p(t,[{key:"handleAddRemoveMember",value:function(e,t){var n=t?this.state.entries.filter(function(t){return t.entry_id!==e.entry_id}):s(this.state.entries).concat([e]);this.setState({entries:n},this.validateCreateChat)}},{key:"renderEntryButton",value:function(e,t){var n=this;if(e){var r="phonebook-entry__btn--remove phonebook-entry__btn--remove-".concat(t.conn_type);return y.default.createElement("button",{className:"btn btn--submit phonebook-entry__btn phonebook-entry__btn--".concat(t.conn_type," ").concat(r),onClick:function(){return n.handleAddRemoveMember(t,e)}},y.default.createElement(v.FormattedMessage,{id:"[chat create] delete",defaultMessage:"DELETE"}))}return y.default.createElement("button",{className:"btn btn--submit phonebook-entry__btn phonebook-entry__btn--".concat(t.conn_type),onClick:function(){return n.handleAddRemoveMember(t,e)}},y.default.createElement(v.FormattedMessage,{id:"[chat create] add",defaultMessage:"ADD"}))}},{key:"renderEntry",value:function(e){var t=this.state.entries.find(function(t){return t.entry_id===e.entry_id});return y.default.createElement(k.default,{entry:e,isActive:t,key:e.entry_id},y.default.createElement("div",{className:"phonebook-entry__actions"},this.renderEntryButton(t,e)))}},{key:"render",value:function(){var e=this,t=this.props.phonebook,n=this.state,r=n.filter,a=n.searchText,o=t.filter(function(e){return!e.isBot}).filter(function(e){return"all"===r||e.conn_type===r}).filter(function(e){return(0,T.matchMultiText)(e.name,a)||e.contact&&e.contact.includes(null===a||void 0===a?void 0:a.replace("+",""))}),s=(0,v.defineMessages)({name:{id:"[chat create] chat title",defaultMessage:"Chat title"},search:{id:"[chat input] search contact",defaultMessage:"Search contact"}});return y.default.createElement("div",{className:"chat"},y.default.createElement("div",{className:"layout-pane__header"},y.default.createElement("div",{className:"chat__header"},y.default.createElement("div",{className:"layout-pane__action layout-pane__action--back"},y.default.createElement(j.default,null)),y.default.createElement("div",{className:"chat__title"},y.default.createElement(v.FormattedMessage,{id:"[chat create] group chat",defaultMessage:"Create group chat"})),y.default.createElement("div",{className:"layout-pane__action layout-pane__action--create"},y.default.createElement("button",{className:"btn btn--layout-create",disabled:!this.state.canSubmit,onClick:this.handleCreateChat},y.default.createElement(P.default,{width:"24",height:"24",className:"btn__icon"}))))),y.default.createElement("div",{className:"layout-pane__body"},y.default.createElement("div",{className:"chat__pane chat__pane--create-chat"},y.default.createElement(C.default,{width:S.AVATAR_UPLOADER_WIDTH,height:S.AVATAR_UPLOADER_HEIGHT,handleAvatar:this.handleAvatar,placeholder:y.default.createElement(v.FormattedHTMLMessage,{id:"[avatar] upload chat",defaultMessage:"Load chat<br/>avatar"})}),y.default.createElement("div",{className:"form-field form-field--chat-name"},y.default.createElement("input",{className:"form-field__input",type:"text",placeholder:(0,O.formatMessage)(s.name),onChange:this.validateCreateChat})),y.default.createElement(w.default,{name:"contacts",placeholder:(0,O.formatMessage)(s.search),onButtonClick:function(t){return e.setState({filter:t})},onInputChange:function(t){return e.setState({searchText:t})}})),y.default.createElement("div",{className:"chat__pane chat__pane--overflow"},y.default.createElement("div",{className:"chat__infinite-scroll chat__infinite-scroll--create-group-chat chat__infinite-scroll--overflow"},o.map(function(t){return e.renderEntry(t)})))))}}]),t}(y.Component),M=function(e){return{phonebook:(0,E.getActivePhonebookEntryListWithStatuses)(e),user:e.user}},N=(0,_.connect)(M,{createChat:g.createChat})(x);t.default=N},"./app/containers/Chats/CreatePersonalChatContainer.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){if(!a(e,t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function u(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?d(e):t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),f=n("./node_modules/react-redux/lib/index.js"),m=n("./node_modules/react-intl/lib/index.es.js"),h=n("./app/modules/chats.js"),y=n("./app/selectors/phonebookSelectors.js"),_=n("./app/selectors/chatsSelectors.js"),b=r(n("./app/components/SearchFiltersPanel.js")),v=r(n("./app/components/GoBackButton.js")),g=r(n("./app/components/Contacts/PhonebookEntry.js")),E=n("./app/helpers/appHelpers.js"),S=function(e){function t(e){var n;return s(this,t),n=u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),Object.defineProperty(d(n),"handleCreateChat",{configurable:!0,enumerable:!0,writable:!0,value:function(e){return n.props.createChat({members:[e.user_huid],chat_type:e.isBot?"botx":"chat",name:e.isBot?"botx personal chat":"personal chat"})}}),n.state={searchText:"",filter:"all"},n}return l(t,e),c(t,[{key:"render",value:function(){var e=this,t=this.props.phonebook,n=this.state,r=n.filter,a=n.searchText,o=t.filter(function(e){return"all"===r||e.connType===r}).filter(function(e){return(0,E.matchMultiText)(e.name,a)||e.contact&&e.contact.includes(null===a||void 0===a?void 0:a.replace("+",""))});return p.default.createElement("div",{className:"chat"},p.default.createElement("div",{className:"layout-pane__header"},p.default.createElement("div",{className:"chat__header"},p.default.createElement("div",{className:"layout-pane__action layout-pane__action--back"},p.default.createElement(v.default,null)),p.default.createElement("div",{className:"chat__title"},p.default.createElement(m.FormattedMessage,{id:"[chat create] personal chat",defaultMessage:"Create personal chat"})))),p.default.createElement("div",{className:"layout-pane__body"},p.default.createElement("div",{className:"chat__pane"},p.default.createElement(b.default,{name:"contacts",onButtonClick:function(t){return e.setState({filter:t})},onInputChange:function(t){return e.setState({searchText:t})}}),p.default.createElement("div",{className:"chat__infinite-scroll chat__infinite-scroll--create-chat chat__infinite-scroll--overflow"},o.map(function(t){return p.default.createElement(g.default,{entry:t,onClick:function(){return e.handleCreateChat(t)},key:t.entry_id})})))))}}]),t}(p.Component),O=function(e){return{phonebook:(0,y.getActivePhonebookEntryListWithStatuses)(e),user:e.user,chats:(0,_.getChatList)(e)}},C=(0,f.connect)(O,{createChat:h.createChat})(S);t.default=C},"./app/containers/Chats/InviteToChatContainer.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e){return u(e)||c(e)||i()}function i(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function c(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function u(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}function l(e,t){if(!a(e,t))throw new TypeError("Cannot call a class as a function")}function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e,t,n){return t&&d(e.prototype,t),n&&d(e,n),e}function f(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?h(e):t}function m(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var y=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),_=r(n("./node_modules/history/createHashHistory.js")),b=n("./node_modules/react-redux/lib/index.js"),v=n("./node_modules/react-intl/lib/index.es.js"),g=n("./node_modules/lodash/lodash.js"),E=n("./app/modules/chats.js"),S=n("./app/selectors/chatsSelectors.js"),O=n("./app/selectors/phonebookSelectors.js"),C=n("./app/helpers/chatsHelpers.js"),w=r(n("./app/components/Contacts/PhonebookEntry.js")),j=r(n("./app/components/SearchFiltersPanel.js")),k=r(n("./app/components/GoBackButton.js")),P=r(n("./app/assets/icons/ok.svg")),T=n("./app/helpers/appHelpers.js"),x=(0,_.default)(),M=function(e){function t(e){var n;return l(this,t),n=f(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),Object.defineProperty(h(n),"validate",{configurable:!0,enumerable:!0,writable:!0,value:function(){var e=n.state.entries.length>0;n.setState({canSubmit:e})}}),Object.defineProperty(h(n),"handleInvite",{configurable:!0,enumerable:!0,writable:!0,value:function(){var e=n.props,t=e.chat,r=e.user,a=n.state,o=a.entries,s=a.canSubmit,i=(0,C.chatMemberConnType)(t,r),c=(0,g.uniq)(o.map(function(e){return e.user_huid}));s&&(n.props.addUser({user_huid:c,group_chat_id:t.group_chat_id},i),x.push("/chats/".concat(t.group_chat_id)))}}),Object.defineProperty(h(n),"handleSeachTextChange",{configurable:!0,enumerable:!0,writable:!0,value:function(e){n.setState({searchText:e})}}),Object.defineProperty(h(n),"handleTypeFilterChange",{configurable:!0,enumerable:!0,writable:!0,value:function(e){n.setState({typeFilter:e})}}),Object.defineProperty(h(n),"renderEntry",{configurable:!0,enumerable:!0,writable:!0,value:function(e){var t=!!n.state.entries.find(function(t){return t.entry_id===e.entry_id});return y.default.createElement(w.default,{entry:e,key:e.entry_id,onClick:function(){return n.handleAddRemoveMember(e,t)}},y.default.createElement("div",{className:"phonebook-entry__actions"},n.renderEntryButton(t,e)))}}),n.state={entries:[],canSubmit:!1,searchText:"",typeFilter:"all"},n}return m(t,e),p(t,[{key:"componentWillMount",value:function(){var e=this.props,t=e.chat,n=e.user;if(t){t.members.find(function(e){return e.user_huid===n.huid}).admin&&!t.left||x.push("/chats/".concat(this.props.match.params.id))}}},{key:"handleAddRemoveMember",value:function(e,t){var n=t?this.state.entries.filter(function(t){return t.entry_id!==e.entry_id}):s(this.state.entries).concat([e]);this.setState({entries:n},this.validate)}},{key:"renderEntryButton",value:function(e,t){var n=this;if(e){var r="phonebook-entry__btn--remove phonebook-entry__btn--remove-".concat(t.conn_type);return y.default.createElement("button",{className:"btn btn--submit phonebook-entry__btn phonebook-entry__btn--".concat(t.conn_type," ").concat(r),onClick:function(){return n.handleAddRemoveMember(t,e)}},y.default.createElement(v.FormattedMessage,{id:"[chat invite] remove",defaultMessage:"REMOVE"}))}return y.default.createElement("button",{className:"btn btn--submit phonebook-entry__btn phonebook-entry__btn--".concat(t.conn_type),onClick:function(){return n.handleAddRemoveMember(t,e)}},y.default.createElement(v.FormattedMessage,{id:"[chat invite] select",defaultMessage:"SELECT"}))}},{key:"renderEntries",value:function(){var e=this.props,t=e.phonebook,n=e.chat,r=this.state,a=r.searchText,o=r.typeFilter,s=n.members.map(function(e){return e.user_huid});return t.filter(function(e){return!e.isBot}).filter(function(e){return e.active&&!s.includes(e.user_huid)}).filter(function(e){return(0,T.matchMultiText)(e.name,a)||e.contact.includes(null===a||void 0===a?void 0:a.replace("+",""))}).filter(function(e){return"all"===o||e.conn_type===o}).map(this.renderEntry)}},{key:"render",value:function(){return this.props.chat?y.default.createElement("div",{className:"chat"},y.default.createElement("div",{className:"layout-pane__header"},y.default.createElement("div",{className:"layout-pane__action layout-pane__action--back"},y.default.createElement(k.default,null)),y.default.createElement("div",{className:"chat__title"},y.default.createElement(v.FormattedMessage,{id:"[chat invite] title",defaultMessage:"Add chat members"})),y.default.createElement("div",{className:"layout-pane__action layout-pane__action--create"},y.default.createElement("button",{className:"btn btn--layout-create",disabled:!this.state.canSubmit,onClick:this.handleInvite},y.default.createElement(P.default,{width:"24",height:"24",className:"btn__icon"})))),y.default.createElement("div",{className:"layout-pane__body"},y.default.createElement("div",{className:"chat__pane"},y.default.createElement(j.default,{name:"contacts",onInputChange:this.handleSeachTextChange,onButtonClick:this.handleTypeFilterChange}),y.default.createElement("div",{className:"chat__infinite-scroll chat__infinite-scroll--overflow"},this.renderEntries())))):null}}]),t}(y.Component),N=function(){var e=(0,S.makeGetCurrentChat)();return function(t,n){return{chat:e(t,n),phonebook:(0,O.getActivePhonebookEntryListWithStatuses)(t),user:t.user}}},A=(0,b.connect)(N,{addUser:E.addUser})(M);t.default=A},"./app/containers/Chats/RoutingContainer.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){if(!a(e,t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function u(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?l(e):t}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),f=r(n("./node_modules/history/createHashHistory.js")),m=n("./node_modules/react-redux/lib/index.js"),h=n("./node_modules/react-intl/lib/index.es.js"),y=n("./app/selectors/chatsSelectors.js"),_=n("./app/helpers/profilesHelpers.js"),b=n("./app/helpers/chatsHelpers.js"),v=r(n("./app/components/GoBackButton.js")),g=(0,f.default)(),E=n("./node_modules/scriptjs/dist/script.js"),S=function(e){function t(e){var n;return s(this,t),n=u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),n.state={schemaRendered:!1},n}return d(t,e),c(t,[{key:"componentWillMount",value:function(){var e=this.props.chat;e&&!e.left||g.push("/chats/".concat(this.props.match.params.id))}},{key:"componentDidMount",value:function(){this.props.chat&&this.renderSchema()}},{key:"componentDidUpdate",value:function(){this.props.chat&&!this.state.schemaRendered&&this.renderSchema()}},{key:"renderSchema",value:function(){var e=this,t=this.props,n=t.chat,r=t.user,a="cts"===(0,b.chatMemberConnType)(n,r)?r.ctsServer:r.rtsHost;E("https://".concat(a,"/routing_schema/static/js/app.js"),function(){var t=e.refs.schema,o=n.members.map(function(e){var t=(0,_.getFlatProfile)(e,e.conn_type);return{huid:t.user_huid,name:t.name}}),s={user_huid:r.huid,contacts_info:o,chat_id:n.group_chat_id};window.routingSchemaService.buildRoutingAt(t,s,"https://".concat(a))}),this.setState({schemaRendered:!0})}},{key:"render",value:function(){return this.props.chat?p.default.createElement("div",{className:"chat-settings__routing"},p.default.createElement("div",{className:"layout-pane__header"},p.default.createElement("div",{className:"layout-pane__action layout-pane__action--back"},p.default.createElement(v.default,null)),p.default.createElement("div",{className:"chat__title"},p.default.createElement(h.FormattedMessage,{id:"[routing] header",defaultMessage:"Routing"}))),p.default.createElement("svg",{ref:"schema",width:"600",height:"500"})):null}}]),t}(p.Component),O=function(){var e=(0,y.makeGetCurrentChat)();return function(t,n){return{chat:e(t,n),user:t.user}}},C=(0,m.connect)(O)(S);t.default=C},"./app/containers/Chats/SearchResultsPanel.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){if(!a(e,t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function u(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?d(e):t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),f=n("./node_modules/react-redux/lib/index.js"),m=n("./app/modules/chats.js"),h=n("./app/selectors/phonebookSelectors.js"),y=r(n("./app/components/Chats/ChatListEntry.js")),_=n("./app/helpers/chatsHelpers.js"),b=n("./app/helpers/appHelpers.js"),v=r(n("./app/components/Contacts/PhonebookEntry.js")),g=n("./app/modules/ui.js"),E=function(e){function t(){var e,n,r;s(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return u(r,(n=r=u(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),Object.defineProperty(d(r),"handlePhonebookEntryClick",{configurable:!0,enumerable:!0,writable:!0,value:function(e){return r.props.chatsSearchTextChanged(""),r.props.createChat({members:[e.user_huid],chat_type:"chat",name:"personal chat"})}}),n))}return l(t,e),c(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.chats,r=t.phonebook,a=t.searchText,o=t.chatsFromFilter,s=t.locale,i=n.filter(function(e){return(0,b.matchMultiText)(e.name,a)}).filter(function(e){return e.connType===o||"all"===o}),c=(0,_.chatsMembersHuids)(i.filter(function(e){return"chat"===e.chat_type})),u=r.filter(function(e){return!c.includes(e.user_huid)}).filter(function(e){return(0,b.matchMultiText)(e.name,a)||e.contact&&e.contact&&e.contact.includes(null===a||void 0===a?void 0:a.replace("+",""))}).filter(function(e){return e.conn_type===o||"all"===o}),l=i.map(function(t){return p.default.createElement(y.default,{key:t.group_chat_id,chat:t,locale:s,onClick:function(){return e.props.chatsSearchTextChanged("")}})}),d=u.map(function(t){return p.default.createElement(v.default,{entry:t,key:t.entry_id,onClick:function(){return e.handlePhonebookEntryClick(t)}})});return l.concat(d)}}]),t}(p.Component),S=function(e){return{phonebook:(0,h.getActivePhonebookEntryListWithStatuses)(e)}},O=(0,f.connect)(S,{createChat:m.createChat,chatsSearchTextChanged:g.chatsSearchTextChanged})(E);t.default=O},"./app/containers/Contacts/AddEntryContainer.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){if(!a(e,t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function u(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?d(e):t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),f=r(n("./node_modules/history/createHashHistory.js")),m=n("./node_modules/react-redux/lib/index.js"),h=n("./node_modules/formsy-react/lib/main.js"),y=n("./node_modules/lodash/lodash.js"),_=r(n("./app/components/Input.js")),b=n("./app/modules/phonebook.js"),v=n("./app/modules/notifiers.js"),g=n("./app/selectors/phonebookSelectors.js"),E=r(n("./lib/config.js")),S=(0,f.default)(),O=function(e){function t(){var e,n,r;s(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return u(r,(n=r=u(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),Object.defineProperty(d(r),"state",{configurable:!0,enumerable:!0,writable:!0,value:{canSubmit:!1}}),Object.defineProperty(d(r),"enableButton",{configurable:!0,enumerable:!0,writable:!0,value:function(){r.setState({canSubmit:!0})}}),Object.defineProperty(d(r),"disableButton",{configurable:!0,enumerable:!0,writable:!0,value:function(){r.setState({canSubmit:!1})}}),Object.defineProperty(d(r),"submit",{configurable:!0,enumerable:!0,writable:!0,value:function(e){var t=r.props,n=t.user,a=t.phonebook,o=E.default.regions[n.region].prefix,s=o+e.phone.trim();if(s===n.phone.toString())return void r.props.showNotifier("You cant add yourself to phonebook","error");var i=(0,y.find)(a,function(e){return(0,y.includes)((0,y.map)(e.contacts,"contact"),s)});if(i)return r.props.showNotifier("Contact already in phonebook"),void S.push("/contacts/".concat(i.entry_id));r.props.uploadPhonebook(e.name.trim(),s),S.push("/contacts")}}),n))}return l(t,e),c(t,[{key:"render",value:function(){var e=this.props.user,t=E.default.regions[e.region].prefix;return p.default.createElement("div",{className:"contact-add"},p.default.createElement("h2",null,"Add new contact"),p.default.createElement(h.Form,{onValidSubmit:this.submit,onValid:this.enableButton,onInvalid:this.disableButton},p.default.createElement("div",{className:"phone"},p.default.createElement("span",{className:"prefix"},"+",t),p.default.createElement(_.default,{autoFocus:!0,name:"phone",type:"text",placeholder:"9001234567",validations:"isPhoneNumber:".concat(e.region),required:!0,validationError:"Please enter valid phone number"})),p.default.createElement(_.default,{name:"name",type:"text",placeholder:"Name",validations:"isName",required:!0,validationError:"Invalid name"}),p.default.createElement("button",{disabled:!this.state.canSubmit,className:"btn small green"},"Add")))}}]),t}(p.Component),C=function(e){return{user:e.user,phonebook:(0,g.getActivePhonebookEntryListWithStatuses)(e)}},w=(0,m.connect)(C,{uploadPhonebook:b.uploadPhonebook,showNotifier:v.showNotifier})(O);t.default=w},"./app/containers/Contacts/EntryBodyContainer.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){if(!a(e,t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function u(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?d(e):t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),f=n("./node_modules/react-redux/lib/index.js"),m=r(n("./node_modules/history/createHashHistory.js")),h=r(n("./app/components/Contacts/PhonebookEntryCard.js")),y=n("./app/modules/chats.js"),_=n("./app/modules/voex.js"),b=n("./app/selectors/phonebookSelectors.js"),v=n("./app/selectors/chatsSelectors.js"),g=(0,m.default)(),E=function(e){function t(){var e,n,r;s(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return u(r,(n=r=u(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),Object.defineProperty(d(r),"handleCreateChat",{configurable:!0,enumerable:!0,writable:!0,value:function(e){return r.props.createChat({members:[e],chat_type:"chat",name:"personal chat"})}}),Object.defineProperty(d(r),"handleCall",{configurable:!0,enumerable:!0,writable:!0,value:function(e,t){r.props.sendCallOffer(e.user_huid,t)}}),n))}return l(t,e),c(t,[{key:"componentDidMount",value:function(){this.props.entry||g.push("/contacts")}},{key:"componentWillReceiveProps",value:function(e){e.entry||g.push("/contacts")}},{key:"render",value:function(){var e=this.props,t=e.entry,n=e.callOfferAllowed;return p.default.createElement(h.default,{entry:t,onCreatePersonalChat:this.handleCreateChat,onCall:this.handleCall,callOfferAllowed:n})}}]),t}(p.Component),S=function(){var e=(0,b.makeGetCurrentPhonebookEntry)();return function(t,n){return{user:t.user,entry:e(t,n),chats:(0,v.getChatList)(t),callOfferAllowed:t.voex.status===_.callStatusEnum.idle}}},O=(0,f.connect)(S,{createChat:y.createChat,sendCallOffer:_.sendCallOffer})(E);t.default=O},"./app/containers/Contacts/EntryContainer.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){if(!a(e,t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function u(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?l(e):t}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),f=r(n("./node_modules/history/createHashHistory.js")),m=n("./node_modules/react-redux/lib/index.js"),h=n("./app/selectors/chatsSelectors.js"),y=n("./app/helpers/reactHelpers.js"),_=r(n("./app/components/Contacts/PhonebookEntry.js")),b=(0,f.default)(),v=function(e){function t(){return s(this,t),u(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return d(t,e),c(t,[{key:"shouldComponentUpdate",value:function(e){var t=["user.huid","user.name","entry","active"];return(0,y.isShouldComponentUpdate)(this.props,e,t)}},{key:"render",value:function(){var e=this.props,t=e.entry,n=e.active;return p.default.createElement(_.default,{entry:t,key:t.user_huid,isActive:n,onClick:function(){return b.push("/contacts/".concat(t.entry_id))}})}}]),t}(p.Component),g=function(e){return{chats:(0,h.getChatList)(e),user:e.user}},E=(0,m.connect)(g)(v);t.default=E},"./app/containers/Contacts/EntryListContainer.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){if(!a(e,t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function u(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?d(e):t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),f=n("./node_modules/react-redux/lib/index.js"),m=n("./node_modules/react-router-dom/es/index.js"),h=n("./node_modules/react-intl/lib/index.es.js"),y=r(n("./app/containers/Contacts/EntryContainer.js")),_=r(n("./app/containers/Contacts/AddEntryContainer.js")),b=r(n("./app/containers/Contacts/EntryBodyContainer.js")),v=r(n("./app/components/App/MainMenu.js")),g=r(n("./app/components/SearchFiltersPanel.js")),E=r(n("./app/components/App/Toggler.js")),S=n("./app/selectors/phonebookSelectors.js"),O=n("./app/modules/ui.js"),C=n("./app/modules/phonebook.js"),w=n("./app/helpers/appHelpers.js"),j=function(e){function t(){var e,n,r;s(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return u(r,(n=r=u(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),Object.defineProperty(d(r),"handleOnlineFilterChange",{configurable:!0,enumerable:!0,writable:!0,value:function(e){r.props.phonebookOnlineOnlyFilterChanged(e.target.checked)}}),Object.defineProperty(d(r),"handleRegisteredFilterChange",{configurable:!0,enumerable:!0,writable:!0,value:function(e){r.props.phonebookRegisteredOnlyFilterChanged(e.target.checked)}}),n))}return l(t,e),c(t,[{key:"componentWillMount",value:function(){this.props.fetchPhonebook()}},{key:"componentWillUnmount",value:function(){this.props.phonebookSearchTextChanged("")}},{key:"renderEntries",value:function(){var e=this.props,t=e.phonebook,n=e.searchText,r=e.onlineOnlyFilter,a=e.registeredOnlyFilter,o=e.phonebookFromFilter,s=e.location;return t.filter(function(e){return(0,w.matchMultiText)(e.name,n)||e.contact&&e.contact.includes(null===n||void 0===n?void 0:n.replace("+",""))}).filter(function(e){return"all"===o||o===e.conn_type}).filter(function(e){return!a||e.active}).filter(function(e){return!r||"online"===e.status}).map(function(e){var t=new RegExp("/".concat(e.entry_id,"$")).test(s.pathname);return p.default.createElement(y.default,{entry:e,active:t,key:e.entry_id})})}},{key:"renderEntry",value:function(){var e=this.props.match;return e.isExact?p.default.createElement("div",{className:"layout-pane__choose-entry"},p.default.createElement("header",{className:"layout-pane__header"}),p.default.createElement("div",{className:"layout-pane__body"},p.default.createElement("strong",{className:"layout-pane__body-title"},p.default.createElement(h.FormattedMessage,{id:"[phonebook] choose",defaultMessage:"Choose phonebook entry"})))):p.default.createElement(m.Switch,null,p.default.createElement(m.Route,{path:"".concat(e.url,"/add"),component:_.default}),p.default.createElement(m.Route,{path:"".concat(e.url,"/:id"),component:b.default}))}},{key:"render",value:function(){var e=this,t=(0,h.defineMessages)({search:{id:"[phonebook] search placeholder",defaultMessage:"Search contacts"}});return p.default.createElement("div",{className:"layout-pane-wrapper"},p.default.createElement("div",{className:"layout-pane"},p.default.createElement("div",{className:"layout-pane__left"},p.default.createElement("div",{className:"layout-pane__header"},p.default.createElement("div",{className:"layout-pane__action layout-pane__action--menu"},p.default.createElement(v.default,null)),p.default.createElement("span",{className:"layout-pane__title"},p.default.createElement(h.FormattedMessage,{id:"[phonebook] title",defaultMessage:"Contacts"}))),p.default.createElement("div",{className:"layout-pane__body layout-pane__body--br"},p.default.createElement("div",{className:"layout-pane__search"},p.default.createElement(g.default,{name:"contacts",onButtonClick:function(t){return e.props.phonebookUsersFromFilterChanged(t)},onInputChange:function(t){return e.props.phonebookSearchTextChanged(t)},placeholder:this.props.intl.formatMessage(t.search)},p.default.createElement("label",{className:"search-filter-panel__switcher",htmlFor:"filter-registered"},p.default.createElement(h.FormattedMessage,{id:"[phonebook] registered",defaultMessage:"Registered contacts"}),p.default.createElement(E.default,{id:"filter-registered",checked:this.props.registeredOnlyFilter,onChange:this.handleRegisteredFilterChange})),p.default.createElement("label",{className:"search-filter-panel__switcher",htmlFor:"filter-online"},p.default.createElement(h.FormattedMessage,{id:"[phonebook] online",defaultMessage:"Online users only"}),p.default.createElement(E.default,{id:"filter-online",checked:this.props.onlineOnlyFilter,onChange:this.handleOnlineFilterChange})))),p.default.createElement("div",{className:"layout-pane__phonebook-list layout-pane__phonebook-list--contacts"},this.renderEntries()))),p.default.createElement("div",{className:"layout-pane__right"},this.renderEntry())))}}]),t}(p.Component),k=function(e){return{user:e.user,phonebook:(0,S.getPhonebookEntryListWithStatuses)(e),searchText:e.ui.phonebookSearchText,onlineOnlyFilter:e.ui.phonebookOnlineOnlyFilter,registeredOnlyFilter:e.ui.phonebookRegisteredOnlyFilter,phonebookFromFilter:e.ui.phonebookUsersFromFilter}},P=(0,f.connect)(k,{phonebookSearchTextChanged:O.phonebookSearchTextChanged,phonebookOnlineOnlyFilterChanged:O.phonebookOnlineOnlyFilterChanged,phonebookRegisteredOnlyFilterChanged:O.phonebookRegisteredOnlyFilterChanged,phonebookUsersFromFilterChanged:O.phonebookUsersFromFilterChanged,fetchPhonebook:C.fetchPhonebook})((0,h.injectIntl)(j));t.default=P},"./app/containers/Layout/Favicon.js":function(e,t,n){"use strict";function r(e,t){return s(e)||o(e,t)||a()}function a(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function o(e,t){var n=[],r=!0,a=!1,o=void 0;try{for(var s,i=e[Symbol.iterator]();!(r=(s=i.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==i.return||i.return()}finally{if(a)throw o}}return n}function s(e){if(Array.isArray(e))return e}function i(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){if(!i(e,t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e,t,n){return t&&l(e.prototype,t),n&&l(e,n),e}function p(e,t){return!t||"object"!==c(t)&&"function"!=typeof t?m(e):t}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function m(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var h=n("./node_modules/react/index.js"),y=n("./node_modules/react-redux/lib/index.js"),_=n("./node_modules/react-router/es/index.js"),b=n("./app/selectors/chatsSelectors.js"),v=n("./app/helpers/appHelpers.js"),g=n("./app/helpers/reactHelpers.js"),E=function(e){return e&&e.__esModule?e:{default:e}}(n("./lib/config.js")),S=function(e){function t(){var e,n,r;u(this,t);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return p(r,(n=r=p(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),Object.defineProperty(m(r),"render",{configurable:!0,enumerable:!0,writable:!0,value:function(){return null}}),n))}return f(t,e),d(t,[{key:"componentDidMount",value:function(){this.handleUpdate()}},{key:"shouldComponentUpdate",value:function(e){var t=["location.pathname","unreadChatsNumber","chat.members_type"];return(0,g.isShouldComponentUpdate)(this.props,e,t)}},{key:"componentDidUpdate",value:function(){this.handleUpdate()}},{key:"handleUpdate",value:function(){var e=this.props,t=e.unreadChatsNumber,n=e.chat,r=E.default.environment,a=(0,v.getFavicon)(r,null===n||void 0===n?void 0:n.members_type,t);a&&(0,v.setFavicon)(a)}}]),t}(h.Component),O=function(e,t){var n=t.location.pathname.match(/\/chats\/([0-9-a-f]{36})/)||[],a=r(n,2),o=a[1];return{unreadChatsNumber:(0,b.countUnreadChats)(e),chat:e.chats.find(function(e){return e.group_chat_id===o})}},C=(0,_.withRouter)((0,y.connect)(O)(S));t.default=C},"./app/containers/Layout/IntlProvider.js":function(e,t,n){"use strict";function r(e){var t=e.ui.locale||"en";return{locale:t,messages:(0,s.getMessages)(t)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n("./node_modules/react-redux/lib/index.js"),o=n("./node_modules/react-intl/lib/index.es.js"),s=n("./lib/reactIntl.js"),i=(0,a.connect)(r)(o.IntlProvider);t.default=i},"./app/containers/Layout/StatusMessageContainer.js":function(e,t,n){"use strict";function r(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!r(e,t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}function c(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?u(e):t}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var d=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),p=n("./node_modules/react-redux/lib/index.js"),f=n("./node_modules/react-intl/lib/index.es.js"),m=function(e){function t(){return o(this,t),c(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return l(t,e),i(t,[{key:"render",value:function(){var e=this.props.statusMessage;if(!e)return null;var t=(0,f.defineMessages)({connecting:{id:"[systemStatusMessages] connecting",defaultMessage:"Connecting"},loading:{id:"[systemStatusMessages] loading",defaultMessage:"Loading"},updating:{id:"[systemStatusMessages] updating",defaultMessage:"Updating"}});return d.default.createElement("div",{className:"app-status-message"},d.default.createElement("span",{className:"app-status-message__text"},this.props.intl.formatMessage(t[e])),d.default.createElement("span",{className:"app-status-message__loader"},"..."))}}]),t}(d.Component),h=function(e){return{statusMessage:e.ui.statusMessage}},y=(0,p.connect)(h)((0,f.injectIntl)(m));t.default=y},"./app/containers/Layout/UiAlert.js":function(e,t,n){"use strict";function r(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!r(e,t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}function c(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?u(e):t}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var d=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),p=n("./node_modules/react-redux/lib/index.js"),f=n("./node_modules/react-intl/lib/index.es.js"),m=n("./app/modules/ui.js"),h=n("./app/modules/user.js"),y=function(e){return e&&e.__esModule?e:{default:e}}(n("./app/assets/icons/logo.svg")),_=function(e){function t(){return o(this,t),c(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return l(t,e),i(t,[{key:"handleUpdate",value:function(e){this.props.updateApp(e)}},{key:"handleClearData",value:function(){this.props.logoutRts()}},{key:"renderUpdate",value:function(){var e=this,t=this.props.ui,n=t.uiAlertType,r=t.uiAlertAppVersion,a="must_update_and_clear_data"===n;return d.default.createElement("div",{className:"ui-alert"},d.default.createElement("div",null,d.default.createElement(y.default,{width:"195",height:"168"})),d.default.createElement("div",{className:"ui-alert__title"},d.default.createElement(f.FormattedMessage,{id:"[uialert] upd title",defaultMessage:"To continue please update application to the latest version"})," ",r,"."),d.default.createElement("button",{className:"btn btn--submit",onClick:function(){return e.handleUpdate(a)}},d.default.createElement(f.FormattedMessage,{id:"[uialert] upd btn",defaultMessage:"Update"})))}},{key:"renderClearData",value:function(){var e=this;return d.default.createElement("div",{className:"ui-alert"},d.default.createElement("div",null,d.default.createElement(y.default,{width:"195",height:"168"})),d.default.createElement("div",{className:"ui-alert__title"},d.default.createElement(f.FormattedMessage,{id:"[uialert] clr title",defaultMessage:"To continue please clear cache."})),d.default.createElement("button",{className:"btn btn--submit",onClick:function(){return e.handleClearData()}},d.default.createElement(f.FormattedMessage,{id:"[uialert] clr btn",defaultMessage:"Clear cache"})))}},{key:"render",value:function(){return"must_clear_data"===this.props.ui.uiAlertType?this.renderClearData():this.renderUpdate()}}]),t}(d.Component),b=function(e){return{ui:e.ui}},v=(0,p.connect)(b,{updateApp:m.updateApp,logoutRts:h.logoutRts})(_);t.default=v},"./app/containers/Root.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){if(!a(e,t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function u(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?l(e):t}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),f=r(n("./node_modules/prop-types/index.js")),m=n("./node_modules/react-redux/lib/index.js"),h=n("./node_modules/react-router-dom/es/index.js"),y=n("./node_modules/react-router-redux/es/index.js"),_=n("./node_modules/react-hot-loader/index.js"),b=r(n("./app/containers/Layout/IntlProvider.js"));n("./app/helpers/contextMenu.js");var v=r(n("./app/containers/App.js")),g=function(e){function t(){return s(this,t),u(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return d(t,e),c(t,[{key:"render",value:function(){var e=this.props,t=e.store,n=e.history;return p.default.createElement(m.Provider,{store:t},p.default.createElement(b.default,null,p.default.createElement(_.AppContainer,null,p.default.createElement(y.ConnectedRouter,{history:n},p.default.createElement(h.Route,{path:"/",component:v.default})))))}}]),t}(p.Component);t.default=g,g.propTypes={store:f.default.object.isRequired,history:f.default.object.isRequired}},"./app/containers/Settings/About.js":function(e,t,n){"use strict";function r(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!r(e,t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}function c(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?u(e):t}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var d=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),p=n("./node_modules/react-intl/lib/index.es.js"),f=n("./node_modules/react-redux/lib/index.js"),m=function(e){return e&&e.__esModule?e:{default:e}}(n("./app/assets/images/express_logo_black.png")),h=function(e){function t(){return o(this,t),c(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return l(t,e),i(t,[{key:"render",value:function(){var e=this.props.user,t=e.corpAvatar?"//".concat(e.ctsServer,"/").concat(e.corpAvatar):m.default;return d.default.createElement("div",{className:"settings"},d.default.createElement("div",{className:"layout-pane__header"},d.default.createElement("div",{className:"chat__title"},d.default.createElement(p.FormattedMessage,{id:"[settings] about",defaultMessage:"About"}))),d.default.createElement("div",{className:"layout-pane__body layout-pane__body--overflow"},d.default.createElement("div",{className:"chat__pane"},d.default.createElement("div",{className:"chat-settings__header"},d.default.createElement("div",{className:"chat-avatar"},d.default.createElement("div",{className:"chat-avatar__inner"},d.default.createElement("img",{className:"chat-avatar__img",alt:"logo",src:t}))),d.default.createElement("div",{className:"chat-settings__title"},d.default.createElement(p.FormattedMessage,{id:"[settings] version",defaultMessage:"Version"}),": ","1.2.788")))))}}]),t}(d.Component),y=function(e){return{user:e.user}},_=(0,f.connect)(y)(h);t.default=_},"./app/containers/Settings/Cts.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){if(!a(e,t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function u(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?d(e):t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),f=n("./node_modules/react-intl/lib/index.es.js"),m=r(n("./node_modules/history/createHashHistory.js")),h=n("./node_modules/react-redux/lib/index.js"),y=n("./node_modules/formsy-react/lib/main.js"),_=n("./app/modules/user.js"),b=n("./app/modules/notifiers.js"),v=n("./lib/sockets.js"),g=n("./lib/reactIntl.js"),E=r(n("./app/components/Input.js")),S=r(n("./app/components/Button.js")),O=(0,m.default)(),C=function(e){function t(e){var n;return s(this,t),n=u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),Object.defineProperty(d(n),"enableButton",{configurable:!0,enumerable:!0,writable:!0,value:function(){n.setState({canSubmit:!0})}}),Object.defineProperty(d(n),"disableButton",{configurable:!0,enumerable:!0,writable:!0,value:function(){n.setState({canSubmit:!1})}}),Object.defineProperty(d(n),"submitLogin",{configurable:!0,enumerable:!0,writable:!0,value:function(e){var t=e.server,r=e.login,a=e.password;n.props.loginCts(t,r,a)}}),Object.defineProperty(d(n),"submitLogout",{configurable:!0,enumerable:!0,writable:!0,value:function(){n.props.requestLogoutCts()}}),Object.defineProperty(d(n),"submitDialog",{configurable:!0,enumerable:!0,writable:!0,value:function(e){n.setState({ctsLogoutRequested:e})}}),n.state={canSubmit:!1,ctsLogoutRequested:!1},n}return l(t,e),c(t,[{key:"componentDidUpdate",value:function(e){var t=e.user.ctsAuthToken,n=this.props.user.ctsAuthToken;this.redirectToPageBasedOnCtsAuth(t,n)}},{key:"redirectToPageBasedOnCtsAuth",value:function(e,t){if(e!==t){var n=(0,f.defineMessages)({success:{id:"[cts notify] success",defaultMessage:"Successfully logged in on CTS"}});O.push("/settings"),this.props.showNotifier(this.props.intl.formatMessage(n.success))}}},{key:"renderConnected",value:function(){var e=this,t=this.props.user,n=t.corpAvatar&&"//".concat(t.ctsServer,"/").concat(t.corpAvatar);return this.state.ctsLogoutRequested?p.default.createElement("div",{className:"cts-connection"},p.default.createElement("p",{className:"cts-connection__desc"},p.default.createElement(f.FormattedMessage,{id:"[auth] cts wait logout",defaultMessage:"The application will be blocked until the administrator confirms logout. Continue?"})),p.default.createElement("div",{className:"cts-connection__actions"},p.default.createElement("button",{className:"btn btn--submit",onClick:function(){return e.submitLogout()}},p.default.createElement(f.FormattedMessage,{id:"[auth] yes",defaultMessage:"Yes"})),p.default.createElement("button",{className:"btn btn--default",onClick:function(){return e.submitDialog(!1)}},p.default.createElement(f.FormattedMessage,{id:"[auth] no",defaultMessage:"No"})))):p.default.createElement("div",{className:"cts-connection"},p.default.createElement("div",{className:"cts-connection-info"},n&&p.default.createElement("img",{className:"cts-connection-info__avatar",alt:"cts-avatar",src:n}),p.default.createElement("div",{className:"cts-connection-info__desc"},p.default.createElement("div",{className:"cts-connection-info__host"},t.ctsServer),p.default.createElement("div",{className:"cts-connection-info__user"},p.default.createElement(f.FormattedMessage,{id:"[auth] connected",defaultMessage:"Connected:"})," ",p.default.createElement("strong",null,t.ctsLogin))),p.default.createElement("button",{className:"btn btn--default cts-connection-info__btn",onClick:function(){return e.submitDialog(!0)}},p.default.createElement(f.FormattedMessage,{id:"[auth] logout",defaultMessage:"Logout"}))))}},{key:"renderDisconnected",value:function(){var e=this.props,t=e.user,n=e.fetching,r=(0,f.defineMessages)({url:{id:"[auth] url",defaultMessage:"URL-address"},domain:{id:"[auth] domain",defaultMessage:"Domain/login"},password:{id:"[auth] password",defaultMessage:"Password"},urlError:{id:"[auth] url error",defaultMessage:"Invalid domain name, example server.com"}});return t.ctsAuthToken?null:p.default.createElement("div",{className:"cts-connection"},p.default.createElement(y.Form,{onValidSubmit:this.submitLogin,onValid:this.enableButton,onInvalid:this.disableButton},p.default.createElement(E.default,{name:"server",type:"text",placeholder:(0,g.formatMessage)(r.url),className:"registration__form-row",labelClassName:"form-field registration__form-field",inputClassName:"form-field__input",errorClassName:"registration__desc registration__desc--warning",value:t.ctsServer,validations:"isDomainName",required:!0,validationError:p.default.createElement(f.FormattedMessage,r.urlError),showValidationErrorOnBlur:!0,tabIndex:"1"}),p.default.createElement(E.default,{name:"login",type:"text",placeholder:(0,g.formatMessage)(r.domain),className:"registration__form-row",labelClassName:"form-field registration__form-field",inputClassName:"form-field__input",errorClassName:"registration__desc registration__desc--warning",value:t.ctsLogin,validations:"isExisty",required:!0,tabIndex:"2"}),p.default.createElement(E.default,{name:"password",type:"password",placeholder:(0,g.formatMessage)(r.password),className:"registration__form-row",labelClassName:"form-field registration__form-field",inputClassName:"form-field__input",errorClassName:"registration__desc registration__desc--warning",validations:"isExisty",required:!0,tabIndex:"3"}),p.default.createElement(S.default,{className:"btn btn--submit",disabled:!this.state.canSubmit,isLoading:n,overlayClassName:"btn__loader-overlay btn__loader-overlay--submit"},p.default.createElement(f.FormattedMessage,{id:"[auth] cts connect",defaultMessage:"Connect"}))))}},{key:"render",value:function(){var e=this.props.socketCts;return p.default.createElement("div",{className:"settings"},p.default.createElement("div",{className:"layout-pane__header"},p.default.createElement("div",{className:"chat__title"},p.default.createElement(f.FormattedMessage,{id:"[auth] cts settings",defaultMessage:"CTS settings"}))),p.default.createElement("div",{className:"layout-pane__body layout-pane__body--overflow"},p.default.createElement("div",{className:"chat__pane"},"open"===(null===e||void 0===e?void 0:e.connectionState())?this.renderConnected():this.renderDisconnected())))}}]),t}(p.Component),w=function(e){return{user:e.user,fetching:e.ui.authFetching,socketCts:(0,v.getSocket)("cts")}},j=(0,h.connect)(w,{loginCts:_.loginCts,requestLogoutCts:_.requestLogoutCts,showNotifier:b.showNotifier})((0,f.injectIntl)(C));t.default=j},"./app/containers/Settings/DeveloperSettings.js":function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}function a(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function o(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){return l(e)||u(e,t)||c()}function c(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function u(e,t){var n=[],r=!0,a=!1,o=void 0;try{for(var s,i=e[Symbol.iterator]();!(r=(s=i.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==i.return||i.return()}finally{if(a)throw o}}return n}function l(e){if(Array.isArray(e))return e}function d(e,t){if(!o(e,t))throw new TypeError("Cannot call a class as a function")}function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e,t,n){return t&&p(e.prototype,t),n&&p(e,n),e}function m(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?h(e):t}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function y(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var _=r(n("./node_modules/react/index.js")),b=n("./node_modules/react-redux/lib/index.js"),v=n("./node_modules/react-intl/lib/index.es.js"),g=n("./lib/sockets.js"),E=r(n("./lib/networkStats.js")),S=function(e){function t(){return d(this,t),m(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return y(t,e),f(t,[{key:"render",value:function(){var e=this.props,t=e.chats,n=e.phonebook,r=e.user,a=e.state,o=(0,g.getSocket)("rts"),s=(0,g.getSocket)("cts");return _.default.createElement("div",{className:"settings"},_.default.createElement("div",{className:"layout-pane__header"},_.default.createElement("div",{className:"chat__title"},_.default.createElement(v.FormattedMessage,{id:"[dev settings] caption",defaultMessage:"Developer settings"}))),_.default.createElement("div",{className:"layout-pane__body infinite-scroll"},_.default.createElement("div",{className:"chat__pane"},_.default.createElement("h4",null,_.default.createElement(v.FormattedMessage,{id:"[main menu] chats",defaultMessage:"Chats"})),_.default.createElement("ul",{className:"dev-settings dev-settings--chats"},_.default.createElement("li",null,_.default.createElement(v.FormattedMessage,{id:"[dev settings] rts chats",defaultMessage:"Number of personal RTS chats: "}),t.filter(function(e){return"rts"===e.members_type&&"chat"===e.chat_type}).length),_.default.createElement("li",null,_.default.createElement(v.FormattedMessage,{id:"[dev settings] group rts chats",defaultMessage:"Number of group RTS chats: "}),t.filter(function(e){return"rts"===e.members_type&&"group_chat"===e.chat_type}).length),_.default.createElement("li",null,_.default.createElement(v.FormattedMessage,{id:"[dev settings] cts chats",defaultMessage:"Number of personal CTS chats: "}),t.filter(function(e){return"cts"===e.members_type&&"chat"===e.chat_type}).length),_.default.createElement("li",null,_.default.createElement(v.FormattedMessage,{id:"[dev settings] group cts chats",defaultMessage:"Number of group CTS chats: "}),t.filter(function(e){return"cts"===e.members_type&&"group_chat"===e.chat_type}).length),_.default.createElement("li",null,_.default.createElement(v.FormattedMessage,{id:"[dev settings] hybrid chats",defaultMessage:"Number of hybrid chats: "}),t.filter(function(e){return"hybrid"===e.members_type}).length),_.default.createElement("li",null,_.default.createElement(v.FormattedMessage,{id:"[dev settings] total chats",defaultMessage:"Total number of chats: "}),t.length)),_.default.createElement("h4",null,_.default.createElement(v.FormattedMessage,{id:"[main menu] contacts",defaultMessage:"Contacts"})),_.default.createElement("ul",{className:"dev-settings dev-settings--contacts"},_.default.createElement("li",null,_.default.createElement(v.FormattedMessage,{id:"[dev settings] rts contacts",defaultMessage:"Number of RTS contacts: "}),n.rts.length),_.default.createElement("li",null,_.default.createElement(v.FormattedMessage,{id:"[dev settings] cts contacts",defaultMessage:"Number of CTS contacts: "}),n.cts.length),_.default.createElement("li",null,_.default.createElement(v.FormattedMessage,{id:"[dev settings] total contacts",defaultMessage:"Total number of contacts: "}),n.rts.length+n.cts.length),_.default.createElement("li",null,_.default.createElement(v.FormattedMessage,{id:"[dev settings] phonebook version rts contacts",defaultMessage:"Phonebook version RTS: "}),n.versions.rts),_.default.createElement("li",null,_.default.createElement(v.FormattedMessage,{id:"[dev settings] phonebook version cts contacts",defaultMessage:"Phonebook version CTS: "}),n.versions.cts)),_.default.createElement("h4",null,_.default.createElement(v.FormattedMessage,{id:"[dev settings] user",defaultMessage:"User"})),_.default.createElement("ul",{className:"dev-settings dev-settings--user"},_.default.createElement("li",null,"huid: ",r.huid),_.default.createElement("li",null,"udid: ",r.udid),_.default.createElement("li",null,_.default.createElement(v.FormattedMessage,{id:"[dev settings] rts connection",defaultMessage:"RTS connection: "}),r.rtsHost||_.default.createElement(v.FormattedMessage,{id:"[dev settings] not connected",defaultMessage:"not connected"}),_.default.createElement("strong",null," ",null===o||void 0===o?void 0:o.connectionState())),_.default.createElement("li",null,_.default.createElement(v.FormattedMessage,{id:"[dev settings] ts connection",defaultMessage:"TS connection: "}),r.ctsServer||_.default.createElement(v.FormattedMessage,{id:"[dev settings] not connected",defaultMessage:"not connected"}),_.default.createElement("strong",null," ",null===s||void 0===s?void 0:s.connectionState()))),_.default.createElement("h4",null,"Socket outgoing commands (",E.default.getCounter(E.networkStatsTypesEnum.socketCommands),"):"),_.default.createElement("ul",{className:"dev-settings"},Object.entries(E.default.get(E.networkStatsTypesEnum.socketCommands)).map(function(e){var t=i(e,2),n=t[0],r=t[1];return _.default.createElement("li",null,"".concat(n,": ").concat(r))})),_.default.createElement("h4",null,"Socket incoming events (",E.default.getCounter(E.networkStatsTypesEnum.socketEvents),"):"),_.default.createElement("ul",{className:"dev-settings"},Object.entries(E.default.get(E.networkStatsTypesEnum.socketEvents)).map(function(e){var t=i(e,2),n=t[0],r=t[1];return _.default.createElement("li",null,"".concat(n,": ").concat(r))})),_.default.createElement("h4",null,"REST calls (",E.default.getCounter(E.networkStatsTypesEnum.restCalls),"):"),_.default.createElement("ul",{className:"dev-settings"},Object.entries(E.default.get(E.networkStatsTypesEnum.restCalls)).map(function(e){var t=i(e,2),n=t[0],r=t[1];return _.default.createElement("li",null,"".concat(n,": ").concat(r))})),_.default.createElement("h4",null,"Redux"),_.default.createElement("div",null,_.default.createElement("button",{className:"btn btn--submit",onClick:function(){return console.log(a)}},_.default.createElement(v.FormattedMessage,{id:"[dev settings] copy state",defaultMessage:"Copy state to console"}))))))}}]),t}(_.Component),O=function(e){var t=(e.encryptionKeys,a(e,["encryptionKeys"]));return{user:e.user,chats:e.chats,phonebook:e.phonebook,state:t}},C=(0,b.connect)(O)(S);t.default=C},"./app/containers/Settings/Notifications.js":function(e,t,n){"use strict";function r(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!r(e,t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}function c(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?l(e):t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var d=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),p=n("./node_modules/react-redux/lib/index.js"),f=n("./node_modules/react-intl/lib/index.es.js"),m=n("./app/modules/notifiers.js"),h=n("./app/modules/settings.js"),y=function(e){return e&&e.__esModule?e:{default:e}}(n("./app/components/App/Toggler.js")),_=function(e){function t(){var e,n,r;o(this,t);for(var a=arguments.length,s=new Array(a),i=0;i<a;i++)s[i]=arguments[i];return c(r,(n=r=c(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),Object.defineProperty(l(r),"handleNotifications",{configurable:!0,enumerable:!0,writable:!0,value:function(){var e=(0,f.defineMessages)({notifySettingsMessage:{id:"[settings notify] notification setting",defaultMessage:"You can change your notifications behavior in browser settings"}});r.props.showNotifier(r.props.intl.formatMessage(e.notifySettingsMessage))}}),n))}return u(t,e),i(t,[{key:"render",value:function(){var e=this,t=this.props.playNotificationSound;return d.default.createElement("div",{className:"settings"},d.default.createElement("div",{className:"layout-pane__header"},d.default.createElement("div",{className:"chat__title"},d.default.createElement(f.FormattedMessage,{id:"[settings notify] notification settings",defaultMessage:"Notification settings"}))),d.default.createElement("div",{className:"layout-pane__body layout-pane__body--overflow"},d.default.createElement("div",{className:"chat__pane"},d.default.createElement("a",{className:"chat-settings__row chat-settings__row--link",onClick:this.handleNotifications},d.default.createElement(f.FormattedMessage,{id:"[settings notify] change desktop notifications",defaultMessage:"Change desktop notifications"})),d.default.createElement("label",{className:"chat-settings__row chat-settings__row--value chat-settings__row--toggler",htmlFor:"sound"},d.default.createElement(f.FormattedMessage,{id:"[settings notify] play sound on new message",defaultMessage:"Play sound on new message"}),d.default.createElement(y.default,{id:"sound",checked:t,onChange:function(){return e.props.setPlayNotificationSound(!t)}})))))}}]),t}(d.Component),b=function(e){return{playNotificationSound:e.settings.playNotificationSound}},v=(0,p.connect)(b,{showNotifier:m.showNotifier,setPlayNotificationSound:h.setPlayNotificationSound})((0,f.injectIntl)(_));t.default=v},"./app/containers/Settings/Profile.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){if(!a(e,t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function u(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?d(e):t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),f=n("./node_modules/react-router-dom/es/index.js"),m=n("./node_modules/react-redux/lib/index.js"),h=n("./node_modules/react-intl/lib/index.es.js"),y=r(n("./node_modules/history/createHashHistory.js")),_=n("./app/modules/user.js"),b=r(n("./app/components/AvatarUploader.js")),v=r(n("./app/components/Avatar.js")),g=r(n("./app/components/Button.js")),E=r(n("./app/assets/icons/arrow-left.svg")),S=n("./lib/constants.js"),O=(0,y.default)(),C=function(e){function t(){var e,n,r;s(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return u(r,(n=r=u(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),Object.defineProperty(d(r),"state",{configurable:!0,enumerable:!0,writable:!0,value:{avatar:void 0,canSubmit:!1,name:""}}),Object.defineProperty(d(r),"handleAvatar",{configurable:!0,enumerable:!0,writable:!0,value:function(e){r.setState({avatar:e},function(){return r.validate()})}}),Object.defineProperty(d(r),"validate",{configurable:!0,enumerable:!0,writable:!0,value:function(e){var t,n,a=e?e.target.value.trim():r.state.name,o=r.state.avatar,s=a&&a!==(null===(t=r.props.user)||void 0===t?void 0:t.name)||o&&o!==(null===(n=r.props.user)||void 0===n?void 0:n.avatar);r.setState({name:a,canSubmit:s})}}),Object.defineProperty(d(r),"handleSaveProfile",{configurable:!0,enumerable:!0,writable:!0,value:function(){var e=r.state,t=e.name,n=e.avatar;e.canSubmit&&(r.props.uploadProfile(t,n),r.setState({canSubmit:!1}),O.push("/settings"))}}),n))}return l(t,e),c(t,[{key:"componentDidMount",value:function(){var e=this.props.user.name;this.setState({name:e})}},{key:"renderAvatar",value:function(){var e=this.state,t=e.name,n=e.avatar,r=this.props.user.ctsAuthToken?"cts":"rts";return p.default.createElement(v.default,{name:t,avatar:n,type:r})}},{key:"render",value:function(){var e=this.props,t=e.fetching,n=e.user,r=n.name,a=n.avatar,o=this.state.canSubmit;return p.default.createElement("div",{className:"settings"},p.default.createElement("div",{className:"layout-pane__header"},p.default.createElement("div",{className:"layout-pane__action layout-pane__action--back"},p.default.createElement(f.Link,{className:"btn btn--layout-back",to:"/settings"},p.default.createElement(E.default,{width:"24",height:"24",className:"btn__icon"}))),p.default.createElement("div",{className:"chat__title"},p.default.createElement(h.FormattedMessage,{id:"[profile] edit",defaultMessage:"Edit profile"}))),p.default.createElement("div",{className:"layout-pane__body layout-pane__body--overflow"},p.default.createElement("div",{className:"chat__pane"},p.default.createElement("div",{className:"chat-settings__header"},p.default.createElement(b.default,{avatar:a,width:S.AVATAR_UPLOADER_WIDTH,height:S.AVATAR_UPLOADER_HEIGHT,handleAvatar:this.handleAvatar,placeholder:p.default.createElement(h.FormattedHTMLMessage,{id:"[avatar] upload profile",defaultMessage:"Load profile<br/>avatar"})}),p.default.createElement("div",{className:"form-field form-field--chat-name"},p.default.createElement("input",{className:"form-field__input",type:"text",placeholder:"Name",defaultValue:r,onChange:this.validate})),p.default.createElement(g.default,{className:"btn btn--submit",disabled:!o,isLoading:t,onClick:this.handleSaveProfile,overlayClassName:"btn__loader-overlay btn__loader-overlay--submit"},p.default.createElement(h.FormattedMessage,{id:"[profile] save",defaultMessage:"Save"}))))))}}]),t}(p.Component),w=function(e){return{user:e.user,fetching:e.ui.authFetching}},j=(0,m.connect)(w,{uploadProfile:_.uploadProfile})(C);t.default=j},"./app/containers/Settings/Settings.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){if(!a(e,t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function u(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?d(e):t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),f=n("./node_modules/react-redux/lib/index.js"),m=n("./node_modules/react-router-dom/es/index.js"),h=n("./node_modules/react-intl/lib/index.es.js"),y=r(n("./node_modules/flag-icon-css/flags/1x1/ru.svg")),_=r(n("./node_modules/flag-icon-css/flags/1x1/gb.svg")),b=r(n("./app/containers/Settings/Profile.js")),v=(r(n("./app/containers/Settings/Cts.js")),r(n("./app/containers/Settings/About.js"))),g=r(n("./app/components/Avatar.js")),E=r(n("./app/components/App/MainMenu.js")),S=r(n("./app/containers/Settings/Notifications.js")),O=r(n("./app/containers/Settings/DeveloperSettings.js")),C=n("./app/modules/ui.js"),w=n("./app/modules/user.js"),j=n("./lib/sockets.js"),k=r(n("./app/assets/icons/edit.svg")),P=r(n("./app/components/App/Modal.js")),T=r(n("./app/components/Contacts/ContactList.js")),x=function(e){function t(e){var n;return s(this,t),n=u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),Object.defineProperty(d(n),"toggleLogoutModal",{configurable:!0,enumerable:!0,writable:!0,value:function(){n.setState({isLogoutModalOpen:!n.state.isLogoutModalOpen})}}),Object.defineProperty(d(n),"toggleLocaleModal",{configurable:!0,enumerable:!0,writable:!0,value:function(){n.setState({isLocaleModalOpen:!n.state.isLocaleModalOpen})}}),Object.defineProperty(d(n),"handleChangeLocale",{configurable:!0,enumerable:!0,writable:!0,value:function(e){n.props.setLocale(e),n.toggleLocaleModal()}}),n.state={isLogoutModalOpen:!1,isLocaleModalOpen:!1},n}return l(t,e),c(t,[{key:"renderUserInfo",value:function(){var e=this.props,t=e.user,n=e.ctsAuthToken,r=e.socketCts,a="open"===(null===r||void 0===r?void 0:r.connectionState());return p.default.createElement("div",{className:"settings"},p.default.createElement("div",{className:"layout-pane__header"},p.default.createElement("div",{className:"chat__title"},p.default.createElement(h.FormattedMessage,{id:"[settings] profile",defaultMessage:"Profile"})),p.default.createElement("div",{className:"layout-pane__action layout-pane__action--edit"},p.default.createElement(m.Link,{className:"btn btn--layout-edit",to:"/settings/profile"},p.default.createElement(k.default,{width:"24",height:"24",className:"btn__icon"})))),p.default.createElement("div",{className:"layout-pane__body layout-pane__body--overflow"},p.default.createElement("div",{className:"chat__pane-wrapper"},p.default.createElement("div",{className:"chat__pane"},p.default.createElement("div",{className:"chat-settings__header"},p.default.createElement(g.default,{name:t.name,avatar:t.avatar,type:n?"cts":"rts"}),p.default.createElement("h2",{className:"chat-settings__title"},t.name)))),p.default.createElement("div",{className:"chat__pane-wrapper"},p.default.createElement("div",{className:"chat__pane"},p.default.createElement(T.default,{contacts:[{contact:t.phone,contact_type:"phone"},{contact:a?p.default.createElement(h.FormattedMessage,{id:"[settings] connected",defaultMessage:"Connected"}):p.default.createElement(h.FormattedMessage,{id:"[settings] not connected",defaultMessage:"Not connected"}),contact_type:"cts_connection"}]})))))}},{key:"renderSetting",value:function(){var e=this.props.match;return e.isExact?this.renderUserInfo():p.default.createElement(m.Switch,null,p.default.createElement(m.Route,{path:"".concat(e.url,"/profile"),component:b.default}),!1,p.default.createElement(m.Route,{path:"".concat(e.url,"/about"),component:v.default}),p.default.createElement(m.Route,{path:"".concat(e.url,"/notifications"),component:S.default}),p.default.createElement(m.Route,{path:"".concat(e.url,"/developer"),component:O.default}))}},{key:"renderLocaleModal",value:function(){var e=this,t=this.state.isLocaleModalOpen,n=this.props.locale,r=[{locale:"en",flag:_.default,name:"English"},{locale:"ru",flag:y.default,name:""}];return p.default.createElement(P.default,{name:"settings-language",caption:p.default.createElement(h.FormattedMessage,{id:"[settings] lang modal",defaultMessage:"Choose language"}),isOpen:t,onClose:this.toggleLocaleModal},p.default.createElement("div",{className:"settings-lang"},r.map(function(t){return p.default.createElement("div",{className:"settings-lang__item ".concat(t.locale===n?"settings-lang__item--selected":""),key:t.locale,onClick:function(){return e.handleChangeLocale(t.locale)}},p.default.createElement("img",{className:"settings-lang__icon",src:t.flag,alt:t.locale}),p.default.createElement("span",null,t.name))})))}},{key:"render",value:function(){var e=this.state.isLogoutModalOpen;return p.default.createElement("div",{className:"layout-pane-wrapper"},p.default.createElement("div",{className:"layout-pane"},p.default.createElement("div",{className:"layout-pane__left"},p.default.createElement("div",{className:"layout-pane__header"},p.default.createElement("div",{className:"layout-pane__action layout-pane__action--menu"},p.default.createElement(E.default,null)),p.default.createElement("span",{className:"layout-pane__title"},p.default.createElement(h.FormattedMessage,{id:"[settings] title",defaultMessage:"Settings"}))),p.default.createElement("div",{className:"layout-pane__body layout-pane__body--br layout-pane__body--overflow"},p.default.createElement("div",{className:"chat__pane chat__pane--settings-chat chat__pane--border-bottom"},p.default.createElement(m.NavLink,{className:"chat-settings__row chat-settings__row--link",activeClassName:"chat-settings__row--link-active",to:"/settings",exact:!0},p.default.createElement(h.FormattedMessage,{id:"[settings] profile",defaultMessage:"Profile"})),!1,p.default.createElement(m.NavLink,{className:"chat-settings__row chat-settings__row--link",activeClassName:"chat-settings__row--link-active",to:"/settings/notifications",exact:!0},p.default.createElement(h.FormattedMessage,{id:"[settings] notifications",defaultMessage:"Notifications"})),p.default.createElement("a",{className:"chat-settings__row chat-settings__row--link",onClick:this.toggleLogoutModal},p.default.createElement(h.FormattedMessage,{id:"[settings] logout",defaultMessage:"Logout"}))),p.default.createElement("div",{className:"chat__pane chat__pane--splitter"},p.default.createElement("a",{className:"chat-settings__row chat-settings__row--link",onClick:this.toggleLocaleModal},p.default.createElement(h.FormattedMessage,{id:"[settings] language",defaultMessage:"Language"})),p.default.createElement(m.NavLink,{className:"chat-settings__row chat-settings__row--link",activeClassName:"chat-settings__row--link-active",to:"/settings/about"},p.default.createElement(h.FormattedMessage,{id:"[settings] about",defaultMessage:"About"}))))),p.default.createElement("div",{className:"layout-pane__right"},this.renderSetting())),p.default.createElement(P.default,{name:"logout",caption:p.default.createElement(h.FormattedMessage,{id:"[settings] logout title",defaultMessage:"You really want to logout?"}),isOpen:e,onClose:this.toggleLogoutModal},p.default.createElement("div",{className:"modal__actions"},p.default.createElement("button",{className:"btn btn--submit",onClick:this.props.logoutRts},p.default.createElement(h.FormattedMessage,{id:"[settings] logout",defaultMessage:"Logout"})))),this.renderLocaleModal())}}]),t}(p.Component),M=function(e){return{user:e.user,socketCts:(0,j.getSocket)("cts"),socketRts:(0,j.getSocket)("rts"),locale:e.ui.locale}},N=(0,f.connect)(M,{logoutRts:w.logoutRts,setLocale:C.setLocale})(x);t.default=N},"./app/containers/Voex/Voex.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){if(!a(e,t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function u(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?d(e):t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/react/index.js")),f=n("./node_modules/react-redux/lib/index.js"),m=r(n("./node_modules/history/createHashHistory.js")),h=n("./node_modules/react-intl/lib/index.es.js"),y=r(n("./node_modules/moment/moment.js")),_=r(n("./app/components/Avatar.js")),b=n("./app/modules/voex.js"),v=n("./app/selectors/chatsSelectors.js"),g=r(n("./app/components/App/Modal.js")),E=r(n("./app/assets/icons/phone.svg")),S=r(n("./app/assets/icons/fullscreen.svg")),O=r(n("./app/assets/audio/call.mp3")),C=r(n("./app/assets/audio/voex-dial.mp3")),w=r(n("./app/assets/audio/voex-connecting.mp3")),j=r(n("./app/assets/icons/mic.svg")),k=r(n("./app/assets/icons/mic-mute.svg")),P=r(n("./app/assets/icons/chats.svg")),T=r(n("./app/components/App/ConnTypeIcon.js")),x=r(n("./app/assets/icons/close-call.svg")),M=(0,m.default)(),N=function(e){function t(e){var n;return s(this,t),n=u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),A.call(d(n)),n.state={isFullscreen:!1,isMicMuted:!1,duration:0},n.fullscreenDiv=null,n}return l(t,e),c(t,[{key:"componentDidMount",value:function(){var e=this;["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"].forEach(function(t){return document.addEventListener(t,e.handleFullscreenChange)})}},{key:"componentWillReceiveProps",value:function(e){this.isNewCall(this.props,e)&&(this.timer=setInterval(this.tick,1e3),this.setState({isMicMuted:!1,duration:0}))}},{key:"componentWillUnmount",value:function(){var e=this;["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"].forEach(function(t){return document.removeEventListener(t,e.handleFullscreenChange)}),clearInterval(this.timer)}},{key:"renderStatusName",value:function(e,t,n,r){if(r)return p.default.createElement(h.FormattedMessage,{id:"[voex status] busy",defaultMessage:"Busy"});var a=p.default.createElement("span",{className:"modal__title-loader"},"...");switch(e){case b.callStatusEnum.offer:return n?p.default.createElement(h.FormattedMessage,{id:"[voex status] connecting",defaultMessage:"Connecting{loader}",values:{loader:a}}):t&&p.default.createElement(h.FormattedMessage,{id:"[voex status] incoming",defaultMessage:"Incoming call{loader}",values:{loader:a}})||p.default.createElement(h.FormattedMessage,{id:"[voex status] outgoing",defaultMessage:"Outgoing call{loader}",values:{loader:a}});case b.callStatusEnum.answer:return this.state.duration?y.default.duration(this.state.duration,"seconds").format():p.default.createElement(h.FormattedMessage,{id:"[voex status] started",defaultMessage:"Call started"});case b.callStatusEnum.hangup:return p.default.createElement(h.FormattedMessage,{id:"[voex status] ended",defaultMessage:"Call ended"});default:return""}}},{key:"renderVideo",value:function(){var e=this,t=this.state.isFullscreen,n=this.props.chat,r=this.props.voex,a=r.remoteStream,o=r.media,s=r.status,i=r.isBusy,c=s===b.callStatusEnum.answer,u=["phonecall-dialog__player","phonecall-dialog__player--remote",t?"phonecall-dialog__player--fullscreen":""],l=["phonecall-dialog__player","phonecall-dialog__player--local",t?"phonecall-dialog__player--fullscreen":""];if(!c)return i?p.default.createElement("div",{className:"phonecall-dialog__avatar"},p.default.createElement(_.default,{name:n.name,avatar:n.avatar,type:n.connType})):p.default.createElement("div",{className:"phonecall-dialog__avatar phonecall-dialog__avatar--".concat(n.connType)},p.default.createElement(_.default,{name:n.name,avatar:n.avatar,type:n.connType}));if(c&&!o.video)return p.default.createElement("div",{className:"phonecall-dialog__avatar"},p.default.createElement(_.default,{name:n.name,avatar:n.avatar,type:n.connType}),a&&p.default.createElement("audio",{autoPlay:!0,ref:this.handleRemoteVideoRef}));var d=p.default.createElement("span",{className:"phonecall-dialog__loader"},"...");return p.default.createElement("div",{className:"phonecall-dialog__container"},p.default.createElement("div",{id:"phonecall-video",className:"phonecall-dialog__video ".concat(t?"phonecall-dialog__video--fullscreen":""),ref:function(t){e.fullscreenDiv=t}},!a&&p.default.createElement(h.FormattedMessage,{id:"[voex status] connecting",defaultMessage:"Connecting{loader}",values:{loader:d}}),a&&p.default.createElement("video",{autoPlay:!0,ref:this.handleRemoteVideoRef,className:u.join(" ")}),a&&p.default.createElement("video",{autoPlay:!0,muted:!0,ref:this.handleLocalVideoRef,className:l.join(" ")})))}},{key:"renderMinimizedCall",value:function(){var e=this,t=this.props.chat,n=this.state.isMicMuted,r=this.props.voex,a=r.isIncomingCall,o=r.status,s=r.isAnswered,i=r.remoteStream,c=r.isBusy,u=o===b.callStatusEnum.offer;return p.default.createElement("div",{className:"phonecall-panel",onDoubleClick:function(){return e.props.minimizeCall(!1)}},p.default.createElement("div",{className:"phonecall-panel__inner"},p.default.createElement("div",{className:"phonecall-panel__avatar phonecall-panel__avatar--".concat(t.connType)},p.default.createElement(_.default,{name:t.name,avatar:t.avatar,type:t.connType})),p.default.createElement("div",{className:"phonecall-panel__info"},p.default.createElement("h3",{className:"phonecall-panel__addressee"},p.default.createElement(T.default,{className:"conn-type-icon",width:"12",height:"12",connType:t.members_type}),p.default.createElement("span",{className:"phonecall-panel__addressee--text"},t.name)),p.default.createElement("span",{className:"phonecall-panel__status"},this.renderStatusName(o,a,s,c))),p.default.createElement("div",{className:"phonecall-panel__buttons"},c?p.default.createElement("button",{className:"btn phonecall-panel__btn phonecall-dialog__btn--default-active",onClick:this.handleHangup},p.default.createElement(x.default,{width:"20",height:"20",className:"btn__icon"})):p.default.createElement("button",{className:"btn phonecall-panel__btn phonecall-dialog__btn--hangup",onClick:this.handleHangup},p.default.createElement(E.default,{width:"20",height:"20",className:"btn__icon"})),c&&p.default.createElement("button",{className:"btn phonecall-panel__btn phonecall-dialog__btn--answer",onClick:this.handleOffer},p.default.createElement(E.default,{width:"20",height:"20",className:"btn__icon"})),u&&a&&p.default.createElement("button",{disabled:s,className:"btn phonecall-panel__btn phonecall-dialog__btn--answer",onClick:this.handleAnswer},p.default.createElement(E.default,{width:"20",height:"20",className:"btn__icon"})),o===b.callStatusEnum.answer&&p.default.createElement("button",{className:"btn phonecall-panel__btn phonecall-dialog__btn--default-active",onClick:this.handleToggleMicrophone},n?p.default.createElement(k.default,{width:"20",height:"20",className:"btn__icon"}):p.default.createElement(j.default,{width:"20",height:"20",className:"btn__icon"})))),i&&p.default.createElement("audio",{autoPlay:!0,ref:this.handleRemoteVideoRef}),u&&!c&&p.default.createElement("audio",{autoPlay:!0,loop:!0,src:O.default}))}},{key:"renderAudio",value:function(){var e=this.props.voex,t=e.status,n=e.isAnswered,r=e.isBusy,a=e.isCallDelivered,o=t===b.callStatusEnum.offer;return o&&n?p.default.createElement("audio",{autoPlay:!0,loop:!0,src:w.default}):o&&a?p.default.createElement("audio",{autoPlay:!0,loop:!0,src:C.default}):o&&!r?p.default.createElement("audio",{autoPlay:!0,loop:!0,src:O.default}):null}},{key:"render",value:function(){var e=this.props.chat,t=this.state.isMicMuted,n=this.props.voex,r=n.isIncomingCall,a=n.status,o=n.remoteStream,s=n.media,i=n.isAnswered,c=n.minimized,u=n.isBusy,l=a===b.callStatusEnum.offer,d=o&&s.video&&a===b.callStatusEnum.answer,f=![b.callStatusEnum.idle,b.callStatusEnum.hangup].includes(a);return c?this.renderMinimizedCall():p.default.createElement(g.default,{isOpen:f,name:"voex",onClose:this.handleHangup,shouldCloseOnOverlayClick:!1,shouldCloseOnEsc:!1},e&&p.default.createElement("div",{className:"phonecall-dialog"},this.renderVideo(),p.default.createElement("h3",{className:"phonecall-dialog__addressee"},p.default.createElement(T.default,{className:"conn-type-icon",width:"16",height:"16",connType:e.members_type}),p.default.createElement("span",{className:"phonecall-dialog__name",title:e.name},e.name)),p.default.createElement("span",{className:"phonecall-dialog__status"},this.renderStatusName(a,r,i,u)),p.default.createElement("div",{className:"phonecall-dialog__buttons"},u?p.default.createElement("button",{className:"btn phonecall-dialog__btn phonecall-dialog__btn--default-active",onClick:this.handleHangup},p.default.createElement(x.default,{width:"24",height:"24",className:"btn__icon"})):p.default.createElement("button",{className:"btn phonecall-dialog__btn phonecall-dialog__btn--hangup",onClick:this.handleHangup},p.default.createElement(E.default,{width:"24",height:"24",className:"btn__icon"})),u&&p.default.createElement("button",{className:"btn phonecall-dialog__btn phonecall-dialog__btn--answer",onClick:this.handleOffer},p.default.createElement(E.default,{width:"24",height:"24",className:"btn__icon"})),l&&r&&p.default.createElement("button",{disabled:i,className:"btn phonecall-dialog__btn phonecall-dialog__btn--answer",onClick:this.handleAnswer},p.default.createElement(E.default,{width:"24",height:"24",className:"btn__icon"})),a===b.callStatusEnum.answer&&p.default.createElement("button",{className:"btn phonecall-dialog__btn phonecall-dialog__btn--default-active",onClick:this.handleToggleMicrophone},t?p.default.createElement(k.default,{width:"24",height:"24",className:"btn__icon"}):p.default.createElement(j.default,{width:"24",height:"24",className:"btn__icon"})),p.default.createElement("button",{className:"btn phonecall-dialog__btn phonecall-dialog__btn--default".concat(a===b.callStatusEnum.answer?"-active":""),onClick:this.handleMinimizeCall},p.default.createElement(P.default,{width:"24",height:"24",className:"btn__icon"})),d&&p.default.createElement("button",{className:"btn phonecall-dialog__btn phonecall-dialog__btn--default-active",onClick:this.handleFullscreen},p.default.createElement(S.default,{width:"24",height:"24",className:"btn__icon"}))),this.renderAudio()))}}]),t}(p.Component),A=function(){var e=this;Object.defineProperty(this,"isNewCall",{configurable:!0,enumerable:!0,writable:!0,value:function(e,t){return e.voex.status!==b.callStatusEnum.answer&&t.voex.status===b.callStatusEnum.answer}}),Object.defineProperty(this,"tick",{configurable:!0,enumerable:!0,writable:!0,value:function(){var t=(0,y.default)().diff(e.props.voex.startTime,"seconds");e.setState({duration:t})}}),Object.defineProperty(this,"handleFullscreenChange",{configurable:!0,enumerable:!0,writable:!0,value:function(){var t=["fullscreenElement","webkitIsFullScreen","mozFullScreen","msFullscreenElement"].reduce(function(e,t){return e||!!document[t]},!1);e.setState({isFullscreen:t})}}),Object.defineProperty(this,"handleHangup",{configurable:!0,enumerable:!0,writable:!0,value:function(){e.props.sendCallHangup(),e.setState({isMicMuted:!1})}}),Object.defineProperty(this,"handleAnswer",{configurable:!0,enumerable:!0,writable:!0,value:function(){e.props.sendCallAnswer()}}),Object.defineProperty(this,"handleOffer",{configurable:!0,enumerable:!0,writable:!0,value:function(){var t,n=e.props,r=n.chat,a=n.voex.media;e.props.setBusy(!1),e.props.sendCallOffer(null===(t=r.opponent)||void 0===t?void 0:t.user_huid,a)}}),Object.defineProperty(this,"handleFullscreen",{configurable:!0,enumerable:!0,writable:!0,value:function(){e.fullscreenDiv&&["requestFullscreen","mozRequestFullScreen","webkitRequestFullscreen"].reduce(function(t,n){return!t&&e.fullscreenDiv[n]&&e.fullscreenDiv[n](),t||e.fullscreenDiv[n]},!1)}}),Object.defineProperty(this,"handleRemoteVideoRef",{configurable:!0,enumerable:!0,writable:!0,value:function(t){var n=e.props.voex.remoteStream;t&&n&&(t.srcObject=n)}}),Object.defineProperty(this,"handleLocalVideoRef",{configurable:!0,enumerable:!0,writable:!0,value:function(t){var n=e.props.voex.localStream;t&&n&&(t.srcObject=n)}}),Object.defineProperty(this,"handleToggleMicrophone",{configurable:!0,enumerable:!0,writable:!0,value:function(){var t=e.state.isMicMuted;e.setState({isMicMuted:!t}),t?e.props.unmuteMicrophone():e.props.muteMicrophone()}}),Object.defineProperty(this,"handleMinimizeCall",{configurable:!0,enumerable:!0,writable:!0,value:function(){var t=e.props.voex.chatId;e.props.minimizeCall(!0),M.push("/chats/".concat(t))}})},R=function(){var e=(0,v.makeGetCurrentChat)();return function(t){return{chat:e(t,{match:{params:{id:t.voex.chatId}}}),voex:t.voex}}},I=(0,f.connect)(R,{sendCallHangup:b.sendCallHangup,sendCallAnswer:b.sendCallAnswer,muteMicrophone:b.muteMicrophone,unmuteMicrophone:b.unmuteMicrophone,minimizeCall:b.minimizeCall,sendCallOffer:b.sendCallOffer,setBusy:b.setBusy})(N);t.default=I},"./app/helpers/api.js":function(e,t,n){"use strict";function r(){return{"content-type":"application/json"}}function a(e){var t=Math.random().toString(36).substring(2),n="------FormBoundary".concat(t),r=Object.keys(e).map(function(t){return void 0===e[t]?"":"--"+n+"\r\nContent-Disposition: form-data; name="+t+"\r\n\r\n"+e[t]+"\r\n"}).join("")+"--".concat(n,"--\r\n");return{contentType:"multipart/form-data; boundary=".concat(n),body:r}}function o(e){return e.ok?e.blob():Promise.reject(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.jsonContentType=r,t.getMultipartFormData=a,t.responseBLOB=o},"./app/helpers/appHelpers.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.matchMultiText=t.setFavicon=t.getFavicon=t.isVersionHigher=t.randomElement=t.getErrorText=t.formatDate=t.formatDateSplitter=t.formatDateMessageInfo=t.formatDateTime=void 0;var a=r(n("./node_modules/moment/moment.js")),o=n("./node_modules/transliteration/lib/node/index.js"),s=r(n("./node_modules/convert-layout/ru.js")),i=n("./node_modules/react-intl/lib/index.es.js"),c=n("./lib/reactIntl.js"),u=function(e,t){if(!e||!e.isValid())return null;var n=e.locale(t),r=(0,a.default)(),o=r.clone().startOf("day"),s=r.clone().subtract(1,"days").startOf("day"),i=r.clone().subtract(2,"days").startOf("day");return e.isSame(o,"d")?n.format("LT"):e.isSame(s,"d")?n.calendar():e.isSame(i,"d")?n.format("dddd"):e.isBefore(i,"d")?n.format("L"):n.format("DD.MM.YY HH:mm")};t.formatDateTime=u;var l=function(e,t){if(!e||!e.isValid())return null;var n=e.locale(t),r=(0,a.default)(),o=r.clone().subtract(2,"days").startOf("day");return e.isAfter(o,"d")?"".concat(n.calendar(),", ").concat(n.format("HH:mm")):n.format("ll, HH:mm")};t.formatDateMessageInfo=l;var d=function(e,t){if(!e||!e.isValid())return null;var n=e.locale(t),r=(0,a.default)(),o=r.clone().startOf("day"),s=r.clone().subtract(1,"days").startOf("day"),i=r.clone().subtract(2,"days").startOf("day");return e.isSame(o,"d")||e.isSame(s,"d")?n.calendar():e.isSame(i,"d")?n.format("dddd"):n.format("L")};t.formatDateSplitter=d;var p=function(e,t){return e.locale(t).format("L")};t.formatDate=p;var f=function(e){var t=(0,i.defineMessages)({invalidCredentials:{id:"[errors] invalidCredentials",defaultMessage:"Wrong login or password"},alreadyRegistered:{id:"[errors] alreadyRegistered",defaultMessage:"This user is already in system. Need to logout from AD"}});switch(e){case"invalidCredentials":return(0,c.formatMessage)(t.invalidCredentials);case"already_registered":return(0,c.formatMessage)(t.alreadyRegistered);default:return e}};t.getErrorText=f;var m=function(e){return e[Math.floor(Math.random()*e.length)]};t.randomElement=m;var h=function(e,t){if(!e||!t)return!1;var n=e.match(/^(\d+)\.(\d+)\.(\d+)/),r=t.match(/^(\d+)\.(\d+)\.(\d+)/);return!(!n||!r)&&!!n.reduce(function(e,t,a){var o=parseInt(n[a],10),s=parseInt(r[a],10);return a>0&&null===e&&o!==s?o<s:e},null)};t.isVersionHigher=h;var y=function(e){return"/favicons/dev-".concat(e>9?"many":e,".ico")},_=function(e){return"/favicons/staging-".concat(e>9?"many":e,".ico")},b=function(e,t){return"/favicons/prod-".concat(t?"".concat(t,"-"):"").concat(e>9?"many":e,".ico")},v=function(e,t,n){switch(e){case"dev":return y(n);case"test":case"staging":return _(n);default:return b(n,t)}};t.getFavicon=v;var g=function(e){Array.from(document.querySelectorAll("link[rel*='icon']")).forEach(function(e){return document.head.removeChild(e)});var t=document.createElement("link");t.type="image/x-icon",t.rel="shortcut icon",t.href=e,document.getElementsByTagName("head")[0].appendChild(t)};t.setFavicon=g;var E=function(e,t){if(!(null===e||void 0===e?void 0:e.length)||!(null===t||void 0===t?void 0:t.length))return!0;var n=e.toLowerCase().trim(),r=t.toLowerCase().trim();return[r,(0,o.transliterate)(r),s.default.toEn(r),s.default.fromEn(r)].some(function(e){return[n,(0,o.transliterate)(n),s.default.toEn(n),s.default.fromEn(n)].some(function(t){return t.includes(e)})})};t.matchMultiText=E},"./app/helpers/attachmentHelpers.js":function(e,t,n){"use strict";function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){a(e,t,n[t])})}return e}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){return c(e)||i(e,t)||s()}function s(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function i(e,t){var n=[],r=!0,a=!1,o=void 0;try{for(var s,i=e[Symbol.iterator]();!(r=(s=i.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==i.return||i.return()}finally{if(a)throw o}}return n}function c(e){if(Array.isArray(e))return e}function u(e,t,n){return new Promise(function(r){var a=URL.createObjectURL(e),o=new Image;o.onload=function(){var e=document.createElement("canvas"),a=o.width,s=o.height,i=l(a,s,t,n);e.width=i.width,e.height=i.height;var c=e.getContext("2d");c.imageSmoothingQuality="medium",c.drawImage(o,0,0,e.width,e.height),r({preview_type:"image/jpeg",preview_file:e.toDataURL("image/jpeg"),preview_width:e.width,preview_height:e.height})},o.src=a})}function l(e,t,n,r){return e>t?e>n&&(t*=n/e,e=n):t>r&&(e*=r/t,t=r),{width:e,height:t}}function d(e,t){var n=new FileReader;return new Promise(function(a){n.onload=function(){var s={name:e.name,type:e.type,size:e.size,file:new Uint8Array(n.result)};if(!t)return void a(s);var i=new Blob([n.result],{type:e.type}),c=[u(i,v.PREVIEW_MAX_WIDTH,v.PREVIEW_MAX_HEIGHT),u(i,v.BLUR_PREVIEW_MAX_WIDTH,v.BLUR_PREVIEW_MAX_HEIGHT)];Promise.all(c).then(function(e){var t=o(e,2),n=t[0],i=t[1];a(r({},s,n,{blur_preview_file:i.preview_file}))})},n.readAsArrayBuffer(e)})}function p(e,t,n){return new Promise(function(r){var a=URL.createObjectURL(e),o=document.createElement("video");o.onloadeddata=function(){var e=document.createElement("canvas"),a=o.videoWidth,s=o.videoHeight,i=l(a,s,t,n);e.width=i.width,e.height=i.height;var c=e.getContext("2d");c.imageSmoothingQuality="medium",c.drawImage(o,0,0,e.width,e.height),r({preview_type:"image/jpeg",preview_file:e.toDataURL("image/jpeg"),preview_width:e.width,preview_height:e.height})},o.src=a})}function f(e,t){var n=new FileReader;return new Promise(function(a){n.onload=function(){var s={name:e.name,type:e.type,size:e.size,file:new Uint8Array(n.result)};if(!t)return void a(s);var i=new Blob([n.result],{type:e.type}),c=[p(i,v.PREVIEW_MAX_WIDTH,v.PREVIEW_MAX_HEIGHT),p(i,v.BLUR_PREVIEW_MAX_WIDTH,v.BLUR_PREVIEW_MAX_HEIGHT)];Promise.all(c).then(function(e){var t=o(e,2),n=t[0],i=t[1];a(r({},s,n,{blur_preview_file:i.preview_file}))})},n.readAsArrayBuffer(e)})}function m(e){var t=new FileReader;return new Promise(function(n){t.onload=function(){n({name:e.name,type:e.type,size:e.size,file:new Uint8Array(t.result)})},t.readAsArrayBuffer(e)})}function h(e){var t=new FileReader;return new Promise(function(n){t.onload=function(){n({name:e.name,type:e.type,size:e.size,file:t.result})},t.readAsDataURL(e)})}Object.defineProperty(t,"__esModule",{value:!0}),t.previewDimensions=l,t.readImageFile=d,t.readVideoFile=f,t.readFileArray=m,t.readFileBase64=h,t.readClipboardFile=t.getFileIcon=t.bytesToSize=void 0;var y=n("./node_modules/react-intl/lib/index.es.js"),_=n("./node_modules/react-icons/lib/fa/index.js"),b=n("./lib/reactIntl.js"),v=n("./lib/constants.js"),g=(0,y.defineMessages)({b:{id:"[size] bytes",defaultMessage:"Bytes"},kb:{id:"[size] kb",defaultMessage:"Kb"},mb:{id:"[size] mb",defaultMessage:"Mb"},gb:{id:"[size] gb",defaultMessage:"Gb"},tb:{id:"[size] tb",defaultMessage:"Tb"}}),E=function(e){var t=[(0,b.formatMessage)(g.b),(0,b.formatMessage)(g.kb),(0,b.formatMessage)(g.mb),(0,b.formatMessage)(g.gb),(0,b.formatMessage)(g.tb)];if(0===e)return"0 ".concat(t[0]);var n=parseInt(Math.floor(Math.log(e)/Math.log(1024)),10);return"".concat(Math.round(e/Math.pow(1024,n),2)," ").concat(t[n])};t.bytesToSize=E;var S=function(e){return e?e.includes("pdf")?_.FaFilePdfO:/image\//.test(e)?_.FaFileImageO:/video\//.test(e)?_.FaFileMovieO:/audio\//.test(e)?_.FaFileAudioO:e.includes("text")?_.FaFileTextO:e.includes("msword")||e.includes("wordprocessingml")?_.FaFileWordO:e.includes("ms-excel")||e.includes("spreadsheetml")?_.FaFileExcelO:_.FaFileO:_.FaFileO};t.getFileIcon=S;var O=function(e){var t=new FileReader;return new Promise(function(n){t.onload=function(){var r=new Blob([t.result],{type:e.type});e.preview=URL.createObjectURL(r),n(e)},t.readAsArrayBuffer(e)})};t.readClipboardFile=O},"./app/helpers/botx.js":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.formatBoxCommand=void 0;var r=function(e,t){return Object.keys(t).reduce(function(e,n){return e.replace(new RegExp("([^\\\\])#".concat(n),"g"),"$1".concat(t[n]))},e)};t.formatBoxCommand=r},"./app/helpers/chatsHelpers.js":function(e,t,n){"use strict";function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){a(e,t,n[t])})}return e}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e){return c(e)||i(e)||s()}function s(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function i(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function c(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}function u(e){var t=e.inserted_at,n=e.updated_at,a=e.last_event_inserted_at,o=e.sorting_inserted_at,s=e.lastEvent,i=e.chat_settings;return r({},e,{inserted_at:(0,h.convert)(t),updated_at:(0,h.convert)(n),last_event_inserted_at:(0,h.convert)(a),sorting_inserted_at:(0,h.convert)(o),lastEvent:s&&(0,y.convertMessageTimestamps)(s),chat_settings:r({},i,{hidden_at:(0,h.convert)(null===i||void 0===i?void 0:i.hidden_at)})})}function l(e){var t=e.inserted_at,n=e.updated_at,a=e.last_event_inserted_at,o=e.sorting_inserted_at,s=e.lastEvent,i=e.chat_settings;return r({},e,{inserted_at:(0,h.toIsoString)(t),updated_at:(0,h.toIsoString)(n),last_event_inserted_at:(0,h.toIsoString)(a),sorting_inserted_at:(0,h.toIsoString)(o),lastEvent:s&&(0,y.isoMessageTimestamps)(s),chat_settings:r({},i,{hidden_at:(0,h.toIsoString)(null===i||void 0===i?void 0:i.hidden_at)})})}function d(e,t){var n=e.members.find(function(e){return e.user_huid===t.huid});return null===n||void 0===n?void 0:n.conn_type}function p(e,t){return e.find(function(e){return("chat"===e.chat_type||"botx"===e.chat_type)&&e.members.find(function(e){return e.user_huid===t})})}function f(e){return null===e||e!==document.body&&f(e.parentElement)}Object.defineProperty(t,"__esModule",{value:!0}),t.convertChatTimestamps=u,t.isoChatTimestamps=l,t.chatMemberConnType=d,t.findOneToOneChatByHuid=p,t.appendCaret=t.chatsMembersHuids=t.sortChats=t.isUnhideNeeded=t.getChatId=t.getChatShortName=t.isOneToOne=t.isLastEventFetchNeeded=t.identifyLastEvent=t.mapLastEventMeta=t.shouldChatUpdate=t.syncChatListPipepline=t.syncChatList=void 0;var m=function(e){return e&&e.__esModule?e:{default:e}}(n("./node_modules/lodash/sortBy.js")),h=n("./lib/timestamps.js"),y=n("./app/helpers/messagesHelpers.js"),_=function(e,t,n){return t.reduce(function(e,t){if(!t)return e;var a=E(t,n),s=e.find(function(e){return e.group_chat_id===a.group_chat_id});if(!s)return o(e).concat([a]);var i=e.filter(function(e){return e.group_chat_id!==a.group_chat_id}),c=S(s,a),u=v(s,a)?a:s;return o(i).concat([r({},u,{lastEvent:c})])},e)};t.syncChatList=_;var b=function(e,t){return function(n){return _(n,e,t)}};t.syncChatListPipepline=b;var v=function(e,t){return!e||(e.active?!(!t.active&&!t.left)&&g(t,e):e.left?g(t,e):!!t.active||g(t,e))};t.shouldChatUpdate=v;var g=function(e,t){return(0,h.convert)(e.updated_at)>(0,h.convert)(t.updated_at)},E=function(e,t){return r({},e,{lastEvent:{inserted_at:e.sorting_inserted_at||e.last_event_inserted_at,sync_id:e.sorting_sync_id||e.last_event_sync_id,connType:t}})};t.mapLastEventMeta=E;var S=function(e,t){return t.lastEvent?e.lastEvent?t.lastEvent.sync_id===e.lastEvent.sync_id?t.active?t.lastEvent:e.lastEvent:(0,h.convert)(t.lastEvent.inserted_at)>(0,h.convert)(e.lastEvent.inserted_at)?t.lastEvent:e.lastEvent:t.lastEvent:e.lastEvent};t.identifyLastEvent=S;var O=function(e,t){var n,r;return!!(null===t||void 0===t?void 0:null===(n=t.lastEvent)||void 0===n?void 0:n.sync_id)&&(!(null===e||void 0===e?void 0:null===(r=e.lastEvent)||void 0===r?void 0:r.sync_id)||(!!e.lastEvent.isObsolete||(t.lastEvent.sync_id!==e.lastEvent.sync_id||!e.lastEvent.payload)))};t.isLastEventFetchNeeded=O;var C=function(e){return"chat"===e.chat_type};t.isOneToOne=C;var w=function(e){return e?(e.match(/(^\s*.)|(\s+[^\s])/g)||[]).reduce(function(e,t){return 2===e.length?e:e+t.trim().toUpperCase()},""):null};t.getChatShortName=w;var j=function(e){return null===e||void 0===e?void 0:e.split(":")[1]};t.getChatId=j;var k=function(e){return!!e&&(!!(e.chat_settings.hidden&&e.chat_settings.hidden_at&&e.sorting_inserted_at)&&e.chat_settings.hidden_at<e.sorting_inserted_at)};t.isUnhideNeeded=k;var P=function(e){return(0,m.default)(e,function(e){var t;return(null===(t=e.lastEvent)||void 0===t?void 0:t.inserted_at)||e.sorting_inserted_at||e.inserted_at}).reverse()};t.sortChats=P;var T=function(e){return e.reduce(function(e,t){return e.concat(t.members.filter(function(t){return!e.includes(t.user_huid)}).map(function(e){return e.user_huid}))},[])};t.chatsMembersHuids=T;var x=function(e){if((null===e||void 0===e?void 0:e.innerText)&&!f(e))if(e.focus(),void 0===window.getSelection||void 0===document.createRange){if(void 0!==document.body.createTextRange){var t=document.body.createTextRange();t.moveToElementText(e),t.collapse(!1),t.select()}}else{var n=document.createRange();n.selectNodeContents(e),n.collapse(!1);var r=window.getSelection();r.removeAllRanges();try{r.addRange(n)}catch(e){console.log(e.message)}}};t.appendCaret=x},"./app/helpers/clipboardHelpers.js":function(e,t,n){"use strict";function r(e){return(0,a.reduce)(e.clipboardData.items,function(e,t){return/^image\//.test(t.type)&&e.push(t.getAsFile()),e},[])}Object.defineProperty(t,"__esModule",{value:!0}),t.getClipboardImages=r;var a=n("./node_modules/lodash/lodash.js")},"./app/helpers/contextMenu.js":function(e,t,n){"use strict";var r=n("./node_modules/react-contextmenu/es6/index.js"),a=n("./app/helpers/reactHelpers.js");r.ContextMenuTrigger.prototype.shouldComponentUpdate=function(e){return(0,a.isShouldComponentUpdate)(this.props,e,["id","children","attributes","disable","attributes"])}},"./app/helpers/logger.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return i(e)||s(e,t)||o()}function o(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function s(e,t){var n=[],r=!0,a=!1,o=void 0;try{for(var s,i=e[Symbol.iterator]();!(r=(s=i.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==i.return||i.return()}finally{if(a)throw o}}return n}function i(e){if(Array.isArray(e))return e}function c(e){return d(e)||l(e)||u()}function u(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function l(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function d(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){f(e,t,n[t])})}return e}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function m(e){var t,n=null===j.default||void 0===j.default?void 0:null===(t=j.default.sentryDSN)||void 0===t?void 0:t.replace(/https?:\/\//,"//"),r={level:"error",tags:{service:"web_client",ccs_host:j.default.ccsHost},release:"1.2.788"};n&&(y(),w.default.config(n,r).setDataCallback(function(t){return h(t,e)}).install())}function h(e,t){return p({},e,{extra:p({},_((null===t||void 0===t?void 0:t.getState)&&(0,C.cloneDeep)(t.getState())||{}))})}function y(){var e=window.console.error;window.console.error=function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];w.default.captureException(n),e.apply(void 0,n)},window.onunhandledrejection=function(e){w.default.captureException(e.reason)}}function _(e){var t=e.routing&&e.routing.location&&e.routing.location.pathname||(0,C.last)(location.hash.match(/^#([^?]+)/));return[{pathRegex:/^\/chats$/,stateBranches:{ui:S,routing:S,membersTyping:S,eventsQueue:v,user:b,chats:g}},{pathRegex:/^\/chats\/[a-f\d-]{36}/,stateBranches:{ui:S,routing:S,membersTyping:S,messages:v,eventsQueue:v,attachements:v,user:b,chats:E.bind({pathname:t})}},{pathRegex:/^\/contacts$/,stateBranches:{ui:S,routing:S,membersTyping:S,eventsQueue:v,user:b,phonebook:S}},{pathRegex:/.*/,stateBranches:{ui:S,routing:S,membersTyping:S,eventsQueue:v,user:b}}].reduce(function(n,r){var a=r.pathRegex,o=r.stateBranches;return n||!a.test(t)?n:O(e,o)},null)}function b(e){return(null===e||void 0===e?void 0:e.authToken)&&delete e.authToken,(null===e||void 0===e?void 0:e.ctsAuthToken)&&delete e.ctsAuthToken,e}function v(e){return!e||e.length<=10?e:c(e.slice(0,5)).concat(["..."],c(e.slice(-5)))}function g(e){return!e||e.length<=20?e:c(e.slice(0,10)).concat(["..."],c(e.slice(-10)))}function E(e){var t=this.pathname.match(/^\/chats\/([a-f\d-]{36})/),n=a(t,2),r=n[1];return e.filter(function(e){return e.group_chat_id===r})}function S(e){return e}function O(e,t){return Object.keys(t).reduce(function(n,r){var a=t[r];return n[r]=a(e[r]),n},{})}Object.defineProperty(t,"__esModule",{value:!0}),t.installErrorLogger=m;var C=n("./node_modules/lodash/lodash.js"),w=r(n("./node_modules/raven-js/src/singleton.js")),j=r(n("./lib/config.js"))},"./app/helpers/messagesHelpers.js":function(e,t,n){"use strict";function r(e){return s(e)||o(e)||a()}function a(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function o(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function s(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){c(e,t,n[t])})}return e}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e,t,n){var r=(0,y.concat)((0,y.map)(t,"sync_id"),(0,y.map)(n,"sync_id"));return(0,y.difference)(e,r)}function l(e){return(0,y.map)(e,function(e){return(0,y.pick)(e,["sync_id","key","sender_key_id"])})}function d(e,t,n){return(0,y.find)(l(e),function(e){return e.sync_id===n})||(0,y.find)(t,function(e){return e.sync_id===n})}function p(e,t){try{if(!e||!e.key)return!1;var n=(0,y.find)(t.publicKeys,function(t){return t.id===e.sender_key_id});if(!n)return!1;var r=(0,y.find)(t.user.privateKeys,function(t){return t.public_key_id===e.key.key_id});return!!r&&(0,_.decryptSymmetricKeyWithPub)((0,_.fromBase64)(e.key.key),(0,_.fromBase64)(n.body),(0,_.fromBase64)(r.body))}catch(e){return console.error("Decrypt message symmetric key error: ".concat(e.message)),!1}}function f(){return(new Date).toISOString()}function m(e){return e.payload&&e.payload.timestamp?i({},e,{inserted_at:(0,b.convert)(e.inserted_at),payload:i({},e.payload,{timestamp:(0,b.convert)(e.payload.timestamp)})}):i({},e,{inserted_at:(0,b.convert)(e.inserted_at)})}function h(e){return e.payload&&e.payload.timestamp?i({},e,{inserted_at:(0,b.toIsoString)(e.inserted_at),payload:i({},e.payload,{timestamp:(0,b.toIsoString)(e.payload.timestamp)})}):i({},e,{inserted_at:(0,b.toIsoString)(e.inserted_at)})}Object.defineProperty(t,"__esModule",{value:!0}),t.getAbsentMessageKeysIds=u,t.mapMessageKeys=l,t.getMessageKeyContainer=d,t.decryptMessageSymmetricKey=p,t.generateTimestamp=f,t.convertMessageTimestamps=m,t.isoMessageTimestamps=h,t.getMessageIndexBySyncId=t.isUrl=t.parseUrls=t.showSenderProfile=t.showDateSplitter=t.renameHuidToUserHuid=t.findRoutingChangedUser=t.isRoutingChangedDisplayable=t.isRoutingChangedServerIdMatches=t.getRoutingChangedConnType=t.hasBotActions=t.isBotMessage=t.mapEventProfile=t.uniqEventSendersHuids=void 0;var y=n("./node_modules/lodash/lodash.js"),_=n("./lib/encryption.js"),b=n("./lib/timestamps.js"),v=n("./app/helpers/profilesHelpers.js"),g=function(e){try{return e.reduce(function(e,t){if(t.sender&&e.push(t.sender),"message_new"===t.event_type&&!e.includes(t.payload.from))return t.payload?r(e).concat([t.payload.from]):e;if("message_new"!==t.event_type){var n=t.payload.user_huid||[],a=n.filter(function(t){return!e.includes(t)});return e.concat(a)}return e},[])}catch(e){return[]}};t.uniqEventSendersHuids=g;var E=function(e,t,n){try{if(!e||!e.payload||!t)return e;if("voex"===e.event_type)return i({},e,{isIncomingCall:e.payload.event.call_offer_sender!==n.huid,isHangedUpByMe:e.payload.event.call_hangup_sender===n.huid});var r="message_new"===e.event_type?[e.payload.from||e.sender]:e.payload.user_huid||[],a="message_new"===e.event_type?e.kind:e.connType,o=r.map(function(e){return t.find(function(t){return t.user_huid===e})}),s=e.sender&&t.find(function(t){return t.user_huid===e.sender})||{};return o.includes(void 0)?e:"message_new"===e.event_type?i({},e,{sender:(0,v.getSenderProfile)(o[0],e.kind)}):i({},e,{profiles:o,senderProfile:(0,v.getSenderProfile)(s,a)})}catch(t){return e}};t.mapEventProfile=E;var S=function(e){var t=["command_result","bot_notification"];return"message_new"===(null===e||void 0===e?void 0:e.event_type)&&e.payload&&t.includes(e.payload.type)};t.isBotMessage=S;var O=function(e){var t,n;return S(e)&&(null===(t=e.payload)||void 0===t?void 0:null===(n=t.actions)||void 0===n?void 0:n.length)>0};t.hasBotActions=O;var C=function(e,t,n){try{var r,a,o,s;return(null===(r=e.payload[t])||void 0===r?void 0:null===(a=r.find(function(e){return e.user_huid===n}))||void 0===a?void 0:a.conn_type)||(null===(o=e.payload["backward"===t?"forward":"backward"])||void 0===o?void 0:null===(s=o.find(function(e){return e.user_huid===n}))||void 0===s?void 0:s.conn_type)}catch(e){return null}};t.getRoutingChangedConnType=C;var w=function(e,t,n){try{var r,a=null===(r=e.payload[t])||void 0===r?void 0:r.find(function(e){return e.user_huid===n.huid});return!!a&&("rts"===a.conn_type?a.rts_id===n.rtsServerId:a.cts_id===n.ctsServerId)}catch(e){return null}};t.isRoutingChangedServerIdMatches=w;var j=function(e,t){try{var n=k(e,t,"forward"),r=k(e,t,"backward");return!(!n||!r)&&n.conn_type!==r.conn_type}catch(e){return!1}};t.isRoutingChangedDisplayable=j;var k=function(e,t,n){var r,a;return null===(r=e.payload)||void 0===r?void 0:null===(a=r[n])||void 0===a?void 0:a.find(function(e){return e.user_huid===t&&("rts"===e.conn_type?"user"===e.user_kind:"cts_user"===e.user_kind)})};t.findRoutingChangedUser=k;var P=function e(t){var n,r;return Array.isArray(t)?t.map(function(t){return e(t)}):"Object"===(null===t||void 0===t?void 0:null===(n=t.__proto__)||void 0===n?void 0:null===(r=n.constructor)||void 0===r?void 0:r.name)?Object.keys(t).reduce(function(n,r){return"huid"===r?n.user_huid=t[r]:n[r]=e(t[r]),n},{}):t};t.renameHuidToUserHuid=P;var T=function(e,t){return!t||!e.payload.timestamp.isSame(t.payload.timestamp,"day")};t.showDateSplitter=T;var x=function(e,t){var n,r;return!e.sender.isMe&&(!t||((null===(n=e.sender)||void 0===n?void 0:n.user_huid)!==(null===(r=t.sender)||void 0===r?void 0:r.user_huid)||(e.kind!==t.kind||(!e.inserted_at.isSame(t.inserted_at,"day")||e.inserted_at.diff(t.inserted_at,"minutes")>=5))))};t.showSenderProfile=x;var M=function(e){var t=/(https?:\/\/)?[-a-zA-Z0-9@:%._+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_+.~#?&\/\/=]*)/gi;return e.match(t)};t.parseUrls=M;var N=function(e){return/(https?:\/\/)?[-a-zA-Z0-9@:%._+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_+.~#?&\/\/=]*)/gi.test(e)};t.isUrl=N;var A=function(e,t){var n=null===e||void 0===e?void 0:e.find(function(e){return e.sync_id===t});return n?e.indexOf(n):-1};t.getMessageIndexBySyncId=A},"./app/helpers/phonebookHelpers.js":function(e,t,n){"use strict";function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){a(e,t,n[t])})}return e}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e){return c(e)||i(e)||s()}function s(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function i(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function c(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}function u(e,t){if(!e)return!1;if(e.deleted_at)return!0;if("cts"===t){var n;return!(null===(n=e.contacts)||void 0===n?void 0:n.reduce(function(e,t){return e||"unregistered"!==t.user_kind},!1))}return!1}Object.defineProperty(t,"__esModule",{value:!0}),t.isEntryDeleted=u,t.entryToVcard=t.getExpressContact=t.findHybridHuids=t.flattenPhonebookContacts=void 0;var l=function(e){return e&&e.__esModule?e:{default:e}}(n("./node_modules/vcf/lib/vcard.js")),d=function(e){var t;return(t=Array.prototype).concat.apply(t,o(e))},p=function(e){return d(e.map(function(e){return e.contacts.map(function(t){return r({},t,{entry_id:e.entry_id,name:e.name})})}))};t.flattenPhonebookContacts=p;var f=function(e,t){var n=p(e).map(function(e){return e.user_huid}),r=p(t).map(function(e){return e.user_huid}),a=n.filter(function(e){return r.includes(e)});return o(new Set(a))};t.findHybridHuids=f;var m=function(e){return e.contacts.find(function(e){return"user"===e.user_kind&&e.active})||e.contacts.find(function(e){return"cts_user"===e.user_kind&&e.active})||e.contacts.find(function(e){return"botx"===e.contact_type})||{active:!1,user_huid:null,avatar:null,name:null,rts_contact:null,cts_contact:null}};t.getExpressContact=m;var h=function(e){var t=e.name.split(" ").reduce(function(e,t){return""!==t&&e.length<2&&e.push(t),e},[]),n=new l.default;if(n.add("n",t),n.add("fn",e.name),e.contacts.forEach(function(e){"phone"===e.contact_type&&n.addProperty(l.default.Property.fromJSON(["tel",{type:["voice"],value:"uri"},"uri","+".concat(e.contact)]))}),e.avatar){var r=e.avatar.match(/\/[^.]*\.(\w+)\?/),a=(null===r||void 0===r?void 0:r.length)>1?"image/".concat(r[1]):"image/*";n.addProperty(l.default.Property.fromJSON(["photo",{mediatype:a},"text",e.avatar]))}return n.toString("3.0")};t.entryToVcard=h},"./app/helpers/profilesHelpers.js":function(e,t,n){"use strict";function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){a(e,t,n[t])})}return e}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}Object.defineProperty(t,"__esModule",{value:!0}),t.mapProfileToEntry=t.getTypingProfile=t.getSenderProfile=t.getChatMemberProfile=t.getFlatProfile=t.findProfile=void 0;var s=n("./app/helpers/phonebookHelpers.js"),i=function(e,t){return e.find(function(e){return e.user_huid===t})};t.findProfile=i;var c=function(e,t){if(!e)return{};var n=e.cts_profile,a=e.rts_profile,s=e.phonebook_profile,i=o(e,["cts_profile","rts_profile","phonebook_profile"]),c="cts"===t?n||s||a||{}:s||a||n||{};return r({},i,c,{conn_type:t,name:c.isMe?"You":c.name,entry_id:null===s||void 0===s?void 0:s.entry_id})};t.getFlatProfile=c;var u=function(e,t,n){var r=e.find(function(e){return e.user_huid===t});return r&&r?c(r,n):{}};t.getChatMemberProfile=u;var l=function(e,t){return c(e,t)};t.getSenderProfile=l;var d=function(e,t){return c(e,t)};t.getTypingProfile=d;var p=function(e,t,n){var a=(0,s.getExpressContact)(e),o=a.active,i=a.user_huid,u=a.contact_type,l=n&&f(e)?"cts":"rts",d="botx"===u,p=t.find(function(e){return e.user_huid===i}),m=c(p,l);return"cts"===l?r({},e,m,{entry_id:e.entry_id,conn_type:l,active:o,isBot:d}):r({},m,e,{conn_type:l,active:o,isBot:d})};t.mapProfileToEntry=p;var f=function(e){return e.contacts.find(function(e){return e.cts_id||"cts_user"===e.user_kind})}},"./app/helpers/push.js":function(e,t,n){"use strict";function r(e,t){return s(e)||o(e,t)||a()}function a(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function o(e,t){var n=[],r=!0,a=!1,o=void 0;try{for(var s,i=e[Symbol.iterator]();!(r=(s=i.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==i.return||i.return()}finally{if(a)throw o}}return n}function s(e){if(Array.isArray(e))return e}function i(e){return r((e.endpoint||"").match(/[^\/]+$/)||[],1)[0]||!1}function c(e){var t=e.toJSON().keys;return{encryptionKey:null===t||void 0===t?void 0:t.p256dh,authKey:null===t||void 0===t?void 0:t.auth}}function u(){var e=null,t=(new f.default).then(function(t){e=t}),n=navigator.serviceWorker.ready,r=[t,n];return Promise.all(r).then(function(){return e})}function l(e){return e.pushManager.getSubscription().then(function(t){return null!==t?t:e.pushManager.subscribe({userVisibleOnly:!0})})}function d(e){return e.pushManager.getSubscription().then(function(e){return e?(p("CLOSE_ALL_NOTIFICATIONS"),e.unsubscribe()):Promise.resolve()})}function p(e){var t,n;if(null===(t=navigator)||void 0===t?void 0:null===(n=t.serviceWorker)||void 0===n?void 0:n.controller){var r=new MessageChannel;navigator.serviceWorker.controller.postMessage(e,[r.port2])}}Object.defineProperty(t,"__esModule",{value:!0}),t.getGcmTokenFromSubscription=i,t.getKeys=c,t.registerServiceWorker=u,t.getPushSubscription=l,t.deletePushSubscription=d,t.sendMessageToServiceWorker=p;var f=function(e){return e&&e.__esModule?e:{default:e}}(n("./app/workers/pushWorker.js"));n("./config/manifest.json")},"./app/helpers/reactHelpers.js":function(e,t,n){"use strict";function r(e,t,n){return n.reduce(function(n,r){return n||!(0,o.equal)((0,a.get)(e,r),(0,a.get)(t,r))},!1)}Object.defineProperty(t,"__esModule",{value:!0}),t.isShouldComponentUpdate=r;var a=n("./node_modules/lodash/lodash.js"),o=n("./lib/deepEqual.js")},"./app/helpers/routing.js":function(e,t,n){"use strict";function r(e,t){return s(e)||o(e,t)||a()}function a(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function o(e,t){var n=[],r=!0,a=!1,o=void 0;try{for(var s,i=e[Symbol.iterator]();!(r=(s=i.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==i.return||i.return()}finally{if(a)throw o}}return n}function s(e){if(Array.isArray(e))return e}Object.defineProperty(t,"__esModule",{value:!0}),t.matchMemberHuid=t.matchChatId=void 0;var i=function(e){return r((null===e||void 0===e?void 0:e.match(/chats\/([-0-9a-f]{36})/))||[],2)[1]};t.matchChatId=i;var c=function(e){return r((null===e||void 0===e?void 0:e.match(/member\/([-0-9a-f]{36})/))||[],2)[1]};t.matchMemberHuid=c},"./app/helpers/userHelpers.js":function(e,t,n){"use strict";function r(e,t){var n=t.members.find(function(t){return t.user_huid===e.huid});if(!n)return{};var r=n.conn_type;return{connType:r,host:"rts"===r?e.rtsHost:e.ctsServer,token:"rts"===r?e.authToken:e.ctsAuthToken}}Object.defineProperty(t,"__esModule",{value:!0}),t.getUserConnection=r,t.generateTimestamp=void 0;var a=function(){return(new Date).getTime()};t.generateTimestamp=a},"./app/helpers/voex.js":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getVoexSessionEndpoint=void 0;var r=function(e,t){try{var n=e.members.find(function(e){return e.user_huid===t.huid}),r=null===n||void 0===n?void 0:n.cts_id;return r&&e.members.every(function(e){return e.cts_id===r})?{host:t.ctsServer,token:t.ctsAuthToken,connType:"cts"}:{host:t.rtsHost,token:t.authToken,connType:"rts"}}catch(e){return{}}};t.getVoexSessionEndpoint=r},"./app/index.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}n("./app/styles/app.scss");var a=r(n("./node_modules/react/index.js")),o=r(n("./node_modules/react-dom/index.js")),s=r(n("./node_modules/history/createHashHistory.js")),i=r(n("./app/containers/Root.js")),c=r(n("./app/store/configureStore.js")),u=n("./app/modules/ui.js"),l=n("./app/sagas/ui.js"),d=n("./app/helpers/logger.js"),p=n("./lib/indexedDb.js"),f=n("./lib/advancedFetch.js"),m=n("./lib/update.js"),h=null,y=null,_=function(e){o.default.render(a.default.createElement(e,{store:h,history:y}),document.getElementById("app"))},b=function(e){var t,n=(0,m.migrateState)(e);h=(0,c.default)(n),(0,l.setMomentLocale)(null===n||void 0===n?void 0:null===(t=n.ui)||void 0===t?void 0:t.locale),(0,d.installErrorLogger)(h),y=(0,s.default)(),(0,f.setStore)(h),_(i.default),h.dispatch((0,u.initApp)())};(0,p.loadState)().then(b)},"./app/modules/attachments.js":function(e,t,n){"use strict";function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){a(e,t,n[t])})}return e}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(t,"__esModule",{value:!0}),t.attachments=t.decryptAttachmentFileSuccess=t.decryptAttachmentFile=t.loadAttachmentsSuccess=t.loadAttachments=t.DECRYPT_ATTACHMENT_FILE_FAILURE=t.DECRYPT_ATTACHMENT_FILE_SUCCESS=t.DECRYPT_ATTACHMENT_FILE=t.LOAD_ATTACHMENTS_FAILURE=t.LOAD_ATTACHMENTS_SUCCESS=t.LOAD_ATTACHMENTS=void 0;var o,s=n("./node_modules/redux-actions/lib/index.js"),i=n("./node_modules/lodash/lodash.js");t.LOAD_ATTACHMENTS="LOAD_ATTACHMENTS";t.LOAD_ATTACHMENTS_SUCCESS="LOAD_ATTACHMENTS_SUCCESS";t.LOAD_ATTACHMENTS_FAILURE="LOAD_ATTACHMENTS_FAILURE";t.DECRYPT_ATTACHMENT_FILE="DECRYPT_ATTACHMENT_FILE";t.DECRYPT_ATTACHMENT_FILE_SUCCESS="DECRYPT_ATTACHMENT_FILE_SUCCESS";t.DECRYPT_ATTACHMENT_FILE_FAILURE="DECRYPT_ATTACHMENT_FILE_FAILURE";var c=(0,s.createAction)("LOAD_ATTACHMENTS",function(e){return e});t.loadAttachments=c;var u=(0,s.createAction)("LOAD_ATTACHMENTS_SUCCESS",function(e,t){return{chatId:e,files:t}});t.loadAttachmentsSuccess=u;var l=(0,s.createAction)("DECRYPT_ATTACHMENT_FILE",function(e,t,n){return{chatId:e,syncId:t,host:n}});t.decryptAttachmentFile=l;var d=(0,s.createAction)("DECRYPT_ATTACHMENT_FILE_SUCCESS",function(e,t,n){return{chatId:e,syncId:t,url:n}});t.decryptAttachmentFileSuccess=d;var p=[],f=(o={},a(o,c,function(e,t){var n=t.payload;return(0,i.map)(e,function(e){return e.chat_id===n?r({},e,{isLoaded:!1}):e})}),a(o,u,function(e,t){var n=t.payload,a=n.chatId,o=n.files;return 0===e.length?[{chat_id:a,files:o,isLoaded:!0}]:(0,i.find)(e,function(e){return e.chat_id===a})?(0,i.map)(e,function(e){return e.chat_id===a?r({},e,{files:(0,i.concat)(o,e.files),isLoaded:!0}):e}):(0,i.concat)(e,{chat_id:a,files:o,isLoaded:!0})}),a(o,d,function(e,t){var n=t.payload,a=n.chatId,o=n.syncId,s=n.url;return(0,i.map)(e,function(e){return e.chat_id===a?r({},e,{files:(0,i.map)(e.files,function(e){return e.sync_id===o?r({},e,{url:s,isLoaded:!0}):e})}):e})}),o),m=(0,s.handleActions)(f,p);t.attachments=m},"./app/modules/botx.js":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.handleBotxAction=t.HANDLE_BOTX_ACTION=void 0;var r=n("./node_modules/redux-actions/lib/index.js");t.HANDLE_BOTX_ACTION="HANDLE_BOTX_ACTION";var a=(0,r.createAction)("HANDLE_BOTX_ACTION",function(e,t,n){return{message:e,action:t,data:n}});t.handleBotxAction=a},"./app/modules/chats.js":function(e,t,n){"use strict";function r(e){return s(e)||o(e)||a()}function a(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function o(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function s(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){c(e,t,n[t])})}return e}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(t,"__esModule",{value:!0}),t.chats=t.loadHistoryBackward=t.chatPositionReportUpdated=t.chatInfoSuccess=t.chatInfo=t.cleanBadge=t.lastEventsFetched=t.addAdmin=t.addUser=t.removeUser=t.updateChat=t.chatSettingsChanged=t.setChatSettings=t.leaveChatSuccess=t.leaveChat=t.incUnreadCounter=t.dropUnreadCounter=t.fetchHistorySuccess=t.fetchHistory=t.createChat=t.chatUpdated=t.chatCreated=t.fetchChatSuccess=t.fetchChatListSuccess=t.LOAD_HISTORY_BACKWARD=t.CHAT_POSITION_REPORT_UPDATED=t.CHAT_INFO_SUCCESS=t.CHAT_INFO=t.CLEAN_BADGE=t.LAST_EVENTS_FETCHED=t.ADD_ADMIN=t.ADD_USER=t.REMOVE_USER=t.UPDATE_CHAT=t.CHAT_SETTINGS_CHANGED=t.SET_CHAT_SETTINGS=t.LEAVE_CHAT_SUCCESS=t.LEAVE_CHAT=t.INC_UNREAD_COUNTER=t.DROP_UNREAD_COUNTER=t.FETCH_CHAT_SUCCESS=t.FETCH_CHAT_LIST_SUCCESS=t.FETCH_HISTORY_SUCCESS=t.FETCH_HISTORY=t.CHAT_UPDATED=t.CHAT_CREATED=t.CREATE_CHAT=void 0;var u,l=n("./node_modules/redux-actions/lib/index.js"),d=n("./node_modules/lodash/lodash.js"),p=n("./app/helpers/messagesHelpers.js"),f=n("./app/helpers/chatsHelpers.js"),m=n("./app/modules/user.js"),h=n("./app/modules/messages.js"),y=n("./app/modules/voex.js");t.CREATE_CHAT="CREATE_CHAT";t.CHAT_CREATED="CHAT_CREATED";t.CHAT_UPDATED="CHAT_UPDATED";t.FETCH_HISTORY="FETCH_HISTORY";t.FETCH_HISTORY_SUCCESS="FETCH_HISTORY_SUCCESS";t.FETCH_CHAT_LIST_SUCCESS="FETCH_CHAT_LIST_SUCCESS";t.FETCH_CHAT_SUCCESS="FETCH_CHAT_SUCCESS";t.DROP_UNREAD_COUNTER="DROP_UNREAD_COUNTER";t.INC_UNREAD_COUNTER="INC_UNREAD_COUNTER";t.LEAVE_CHAT="LEAVE_CHAT";t.LEAVE_CHAT_SUCCESS="LEAVE_CHAT_SUCCESS";t.SET_CHAT_SETTINGS="SET_CHAT_SETTINGS";t.CHAT_SETTINGS_CHANGED="CHAT_SETTINGS_CHANGED";t.UPDATE_CHAT="UPDATE_CHAT";t.REMOVE_USER="REMOVE_USER";t.ADD_USER="ADD_USER";t.ADD_ADMIN="ADD_ADMIN";t.LAST_EVENTS_FETCHED="LAST_EVENTS_FETCHED";t.CLEAN_BADGE="CLEAN_BADGE";t.CHAT_INFO="CHAT_INFO";t.CHAT_INFO_SUCCESS="CHAT_INFO_SUCCESS";t.CHAT_POSITION_REPORT_UPDATED="CHAT_POSITION_REPORT_UPDATED";t.LOAD_HISTORY_BACKWARD="LOAD_HISTORY_BACKWARD";var _=(0,l.createAction)("FETCH_CHAT_LIST_SUCCESS",function(e){return e.map(function(e){return(0,f.convertChatTimestamps)(e)})});t.fetchChatListSuccess=_;var b=(0,l.createAction)("FETCH_CHAT_SUCCESS",function(e){return(0,f.convertChatTimestamps)(e)});t.fetchChatSuccess=b;var v=(0,l.createAction)("CHAT_CREATED",function(e,t){return(0,f.mapLastEventMeta)((0,f.convertChatTimestamps)(e),t)});t.chatCreated=v;var g=(0,l.createAction)("CHAT_UPDATED",function(e,t){return(0,f.mapLastEventMeta)((0,f.convertChatTimestamps)(e),t)});t.chatUpdated=g;var E=(0,l.createAction)("CREATE_CHAT",function(e){return e});t.createChat=E;var S=(0,l.createAction)("FETCH_HISTORY",function(e,t,n,r){return{chatId:e,direction:t,chunkSize:n,isInitLoading:r}});t.fetchHistory=S;var O=(0,l.createAction)("FETCH_HISTORY_SUCCESS",function(e,t){return{chatId:e,boundary:t}});t.fetchHistorySuccess=O;var C=(0,l.createAction)("DROP_UNREAD_COUNTER",function(e){return e});t.dropUnreadCounter=C;var w=(0,l.createAction)("INC_UNREAD_COUNTER",function(e){return e});t.incUnreadCounter=w;var j=(0,l.createAction)("LEAVE_CHAT",function(e){return e});t.leaveChat=j;var k=(0,l.createAction)("LEAVE_CHAT_SUCCESS",function(e){return e});t.leaveChatSuccess=k;var P=(0,l.createAction)("SET_CHAT_SETTINGS",function(e,t){return{chatId:e,settings:t}});t.setChatSettings=P;var T=(0,l.createAction)("CHAT_SETTINGS_CHANGED",function(e,t){return{chatId:e,settings:t}});t.chatSettingsChanged=T;var x=(0,l.createAction)("UPDATE_CHAT",function(e,t){return{payload:e,connType:t}});t.updateChat=x;var M=(0,l.createAction)("REMOVE_USER",function(e,t){return{payload:e,connType:t}});t.removeUser=M;var N=(0,l.createAction)("ADD_USER",function(e,t){return{payload:e,connType:t}});t.addUser=N;var A=(0,l.createAction)("ADD_ADMIN",function(e,t){return{payload:e,connType:t}});t.addAdmin=A;var R=(0,l.createAction)("LAST_EVENTS_FETCHED",function(e){return e.map(function(e){return(0,p.convertMessageTimestamps)(e)})});t.lastEventsFetched=R;var I=(0,l.createAction)("CLEAN_BADGE",function(e){return e});t.cleanBadge=I;var D=(0,l.createAction)("CHAT_INFO",function(e){return e});t.chatInfo=D;var L=(0,l.createAction)("CHAT_INFO_SUCCESS",function(e){return e});t.chatInfoSuccess=L;var U=(0,l.createAction)("CHAT_POSITION_REPORT_UPDATED",function(e,t){return{chatId:e,message:t}});t.chatPositionReportUpdated=U;var F=(0,l.createAction)("LOAD_HISTORY_BACKWARD",function(e,t){return{chatId:e,initialLoad:t}});t.loadHistoryBackward=F;var H=[],K=(u={},c(u,_,function(e,t){return t.payload.map(function(t){var n=e.find(function(e){return e.group_chat_id===t.group_chat_id});if(!n)return t;var r=n.lastEvent,a=n.forward,o=n.backward;return t.unreadCounter?i({},t,{lastEvent:r}):i({},t,{lastEvent:r,forward:a,backward:o})})}),c(u,b,function(e,t){var n=t.payload;return e.map(function(e){if(e.group_chat_id!==n.group_chat_id)return e;var t=e.lastEvent,r=e.forward,a=e.backward;return i({},n,{lastEvent:i({},t,{isObsolete:!0}),forward:r,backward:a})})}),c(u,v,function(e,t){var n=t.payload;return r(e.filter(function(e){return e.group_chat_id!==n.group_chat_id})).concat([i({},n,{unreadCounter:0})])}),c(u,g,function(e,t){var n=t.payload;return e.map(function(e){if(e.group_chat_id!==n.group_chat_id)return e;var t=e.lastEvent,r=e.unreadCounter,a=e.forward,o=e.backward,s=e.sorting_inserted_at,c=e.sorting_sync_id,u=e.last_event_inserted_at,l=e.last_event_sync_id;return i({},n,{lastEvent:t,sorting_inserted_at:s,sorting_sync_id:c,last_event_inserted_at:u,last_event_sync_id:l,unreadCounter:r,servers:null,forward:a,backward:o})})}),c(u,O,function(e,t){var n=t.payload,r=n.chatId,a=n.boundary;return e.map(function(e){return e.group_chat_id!==r?e:i({},e,a)})}),c(u,h.decryptNewMessageSuccess,function(e,t){var n=t.payload;return B(e,n)}),c(u,h.messageAddedLocally,function(e,t){var n=t.payload;return e.map(function(e){return e.group_chat_id!==n.group_chat_id?e:i({},e,{last_event_inserted_at:n.inserted_at,last_event_sync_id:n.sync_id,position_event_sync_id:n.sync_id})})}),c(u,h.systemEventAdded,function(e,t){var n=t.payload;return B(e,n)}),c(u,y.callHangupReceived,function(e,t){var n=t.payload;return B(e,n)}),c(u,C,function(e,t){var n=t.payload;return(0,d.map)(e,function(e){return e.group_chat_id===n?i({},e,{unreadCounter:0}):e})}),c(u,w,function(e,t){var n=t.payload;return e.map(function(e){return e.group_chat_id!==n?e:i({},e,{unreadCounter:e.unreadCounter+1})})}),c(u,m.requestLogoutCtsSuccess,function(){return[]}),c(u,m.logoutCts,function(){return[]}),c(u,m.registeredOnCts,function(){return[]}),c(u,m.registeredOnOtherCts,function(){return[]}),c(u,m.loggedOutCts,function(){return[]}),c(u,k,function(e,t){return e.map(function(e){return e.group_chat_id===t.payload?i({},e,{left:!0,active:!1}):e})}),c(u,T,function(e,t){var n=t.payload,r=n.chatId,a=n.settings;return e.map(function(e){return e.group_chat_id===r?i({},e,{chat_settings:i({},e.chat_settings,a)}):e})}),c(u,R,function(e,t){var n=t.payload;return e.map(function(e){var t=n.find(function(t){return t.group_chat_id===e.group_chat_id});return t?i({},e,{lastEvent:t}):e})}),c(u,L,function(e,t){var n=t.payload;return e.map(function(e){return e.group_chat_id===n.group_chat_id?i({},e,{servers:n.servers}):e})}),c(u,U,function(e,t){var n=t.payload,r=n.chatId,a=n.message;return e.map(function(e){var t;return e.group_chat_id!==r?e:i({},e,{position_event_sync_id:(null===a||void 0===a?void 0:a.sync_id)||(null===e||void 0===e?void 0:null===(t=e.lastEvent)||void 0===t?void 0:t.sync_id)})})}),u),B=function(e,t){return e.map(function(e){if(e.group_chat_id!==t.group_chat_id)return e;if("routing_changed"===t.event_type)return i({},e,{forward:{sync_id:t.sync_id,connType:t.payload.forward[0].conn_type},last_event_inserted_at:t.inserted_at,last_event_sync_id:t.sync_id});var n={sync_id:t.sync_id,connType:"message_new"===t.event_type?t.kind:t.connType};if(e.sorting_inserted_at>t.inserted_at)return i({},e,{forward:n});var r=t.inserted_at,a=t.sync_id,o=t.event_type,s=t.connType,c=t.group_chat_id,u=t.kind,l=t.sender,d=t.payload,p=d.body,f=d.type,m=d.from,h=d.timestamp,y=d.user_huid,_="message_new"===t.event_type?{body:p,type:f,from:m,timestamp:h}:{user_huid:y};return"voex"===t.event_type?i({},e,{forward:n,lastEvent:{sync_id:a,inserted_at:r,event_type:o,connType:s,group_chat_id:c,kind:u,payload:t.payload},last_event_inserted_at:r,last_event_sync_id:a,sorting_inserted_at:r,sorting_sync_id:a}):i({},e,{forward:n,lastEvent:{sync_id:a,inserted_at:r,event_type:o,connType:s,group_chat_id:c,kind:u,sender:l,payload:_},last_event_inserted_at:r,last_event_sync_id:a,sorting_inserted_at:r,sorting_sync_id:a})})},G=(0,l.handleActions)(K,H);t.chats=G},"./app/modules/drafts.js":function(e,t,n){"use strict";function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){a(e,t,n[t])})}return e}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(t,"__esModule",{value:!0}),t.drafts=t.showDraftMessage=t.draftMessageChanged=t.changeDraftMessage=t.SHOW_DRAFT_MESSAGE=t.DRAFT_MESSAGE_CHANGED=t.CHANGE_DRAFT_MESSAGE=void 0;var o,s=n("./node_modules/redux-actions/lib/index.js"),i=n("./app/modules/ui.js");t.CHANGE_DRAFT_MESSAGE="CHANGE_DRAFT_MESSAGE";t.DRAFT_MESSAGE_CHANGED="DRAFT_MESSAGE_CHANGED";t.SHOW_DRAFT_MESSAGE="SHOW_DRAFT_MESSAGE";var c=(0,s.createAction)("CHANGE_DRAFT_MESSAGE",function(e,t){return{chatId:e,text:t}});t.changeDraftMessage=c;var u=(0,s.createAction)("DRAFT_MESSAGE_CHANGED",function(e,t){return{chatId:e,text:t}});t.draftMessageChanged=u;var l=(0,s.createAction)("SHOW_DRAFT_MESSAGE",function(e){return e});t.showDraftMessage=l;var d=[],p=(o={},a(o,u,function(e,t){var n=t.payload,a=n.chatId,o=n.text,s=e.filter(function(e){return e.chatId!==a});if(!o)return s;var i=e.find(function(e){return e.chatId===a});return s.concat(r({},i,t.payload))}),a(o,l,function(e,t){var n=t.payload,a=e.find(function(e){return e.chatId===n});return a?e.filter(function(e){return e.chatId!==n}).concat(r({},a,{visible:!0})):e.concat({chatId:n,visible:!0})}),a(o,i.initApp,function(e){return Array.isArray(e)?e.filter(function(e){return e.text}).map(function(e){return r({},e,{visible:!0})}):[]}),o),f=(0,s.handleActions)(p,d);t.drafts=f},"./app/modules/encryptionKeys.js":function(e,t,n){"use strict";function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){a(e,t,n[t])})}return e}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(t,"__esModule",{value:!0}),t.encryptionKeys=t.loadServerPublicKeys=t.setQrRequestKeys=t.setServerPublicKeys=t.setEncryptionKeysData=t.uploadUserKeys=t.decryptUserPrivateKeys=t.userPrivateKeyUploaded=t.userPublicKeyUploaded=t.userPrivateKeysDecrypted=t.userPublicKeyFetched=t.userPrivateKeyFetched=t.fetchPublicKeysSuccess=t.LOAD_SERVER_PUBLIC_KEYS=t.USER_PUBLIC_KEY_FETCHED=t.USER_PRIVATE_KEY_FETCHED=t.SET_QR_REQUEST_KEYS=t.USER_PRIVATE_KEYS_DECRYPTED=t.SET_SERVER_PUBLIC_KEYS=t.SET_ENCRYPTION_KEYS_DATA=t.ENCRYPT_SYMMETRIC_KEY_SUCCESS=t.ENCRYPT_SYMMETRIC_KEY=t.DECRYPT_USER_PRIVATE_KEYS=t.UPLOAD_USER_KEY=t.USER_PUBLIC_KEY_UPLOADED=t.FETCH_PUBLIC_KEYS_SUCCESS=t.UPLOAD_CTS_PUBLIC_KEY_FAILURE=t.UPLOAD_CTS_PUBLIC_KEY_SUCCESS=void 0;var o,s=n("./node_modules/redux-actions/lib/index.js"),i=n("./node_modules/lodash/lodash.js"),c=n("./lib/encryption.js");t.UPLOAD_CTS_PUBLIC_KEY_SUCCESS="UPLOAD_CTS_PUBLIC_KEY_SUCCESS";t.UPLOAD_CTS_PUBLIC_KEY_FAILURE="UPLOAD_CTS_PUBLIC_KEY_FAILURE";t.FETCH_PUBLIC_KEYS_SUCCESS="FETCH_PUBLIC_KEYS_SUCCESS";t.USER_PUBLIC_KEY_UPLOADED="USER_PUBLIC_KEY_UPLOADED";t.UPLOAD_USER_KEY="UPLOAD_USER_KEY";t.DECRYPT_USER_PRIVATE_KEYS="DECRYPT_USER_PRIVATE_KEYS";t.ENCRYPT_SYMMETRIC_KEY="ENCRYPT_SYMMETRIC_KEY";t.ENCRYPT_SYMMETRIC_KEY_SUCCESS="ENCRYPT_SYMMETRIC_KEY_SUCCESS";t.SET_ENCRYPTION_KEYS_DATA="SET_ENCRYPTION_KEYS_DATA";t.SET_SERVER_PUBLIC_KEYS="SET_SERVER_PUBLIC_KEYS";t.USER_PRIVATE_KEYS_DECRYPTED="USER_PRIVATE_KEYS_DECRYPTED";t.SET_QR_REQUEST_KEYS="SET_QR_REQUEST_KEYS";t.USER_PRIVATE_KEY_FETCHED="USER_PRIVATE_KEY_FETCHED";t.USER_PUBLIC_KEY_FETCHED="USER_PUBLIC_KEY_FETCHED";t.LOAD_SERVER_PUBLIC_KEYS="LOAD_SERVER_PUBLIC_KEYS";var u=(0,s.createAction)("FETCH_PUBLIC_KEYS_SUCCESS",function(e){return e});t.fetchPublicKeysSuccess=u;var l=(0,s.createAction)("USER_PRIVATE_KEY_FETCHED",function(e,t){return{key:e,kind:t}});t.userPrivateKeyFetched=l;var d=(0,s.createAction)("USER_PUBLIC_KEY_FETCHED",function(e,t){return{key:e,kind:t}});t.userPublicKeyFetched=d;var p=(0,s.createAction)("USER_PRIVATE_KEYS_DECRYPTED",function(e,t){return{rts:(0,c.toBase64)(e),cts:(0,c.toBase64)(t)}});t.userPrivateKeysDecrypted=p;var f=(0,s.createAction)("USER_PUBLIC_KEY_UPLOADED",function(e,t){return{key:r({},e,{body:(0,c.toBase64)(e.body)}),kind:t}});t.userPublicKeyUploaded=f;var m=(0,s.createAction)("USER_PRIVATE_KEY_UPLOADED",function(e,t){return{key:r({},e,{body:(0,c.toBase64)(e.body)}),kind:t}});t.userPrivateKeyUploaded=m;var h=(0,s.createAction)("DECRYPT_USER_PRIVATE_KEYS",function(e){return e});t.decryptUserPrivateKeys=h;var y=(0,s.createAction)("UPLOAD_USER_KEY",function(e){return e});t.uploadUserKeys=y;var _=(0,s.createAction)("SET_ENCRYPTION_KEYS_DATA",function(e){return e});t.setEncryptionKeysData=_;var b=(0,s.createAction)("SET_SERVER_PUBLIC_KEYS",function(e){return e});t.setServerPublicKeys=b;var v=(0,s.createAction)("SET_QR_REQUEST_KEYS",function(e){return e});t.setQrRequestKeys=v;var g=(0,s.createAction)("LOAD_SERVER_PUBLIC_KEYS",function(e){return e});t.loadServerPublicKeys=g;var E={user:{privateKeys:{rts:void 0,cts:void 0},publicKeys:{rts:void 0,cts:void 0}},publicKeys:[],server:{rts:void 0,cts:void 0},qrRequest:{private:void 0,public:void 0}},S=(o={},a(o,l,function(e,t){return r({},e,{user:r({},e.user,{privateKeys:r({},e.user.privateKeys,a({},t.payload.kind,t.payload.key))})})}),a(o,d,function(e,t){return r({},e,{user:r({},e.user,{publicKeys:r({},e.user.publicKeys,a({},t.payload.kind,t.payload.key))}),publicKeys:(0,i.concat)(e.publicKeys||[],t.payload.key)})}),a(o,p,function(e,t){return r({},e,{user:r({},e.user,{privateKeys:{rts:r({},e.user.privateKeys.rts,{body:t.payload.rts}),cts:r({},e.user.privateKeys.cts,{body:t.payload.cts})}})})}),a(o,f,function(e,t){return r({},e,{user:r({},e.user,{publicKeys:r({},e.user.publicKeys,a({},t.payload.kind,t.payload.key))}),publicKeys:(0,i.concat)(e.publicKeys||[],t.payload.key)})}),a(o,m,function(e,t){return r({},e,{user:r({},e.user,{privateKeys:r({},e.user.privateKeys,a({},t.payload.kind,t.payload.key))})})}),a(o,u,function(e,t){return r({},e,{publicKeys:(0,i.uniqBy)((0,i.concat)(e.publicKeys||[],t.payload),"id")})}),a(o,_,function(e,t){return r({},e,t.payload)}),a(o,b,function(e,t){return r({},e,{server:t.payload})}),a(o,v,function(e,t){var n=t.payload,a=n.publicKey;return r({},e,{qrRequest:{private:n.privateKey,public:a}})}),o),O=(0,s.handleActions)(S,E);t.encryptionKeys=O},"./app/modules/eventsQueue.js":function(e,t,n){"use strict";function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(t,"__esModule",{value:!0}),t.eventsQueue=t.pullEventsQueue=t.pushEventsQueue=t.PULL_EVENTS_QUEUE=t.PUSH_EVENTS_QUEUE=void 0;var a,o=n("./node_modules/redux-actions/lib/index.js"),s=n("./node_modules/lodash/lodash.js");t.PUSH_EVENTS_QUEUE="PUSH_EVENTS_QUEUE";t.PULL_EVENTS_QUEUE="PULL_EVENTS_QUEUE";var i=(0,o.createAction)("PUSH_EVENTS_QUEUE",function(e){return e});t.pushEventsQueue=i;var c=(0,o.createAction)("PULL_EVENTS_QUEUE");t.pullEventsQueue=c;var u=[],l=(a={},r(a,i,function(e,t){return(0,s.concat)(e,t.payload)}),r(a,c,function(e){return(0,s.tail)(e)}),a),d=(0,o.handleActions)(l,u);t.eventsQueue=d},"./app/modules/index.js":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.rootReducer=t.appReducer=void 0;var r=n("./node_modules/react-router-redux/es/index.js"),a=n("./node_modules/redux/es/index.js"),o=n("./app/modules/notifiers.js"),s=n("./app/modules/phonebook.js"),i=n("./app/modules/user.js"),c=n("./app/modules/chats.js"),u=n("./app/modules/messages.js"),l=n("./app/modules/statuses.js"),d=n("./app/modules/membersTyping.js"),p=n("./app/modules/ui.js"),f=n("./app/modules/attachments.js"),m=n("./app/modules/profiles.js"),h=n("./app/modules/encryptionKeys.js"),y=n("./app/modules/messageKeys.js"),_=n("./app/modules/eventsQueue.js"),b=n("./app/modules/drafts.js"),v=n("./app/modules/voex.js"),g=n("./app/modules/settings.js"),E=(0,a.combineReducers)({notifiers:o.notifiers,phonebook:s.phonebook,user:i.user,chats:c.chats,messages:u.messages,routing:r.routerReducer,statuses:l.statuses,membersTyping:d.membersTyping,ui:p.ui,attachments:f.attachments,profiles:m.profiles,encryptionKeys:h.encryptionKeys,messageKeys:y.messageKeys,eventsQueue:_.eventsQueue,drafts:b.drafts,voex:v.voex,settings:g.settings});t.appReducer=E;var S=function(e,t){return[i.LOGOUT_RTS_SUCCESS].includes(t.type)&&(e=void 0),E(e,t)};t.rootReducer=S;var O=S;t.default=O},"./app/modules/membersTyping.js":function(e,t,n){"use strict";function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(t,"__esModule",{value:!0}),t.membersTyping=t.removeMemberTyping=t.addMemberTyping=t.typingMemberRemoved=t.typingMemberAdded=t.REMOVE_TYPING_MEMBER=t.ADD_TYPING_MEMBER=t.TYPING_MEMBER_REMOVED=t.TYPING_MEMBER_ADDED=void 0;var a,o=n("./node_modules/redux-actions/lib/index.js"),s=n("./node_modules/lodash/lodash.js");t.TYPING_MEMBER_ADDED="TYPING_MEMBER_ADDED";t.TYPING_MEMBER_REMOVED="TYPING_MEMBER_REMOVED";t.ADD_TYPING_MEMBER="ADD_TYPING_MEMBER";t.REMOVE_TYPING_MEMBER="REMOVE_TYPING_MEMBER";var i=(0,o.createAction)("TYPING_MEMBER_ADDED",function(e){return e});t.typingMemberAdded=i;var c=(0,o.createAction)("TYPING_MEMBER_REMOVED",function(e){return e});t.typingMemberRemoved=c;var u=(0,o.createAction)("ADD_TYPING_MEMBER",function(e){return e});t.addMemberTyping=u;var l=(0,o.createAction)("REMOVE_TYPING_MEMBER",function(e){return e});t.removeMemberTyping=l;var d=[],p=(a={},r(a,i,function(e,t){return(0,s.find)(e,function(e){return(0,s.isEqual)(e,t.payload)})?e:(0,s.concat)(e,t.payload)}),r(a,c,function(e,t){return(0,s.filter)(e,function(e){return!(0,s.isEqual)(e,t.payload)})}),a),f=(0,o.handleActions)(p,d);t.membersTyping=f},"./app/modules/messageKeys.js":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.messageKeys=t.fetchMessageKeysSuccess=t.FETCH_MESSAGE_KEYS_FAILURE=t.FETCH_MESSAGE_KEYS_SUCCESS=void 0;var r=n("./node_modules/redux-actions/lib/index.js"),a=n("./node_modules/lodash/lodash.js"),o=n("./app/helpers/messagesHelpers.js");t.FETCH_MESSAGE_KEYS_SUCCESS="FETCH_MESSAGE_KEYS_SUCCESS";t.FETCH_MESSAGE_KEYS_FAILURE="FETCH_MESSAGE_KEYS_FAILURE";var s=(0,r.createAction)("FETCH_MESSAGE_KEYS_SUCCESS",function(e){return(0,o.mapMessageKeys)(e)});t.fetchMessageKeysSuccess=s;var i=[],c=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},s,function(e,t){return(0,a.uniqBy)((0,a.concat)(e,t.payload),"sync_id")}),u=(0,r.handleActions)(c,i);t.messageKeys=u},"./app/modules/messages.js":function(e,t,n){"use strict";function r(e){return s(e)||o(e)||a()}function a(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function o(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function s(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){c(e,t,n[t])})}return e}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(t,"__esModule",{value:!0}),t.messages=t.sendAppEvent=t.decryptMessagesPreviewSuccess=t.systemEventAdded=t.addSystemEvent=t.receiveMessageMarkReadReports=t.receiveMessageNewReports=t.sendMessageMarkReadReports=t.loadMessageFileSuccess=t.loadMessageFile=t.decryptNewMessageFailure=t.decryptNewMessagePreviewSuccess=t.decryptNewMessageSuccess=t.receiveMessageNew=t.decryptHistorySuccess=t.decryptHistoryFailure=t.cleanCache=t.messageAddedLocally=t.sendMessage=t.DECRYPT_MESSAGES_PREVIEW_SUCCESS=t.DECRYPT_NEW_MESSAGE_PREVIEW_SUCCESS=t.DECRYPT_SYMMETRIC_KEY_SUCCESS=t.DECRYPT_SYMMETRIC_KEY=t.DECRYPT_FILE_SUCCESS=t.DECRYPT_FILE=t.ENCRYPT_MESSAGE_PAYLOAD_SUCCESS=t.ENCRYPT_MESSAGE_PAYLOAD=t.DECRYPT_MESSAGE_PAYLOADS_SUCCESS=t.DECRYPT_MESSAGE_PAYLOADS=t.SEND_APP_EVENT=t.SYSTEM_EVENT_ADDED=t.ADD_SYSTEM_EVENT=t.ENCRYPT_FILE_SUCCESS=t.ENCRYPT_FILE=t.CLEAN_CACHE=t.RECEIVE_MESSAGE_MARK_READ_REPORTS=t.RECEIVE_MESSAGE_NEW_REPORTS=t.SEND_MESSAGE_MARK_READ_REPORTS=t.LOAD_MESSAGE_FILE_FAILURE=t.LOAD_MESSAGE_FILE_SUCCESS=t.LOAD_MESSAGE_FILE=t.DECRYPT_NEW_MESSAGE_FAILURE=t.DECRYPT_NEW_MESSAGE_SUCCESS=t.RECEIVE_MESSAGE_NEW=t.DECRYPT_HISTORY_FAILURE=t.DECRYPT_HISTORY_SUCCESS=t.MESSAGE_ADDED_LOCALLY=t.SEND_MESSAGE=void 0;var u,l=n("./node_modules/redux-actions/lib/index.js"),d=function(e){return e&&e.__esModule?e:{default:e}}(n("./node_modules/moment/moment.js")),p=n("./app/helpers/messagesHelpers.js"),f=n("./app/modules/user.js"),m=n("./app/modules/voex.js");t.SEND_MESSAGE="SEND_MESSAGE";t.MESSAGE_ADDED_LOCALLY="MESSAGE_ADDED_LOCALLY";t.DECRYPT_HISTORY_SUCCESS="DECRYPT_HISTORY_SUCCESS";t.DECRYPT_HISTORY_FAILURE="DECRYPT_HISTORY_FAILURE";t.RECEIVE_MESSAGE_NEW="RECEIVE_MESSAGE_NEW";t.DECRYPT_NEW_MESSAGE_SUCCESS="DECRYPT_NEW_MESSAGE_SUCCESS";t.DECRYPT_NEW_MESSAGE_FAILURE="DECRYPT_NEW_MESSAGE_FAILURE";t.LOAD_MESSAGE_FILE="LOAD_MESSAGE_FILE";t.LOAD_MESSAGE_FILE_SUCCESS="LOAD_MESSAGE_FILE_SUCCESS";t.LOAD_MESSAGE_FILE_FAILURE="LOAD_MESSAGE_FILE_FAILURE";t.SEND_MESSAGE_MARK_READ_REPORTS="SEND_MESSAGE_MARK_READ_REPORTS";t.RECEIVE_MESSAGE_NEW_REPORTS="RECEIVE_MESSAGE_NEW_REPORTS";t.RECEIVE_MESSAGE_MARK_READ_REPORTS="RECEIVE_MESSAGE_MARK_READ_REPORTS";t.CLEAN_CACHE="CLEAN_CACHE";t.ENCRYPT_FILE="ENCRYPT_FILE";t.ENCRYPT_FILE_SUCCESS="ENCRYPT_FILE_SUCCESS";t.ADD_SYSTEM_EVENT="ADD_SYSTEM_EVENT";t.SYSTEM_EVENT_ADDED="SYSTEM_EVENT_ADDED";t.SEND_APP_EVENT="SEND_APP_EVENT";t.DECRYPT_MESSAGE_PAYLOADS="DECRYPT_MESSAGE_PAYLOADS";t.DECRYPT_MESSAGE_PAYLOADS_SUCCESS="DECRYPT_MESSAGE_PAYLOADS_SUCCESS";t.ENCRYPT_MESSAGE_PAYLOAD="ENCRYPT_MESSAGE_PAYLOAD";t.ENCRYPT_MESSAGE_PAYLOAD_SUCCESS="ENCRYPT_MESSAGE_PAYLOAD_SUCCESS";t.DECRYPT_FILE="DECRYPT_FILE";t.DECRYPT_FILE_SUCCESS="DECRYPT_FILE_SUCCESS";t.DECRYPT_SYMMETRIC_KEY="DECRYPT_SYMMETRIC_KEY";t.DECRYPT_SYMMETRIC_KEY_SUCCESS="DECRYPT_SYMMETRIC_KEY_SUCCESS";t.DECRYPT_NEW_MESSAGE_PREVIEW_SUCCESS="DECRYPT_NEW_MESSAGE_PREVIEW_SUCCESS";t.DECRYPT_MESSAGES_PREVIEW_SUCCESS="DECRYPT_MESSAGES_PREVIEW_SUCCESS";var h=(0,l.createAction)("SEND_MESSAGE",function(e,t,n){return{chatId:e,type:t,data:n}});t.sendMessage=h;var y=(0,l.createAction)("MESSAGE_ADDED_LOCALLY",function(e){return(0,p.convertMessageTimestamps)(e)});t.messageAddedLocally=y;var _=(0,l.createAction)("CLEAN_CACHE");t.cleanCache=_;var b=(0,l.createAction)("DECRYPT_HISTORY_FAILURE",function(e,t){return{messages:e,error:t}});t.decryptHistoryFailure=b;var v=(0,l.createAction)("DECRYPT_HISTORY_SUCCESS",function(e){return e.map(function(e){var t=(0,p.convertMessageTimestamps)(i({},e,{payload:i({},e.payload,{timestamp:e.inserted_at})}));return"app_event"===t.event_type&&"call_hangup"===t.payload.event_type?i({},t,{event_type:"voex"}):t})});t.decryptHistorySuccess=v;var g=(0,l.createAction)("RECEIVE_MESSAGE_NEW",function(e){return e});t.receiveMessageNew=g;var E=(0,l.createAction)("DECRYPT_NEW_MESSAGE_SUCCESS",function(e){return(0,p.convertMessageTimestamps)(i({},e,{event_type:"message_new",payload:i({},e.payload,{timestamp:(0,d.default)()})}))});t.decryptNewMessageSuccess=E;var S=(0,l.createAction)("DECRYPT_NEW_MESSAGE_PREVIEW_SUCCESS",function(e){return(0,p.convertMessageTimestamps)(i({},e,{event_type:"message_new",payload:i({},e.payload,{timestamp:(0,d.default)()})}))});t.decryptNewMessagePreviewSuccess=S;var O=(0,l.createAction)("DECRYPT_NEW_MESSAGE_FAILURE",function(e){return(0,p.convertMessageTimestamps)(e)});t.decryptNewMessageFailure=O;var C=(0,l.createAction)("LOAD_MESSAGE_FILE",function(e){return e});t.loadMessageFile=C;var w=(0,l.createAction)("LOAD_MESSAGE_FILE_SUCCESS",function(e){return e});t.loadMessageFileSuccess=w;var j=(0,l.createAction)("SEND_MESSAGE_MARK_READ_REPORTS",function(e){return e});t.sendMessageMarkReadReports=j;var k=(0,l.createAction)("RECEIVE_MESSAGE_NEW_REPORTS",function(e){return e});t.receiveMessageNewReports=k;var P=(0,l.createAction)("RECEIVE_MESSAGE_MARK_READ_REPORTS",function(e){return e});t.receiveMessageMarkReadReports=P;var T=(0,l.createAction)("ADD_SYSTEM_EVENT",function(e){return e});t.addSystemEvent=T;var x=(0,l.createAction)("SYSTEM_EVENT_ADDED",function(e){return(0,p.convertMessageTimestamps)(i({},e,{payload:i({},e.payload,{timestamp:(0,d.default)()})}))});t.systemEventAdded=x;var M=(0,l.createAction)("DECRYPT_MESSAGES_PREVIEW_SUCCESS",function(e){return e.map(function(e){return(0,p.convertMessageTimestamps)(i({},e,{payload:i({},e.payload,{timestamp:e.inserted_at})}))})});t.decryptMessagesPreviewSuccess=M;var N=(0,l.createAction)("SEND_APP_EVENT",function(e,t,n,r){return{chatId:e,type:t,data:n,params:r}});t.sendAppEvent=N;var A=[],R=(u={},c(u,y,function(e,t){return e.filter(function(e){return e.sync_id!==t.payload.sync_id}).concat(i({},t.payload,{event_type:"message_new",read_by:null,received_by:null,payload:i({},t.payload.payload,{isLocal:!0})}))}),c(u,k,function(e,t){var n=t.payload.from,a=t.payload.sync_id;return e.map(function(e){return!a.includes(e.sync_id)||I(e,"received_by",n)?e:i({},e,{received_by:r(e.received_by||[]).concat([{user_huid:n,reported_at:(0,d.default)()}])})})}),c(u,P,function(e,t){var n=t.payload.from,a=t.payload.sync_id;return e.map(function(e){return!a.includes(e.sync_id)||I(e,"read_by",n)?e:i({},e,{read_by:r(e.read_by||[]).concat([{user_huid:n,reported_at:(0,d.default)()}])})})}),c(u,_,function(){return[]}),c(u,v,function(e,t){var n=e.map(function(e){return e.sync_id}),r=t.payload.filter(function(e){return!n.includes(e.sync_id)});return e.concat(r)}),c(u,E,function(e,t){var n=t.payload,r=e.find(function(e){return e.sync_id===n.sync_id});return r?e.map(function(e){return e.sync_id===n.sync_id?i({},n,{inserted_at:r.inserted_at}):e}):e.concat(n)}),c(u,w,function(e,t){var n=t.payload;return e.map(function(e){return e.payload.msg_id===n.payload.msg_id?i({},n,{payload:i({},n.payload,{attachmentLoaded:!0})}):e})}),c(u,f.requestLogoutCtsSuccess,function(){return[]}),c(u,f.registeredOnCts,function(){return[]}),c(u,f.registeredOnOtherCts,function(){return[]}),c(u,f.loggedOutCts,function(){return[]}),c(u,x,function(e,t){return e.filter(function(e){return e.sync_id!==t.payload.sync_id}).concat(t.payload)}),c(u,S,function(e,t){var n=t.payload;return e.map(function(e){return n.sync_id===e.sync_id?i({},n,{inserted_at:e.inserted_at}):e})}),c(u,M,function(e,t){var n=t.payload;return e.map(function(e){return n.find(function(t){return t.sync_id===e.sync_id})||e})}),c(u,m.callHangupReceived,function(e,t){return e.concat(t.payload)}),u),I=function(e,t,n){return e[t]&&e[t].find(function(e){return e.user_huid===n})},D=(0,l.handleActions)(R,A);t.messages=D},"./app/modules/notifiers.js":function(e,t,n){"use strict";function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(t,"__esModule",{value:!0}),t.notifiers=t.dismissAllNotifiers=t.dismissNotifier=t.showNotifierSuccess=t.showNotifier=t.DISMISS_ALL_NOTIFIERS=t.DISMISS_NOTIFIER=t.SHOW_NOTIFIER_SUCCESS=t.SHOW_NOTIFIER=void 0;var a,o=n("./node_modules/redux-actions/lib/index.js");t.SHOW_NOTIFIER="SHOW_NOTIFIER";t.SHOW_NOTIFIER_SUCCESS="SHOW_NOTIFIER_SUCCESS";t.DISMISS_NOTIFIER="DISMISS_NOTIFIER";t.DISMISS_ALL_NOTIFIERS="DISMISS_ALL_NOTIFIERS";var s=(0,o.createAction)("SHOW_NOTIFIER",function(e,t,n){return{text:e,type:t,permanent:n}});t.showNotifier=s;var i=(0,o.createAction)("SHOW_NOTIFIER_SUCCESS",function(e,t){return{text:e,type:t}});t.showNotifierSuccess=i;var c=(0,o.createAction)("DISMISS_NOTIFIER",function(e){return e});t.dismissNotifier=c;var u=(0,o.createAction)("DISMISS_ALL_NOTIFIERS");t.dismissAllNotifiers=u;var l=[],d=(a={},r(a,i,function(e,t){return[t.payload]}),r(a,c,function(e,t){return e.filter(function(e,n){return n!==t.payload})}),r(a,u,function(){return[]}),a),p=(0,o.handleActions)(d,l);t.notifiers=p},"./app/modules/phonebook.js":function(e,t,n){"use strict";function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){a(e,t,n[t])})}return e}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(t,"__esModule",{value:!0}),t.phonebook=t.resetPhonebook=t.uploadPhonebookSuccess=t.uploadPhonebook=t.fetchPhonebookSuccess=t.fetchPhonebook=t.RESET_PHONEBOOK=t.UPLOAD_PHONEBOOK_SUCCESS=t.UPLOAD_PHONEBOOK=t.FETCH_PHONEBOOK_SUCCESS=t.FETCH_PHONEBOOK=void 0;var o,s=n("./node_modules/redux-actions/lib/index.js"),i=n("./app/modules/user.js"),c=n("./app/helpers/phonebookHelpers.js");t.FETCH_PHONEBOOK="FETCH_PHONEBOOK";t.FETCH_PHONEBOOK_SUCCESS="FETCH_PHONEBOOK_SUCCESS";t.UPLOAD_PHONEBOOK="UPLOAD_PHONEBOOK";t.UPLOAD_PHONEBOOK_SUCCESS="UPLOAD_PHONEBOOK_SUCCESS";t.RESET_PHONEBOOK="RESET_PHONEBOOK";var u=(0,s.createAction)("FETCH_PHONEBOOK");t.fetchPhonebook=u;var l=(0,s.createAction)("FETCH_PHONEBOOK_SUCCESS",function(e,t,n){return{entries:e,connType:t,version:n}});t.fetchPhonebookSuccess=l;var d=(0,s.createAction)("UPLOAD_PHONEBOOK",function(e,t){return{name:e,phone:t}});t.uploadPhonebook=d;var p=(0,s.createAction)("UPLOAD_PHONEBOOK_SUCCESS",function(e,t){return{entry:e,version:t}});t.uploadPhonebookSuccess=p;var f=(0,s.createAction)("RESET_PHONEBOOK");t.resetPhonebook=f;var m={rts:[],cts:[],versions:{rts:0,cts:0}},h=(o={},a(o,l,function(e,t){var n,o=t.payload,s=o.entries,i=o.connType,u=o.version,l=e[i],d=l.filter(function(e){return!s.find(function(t){return t.entry_id===e.entry_id})}),p=s.filter(function(e){return!(0,c.isEntryDeleted)(e,i)});return r({},e,(n={},a(n,i,d.concat(p)),a(n,"versions",r({},e.versions,a({},i,u))),n))}),a(o,p,function(e,t){var n=t.payload,a=n.entry,o=n.version;return r({},e,{rts:e.rts.concat(a),versions:r({},e.versions,{rts:o})})}),a(o,i.logoutCts,function(e){return r({},e,{cts:[],versions:r({},e.versions,{cts:0})})}),a(o,i.requestLogoutCtsSuccess,function(){return{rts:[],cts:[],versions:{rts:0,cts:0}}}),a(o,f,function(){return{rts:[],cts:[],versions:{rts:0,cts:0}}}),a(o,i.registeredOnCts,function(e){return r({},e,{cts:[],versions:r({},e.versions,{cts:0})})}),a(o,i.registeredOnOtherCts,function(e){return r({},e,{cts:[],versions:r({},e.versions,{cts:0})})}),a(o,i.loggedOutCts,function(e){return r({},e,{cts:[],versions:r({},e.versions,{cts:0})})}),o),y=(0,s.handleActions)(h,m);t.phonebook=y},"./app/modules/profiles.js":function(e,t,n){"use strict";function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){a(e,t,n[t])})}return e}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(t,"__esModule",{value:!0}),t.profiles=t.profilesFetched=t.PROFILES_FETCHED=void 0;var o=n("./node_modules/redux-actions/lib/index.js");t.PROFILES_FETCHED="PROFILES_FETCHED";var s=(0,o.createAction)("PROFILES_FETCHED",function(e){return e});t.profilesFetched=s;var i=[],c=a({},s,function(e,t){var n=t.payload.map(function(t){return r({},e.find(function(e){return e.user_huid===t.user_huid}),t)});return e.filter(function(e){return!n.find(function(t){return t.user_huid===e.user_huid})}).concat(n)}),u=(0,o.handleActions)(c,i);t.profiles=u},"./app/modules/push.js":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.activateCallFromPush=t.activateChatFromPush=t.ACTIVATE_CALL_FROM_PUSH=t.ACTIVATE_CHAT_FROM_PUSH=void 0;var r=n("./node_modules/redux-actions/lib/index.js");t.ACTIVATE_CHAT_FROM_PUSH="ACTIVATE_CHAT_FROM_PUSH";t.ACTIVATE_CALL_FROM_PUSH="ACTIVATE_CALL_FROM_PUSH";var a=(0,r.createAction)("ACTIVATE_CHAT_FROM_PUSH",function(e,t){return{payload:e,port:t}});t.activateChatFromPush=a;var o=(0,r.createAction)("ACTIVATE_CALL_FROM_PUSH",function(e,t){return{payload:e,port:t}});t.activateCallFromPush=o},"./app/modules/settings.js":function(e,t,n){"use strict";function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){a(e,t,n[t])})}return e}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(t,"__esModule",{value:!0}),t.settings=t.setPlayNotificationSound=t.SET_PLAY_NOTIFICATION_SOUND=void 0;var o=n("./node_modules/redux-actions/lib/index.js");t.SET_PLAY_NOTIFICATION_SOUND="SET_PLAY_NOTIFICATION_SOUND";var s=(0,o.createAction)("SET_PLAY_NOTIFICATION_SOUND",function(e){return e});t.setPlayNotificationSound=s;var i={playNotificationSound:!0},c=a({},s,function(e,t){return r({},e,{playNotificationSound:t.payload})}),u=(0,o.handleActions)(c,i);t.settings=u},"./app/modules/socket.js":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.networkOffline=t.networkOnline=t.NETWORK_OFFLINE=t.NETWORK_ONLINE=void 0;var r=n("./node_modules/redux-actions/lib/index.js");t.NETWORK_ONLINE="NETWORK_ONLINE";t.NETWORK_OFFLINE="NETWORK_OFFLINE";var a=(0,r.createAction)("NETWORK_ONLINE");t.networkOnline=a;var o=(0,r.createAction)("NETWORK_OFFLINE");t.networkOffline=o},"./app/modules/statuses.js":function(e,t,n){"use strict";function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(t,"__esModule",{value:!0}),t.statuses=t.userStatusFetchSuccess=t.userStatusListFetchSuccess=t.USER_STATUS_FETCH_SUCCESS=t.USER_STATUS_LIST_FETCH_SUCCESS=void 0;var a,o=n("./node_modules/redux-actions/lib/index.js"),s=n("./node_modules/lodash/lodash.js");t.USER_STATUS_LIST_FETCH_SUCCESS="USER_STATUS_LIST_FETCH_SUCCESS";t.USER_STATUS_FETCH_SUCCESS="USER_STATUS_FETCH_SUCCESS";var i=(0,o.createAction)("USER_STATUS_LIST_FETCH_SUCCESS",function(e){return e});t.userStatusListFetchSuccess=i;var c=(0,o.createAction)("USER_STATUS_FETCH_SUCCESS",function(e){return e});t.userStatusFetchSuccess=c;var u=[],l=(a={},r(a,i,function(e,t){var n=t.payload,r=(0,s.map)(n,"user_huid"),a=(0,s.filter)(e,function(e){return!r.includes(e.user_huid)});return(0,s.concat)(a,n)}),r(a,c,function(e,t){var n=t.payload,r=(0,s.filter)(e,function(e){return e.user_huid!==n.user_huid});return(0,s.concat)(r,n)}),a),d=(0,o.handleActions)(l,u);t.statuses=d},"./app/modules/ui.js":function(e,t,n){"use strict";function r(e){return s(e)||o(e)||a()}function a(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function o(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function s(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){c(e,t,n[t])})}return e}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e,t,n){var r=e.chats[t];return i({},e,{chats:i({},e.chats,c({},t,i({},r,n)))})}Object.defineProperty(t,"__esModule",{value:!0}),t.ui=t.initialState=t.systemMessages=t.chatState=t.chatHistorySearchTextChanged=t.showChatHistorySearch=t.setChatFirstVisibleMessage=t.locationChange=t.setSilentMode=t.uiAlertReceived=t.showUiAlert=t.hideLoadingOverlay=t.showLoadingOverlay=t.setAuthFetching=t.setChatHistoryLoader=t.setAppInFocus=t.setChatsFsmState=t.setChatFsmState=t.setChatLoadedFullHistory=t.setChatScrollPosition=t.setLocale=t.updateApp=t.hideUpdateDialog=t.hasNewAppVersion=t.hideStatusMessage=t.showStatusMessage=t.chatsSearchTextChanged=t.chatsFromFilterChanged=t.phonebookUsersFromFilterChanged=t.phonebookRegisteredOnlyFilterChanged=t.phonebookOnlineOnlyFilterChanged=t.phonebookSearchTextChanged=t.initApp=t.CHAT_HISTORY_TEXT_CHANGED=t.SHOW_CHAT_HISTORY_SEARCH=t.SET_CHAT_FIRST_VISIBLE_MESSAGE=t.SET_SILENT_MODE=t.UI_ALERT_RECEIVED=t.SHOW_UI_ALERT=t.HIDE_LOADING_OVERLAY=t.SHOW_LOADING_OVERLAY=t.SET_AUTH_FETCHING=t.SET_CHAT_HISTORY_LOADER=t.CHATS_SEARCH_TEXT_CHANGED=t.PHONEBOOK_USERS_FROM_FILTER_CHANGED=t.PHONEBOOK_REGISTERED_ONLY_FILTER_CHANGED=t.PHONEBOOK_ONLINE_ONLY_FILTER_CHANGED=t.PHONEBOOK_SEARCH_TEXT_CHANGED=t.SET_APP_IN_FOCUS=t.SET_CHATS_FSM_STATE=t.SET_CHAT_FSM_STATE=t.SET_CHAT_LOADED_FULL_HISTORY=t.SET_CHAT_SCROLL_POSITION=t.SET_LOCALE=t.UPDATE_APP=t.HIDE_UPDATE_DIALOG=t.HAS_NEW_APP_VERSION=t.HIDE_STATUS_MESSAGE=t.SHOW_STATUS_MESSAGE=t.INIT_APP=void 0;var l,d=n("./node_modules/redux-actions/lib/index.js"),p=n("./node_modules/react-router-redux/es/index.js"),f=n("./app/modules/chats.js");t.INIT_APP="INIT_APP";t.SHOW_STATUS_MESSAGE="SHOW_STATUS_MESSAGE";t.HIDE_STATUS_MESSAGE="HIDE_STATUS_MESSAGE";t.HAS_NEW_APP_VERSION="HAS_NEW_APP_VERSION";t.HIDE_UPDATE_DIALOG="HIDE_UPDATE_DIALOG";t.UPDATE_APP="UPDATE_APP";t.SET_LOCALE="SET_LOCALE";t.SET_CHAT_SCROLL_POSITION="SET_CHAT_SCROLL_POSITION";t.SET_CHAT_LOADED_FULL_HISTORY="SET_CHAT_LOADED_FULL_HISTORY";t.SET_CHAT_FSM_STATE="SET_CHAT_FSM_STATE";t.SET_CHATS_FSM_STATE="SET_CHATS_FSM_STATE";t.SET_APP_IN_FOCUS="SET_APP_IN_FOCUS";t.PHONEBOOK_SEARCH_TEXT_CHANGED="PHONEBOOK_SEARCH_TEXT_CHANGED";t.PHONEBOOK_ONLINE_ONLY_FILTER_CHANGED="PHONEBOOK_ONLINE_ONLY_FILTER_CHANGED";t.PHONEBOOK_REGISTERED_ONLY_FILTER_CHANGED="PHONEBOOK_REGISTERED_ONLY_FILTER_CHANGED";t.PHONEBOOK_USERS_FROM_FILTER_CHANGED="PHONEBOOK_USERS_FROM_FILTER_CHANGED";t.CHATS_SEARCH_TEXT_CHANGED="CHATS_SEARCH_TEXT_CHANGED";t.SET_CHAT_HISTORY_LOADER="SET_CHAT_HISTORY_LOADER";t.SET_AUTH_FETCHING="SET_AUTH_FETCHING";t.SHOW_LOADING_OVERLAY="SHOW_LOADING_OVERLAY";t.HIDE_LOADING_OVERLAY="HIDE_LOADING_OVERLAY";t.SHOW_UI_ALERT="SHOW_UI_ALERT";t.UI_ALERT_RECEIVED="UI_ALERT_RECEIVED";t.SET_SILENT_MODE="SET_SILENT_MODE";t.SET_CHAT_FIRST_VISIBLE_MESSAGE="SET_CHAT_FIRST_VISIBLE_MESSAGE";t.SHOW_CHAT_HISTORY_SEARCH="SHOW_CHAT_HISTORY_SEARCH";t.CHAT_HISTORY_TEXT_CHANGED="CHAT_HISTORY_TEXT_CHANGED";var m=(0,d.createAction)("INIT_APP");t.initApp=m;var h=(0,d.createAction)("PHONEBOOK_SEARCH_TEXT_CHANGED",function(e){return e});t.phonebookSearchTextChanged=h;var y=(0,d.createAction)("PHONEBOOK_ONLINE_ONLY_FILTER_CHANGED",function(e){return e});t.phonebookOnlineOnlyFilterChanged=y;var _=(0,d.createAction)("PHONEBOOK_REGISTERED_ONLY_FILTER_CHANGED",function(e){return e});t.phonebookRegisteredOnlyFilterChanged=_;var b=(0,d.createAction)("PHONEBOOK_USERS_FROM_FILTER_CHANGED",function(e){return e});t.phonebookUsersFromFilterChanged=b;var v=(0,d.createAction)("CHATS_FROM_FILTER_CHANGED",function(e){return e});t.chatsFromFilterChanged=v;var g=(0,d.createAction)("CHATS_SEARCH_TEXT_CHANGED",function(e){return e});t.chatsSearchTextChanged=g;var E=(0,d.createAction)("SHOW_STATUS_MESSAGE",function(e){return e});t.showStatusMessage=E;var S=(0,d.createAction)("HIDE_STATUS_MESSAGE");t.hideStatusMessage=S;var O=(0,d.createAction)("HAS_NEW_APP_VERSION",function(e){return e});t.hasNewAppVersion=O;var C=(0,d.createAction)("HIDE_UPDATE_DIALOG");t.hideUpdateDialog=C;var w=(0,d.createAction)("UPDATE_APP",function(e){return e});t.updateApp=w;var j=(0,d.createAction)("SET_LOCALE",function(e){return e});t.setLocale=j;var k=(0,d.createAction)("SET_CHAT_SCROLL_POSITION",function(e,t){return{chatId:e,scrollPosition:t}});t.setChatScrollPosition=k;var P=(0,d.createAction)("SET_CHAT_LOADED_FULL_HISTORY",function(e){return e});t.setChatLoadedFullHistory=P;var T=(0,d.createAction)("SET_CHAT_FSM_STATE",function(e,t){return{chatId:e,state:t}});t.setChatFsmState=T;var x=(0,d.createAction)("SET_CHATS_FSM_STATE",function(e,t){return{chatIds:e,state:t}});t.setChatsFsmState=x;var M=(0,d.createAction)("SET_APP_IN_FOCUS",function(e){return e});t.setAppInFocus=M;var N=(0,d.createAction)("SET_CHAT_HISTORY_LOADER",function(e){return e});t.setChatHistoryLoader=N;var A=(0,d.createAction)("SET_AUTH_FETCHING",function(e){return e});t.setAuthFetching=A;var R=(0,d.createAction)("SHOW_LOADING_OVERLAY");t.showLoadingOverlay=R;var I=(0,d.createAction)("HIDE_LOADING_OVERLAY");t.hideLoadingOverlay=I;var D=(0,d.createAction)("SHOW_UI_ALERT",function(e,t){return{type:e,version:t}});t.showUiAlert=D;var L=(0,d.createAction)("UI_ALERT_RECEIVED",function(e,t){return{type:e,version:t}});t.uiAlertReceived=L;var U=(0,d.createAction)("SET_SILENT_MODE",function(e){return{appInFocus:e}});t.setSilentMode=U;var F=(0,d.createAction)(p.LOCATION_CHANGE,function(e){return e});t.locationChange=F;var H=(0,d.createAction)("SET_CHAT_FIRST_VISIBLE_MESSAGE",function(e,t){return{chatId:e,firstVisibleMessageSyncId:t}});t.setChatFirstVisibleMessage=H;var K=(0,d.createAction)("SHOW_CHAT_HISTORY_SEARCH",function(e){return e});t.showChatHistorySearch=K;var B=(0,d.createAction)("CHAT_HISTORY_TEXT_CHANGED",function(e){return e});t.chatHistorySearchTextChanged=B;var G={idle:"idle",initLoading:"init",scrollLoading:"scroll",switchChat:"switch",sendMessage:"sendmsg",receiveMessage:"recvmsg",uninitialized:"uninit"};t.chatState=G;var Y={connecting:"connecting",loading:"loading",updating:"updating"};t.systemMessages=Y;var V={phonebookSearchText:"",phonebookOnlineOnlyFilter:!1,phonebookUsersFromFilter:"all",phonebookRegisteredOnlyFilter:!0,chatsFromFilter:"all",chatsSearchText:"",chats:{},chatHistoryLoader:!1,statusMessage:null,availableAppVersion:"1.2.788",showUpdateDialog:!1,locale:null,appInFocus:!0,authFetching:!1,showLoadingOverlay:!1,showUiAlert:!1,uiAlertType:null,uiAlertAppVersion:"1.2.788",prevLocation:null,nextLocation:null,showChatHistorySearch:!1,chatHistorySearchText:""};t.initialState=V;var W=(l={},c(l,F,function(e,t){return i({},e,{prevLocation:e.nextLocation,nextLocation:t.payload.pathname})}),c(l,h,function(e,t){return i({},e,{phonebookSearchText:t.payload})}),c(l,y,function(e,t){return i({},e,{phonebookOnlineOnlyFilter:t.payload})}),c(l,_,function(e,t){return i({},e,{phonebookRegisteredOnlyFilter:t.payload})}),c(l,b,function(e,t){return i({},e,{phonebookUsersFromFilter:t.payload})}),c(l,g,function(e,t){return i({},e,{chatsSearchText:t.payload})}),c(l,v,function(e,t){return i({},e,{chatsFromFilter:t.payload})}),c(l,E,function(e,t){return i({},e,{statusMessage:t.payload})}),c(l,S,function(e){return i({},e,{statusMessage:null})}),c(l,O,function(e,t){return i({},e,{availableAppVersion:t.payload,showUpdateDialog:!0})}),c(l,C,function(e){return i({},e,{showUpdateDialog:!1})}),c(l,w,function(e){return i({},e,{showUpdateDialog:!1})}),c(l,j,function(e,t){return i({},e,{locale:t.payload})}),c(l,k,function(e,t){var n=t.payload;return u(e,n.chatId,{scrollPosition:n.scrollPosition})}),c(l,P,function(e,t){return u(e,t.payload,{fullHistoryLoaded:!0})}),c(l,T,function(e,t){var n=(e.chats[t.payload.chatId]||{}).state||G.uninitialized;return u(e,t.payload.chatId,{prevState:n,state:t.payload.state})}),c(l,x,function(e,t){return t.payload.chatIds.reduce(function(e,n){var r=(e.chats[n]||{}).state||G.uninitialized,a=e.chats[n];return i({},e,{chats:i({},e.chats,c({},n,i({},a,{prevState:r,state:t.payload.state})))})},e)}),c(l,M,function(e,t){return i({},e,{appInFocus:t.payload})}),c(l,f.fetchChatListSuccess,function(e,t){var n=t.payload,a=Object.assign.apply(Object,r(n.map(function(t){var n=t.group_chat_id;return e.chats[n]?c({},n,e.chats[n]):c({},n,{prevState:G.uninitialized,state:G.uninitialized})})));return i({},e,{chats:a})}),c(l,N,function(e,t){return i({},e,{chatHistoryLoader:t.payload})}),c(l,A,function(e,t){return i({},e,{authFetching:t.payload})}),c(l,R,function(e){return i({},e,{showLoadingOverlay:!0})}),c(l,I,function(e){return i({},e,{showLoadingOverlay:!1})}),c(l,D,function(e,t){var n=t.payload;return i({},e,{showUiAlert:!0,uiAlertType:n.type,uiAlertAppVersion:n.version})}),c(l,H,function(e,t){var n=t.payload;return u(e,n.chatId,{firstVisibleMessageSyncId:n.firstVisibleMessageSyncId})}),c(l,K,function(e,t){return i({},e,{showChatHistorySearch:t.payload})}),c(l,B,function(e,t){return i({},e,{chatHistorySearchText:t.payload})}),l),q=(0,d.handleActions)(W,V);t.ui=q},"./app/modules/user.js":function(e,t,n){"use strict";function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){a(e,t,n[t])})}return e}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(t,"__esModule",{value:!0}),t.user=t.authStatusEnum=t.multideviceLogout=t.qrRegisterRequest=t.registeredOnOtherCts=t.registeredOnCts=t.resetAuth=t.resendConfirmationCode=t.setUserData=t.uploadProfile=t.regionChanged=t.settingsChanged=t.needCtsLogin=t.loggedOutCts=t.logoutCts=t.authStatusChanged=t.keysDecryptAttemptUsed=t.fetchSettingsSuccess=t.profileUploaded=t.fetchProfileSuccess=t.requestLogoutCtsSuccess=t.requestLogoutCts=t.loginCtsWebSuccess=t.loginCtsSuccess=t.loginCtsWeb=t.loginCts=t.checkUdidSuccess=t.logoutRtsSuccess=t.logoutRts=t.confirm=t.register=t.MULTIDEVICE_LOGOUT=t.QR_REGISTER_REQUEST=t.REGISTERED_ON_OTHER_CTS=t.REGISTERED_ON_CTS=t.RESET_AUTH=t.RESEND_CONFIRMATION_CODE=t.SET_USER_DATA=t.KEYS_DECRYPT_ATTEMPT_USED=t.PROFILE_UPLOADED=t.UPLOAD_PROFILE=t.REGION_CHANGED=t.SETTINGS_CHANGED=t.NEED_CTS_LOGIN=t.LOGGED_OUT_CTS=t.LOGOUT_CTS=t.REQUEST_LOGOUT_CTS_SUCCESS=t.REQUEST_LOGOUT_CTS=t.LOGIN_CTSWEB_SUCCESS=t.LOGIN_CTS_SUCCESS=t.LOGIN_CTSWEB=t.LOGIN_CTS=t.LOGOUT_RTS_SUCCESS=t.LOGOUT_RTS=t.CONFIRM=t.AUTH_STATUS_CHANGED=t.REGISTER=t.CHECK_UDID_SUCCESS=t.FETCH_SETTINGS_SUCCESS=t.FETCH_PROFILE_SUCCESS=void 0;var o,s=n("./node_modules/redux-actions/lib/index.js"),i=n("./lib/constants.js"),c=n("./app/modules/encryptionKeys.js"),u=function(e){return e&&e.__esModule?e:{default:e}}(n("./lib/config.js"));t.FETCH_PROFILE_SUCCESS="FETCH_PROFILE_SUCCESS";t.FETCH_SETTINGS_SUCCESS="FETCH_SETTINGS_SUCCESS";t.CHECK_UDID_SUCCESS="CHECK_UDID_SUCCESS";t.REGISTER="REGISTER";t.AUTH_STATUS_CHANGED="AUTH_STATUS_CHANGED";t.CONFIRM="CONFIRM";t.LOGOUT_RTS="LOGOUT_RTS";t.LOGOUT_RTS_SUCCESS="LOGOUT_RTS_SUCCESS";t.LOGIN_CTS="LOGIN_CTS";t.LOGIN_CTSWEB="LOGIN_CTSWEB";t.LOGIN_CTS_SUCCESS="LOGIN_CTS_SUCCESS";t.LOGIN_CTSWEB_SUCCESS="LOGIN_CTSWEB_SUCCESS";t.REQUEST_LOGOUT_CTS="REQUEST_LOGOUT_CTS";t.REQUEST_LOGOUT_CTS_SUCCESS="REQUEST_LOGOUT_CTS_SUCCESS";t.LOGOUT_CTS="LOGOUT_CTS";t.LOGGED_OUT_CTS="LOGGED_OUT_CTS";t.NEED_CTS_LOGIN="NEED_CTS_LOGIN";t.SETTINGS_CHANGED="SETTINGS_CHANGED";t.REGION_CHANGED="REGION_CHANGED";t.UPLOAD_PROFILE="UPLOAD_PROFILE";t.PROFILE_UPLOADED="PROFILE_UPLOADED";t.KEYS_DECRYPT_ATTEMPT_USED="KEYS_DECRYPT_ATTEMPT_USED";t.SET_USER_DATA="SET_USER_DATA";t.RESEND_CONFIRMATION_CODE="RESEND_CONFIRMATION_CODE";t.RESET_AUTH="RESET_AUTH";t.REGISTERED_ON_CTS="REGISTERED_ON_CTS";t.REGISTERED_ON_OTHER_CTS="REGISTERED_ON_OTHER_CTS";t.QR_REGISTER_REQUEST="QR_REGISTER_REQUEST";t.MULTIDEVICE_LOGOUT="MULTIDEVICE_LOGOUT";var l=(0,s.createAction)("REGISTER",function(e,t){return{host:e,phone:t}});t.register=l;var d=(0,s.createAction)("CONFIRM",function(e,t,n){return{host:e,code:t,forceCtsLogout:n}});t.confirm=d;var p=(0,s.createAction)("LOGOUT_RTS");t.logoutRts=p;var f=(0,s.createAction)("LOGOUT_RTS_SUCCESS");t.logoutRtsSuccess=f;var m=(0,s.createAction)("CHECK_UDID_SUCCESS",function(e){return e});t.checkUdidSuccess=m;var h=(0,s.createAction)("LOGIN_CTS",function(e,t,n,r){return{server:e,login:t,password:n,domain:r}});t.loginCts=h;var y=(0,s.createAction)("LOGIN_CTSWEB",function(e,t,n){return{server:e,login:t,password:n}});t.loginCtsWeb=y;var _=(0,s.createAction)("LOGIN_CTS_SUCCESS",function(e){return e});t.loginCtsSuccess=_;var b=(0,s.createAction)("LOGIN_CTSWEB_SUCCESS",function(e){return e});t.loginCtsWebSuccess=b;var v=(0,s.createAction)("REQUEST_LOGOUT_CTS");t.requestLogoutCts=v;var g=(0,s.createAction)("REQUEST_LOGOUT_CTS_SUCCESS",function(e){return e});t.requestLogoutCtsSuccess=g;var E=(0,s.createAction)("FETCH_PROFILE_SUCCESS",function(e){return e});t.fetchProfileSuccess=E;var S=(0,s.createAction)("PROFILE_UPLOADED",function(e){return e});t.profileUploaded=S;var O=(0,s.createAction)("FETCH_SETTINGS_SUCCESS",function(e){return e});t.fetchSettingsSuccess=O;var C=(0,s.createAction)("KEYS_DECRYPT_ATTEMPT_USED");t.keysDecryptAttemptUsed=C;var w=(0,s.createAction)("AUTH_STATUS_CHANGED",function(e,t){return{status:e,attrs:t}});t.authStatusChanged=w;var j=(0,s.createAction)("LOGOUT_CTS");t.logoutCts=j;var k=(0,s.createAction)("LOGGED_OUT_CTS");t.loggedOutCts=k;var P=(0,s.createAction)("NEED_CTS_LOGIN",function(e){return e});t.needCtsLogin=P;var T=(0,s.createAction)("SETTINGS_CHANGED",function(e){return e});t.settingsChanged=T;var x=(0,s.createAction)("REGION_CHANGED",function(e){return e});t.regionChanged=x;var M=(0,s.createAction)("UPLOAD_PROFILE",function(e,t){return{newName:e,newAvatar:t}});t.uploadProfile=M;var N=(0,s.createAction)("SET_USER_DATA",function(e){return e});t.setUserData=N;var A=(0,s.createAction)("RESEND_CONFIRMATION_CODE",function(e,t){return{host:e,phone:t}});t.resendConfirmationCode=A;var R=(0,s.createAction)("RESET_AUTH");t.resetAuth=R;var I=(0,s.createAction)("REGISTERED_ON_CTS");t.registeredOnCts=I;var D=(0,s.createAction)("REGISTERED_ON_OTHER_CTS");t.registeredOnOtherCts=D;var L=(0,s.createAction)("QR_REGISTER_REQUEST");t.qrRegisterRequest=L;var U=(0,s.createAction)("MULTIDEVICE_LOGOUT");t.multideviceLogout=U;var F={unregistered:"unregistered",confirm:"confirm",keysPassDecrypt:"keysPassDecrypt",emptyKeysPass:"emptyKeysPass",newKeysPass:"newKeysPass",profile:"profile",ctsRegular:"ctsRegular",ctsMultidevice:"ctsMultidevice",ctsRequestLogout:"ctsRequestLogout",ctsOffer:"ctsOffer",ctsForce:"ctsForce",registered:"registered",qrCode:"qrCode",qrMultidevice:"qrMultidevice"};t.authStatusEnum=F;var H={authStatus:F.qrCode,active:!1,authToken:void 0,expiresAt:void 0,huid:void 0,udid:void 0,name:void 0,avatar:void 0,phone:void 0,cacheTime:void 0,ctsAuthToken:void 0,ctsServer:void 0,ctsLogin:void 0,keysDecryptAttempts:i.PRIVATE_KEYS_DECRYPT_ATTEMPTS,keyId:void 0,corpAvatar:void 0,region:"ru",rtsHost:u.default.ctsWeb?void 0:u.default.regions.ru.host,registerTimestamp:null,ctsWeb:!0===u.default.ctsWeb,pushToken:void 0,rtsServerId:void 0,ctsServerId:void 0,confirmationLimitExceeded:!1,wasOnCts:!1,registrationId:void 0},K=(o={},a(o,m,function(e,t){return r({},e,{udid:t.payload})}),a(o,E,function(e,t){var n=t.payload||{},a=n.name,o=n.avatar,s=n.phone;return s?r({},e,{name:a,avatar:o,phone:s}):e}),a(o,S,function(e,t){var n=t.payload,a=n.name,o=n.avatar;return r({},e,{name:a||e.name,avatar:o||e.avatar})}),a(o,O,function(e,t){return r({},e,{cacheTime:t.payload.cache_time})}),a(o,_,function(e,t){var n=t.payload,a=n.token,o=n.server,s=n.login,i=n.corpAvatar;return r({},e,{ctsAuthToken:a,ctsServer:o,ctsServerId:n.ctsServerId,ctsLogin:s,corpAvatar:i})}),a(o,b,function(e,t){var n=t.payload,a=n.huid,o=n.token,s=n.ctsServerId,i=n.server,c=n.login,u=n.corpAvatar,l=n.keyId;return r({},e,{authStatus:F.registered,huid:a,ctsAuthToken:o,ctsServer:i,ctsServerId:s,ctsLogin:c,corpAvatar:u,keyId:l})}),a(o,g,function(e,t){return r({},e,{ctsAdminInfo:t.payload})}),a(o,j,function(e){return r({},e,{ctsAuthToken:void 0,ctsLogin:void 0,ctsServer:void 0,ctsServerId:void 0,ctsAdminInfo:void 0,corpAvatar:void 0})}),a(o,C,function(e){return r({},e,{keysDecryptAttempts:e.keysDecryptAttempts-1})}),a(o,c.userPublicKeyUploaded,function(e,t){return r({},e,{keyId:"rts"===t.payload.kind?t.payload.key.id:e.keyId})}),a(o,w,function(e,t){var n=t.payload,a=n.status;return r({},e,n.attrs,{authStatus:a})}),a(o,T,function(e,t){var n=t.payload;return r({},e,{cacheTime:n.cache_time||e.cacheTime,corpAvatar:n.corp_avatar||e.corpAvatar})}),a(o,x,function(e,t){var n=t.payload;return r({},e,{region:n,rtsHost:u.default.regions[n].host})}),a(o,N,function(e,t){return r({},e,t.payload)}),a(o,R,function(){return r({},H,{authStatus:F.unregistered})}),a(o,D,function(e){return r({},e,{ctsAuthToken:void 0,ctsLogin:void 0,ctsServer:void 0,ctsServerId:void 0,ctsAdminInfo:void 0,corpAvatar:void 0})}),o),B=(0,s.handleActions)(K,H);t.user=B},"./app/modules/voex.js":function(e,t,n){"use strict";function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){a(e,t,n[t])})}return e}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(t,"__esModule",{value:!0}),t.voex=t.callStatusEnum=t.callDelivered=t.setBusy=t.minimizeCall=t.unmuteMicrophone=t.muteMicrophone=t.callSessionStopped=t.callSessionStarted=t.callAnswerSent=t.connected=t.localStream=t.remoteStream=t.localIceCandidate=t.localSdp=t.callHangupReceived=t.callHangupSent=t.sendCallHangup=t.callAnswerReceived=t.sendCallAnswer=t.callOfferReceived=t.callOfferSent=t.sendCallOffer=t.CALL_DELIVERED=t.SET_BUSY=t.MINIMIZE_CALL=t.UNMUTE_MICROPHONE=t.MUTE_MICROPHONE=t.CALL_SESSION_STOPPED=t.CALL_SESSION_STARTED=t.CALL_ANSWER_SENT=t.CONNECTED=t.LOCAL_STREAM=t.REMOTE_STREAM=t.LOCAL_ICE_CANDIDATE=t.LOCAL_SDP=t.CALL_HANGUP_RECEIVED=t.CALL_HANGUP_SENT=t.SEND_CALL_HANGUP=t.CALL_ANSWER_RECEIVED=t.SEND_CALL_ANSWER=t.CALL_OFFER_RECEIVED=t.CALL_OFFER_SENT=t.SEND_CALL_OFFER=void 0;var o,s=n("./node_modules/redux-actions/lib/index.js"),i=function(e){return e&&e.__esModule?e:{default:e}}(n("./node_modules/moment/moment.js")),c=n("./app/helpers/messagesHelpers.js");t.SEND_CALL_OFFER="SEND_CALL_OFFER";t.CALL_OFFER_SENT="CALL_OFFER_SENT";t.CALL_OFFER_RECEIVED="CALL_OFFER_RECEIVED";t.SEND_CALL_ANSWER="SEND_CALL_ANSWER";t.CALL_ANSWER_RECEIVED="CALL_ANSWER_RECEIVED";t.SEND_CALL_HANGUP="SEND_CALL_HANGUP";t.CALL_HANGUP_SENT="CALL_HANGUP_SENT";t.CALL_HANGUP_RECEIVED="CALL_HANGUP_RECEIVED";t.LOCAL_SDP="LOCAL_SDP";t.LOCAL_ICE_CANDIDATE="LOCAL_ICE_CANDIDATE";t.REMOTE_STREAM="REMOTE_STREAM";t.LOCAL_STREAM="LOCAL_STREAM";t.CONNECTED="CONNECTED";t.CALL_ANSWER_SENT="CALL_ANSWER_SENT";t.CALL_SESSION_STARTED="CALL_SESSION_STARTED";t.CALL_SESSION_STOPPED="CALL_SESSION_STOPPED";t.MUTE_MICROPHONE="MUTE_MICROPHONE";t.UNMUTE_MICROPHONE="UNMUTE_MICROPHONE";t.MINIMIZE_CALL="MINIMIZE_CALL";t.SET_BUSY="SET_BUSY";t.CALL_DELIVERED="CALL_DELIVERED";var u=(0,s.createAction)("SEND_CALL_OFFER",function(e,t){return{huid:e,media:t}});t.sendCallOffer=u;var l=(0,s.createAction)("CALL_OFFER_SENT",function(e,t,n,r,a){return{chatId:e,media:t,callId:n,callOfferSender:r,offerConnType:a}});t.callOfferSent=l;var d=(0,s.createAction)("CALL_OFFER_RECEIVED",function(e,t,n,r,a,o){return{chatId:e,media:t,callId:n,offerSecret:r,offerConnType:a,callOfferSender:o}});t.callOfferReceived=d;var p=(0,s.createAction)("SEND_CALL_ANSWER");t.sendCallAnswer=p;var f=(0,s.createAction)("CALL_ANSWER_RECEIVED");t.callAnswerReceived=f;var m=(0,s.createAction)("SEND_CALL_HANGUP",function(e){return e});t.sendCallHangup=m;var h=(0,s.createAction)("CALL_HANGUP_SENT");t.callHangupSent=h;var y=(0,s.createAction)("CALL_HANGUP_RECEIVED",function(e){return(0,c.convertMessageTimestamps)(r({},e,{event_type:"voex",payload:r({},e.payload,{timestamp:(0,i.default)()})}))});t.callHangupReceived=y;var _=(0,s.createAction)("LOCAL_SDP",function(e){return e});t.localSdp=_;var b=(0,s.createAction)("LOCAL_ICE_CANDIDATE",function(e){return e});t.localIceCandidate=b;var v=(0,s.createAction)("REMOTE_STREAM",function(e){return e});t.remoteStream=v;var g=(0,s.createAction)("LOCAL_STREAM",function(e){return e});t.localStream=g;var E=(0,s.createAction)("CONNECTED");t.connected=E;var S=(0,s.createAction)("CALL_ANSWER_SENT",function(e){return e});t.callAnswerSent=S;var O=(0,s.createAction)("CALL_SESSION_STARTED",function(e,t,n){return{callId:e,offerSecret:t,connection:n}});t.callSessionStarted=O;var C=(0,s.createAction)("CALL_SESSION_STOPPED",function(e){return e});t.callSessionStopped=C;var w=(0,s.createAction)("MUTE_MICROPHONE");t.muteMicrophone=w;var j=(0,s.createAction)("UNMUTE_MICROPHONE");t.unmuteMicrophone=j;var k=(0,s.createAction)("MINIMIZE_CALL",function(e){return e});t.minimizeCall=k;var P=(0,s.createAction)("SET_BUSY",function(e){return e});t.setBusy=P;var T=(0,s.createAction)("CALL_DELIVERED");t.callDelivered=T;var x={idle:"idle",offer:"offer",answer:"answer",hangup:"hangup"};t.callStatusEnum=x;var M={chatId:void 0,status:x.idle,isIncomingCall:!1,localStream:void 0,remoteStream:void 0,media:void 0,callId:void 0,callOfferSender:void 0,offerSecret:void 0,offerConnType:void 0,startTime:void 0,isAnswered:!1,answerId:void 0,connection:void 0,minimized:!1,isBusy:!1,isCallDelivered:!1},N=(o={},a(o,l,function(e,t){var n=t.payload,a=n.chatId,o=n.media,s=n.callId,i=n.callOfferSender,c=n.offerConnType;return r({},e,{media:o,chatId:a,status:x.offer,isIncomingCall:!1,offerConnType:c,callId:s,callOfferSender:i})}),a(o,d,function(e,t){var n=t.payload,a=n.chatId,o=n.media,s=n.callId,i=n.offerSecret,c=n.offerConnType,u=n.callOfferSender;return r({},e,{media:o,chatId:a,status:x.offer,isIncomingCall:!0,callId:s,offerSecret:i,offerConnType:c,callOfferSender:u})}),a(o,T,function(e){return r({},e,{isCallDelivered:!0})}),a(o,f,function(e){return r({},e,{isAnswered:!0})}),a(o,p,function(e){return r({},e,{isAnswered:!0})}),a(o,S,function(e,t){return r({},e,{answerId:t.payload})}),a(o,E,function(e){return e.isAnswered?r({},e,{status:x.answer,startTime:(0,i.default)()}):e}),a(o,h,function(){return M}),a(o,y,function(e,t){return t.payload.payload.event.call_id!==e.callId?e:M}),a(o,v,function(e,t){return r({},e,{remoteStream:t.payload})}),a(o,g,function(e,t){return r({},e,{localStream:t.payload})}),a(o,O,function(e,t){var n=t.payload;return r({},e,{callId:n.callId,offerSecret:n.offerSecret,connection:n.connection})}),a(o,C,function(e,t){return t.payload!==e.callId?e:r({},e,{status:x.idle,callId:void 0,offerSecret:void 0,connection:void 0})}),a(o,k,function(e,t){return r({},e,{minimized:t.payload})}),a(o,P,function(e,t){return r({},e,{isBusy:t.payload})}),o),A=(0,s.handleActions)(N,M);t.voex=A},"./app/sagas/attachments.js":function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){o(e,t,n[t])})}return e}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e){var t,n,r,a,o,s,c,u,l,y,b,v,g;return regeneratorRuntime.wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return E.prev=0,t=e.payload,E.next=4,(0,d.select)(j);case 4:return n=E.sent,E.next=7,(0,d.select)(k);case 7:return r=E.sent,E.next=10,(0,d.select)(P);case 10:return a=E.sent,o=r.find(function(e){return e.group_chat_id===t}),s=(0,m.getUserConnection)(n,o),E.next=15,(0,d.call)(f.fetchChatFiles,s.host,s.token,t);case 15:if(c=E.sent,u=a.find(function(e){return e.chat_id===t}),l=u?u.files:[],y=(0,p.differenceBy)(c.files,l,"sync_id"),0===y.length){E.next=31;break}return E.next=22,(0,d.select)(T);case 22:return b=E.sent,E.next=25,(0,d.select)(x);case 25:return v=E.sent,g=(0,h.getAbsentMessageKeysIds)(y.map(function(e){return e.sync_id}),b,v),E.next=29,(0,d.fork)(i,t,y,s.host,g);case 29:E.next=33;break;case 31:return E.next=33,(0,d.put)(_.loadAttachmentsSuccess(t,[]));case 33:E.next=39;break;case 35:return E.prev=35,E.t0=E.catch(0),E.next=39,(0,d.put)({type:_.LOAD_ATTACHMENTS_FAILURE,payload:E.t0.message});case 39:case"end":return E.stop()}},E,this,[[0,35]])}function i(e,t,n,r){var a,o,s,i;return regeneratorRuntime.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(u.prev=0,!(null===r||void 0===r?void 0:r.length)){u.next=4;break}return u.next=4,(0,d.call)(b.fetchMessageKeysSaga,e,r);case 4:return u.next=6,(0,d.select)(T);case 6:return a=u.sent,u.next=9,(0,d.select)(x);case 9:return o=u.sent,u.next=12,(0,d.select)(M);case 12:return s=u.sent,u.next=15,t.map(function(e){var t=(0,h.getMessageKeyContainer)(a,o,e.sync_id),r=(0,h.decryptMessageSymmetricKey)(t,s);if(r)return(0,d.call)(c,e,r,n)});case 15:return i=u.sent,u.next=18,(0,d.put)(_.loadAttachmentsSuccess(e,(0,p.compact)(i)));case 18:u.next=23;break;case 20:u.prev=20,u.t0=u.catch(0),console.error("Error decrypt previews: ".concat(null===u.t0||void 0===u.t0?void 0:u.t0.message));case 23:case"end":return u.stop()}},S,this,[[0,20]])}function c(e,t,n){var r;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(e.preview_url){o.next=2;break}return o.abrupt("return",e);case 2:return o.next=4,(0,d.call)(y.runEncryptionTask,v.DECRYPT_FILE,v.DECRYPT_FILE_SUCCESS,{url:e.preview_url,host:n,symmetricKey:t,mimeType:e.mimetype,chunkSize:g.CHUNK_SIZE});case 4:return r=o.sent,o.abrupt("return",a({},e,{preview_url:r}));case 6:case"end":return o.stop()}},O,this)}function u(e){var t,n,r,a,o,s,i,c,u,l,p,f,m;return regeneratorRuntime.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.prev=0,t=e.payload,n=t.chatId,r=t.syncId,a=t.host,b.next=4,(0,d.select)(P);case 4:return o=b.sent,b.next=7,(0,d.select)(T);case 7:return s=b.sent,b.next=10,(0,d.select)(x);case 10:return i=b.sent,b.next=13,(0,d.select)(M);case 13:if(c=b.sent,u=o.find(function(e){return e.chat_id===n}),l=u.files.find(function(e){return e.sync_id===r}),p=(0,h.getMessageKeyContainer)(s,i,l.sync_id),!(f=(0,h.decryptMessageSymmetricKey)(p,c))){b.next=26;break}return b.next=21,(0,d.call)(y.runEncryptionTask,v.DECRYPT_FILE,v.DECRYPT_FILE_SUCCESS,{url:l.url,host:a,symmetricKey:f,mimeType:l.mimetype,chunkSize:g.CHUNK_SIZE});case 21:return m=b.sent,b.next=24,(0,d.put)(_.decryptAttachmentFileSuccess(n,r,m));case 24:b.next=28;break;case 26:return b.next=28,(0,d.put)({type:_.DECRYPT_ATTACHMENT_FILE_FAILURE,payload:"symmetric key error"});case 28:b.next=33;break;case 30:b.prev=30,b.t0=b.catch(0),console.error("Error decrypt attachment: ".concat(null===b.t0||void 0===b.t0?void 0:b.t0.message));case 33:case"end":return b.stop()}},C,this,[[0,30]])}function l(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,[(0,d.takeEvery)(_.LOAD_ATTACHMENTS,s),(0,d.takeEvery)(_.DECRYPT_ATTACHMENT_FILE,u)];case 2:case"end":return e.stop()}},w,this)}Object.defineProperty(t,"__esModule",{value:!0}),t.loadAttachmentsSaga=s,t.decryptAttachmentsPreviews=i,t.decryptAttachmentFileSaga=u,t.rootAttachmentsSaga=l,t.getEncryptionKeys=t.getMessageKeys=t.getMessages=t.getAttachments=t.getChats=t.getUser=void 0;var d=n("./node_modules/redux-saga/es/effects.js"),p=n("./node_modules/lodash/lodash.js"),f=r(n("./app/api/fileService.js")),m=n("./app/helpers/userHelpers.js"),h=n("./app/helpers/messagesHelpers.js"),y=n("./lib/encryptionTaskWrapper.js"),_=r(n("./app/modules/attachments.js")),b=n("./app/sagas/messageKeys.js"),v=r(n("./app/modules/messages.js")),g=n("./lib/constants.js"),E=regeneratorRuntime.mark(s),S=regeneratorRuntime.mark(i),O=regeneratorRuntime.mark(c),C=regeneratorRuntime.mark(u),w=regeneratorRuntime.mark(l),j=function(e){return e.user};t.getUser=j;var k=function(e){return e.chats};t.getChats=k;var P=function(e){return e.attachments};t.getAttachments=P;var T=function(e){return e.messages};t.getMessages=T;var x=function(e){return e.messageKeys};t.getMessageKeys=x;var M=function(e){return e.encryptionKeys};t.getEncryptionKeys=M},"./app/sagas/botx.js":function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}function a(e){var t,n,r,a,o,i,d,p;return regeneratorRuntime.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.prev=0,t=e.payload,n=t.message,r=t.data,a=void 0===r?{}:r,o=e.payload.action.command,i=n.payload.metadata.preview.id,d=a.text,p=(0,u.formatBoxCommand)(o,{id:i,text:d}),l.next=8,(0,s.put)(c.sendMessage(n.group_chat_id,"text",p));case 8:l.next=13;break;case 10:l.prev=10,l.t0=l.catch(0),console.error("handleBotxActionSaga error: ".concat(l.t0.message));case 13:case"end":return l.stop()}},l,this,[[0,10]])}function o(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,[(0,s.takeLatest)(i.HANDLE_BOTX_ACTION,a)];case 2:case"end":return e.stop()}},d,this)}Object.defineProperty(t,"__esModule",{value:!0}),t.handleBotxActionSaga=a,t.rootBotxSaga=o;var s=n("./node_modules/redux-saga/es/effects.js"),i=r(n("./app/modules/botx.js")),c=r(n("./app/modules/messages.js")),u=n("./app/helpers/botx.js"),l=regeneratorRuntime.mark(a),d=regeneratorRuntime.mark(o)},"./app/sagas/channels.js":function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){o(e,t,n[t])})}return e}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,[(0,_.fork)(i,e,"chat_created"),(0,_.fork)(i,e,"chat_updated"),(0,_.fork)(i,e,"cache_clean"),(0,_.fork)(i,e,"clean_all"),(0,_.fork)(i,e,"users_status_list"),(0,_.fork)(i,e,"user_status"),(0,_.fork)(i,e,"cts_logout"),(0,_.fork)(i,e,"settings_changed"),(0,_.fork)(i,e,"admin_added_to_chat"),(0,_.fork)(i,e,"added_to_chat"),(0,_.fork)(i,e,"deleted_from_chat"),(0,_.fork)(i,e,"left_from_chat"),(0,_.fork)(i,e,"phonebook_changed"),(0,_.fork)(i,e,"message_new"),(0,_.fork)(i,e,"message_new_report"),(0,_.fork)(i,e,"message_mark_read_report"),(0,_.fork)(i,e,"typing"),(0,_.fork)(i,e,"stop_typing"),(0,_.fork)(i,e,"chat_settings_changed"),(0,_.fork)(i,e,"kicked_by_cts_logout"),(0,_.fork)(i,e,"chat_name_changed"),(0,_.fork)(i,e,"chat_avatar_changed"),(0,_.fork)(i,e,"routing_changed"),(0,_.fork)(i,e,"app_event"),(0,_.fork)(i,e,"cts_login")];case 2:case"end":return t.stop()}},I,this)}function i(e,t){var n,r,o,s,i,u;return regeneratorRuntime.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,(0,_.call)(c,e,t);case 2:n=l.sent;case 3:return l.next=6,(0,_.take)(n);case 6:if(r=l.sent,R.default.push(R.networkStatsTypesEnum.socketEvents,r.type),o=["chat_created","chat_updated","cache_clean","left_from_chat","admin_added_to_chat","admin_deleted_from_chat","ignore_messages","settings_changed","added_to_chat","message_new","message_new_report","message_mark_read_report","chat_settings_changed","kicked_by_cts_logout","chat_name_changed","chat_avatar_changed","routing_changed","app_event"],!o.includes(r.type)){l.next=12;break}return l.next=12,(0,_.call)(f,e,"ack_event",{sync_id:r.payload.sync_id,event_type:r.type});case 12:l.t0=r.type,l.next="chat_created"===l.t0?15:"chat_updated"===l.t0?18:"message_new"===l.t0?21:"message_new_report"===l.t0?24:"message_mark_read_report"===l.t0?27:"cache_clean"===l.t0?30:"clean_all"===l.t0?33:"users_status_list"===l.t0?36:"user_status"===l.t0?39:"cts_logout"===l.t0?42:"settings_changed"===l.t0?45:"typing"===l.t0?48:"stop_typing"===l.t0?51:"admin_added_to_chat"===l.t0?54:"added_to_chat"===l.t0?54:"deleted_from_chat"===l.t0?54:"left_from_chat"===l.t0?54:"kicked_by_cts_logout"===l.t0?54:"chat_name_changed"===l.t0?54:"chat_avatar_changed"===l.t0?54:"routing_changed"===l.t0?54:"chat_settings_changed"===l.t0?57:"phonebook_changed"===l.t0?62:"app_event"===l.t0?65:"cts_login"===l.t0?70:73;break;case 15:return l.next=17,(0,_.fork)(v.chatCreatedSaga,r.payload);case 17:return l.abrupt("break",74);case 18:return l.next=20,(0,_.fork)(v.chatUpdatedSaga,r.payload);case 20:return l.abrupt("break",74);case 21:return l.next=23,(0,_.put)(C.receiveMessageNew(a({},r.payload,{connType:e.connType})));case 23:return l.abrupt("break",74);case 24:return l.next=26,(0,_.put)(C.receiveMessageNewReports(r.payload.payload));case 26:return l.abrupt("break",74);case 27:return l.next=29,(0,_.put)(C.receiveMessageMarkReadReports(r.payload.payload));case 29:return l.abrupt("break",74);case 30:return l.next=32,(0,_.put)(C.cleanCache());case 32:return l.abrupt("break",74);case 33:return l.next=35,(0,_.put)(w.logoutRts());case 35:return l.abrupt("break",74);case 36:return l.next=38,(0,_.put)(j.userStatusListFetchSuccess(r.payload.users_status_list));case 38:return l.abrupt("break",74);case 39:return l.next=41,(0,_.put)(j.userStatusFetchSuccess(r.payload));case 41:return l.abrupt("break",74);case 42:return l.next=44,(0,_.fork)(E.handleCtsLogout);case 44:return l.abrupt("break",74);case 45:return l.next=47,(0,_.put)(w.settingsChanged(r.payload.payload));case 47:return l.abrupt("break",74);case 48:return l.next=50,(0,_.put)(P.typingMemberAdded(r.payload));case 50:return l.abrupt("break",74);case 51:return l.next=53,(0,_.put)(P.typingMemberRemoved(r.payload));case 53:return l.abrupt("break",74);case 54:return l.next=56,(0,_.put)(C.addSystemEvent(a({},r.payload,{event_type:r.type,group_chat_id:r.payload.group_chat_id||r.payload.payload.group_chat_id,connType:e.connType,payload:(0,N.renameHuidToUserHuid)(r.payload.payload)})));case 56:return l.abrupt("break",74);case 57:return s=r.payload.group_chat_id,i=r.payload.payload.settings,l.next=61,(0,_.put)(k.chatSettingsChanged(s,i));case 61:return l.abrupt("break",74);case 62:return l.next=64,(0,_.fork)(O.fetchPhonebook,{connType:e.connType,forceProfileHuids:[r.payload.payload.user_huid]});case 64:return l.abrupt("break",74);case 65:if(u=["call_offer","call_answer","call_hangup","call_ice","call_sdp","call_busy","call_offer_received","call_already_answered"],!u.includes(r.payload.payload.event_type)){l.next=69;break}return l.next=69,(0,_.fork)(g.handleVoexEvent,a({},r.payload,{event_type:r.type}));case 69:return l.abrupt("break",74);case 70:return l.next=72,(0,_.fork)(E.handleCtsLogin,r.payload.payload.user_huid);case 72:case 73:return l.abrupt("break",74);case 74:l.next=3;break;case 76:case"end":return l.stop()}},D,this)}function c(e,t){return(0,b.eventChannel)(function(n){var r=function(e){n({type:t,payload:e})};return e.on(t,r),function(){e.off(t)}},b.buffers.expanding(10))}function u(e,t,n){var r,a;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(o.prev=0,e&&e.channels){o.next=3;break}return o.abrupt("return");case 3:if(r=e.channels.find(function(e){return e.topic===t}),!(null===r||void 0===r?void 0:r.joinedOnce)){o.next=6;break}return o.abrupt("return");case 6:return a=e.channel(t),a.connType=n,o.next=10,(0,_.call)(l,a);case 10:return o.next=12,(0,_.fork)(s,a);case 12:o.next=17;break;case 14:o.prev=14,o.t0=o.catch(0),Object({PRODUCTION:1,NODE_ENV:"production"}).TEST||console.error("joinChannelSaga error: ".concat(o.t0.message));case 17:case"end":return o.stop()}},L,this,[[0,14]])}function l(e){return new Promise(function(t,n){e.join().receive("ok",function(n){H.put(e),t(n);var r="system"===e.topic?"".concat(e.topic,":").concat(e.connType):e.topic;K.dispatchEvent("join",r)}).receive("error",function(e){return n(e)}).receive("timeout",function(){return n("channel ".concat(e.topic," timeout error"))})})}function d(e){try{e&&e.leave()}catch(t){console.error("Error leaving channel ".concat(null===t||void 0===t?void 0:t.message),e)}}function p(){var e,t,n,r,a,o,s;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=3,(0,_.take)(H);case 3:if(e=i.sent,!e.isJoined()||"system"!==e.topic){i.next=23;break}return i.next=7,(0,_.select)(B);case 7:return t=i.sent,i.next=10,(0,_.select)(G);case 10:if(n=i.sent,r=(0,x.matchChatId)(t),!W(n)){i.next=16;break}return a=r?[(0,_.fork)(v.syncChat,r),(0,_.put)(T.setChatFsmState(r,T.chatState.initLoading))]:(0,_.fork)(v.syncAllChats),i.next=16,a;case 16:return i.next=18,(0,_.fork)(O.fetchPhonebook,{connType:e.connType,timeout:1e4});case 18:return i.next=20,(0,_.select)(V);case 20:return o=i.sent,i.next=23,(0,_.put)(T.setSilentMode(o));case 23:if(!e.isJoined()||!e.topic.includes("groupchat")){i.next=30;break}return i.next=26,(0,_.select)(Y,(0,M.getChatId)(e.topic));case 26:if(s=i.sent,!(0,M.isUnhideNeeded)(s)){i.next=30;break}return i.next=30,(0,_.fork)(v.unhideChat,s.group_chat_id);case 30:i.next=0;break;case 32:case"end":return i.stop()}},U,this)}function f(e,t,n,r){return!(null===e||void 0===e||!e.isJoined())&&(R.default.push(R.networkStatsTypesEnum.socketCommands,t),new Promise(function(a){e.push(t,n).receive("ok",function(e){return a(e)}).receive("error",function(n){["chat_not_found"].includes(n.error)||console.error("channel ".concat(e.topic," ").concat(t," push error: ").concat(n.error)),a(!!r&&n)}).receive("timeout",function(){console.error("channel ".concat(e.topic," ").concat(t," push timeout error")),a(!!r&&{error:"timeout"})})}))}function m(e,t){var n="system"===e?"".concat(e,":").concat(t):"groupchat:".concat(t),r=q(e,t);return r?Promise.resolve(r):K.waitEventInfinite("join",n).then(function(){return q(e,t)})}function h(){K.cancelAllWaitEvents()}function y(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,[p()];case 2:case"end":return e.stop()}},F,this)}Object.defineProperty(t,"__esModule",{value:!0}),t.subscribeEvents=s,t.subscribeChannel=i,t.createSocketEventChannel=c,t.joinChannel=u,t.join=l,t.leaveChannel=d,t.watchJoinStatus=p,t.push=f,t.selectChannel=m,t.cancelAllSelectChannelPromises=h,t.rootChannelsSaga=y,t.getAppInFocus=t.getChat=t.getUser=t.getLocation=t.joinStatusChannel=void 0;var _=n("./node_modules/redux-saga/es/effects.js"),b=n("./node_modules/redux-saga/es/index.js"),v=n("./app/sagas/chats.js"),g=n("./app/sagas/voex.js"),E=n("./app/sagas/user.js"),S=n("./lib/sockets.js"),O=n("./app/sagas/phonebook.js"),C=r(n("./app/modules/messages.js")),w=r(n("./app/modules/user.js")),j=r(n("./app/modules/statuses.js")),k=r(n("./app/modules/chats.js")),P=r(n("./app/modules/membersTyping.js")),T=r(n("./app/modules/ui.js")),x=n("./app/helpers/routing.js"),M=n("./app/helpers/chatsHelpers.js"),N=n("./app/helpers/messagesHelpers.js"),A=function(e){return e&&e.__esModule?e:{default:e}}(n("./lib/dispatcher.js")),R=r(n("./lib/networkStats.js")),I=regeneratorRuntime.mark(s),D=regeneratorRuntime.mark(i),L=regeneratorRuntime.mark(u),U=regeneratorRuntime.mark(p),F=regeneratorRuntime.mark(y),H=(0,b.channel)();t.joinStatusChannel=H;var K=new A.default,B=function(e){return e.routing.location.pathname};t.getLocation=B;var G=function(e){return e.user};t.getUser=G;var Y=function(e,t){return e.chats.find(function(e){return e.group_chat_id===t})};t.getChat=Y;var V=function(e){return e.ui.appInFocus};t.getAppInFocus=V;var W=function(e){var t=(0,S.getSystemChannel)("rts"),n=(0,S.getSystemChannel)("cts");return e.ctsAuthToken?(null===t||void 0===t?void 0:t.isJoined())&&(null===n||void 0===n?void 0:n.isJoined()):null===t||void 0===t?void 0:t.isJoined()},q=function(e,t){return"system"===e?(0,S.getSystemChannel)(t):(0,S.getGroupChannel)(t)}},"./app/sagas/chats.js":function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}function a(e,t){return i(e)||s(e,t)||o()}function o(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function s(e,t){var n=[],r=!0,a=!1,o=void 0;try{for(var s,i=e[Symbol.iterator]();!(r=(s=i.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==i.return||i.return()}finally{if(a)throw o}}return n}function i(e){if(Array.isArray(e))return e}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){u(e,t,n[t])})}return e}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e){var t,n,r,a,o;return regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return n=c({},e.payload,{members:(0,H.renameHuidToUserHuid)(null===(t=e.payload)||void 0===t?void 0:t.members)}),s.prev=1,s.next=4,(0,R.call)(B.fetchMissingPublicKeys,n.keys);case 4:return s.next=6,(0,R.select)(Oe);case 6:return r=s.sent,a=(0,F.chatMemberConnType)(n,r),o=(0,G.getSocket)(a),s.next=11,(0,R.fork)(K.joinChannel,o,"groupchat:".concat(n.group_chat_id),a);case 11:return s.next=13,[(0,R.put)(q.chatCreated(n,a)),(0,R.fork)(W.fetchProfiles,n.members.map(function(e){return e.user_huid}),!0)];case 13:s.next=18;break;case 15:s.prev=15,s.t0=s.catch(1),Object({PRODUCTION:1,NODE_ENV:"production"}).TEST||console.error("chat created saga error: ".concat(s.t0.message));case 18:case"end":return s.stop()}},Z,this,[[1,15]])}function d(e){var t,n,r,a,o,s,i,u;return regeneratorRuntime.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return n=c({},e.payload,{members:(0,H.renameHuidToUserHuid)(null===(t=e.payload)||void 0===t?void 0:t.members)}),l.prev=1,l.next=4,(0,R.select)(we,n.group_chat_id);case 4:if(r=l.sent,(0,F.shouldChatUpdate)(r,n)||Object({PRODUCTION:1,NODE_ENV:"production"}).TEST){l.next=7;break}return l.abrupt("return");case 7:return l.next=9,(0,R.call)(B.fetchMissingPublicKeys,n.keys);case 9:return l.next=11,(0,R.select)(Oe);case 11:if(a=l.sent,o=(0,F.chatMemberConnType)(n,a),s=(0,G.getGroupChannel)(n.group_chat_id),(null===s||void 0===s?void 0:s.connType)===o){l.next=17;break}return l.next=17,(0,R.fork)(K.leaveChannel,s);case 17:return i=(0,G.getSocket)(o),l.next=20,(0,R.fork)(K.joinChannel,i,"groupchat:".concat(n.group_chat_id),o);case 20:return u=r?q.chatUpdated:q.chatCreated,l.next=23,[(0,R.put)(u(n,o)),(0,R.fork)(W.fetchProfiles,n.members.map(function(e){return e.user_huid}),!0)];case 23:l.next=28;break;case 25:l.prev=25,l.t0=l.catch(1),Object({PRODUCTION:1,NODE_ENV:"production"}).TEST||console.error("chat updated saga error: ".concat(l.t0.message));case 28:case"end":return l.stop()}},$,this,[[1,25]])}function p(e){var t,n,r,a,o;return regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,(0,R.put)(Q.showLoadingOverlay());case 3:return s.next=5,(0,R.select)(Oe);case 5:return n=s.sent,r=n.ctsAuthToken?"cts":"rts",a=(0,G.getSystemChannel)(r),s.next=10,(0,R.call)(K.push,a,"chat_new",c({},e,{members:e.members.concat(n.huid)}));case 10:return o=s.sent,s.abrupt("return",null===(t=o.chat_new)||void 0===t?void 0:t.payload);case 14:s.prev=14,s.t0=s.catch(0),Object({PRODUCTION:1,NODE_ENV:"production"}).TEST||console.error("createChatSaga error: ".concat(s.t0.message));case 17:return s.prev=17,s.next=20,(0,R.put)(Q.hideLoadingOverlay());case 20:return s.finish(17);case 21:return s.abrupt("return",null);case 22:case"end":return s.stop()}},ee,this,[[0,14,17,21]])}function f(e){var t,n,r;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if("chat"!==e.payload.chat_type){a.next=8;break}return a.next=3,(0,R.select)(Ce);case 3:if(t=a.sent,!(n=(0,F.findOneToOneChatByHuid)(t,e.payload.members[0]))){a.next=8;break}return Se.push("/chats/".concat(n.group_chat_id)),a.abrupt("return");case 8:return a.next=10,(0,R.call)(p,e.payload);case 10:if(!(r=a.sent)){a.next=15;break}Se.push("/chats/".concat(r.group_chat_id)),a.next=17;break;case 15:return a.next=17,(0,R.put)(X.showNotifier((0,U.formatMessage)(xe.create),"error"));case 17:case"end":return a.stop()}},te,this)}function m(e){var t,n,r,a,o,s,i;return regeneratorRuntime.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return t=e.payload,c.prev=1,c.next=4,(0,R.select)(we,t);case 4:return n=c.sent,c.next=7,(0,R.select)(Oe);case 7:return r=c.sent,a=(0,F.chatMemberConnType)(n,r),o=(0,G.getSystemChannel)(a),c.next=12,(0,R.call)(K.push,o,"chat_leave",{group_chat_id:t});case 12:if(s=c.sent,!s.chat_leave){c.next=22;break}return c.next=16,(0,R.put)(q.leaveChatSuccess(t));case 16:return i=(0,G.getGroupChannel)(t),c.next=19,(0,R.fork)(K.leaveChannel,i);case 19:Se.push("/chats/".concat(t)),c.next=24;break;case 22:return c.next=24,(0,R.put)(X.showNotifier((0,U.formatMessage)(xe.leave),"error"));case 24:c.next=29;break;case 26:c.prev=26,c.t0=c.catch(1),Object({PRODUCTION:1,NODE_ENV:"production"}).TEST||console.error("leaveChatSaga error: ".concat(c.t0.message));case 29:case"end":return c.stop()}},ne,this,[[1,26]])}function h(e){var t,n,r,a;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return t=e.payload,o.prev=1,o.next=4,(0,R.select)(Oe);case 4:if(n=o.sent,"deleted_from_chat"!==t.event_type||!t.payload.user_huid.includes(n.huid)){o.next=12;break}return r=t.group_chat_id,o.next=9,(0,R.put)(q.leaveChatSuccess(r));case 9:return a=(0,G.getGroupChannel)(r),o.next=12,(0,R.fork)(K.leaveChannel,a);case 12:o.next=17;break;case 14:o.prev=14,o.t0=o.catch(1),Object({PRODUCTION:1,NODE_ENV:"production"}).TEST||console.error("deletedFromChatSaga error: ".concat(o.t0&&o.t0.message));case 17:case"end":return o.stop()}},re,this,[[1,14]])}function y(e,t,n,r){var a,o,s,i,l,d,p,f,m;return regeneratorRuntime.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.prev=0,a=n||J.HISTORY_LIMIT,h.next=4,(0,R.select)(we,e);case 4:return o=h.sent,h.next=7,(0,R.select)(Oe);case 7:if(s=h.sent,i=o[t]||"forward"===t&&o.lastEvent,l=i?i.connType:(0,F.chatMemberConnType)(o,s),(d=ke(e,l))&&d.isJoined()){h.next=15;break}return h.next=14,[(0,R.put)(Q.setChatFsmState(e,Q.chatState.idle)),(0,R.put)(Q.setChatHistoryLoader(!1))];case 14:return h.abrupt("return");case 15:return h.next=17,[(0,R.put)(Q.setChatFsmState(e,r?Q.chatState.initLoading:Q.chatState.scrollLoading)),(0,R.put)(Q.setChatHistoryLoader(!0)),(0,R.put)(Q.showStatusMessage(Q.systemMessages.loading))];case 17:return p={limit:a,group_chat_id:e,direction:t},h.next=20,(0,R.call)(_,[],d,i?c({},p,{sync_id:i.sync_id}):p);case 20:if((f=h.sent)&&f.length){h.next=25;break}return h.next=24,[(0,R.put)(Q.setChatFsmState(e,Q.chatState.idle)),(0,R.put)(Q.setChatHistoryLoader(!1))];case 24:return h.abrupt("return");case 25:return m={connType:(0,D.last)(f).connType,sync_id:(0,D.last)(f).sync_id},h.next=28,[(0,R.put)(q.fetchHistorySuccess(e,u({},t,m))),(0,R.fork)(Y.decryptHistory,f)];case 28:h.next=35;break;case 30:return h.prev=30,h.t0=h.catch(0),Object({PRODUCTION:1,NODE_ENV:"production"}).TEST||console.error("fetch history saga error: ".concat(h.t0.message)),h.next=35,[(0,R.put)(Q.setChatFsmState(e,Q.chatState.idle)),(0,R.put)(Q.setChatHistoryLoader(!1))];case 35:return h.prev=35,h.next=38,(0,R.put)(Q.hideStatusMessage());case 38:return h.finish(35);case 39:case"end":return h.stop()}},ae,this,[[0,30,35,39]])}function _(e,t,n){var r,a,o,s,i,u,l,d,p,f,m,h,y;return regeneratorRuntime.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.prev=0,b.next=3,(0,R.call)(K.push,t,"events_history",n);case 3:if(a=b.sent,null===a||void 0===a?void 0:null===(r=a.history)||void 0===r?void 0:r.length){b.next=6;break}return b.abrupt("return",e);case 6:if(o=a.history.filter(function(e){return e.group_chat_id&&("routing_changed"!==e.event_type||e.sync_id!==n.sync_id)}).map(function(e){return(0,H.renameHuidToUserHuid)(e)}),s=o.find(function(e){return"routing_changed"===e.event_type})){b.next=10;break}return b.abrupt("return",e.concat(o.map(function(e){return c({},e,{connType:t.connType})})));case 10:return i=n.direction,u=n.group_chat_id,l=s.sync_id,b.next=14,(0,R.select)(Oe);case 14:return d=b.sent,p=(0,H.getRoutingChangedConnType)(s,i,d.huid),f=t.connType!==p&&(0,H.isRoutingChangedServerIdMatches)(s,i,d),m=o.filter(function(e){return"routing_changed"!==e.event_type||(0,H.isRoutingChangedDisplayable)(e,d.huid)}).map(function(e){return"routing_changed"!==e.event_type?c({},e,{connType:t.connType}):c({},e,{connType:t.connType,payload:c({},e.payload,{forward:e.payload.forward.filter(function(e){return e.user_huid===d.huid}),backward:null})})}),h=n.limit-m.length,y=f?ke(u,p)||t:t,b.next=22,(0,R.call)(_,e.concat(m),y,{sync_id:l,limit:h,group_chat_id:u,direction:i});case 22:return b.abrupt("return",b.sent);case 25:return b.prev=25,b.t0=b.catch(0),console.error("fetchHistoryEvents error: ".concat(b.t0.message)),b.abrupt("return",e);case 29:case"end":return b.stop()}},oe,this,[[0,25]])}function b(e){var t,n,r,o,s,i,c,u,l,d;return regeneratorRuntime.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.prev=0,p.next=3,(0,R.put)(Q.showStatusMessage(Q.systemMessages.updating));case 3:return p.next=5,(0,R.select)(Oe);case 5:return r=p.sent,o=r.authToken&&(0,G.getSystemChannel)("rts"),s=r.ctsAuthToken&&(0,G.getSystemChannel)("cts"),p.next=10,(0,R.call)(g,o,e);case 10:return i=p.sent,p.next=13,(0,R.call)(g,s,e);case 13:if(c=p.sent,n=[],t=(0,F.syncChatListPipepline)([i],"rts")(n),u=(0,F.syncChatListPipepline)([c],"cts")(t),l=a(u,1),d=l[0],!d){p.next=22;break}return p.next=18,[(0,R.fork)(B.fetchMissingPublicKeys,d.keys),(0,R.put)(q.fetchChatSuccess(d))];case 18:return p.next=20,[(0,R.fork)(S,i?[i]:[],o),(0,R.fork)(S,c?[c]:[],s)];case 20:return p.next=22,(0,R.fork)(W.fetchProfiles,(0,F.chatsMembersHuids)([d]));case 22:return p.next=24,(0,R.fork)(v,[e]);case 24:p.next=29;break;case 26:p.prev=26,p.t0=p.catch(0),console.error("syncChat error: ".concat(p.t0.message," ").concat(p.t0.stack));case 29:return p.prev=29,p.next=32,(0,R.put)(Q.hideStatusMessage());case 32:return p.finish(29);case 33:case"end":return p.stop()}},se,this,[[0,26,29,33]])}function v(e){var t,n,r,a,o,s,i,u,l,d,p;return regeneratorRuntime.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.prev=0,f.next=3,(0,R.put)(Q.showStatusMessage(Q.systemMessages.updating));case 3:return f.next=5,(0,R.select)(Oe);case 5:if(r=f.sent,a=r.authToken&&(0,G.getSystemChannel)("rts"),o=r.ctsAuthToken&&(0,G.getSystemChannel)("cts"),!(null===a||void 0===a?void 0:a.isJoined())){f.next=14;break}return f.next=11,(0,R.call)(E,a);case 11:f.t0=f.sent,f.next=15;break;case 14:f.t0=[];case 15:if(s=f.t0,!(null===o||void 0===o?void 0:o.isJoined())){f.next=22;break}return f.next=19,(0,R.call)(E,o);case 19:f.t1=f.sent,f.next=23;break;case 22:f.t1=[];case 23:if(i=f.t1,n=[],t=(0,F.syncChatListPipepline)(s,"rts")(n),u=(0,F.syncChatListPipepline)(i,"cts")(t),!((null===u||void 0===u?void 0:u.length)>0)){f.next=37;break}return f.next=28,(0,R.fork)(B.fetchMissingPublicKeys,(0,D.flatten)((0,D.map)(u,"keys")));case 28:if(l=u,!a){f.next=35;break}return f.next=32,(0,R.call)(K.push,a,"get_unread_counters",{group_chats:u.filter(function(t){return!(null===e||void 0===e?void 0:e.includes(t.group_chat_id))}).map(function(e){return e.group_chat_id})});case 32:d=f.sent,p=(null===d||void 0===d?void 0:d.unread_counters)||[],l=u.map(function(e){var t=p.find(function(t){return t.group_chat_id===e.group_chat_id});return c({},e,{unreadCounter:~~(null===t||void 0===t?void 0:t.counter)})});case 35:return f.next=37,[(0,R.put)(q.fetchChatListSuccess(l)),(0,R.fork)(W.fetchProfiles,(0,F.chatsMembersHuids)(l))];case 37:return f.next=39,[(0,R.fork)(S,s.filter(function(t){return!(null===e||void 0===e?void 0:e.includes(t.group_chat_id))}),a),(0,R.fork)(S,i.filter(function(t){return!(null===e||void 0===e?void 0:e.includes(t.group_chat_id))}),o)];case 39:f.next=44;break;case 41:f.prev=41,f.t2=f.catch(0),Object({PRODUCTION:1,NODE_ENV:"production"}).TEST||console.error("syncAllChats error: ".concat(f.t2.message," ").concat(f.t2.stack));case 44:return f.prev=44,f.next=47,(0,R.put)(Q.hideStatusMessage());case 47:return f.finish(44);case 48:case"end":return f.stop()}},ie,this,[[0,41,44,48]])}function g(e,t){var n;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,e&&e.isJoined){r.next=3;break}return r.abrupt("return",null);case 3:return r.next=5,(0,R.call)(K.push,e,"chat_info",{group_chat_id:t});case 5:if(n=r.sent,null===n||void 0===n?void 0:n.chat_info){r.next=8;break}return r.abrupt("return",null);case 8:return r.abrupt("return",c({},n.chat_info,{members:(0,H.renameHuidToUserHuid)(n.chat_info.members)}));case 11:return r.prev=11,r.t0=r.catch(0),Object({PRODUCTION:1,NODE_ENV:"production"}).TEST||console.error("fetchChat error: ".concat(r.t0.message," ").concat(r.t0.stack)),r.abrupt("return",null);case 15:case"end":return r.stop()}},ce,this,[[0,11]])}function E(e){var t;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,(0,R.call)(K.push,e,"chat_list");case 3:if(t=n.sent,null===t||void 0===t?void 0:t.chat_list){n.next=6;break}return n.abrupt("return",[]);case 6:return n.abrupt("return",t.chat_list.map(function(e){return c({},e,{members:(0,H.renameHuidToUserHuid)(e.members)})}));case 9:return n.prev=9,n.t0=n.catch(0),Object({PRODUCTION:1,NODE_ENV:"production"}).TEST||console.error("fetchList error: ".concat(n.t0.message," ").concat(n.t0.stack)),n.abrupt("return",[]);case 13:case"end":return n.stop()}},ue,this,[[0,9]])}function S(e,t){var n,r,a;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,n=e.filter(function(e){return e.active&&!e.left}),r=e.filter(function(e){return!e.active||e.left}),o.next=5,n.map(function(e){return(0,R.fork)(K.joinChannel,t.socket,"groupchat:".concat(e.group_chat_id),t.connType)});case 5:return a=r.map(function(e){return e.group_chat_id}),o.next=8,(0,R.put)(Q.setChatsFsmState(a,Q.chatState.initLoading));case 8:o.next=13;break;case 10:o.prev=10,o.t0=o.catch(0),Object({PRODUCTION:1,NODE_ENV:"production"}).TEST||console.error("joinChats error: ".concat(o.t0.message," ").concat(o.t0.stack));case 13:case"end":return o.stop()}},le,this,[[0,10]])}function O(e){var t,n,r,a;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return t=e.payload,n=t.chatId,r=t.settings,o.prev=1,o.next=4,(0,R.call)(K.selectChannel,"groupchat",n);case 4:return a=o.sent,o.next=7,(0,R.call)(K.push,a,"chat_settings_set",{settings:r});case 7:o.next=12;break;case 9:o.prev=9,o.t0=o.catch(1),Object({PRODUCTION:1,NODE_ENV:"production"}).TEST||console.error("setChatSettings error: ".concat(o.t0.message));case 12:case"end":return o.stop()}},de,this,[[1,9]])}function C(e){var t,n,r,a;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return t=e.payload,n=t.payload,r=t.connType,o.prev=1,a=(0,G.getSystemChannel)(r),o.next=5,(0,R.call)(K.push,a,"chat_info_update",n);case 5:o.next=10;break;case 7:o.prev=7,o.t0=o.catch(1),Object({PRODUCTION:1,NODE_ENV:"production"}).TEST||console.error("Update chat error: ".concat(o.t0.message),e);case 10:case"end":return o.stop()}},pe,this,[[1,7]])}function w(e){var t,n,r,a,o;return regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return t=e.payload,n=t.chatId,r=t.connType,s.prev=1,a=(0,G.getSystemChannel)(r),s.next=5,(0,R.call)(K.push,a,"chat_info",{group_chat_id:n});case 5:if(o=s.sent,!(null===o||void 0===o?void 0:o.chat_info)){s.next=9;break}return s.next=9,(0,R.put)(q.chatInfoSuccess(o.chat_info));case 9:s.next=14;break;case 11:s.prev=11,s.t0=s.catch(1),Object({PRODUCTION:1,NODE_ENV:"production"}).TEST||console.error("Update chat error: ".concat(s.t0.message),e);case 14:case"end":return s.stop()}},fe,this,[[1,11]])}function j(e){var t,n,r,a;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return t=e.payload,n=t.payload,r=t.connType,o.prev=1,a=(0,G.getSystemChannel)(r),o.next=5,(0,R.call)(V.push,"chat_remove_user",{channel:a,payload:n});case 5:o.next=10;break;case 7:o.prev=7,o.t0=o.catch(1),Object({PRODUCTION:1,NODE_ENV:"production"}).TEST||console.error("Remove user error: ".concat(o.t0.message),e);case 10:case"end":return o.stop()}},me,this,[[1,7]])}function k(e){var t,n,r,a;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return t=e.payload,n=t.payload,r=t.connType,o.prev=1,a=(0,G.getSystemChannel)(r),o.next=5,(0,R.call)(V.push,"chat_add_user",{channel:a,payload:n});case 5:o.next=10;break;case 7:o.prev=7,o.t0=o.catch(1),Object({PRODUCTION:1,NODE_ENV:"production"}).TEST||console.error("Add user error: ".concat(o.t0.message),e);case 10:case"end":return o.stop()}},he,this,[[1,7]])}function P(e){var t,n,r,a;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return t=e.payload,n=t.payload,r=t.connType,o.prev=1,a=(0,G.getSystemChannel)(r),o.next=5,(0,R.call)(V.push,"chat_add_admin",{channel:a,payload:n});case 5:o.next=10;break;case 7:o.prev=7,o.t0=o.catch(1),Object({PRODUCTION:1,NODE_ENV:"production"}).TEST||console.error("Add admin error: ".concat(o.t0.message),e);case 10:case"end":return o.stop()}},ye,this,[[1,7]])}function T(e){var t,n;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(t=e.payload,r.prev=1,!(n=(0,G.getGroupChannel)(t))){r.next=6;break}return r.next=6,(0,R.call)(V.push,"clean_badge",{channel:n});case 6:r.next=11;break;case 8:r.prev=8,r.t0=r.catch(1),Object({PRODUCTION:1,NODE_ENV:"production"}).TEST||console.error("cleanBadgeSaga error: ".concat(r.t0.message));case 11:case"end":return r.stop()}},_e,this,[[1,8]])}function x(e){var t,n,r;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,(0,R.select)(we,e);case 3:if((t=a.sent)&&t.chat_settings.hidden){a.next=6;break}return a.abrupt("return");case 6:return a.next=8,(0,R.select)(Oe);case 8:return n=a.sent,r=(0,G.getSystemChannel)((0,F.chatMemberConnType)(t,n)),a.next=12,(0,R.call)(V.push,"unhide_chat",{channel:r,payload:{group_chat_id:e}});case 12:a.next=17;break;case 14:a.prev=14,a.t0=a.catch(0),Object({PRODUCTION:1,NODE_ENV:"production"}).TEST||console.error("unhideChat error: ".concat(a.t0.message));case 17:case"end":return a.stop()}},be,this,[[0,14]])}function M(e){var t,n,r;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(t=e.group_chat_id,n=e.sync_id,a.prev=1,r=(0,G.getGroupChannel)(t)){a.next=5;break}return a.abrupt("return");case 5:return a.next=7,(0,R.call)(V.push,"chat_position_report",{channel:r,payload:{position_event_sync_id:n}});case 7:a.next=12;break;case 9:a.prev=9,a.t0=a.catch(1),console.error("pushChatPositionReport error: ".concat(a.t0.message));case 12:case"end":return a.stop()}},ve,this,[[1,9]])}function N(e){var t,n,r,a,o,s,i,c,u,l,d,p,f,m,h,_,b,v;return regeneratorRuntime.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return t=e.payload,n=t.chatId,r=t.initialLoad,g.prev=1,g.next=4,(0,R.select)(Pe,n);case 4:return a=g.sent,g.next=7,(0,R.select)(Te,n)||{};case 7:return o=g.sent,s=o.firstVisibleMessageSyncId,g.next=11,(0,R.select)(we,n);case 11:if(i=g.sent,c=i||{},u=c.unreadCounter,l=c.backward,!r||i){g.next=15;break}return g.abrupt("return");case 15:if(!((d=(0,H.getMessageIndexBySyncId)(a,s))>0)){g.next=21;break}return p=d<J.MAX_VISIBLE_MESSAGES?0:d-J.MAX_VISIBLE_MESSAGES,g.next=20,(0,R.put)(Q.setChatFirstVisibleMessage(n,a[p].sync_id));case 20:return g.abrupt("return");case 21:return f=u>J.HISTORY_LIMIT?u+J.UNREAD_AFOREGOING_NUMBER:J.HISTORY_LIMIT,m=r&&l?"forward":"backward",g.next=25,(0,R.call)(y,n,m,r&&f,r);case 25:return g.next=27,(0,R.select)(Te,n)||{};case 27:if(h=g.sent,"bottom"===(_=h.scrollPosition)){g.next=35;break}return g.next=32,(0,R.select)(Pe,n);case 32:return v=g.sent,g.next=35,(0,R.put)(Q.setChatFirstVisibleMessage(n,null===(b=v[0])||void 0===b?void 0:b.sync_id));case 35:g.next=40;break;case 37:g.prev=37,g.t0=g.catch(1),console.error("loadHistoryBackwardSaga error: ".concat(g.t0.message));case 40:case"end":return g.stop()}},ge,this,[[1,37]])}function A(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,[(0,R.takeLatest)(q.CREATE_CHAT,f),(0,R.takeLatest)(q.LEAVE_CHAT,m),(0,R.takeEvery)(z.ADD_SYSTEM_EVENT,h),(0,R.takeEvery)(q.SET_CHAT_SETTINGS,O),(0,R.takeEvery)(q.UPDATE_CHAT,C),(0,R.takeEvery)(q.REMOVE_USER,j),(0,R.takeEvery)(q.ADD_USER,k),(0,R.takeEvery)(q.ADD_ADMIN,P),(0,R.takeEvery)(q.CLEAN_BADGE,T),(0,R.takeEvery)(q.CHAT_INFO,w),(0,R.takeEvery)(q.LOAD_HISTORY_BACKWARD,N)];case 2:case"end":return e.stop()}},Ee,this)}Object.defineProperty(t,"__esModule",{value:!0}),t.chatCreatedSaga=l,t.chatUpdatedSaga=d,t.createChat=p,t.createChatSaga=f,t.leaveChatSaga=m,t.deletedFromChatSaga=h,t.fetchHistory=y,t.fetchHistoryEvents=_,t.syncChat=b,t.syncAllChats=v,t.fetchChat=g,t.fetchList=E,t.joinChats=S,t.updateChatSaga=C,t.chatInfoSaga=w,t.removeUserSaga=j,t.addUserSaga=k,t.addAdminSaga=P,t.cleanBadgeSaga=T,t.unhideChat=x,t.pushChatPositionReport=M,t.loadHistoryBackwardSaga=N,t.rootChatsSaga=A,t.getChatUi=t.getChatMessages=t.selectHistoryChannel=t.getEncryptionKeys=t.getChat=t.getChats=t.getUser=void 0;var R=n("./node_modules/redux-saga/es/effects.js"),I=function(e){return e&&e.__esModule?e:{default:e}}(n("./node_modules/history/createHashHistory.js")),D=n("./node_modules/lodash/lodash.js"),L=n("./node_modules/react-intl/lib/index.es.js"),U=n("./lib/reactIntl.js"),F=n("./app/helpers/chatsHelpers.js"),H=n("./app/helpers/messagesHelpers.js"),K=n("./app/sagas/channels.js"),B=n("./app/sagas/encryptionKeys.js"),G=n("./lib/sockets.js"),Y=n("./app/sagas/messages.js"),V=n("./app/sagas/eventsQueue.js"),W=n("./app/sagas/profiles.js"),q=r(n("./app/modules/chats.js")),z=r(n("./app/modules/messages.js")),Q=r(n("./app/modules/ui.js")),X=r(n("./app/modules/notifiers.js")),J=n("./lib/constants.js"),Z=regeneratorRuntime.mark(l),$=regeneratorRuntime.mark(d),ee=regeneratorRuntime.mark(p),te=regeneratorRuntime.mark(f),ne=regeneratorRuntime.mark(m),re=regeneratorRuntime.mark(h),ae=regeneratorRuntime.mark(y),oe=regeneratorRuntime.mark(_),se=regeneratorRuntime.mark(b),ie=regeneratorRuntime.mark(v),ce=regeneratorRuntime.mark(g),ue=regeneratorRuntime.mark(E),le=regeneratorRuntime.mark(S),de=regeneratorRuntime.mark(O),pe=regeneratorRuntime.mark(C),fe=regeneratorRuntime.mark(w),me=regeneratorRuntime.mark(j),he=regeneratorRuntime.mark(k),ye=regeneratorRuntime.mark(P),_e=regeneratorRuntime.mark(T),be=regeneratorRuntime.mark(x),ve=regeneratorRuntime.mark(M),ge=regeneratorRuntime.mark(N),Ee=regeneratorRuntime.mark(A),Se=(0,I.default)(),Oe=function(e){return e.user};t.getUser=Oe;var Ce=function(e){return e.chats};t.getChats=Ce;var we=function(e,t){return e.chats.find(function(e){return e.group_chat_id===t})};t.getChat=we;var je=function(e){return e.encryptionKeys};t.getEncryptionKeys=je;var ke=function(e,t){var n=(0,G.getGroupChannel)(e);return(null===n||void 0===n?void 0:n.isJoined())&&n.connType===t?n:(0,G.getSystemChannel)(t)||(0,G.getSystemChannel)("rts")};t.selectHistoryChannel=ke;var Pe=function(e,t){var n=e.messages.filter(function(e){return e.group_chat_id===t});return(0,D.orderBy)(n,"inserted_at","asc")};t.getChatMessages=Pe;var Te=function(e,t){return e.ui.chats[t]};t.getChatUi=Te;var xe=(0,L.defineMessages)({create:{id:"[chat error] create",defaultMessage:"Create chat error"},leave:{id:"[chat error] leave",defaultMessage:"Error while leaving chat"}})},"./app/sagas/drafts.js":function(e,t,n){"use strict";function r(e){var t,n;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return t=e.chatId,n=e.text,r.prev=1,r.next=4,(0,i.call)(c.delay,1e3);case 4:return r.next=6,(0,i.put)(u.draftMessageChanged(t,n));case 6:r.next=11;break;case 8:r.prev=8,r.t0=r.catch(1),console.error("changeDraftMessage error: ".concat(r.t0.message));case 11:case"end":return r.stop()}},d,this,[[1,8]])}function a(){var e,t,n,a;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=3,(0,i.take)(u.CHANGE_DRAFT_MESSAGE);case 3:if(n=o.sent,a=n.payload,!e||t!==a.chatId){o.next=8;break}return o.next=8,(0,i.cancel)(e);case 8:return o.next=10,(0,i.fork)(r,a);case 10:e=o.sent,t=a.chatId,o.next=0;break;case 14:case"end":return o.stop()}},p,this)}function o(){var e;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,(0,i.select)(h);case 3:e=t.sent,(0,l.saveStateData)({drafts:e}),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),console.error("flushDraftsToDiskSaga error: ".concat(t.t0.message));case 10:case"end":return t.stop()}},f,this,[[0,7]])}function s(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,[a(),(0,i.takeEvery)(u.DRAFT_MESSAGE_CHANGED,o)];case 2:case"end":return e.stop()}},m,this)}Object.defineProperty(t,"__esModule",{value:!0}),t.changeDraftMessage=r,t.watchDrafts=a,t.flushDraftsToDiskSaga=o,t.rootDraftsSaga=s,t.getDrafts=void 0;var i=n("./node_modules/redux-saga/es/effects.js"),c=n("./node_modules/redux-saga/es/index.js"),u=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./app/modules/drafts.js")),l=n("./lib/indexedDb.js"),d=regeneratorRuntime.mark(r),p=regeneratorRuntime.mark(a),f=regeneratorRuntime.mark(o),m=regeneratorRuntime.mark(s),h=function(e){return e.drafts};t.getDrafts=h},"./app/sagas/encryptionKeys.js":function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){o(e,t,n[t])})}return e}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(){var e,t,n,r;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,(0,y.select)(A);case 3:return e=a.sent,a.next=6,(0,y.select)(R);case 6:if(t=a.sent,n=t.user.publicKeys.cts){a.next=10;break}return a.abrupt("return");case 10:return a.next=12,(0,y.call)(b.uploadUserPublicKey,e.huid,n.body,n.kind,n.algo,n.id,e.ctsServer,e.ctsAuthToken);case 12:if(r=a.sent,"ok"!==r.status){a.next=16;break}return a.next=16,(0,y.put)({type:E.UPLOAD_CTS_PUBLIC_KEY_SUCCESS});case 16:a.next=22;break;case 18:return a.prev=18,a.t0=a.catch(0),a.next=22,(0,y.put)({type:E.UPLOAD_CTS_PUBLIC_KEY_FAILURE});case 22:case"end":return a.stop()}},O,this,[[0,18]])}function i(e){var t,n,r,a,o,s;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,(0,y.select)(I);case 3:return t=i.sent,i.next=6,(0,y.select)(A);case 6:if(n=i.sent,r=n.rtsHost,a=n.authToken,o=(0,_.uniq)((0,_.difference)((0,_.compact)(e),(0,_.map)(t,"id"))),o.length){i.next=12;break}return i.abrupt("return");case 12:if(!(o.length>0)){i.next=21;break}return i.next=15,(0,y.call)(b.fetchPublicKeysByIds,r,o.splice(0,50),a);case 15:if(s=i.sent,"ok"!==s.status){i.next=19;break}return i.next=19,(0,y.put)(E.fetchPublicKeysSuccess(s.result));case 19:i.next=12;break;case 21:i.next=26;break;case 23:i.prev=23,i.t0=i.catch(0),Object({PRODUCTION:1,NODE_ENV:"production"}).TEST||console.error("fetchMissingPublicKeys error: ".concat(i.t0.message));case 26:case"end":return i.stop()}},C,this,[[0,23]])}function c(e,t,n,r){var a,o,s,i,c;return regeneratorRuntime.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.prev=0,u.next=3,(0,y.call)(b.fetchUserPublicKeys,e,n,r,t);case 3:if(a=u.sent,"ok"!==a.status){u.next=18;break}return o=(0,_.find)(a.result,function(e){return"rts"===e.kind}),s=(0,_.find)(a.result,function(e){return"cts"===e.kind}),u.next=9,(0,y.call)(b.fetchPrivateKeyByPubId,e,t,o.id,"rts");case 9:if(i=u.sent,"ok"!==i.status){u.next=18;break}return u.next=13,(0,y.call)(b.fetchPrivateKeyByPubId,e,t,s.id,"rts");case 13:if(c=u.sent,"ok"!==c.status){u.next=18;break}return u.next=17,[(0,y.put)(E.userPublicKeyFetched(o,"rts")),(0,y.put)(E.userPublicKeyFetched(s,"cts")),(0,y.put)(E.userPrivateKeyFetched(i.result,"rts")),(0,y.put)(E.userPrivateKeyFetched(c.result,"cts"))];case 17:return u.abrupt("return","ok");case 18:return u.abrupt("return",!1);case 21:return u.prev=21,u.t0=u.catch(0),Object({PRODUCTION:1,NODE_ENV:"production"}).TEST||console.error("fetch user keys error: ".concat(u.t0.message)),u.abrupt("return",!1);case 25:case"end":return u.stop()}},w,this,[[0,21]])}function u(e){var t,n,r,o,s,i,c,u,l,d,p,f,m;return regeneratorRuntime.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return t=e.payload,h.prev=1,h.next=4,(0,y.put)(g.setAuthFetching(!0));case 4:return h.next=6,(0,y.select)(A);case 6:return n=h.sent,r=n.authToken,o=n.huid,s=n.rtsHost,i=(0,S.generateRtsCtsKeyPairs)(),c=(0,S.encryptPrivateKey)(i.rts.privateKey,t),u=(0,S.encryptPrivateKey)(i.cts.privateKey,t),h.next=15,(0,y.call)(b.uploadUserPublicKeys,s,r,o,(0,S.toBase64)(i.rts.publicKey),(0,S.toBase64)(i.cts.publicKey),"xsalsa20");case 15:if(l=h.sent,"ok"===l.status){h.next=18;break}return h.abrupt("return");case 18:return d=(0,_.find)(l.result,function(e){return"rts"===e.kind}),p=(0,_.find)(l.result,function(e){return"cts"===e.kind}),h.next=22,(0,y.call)(b.uploadPrivateKey,s,r,(0,S.toBase64)(c),"rts",d.id,"xsalsa20","rts");case 22:if(f=h.sent,"ok"===f.status){h.next=25;break}return h.abrupt("return");case 25:return h.next=27,(0,y.call)(b.uploadPrivateKey,s,r,(0,S.toBase64)(u),"cts",p.id,"xsalsa20","rts");case 27:if(m=h.sent,"ok"===m.status){h.next=30;break}return h.abrupt("return");case 30:return h.next=32,(0,y.put)(E.userPublicKeyUploaded(a({},d,{body:i.rts.publicKey}),"rts"));case 32:return h.next=34,(0,y.put)(E.userPublicKeyUploaded(a({},p,{body:i.cts.publicKey}),"cts"));case 34:return h.next=36,(0,y.put)(E.userPrivateKeyUploaded(a({},f.result,{body:i.rts.privateKey}),"rts"));case 36:return h.next=38,(0,y.put)(E.userPrivateKeyUploaded(a({},m.result,{body:i.cts.privateKey}),"cts"));case 38:h.next=43;break;case 40:h.prev=40,h.t0=h.catch(1),Object({PRODUCTION:1,NODE_ENV:"production"}).TEST||console.error("Upload user keys error: ".concat(h.t0.message));case 43:return h.prev=43,h.next=46,(0,y.put)(g.setAuthFetching(!1));case 46:return h.finish(43);case 47:case"end":return h.stop()}},j,this,[[1,40,43,47]])}function l(e){var t,n,r,a;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return t=e.payload,o.prev=1,o.next=4,(0,y.select)(R);case 4:if(n=o.sent,r=(0,S.decryptPrivateKey)((0,S.fromBase64)(n.user.privateKeys.rts.body),t),a=(0,S.decryptPrivateKey)((0,S.fromBase64)(n.user.privateKeys.cts.body),t),!r.byteLength||!a.byteLength){o.next=12;break}return o.next=10,(0,y.put)(E.userPrivateKeysDecrypted(r,a));case 10:o.next=14;break;case 12:return o.next=14,(0,y.put)(v.keysDecryptAttemptUsed());case 14:o.next=21;break;case 16:return o.prev=16,o.t0=o.catch(1),o.next=20,(0,y.put)(v.keysDecryptAttemptUsed());case 20:Object({PRODUCTION:1,NODE_ENV:"production"}).TEST||console.error("Decrypt user private keys error: ".concat(o.t0.message));case 21:case"end":return o.stop()}},k,this,[[1,16]])}function d(e,t,n){var r,a,o;return regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,(0,y.call)(b.fetchUserPublicKeys,e,t,"cts",n);case 3:if((r=s.sent)&&"error"!==r.status){s.next=6;break}return s.abrupt("return",r);case 6:if(a=r.result.find(function(e){return"ctsweb"===e.kind})){s.next=9;break}return s.abrupt("return",!1);case 9:return s.next=11,(0,y.call)(b.fetchPrivateKeyByPubId,e,n,a.id,"cts");case 11:if((o=s.sent)&&"error"!==o.status){s.next=14;break}return s.abrupt("return",o);case 14:return s.next=16,[(0,y.put)(E.userPublicKeyFetched(a,"cts")),(0,y.put)(E.userPrivateKeyFetched(o.result,"cts"))];case 16:return s.abrupt("return",{status:"ok"});case 19:return s.prev=19,s.t0=s.catch(0),console.error("fetchCtsWebKeys error: ".concat(s.t0.message)),s.abrupt("return",!1);case 23:case"end":return s.stop()}},P,this,[[0,19]])}function p(e,t,n){var r,o,s;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,r=(0,S.generateRtsCtsKeyPairs)(),i.next=4,(0,y.call)(b.uploadUserPublicKey,t,(0,S.toBase64)(r.cts.publicKey),"ctsweb","xsalsa20",null,e,n);case 4:if((o=i.sent)&&"error"!==o.status){i.next=7;break}return i.abrupt("return",o);case 7:return i.next=9,(0,y.call)(b.uploadPrivateKey,e,n,(0,S.toBase64)(r.cts.privateKey),"ctsweb",o.result.id,"xsalsa20","cts");case 9:if((s=i.sent)&&"error"!==s.status){i.next=12;break}return i.abrupt("return",s);case 12:return i.next=14,[(0,y.put)(E.userPublicKeyUploaded(a({},o.result,{body:r.cts.publicKey}),"cts")),(0,y.put)(E.userPrivateKeyUploaded(a({},s.result,{body:r.cts.privateKey}),"cts"))];case 14:return i.abrupt("return",{status:"ok"});case 17:return i.prev=17,i.t0=i.catch(0),console.error("uploadCtsWebKeys error: ".concat(i.t0.message)),i.abrupt("return",!1);case 21:case"end":return i.stop()}},T,this,[[0,17]])}function f(e){var t,n,r,a,o;return regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,(0,y.select)(A);case 3:return t=s.sent,n=(null===e||void 0===e?void 0:e.payload)||t,r=n.rtsHost,a=n.ctsServer,s.next=7,(0,y.all)({rts:(0,y.call)(b.fetchServerPublicKey,r),cts:a&&(0,y.call)(b.fetchServerPublicKey,a)});case 7:return o=s.sent,s.next=10,(0,y.put)(E.setServerPublicKeys(o));case 10:s.next=15;break;case 12:s.prev=12,s.t0=s.catch(0),console.error("loadServerPublicKeysSaga error: ".concat(s.t0.message));case 15:case"end":return s.stop()}},x,this,[[0,12]])}function m(e){var t,n,r,a,o,s,i,c;return regeneratorRuntime.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(t=e.rts_pub_key_id,n=e.rts_priv_key_id,r=e.rts_pub_key_body,a=e.rts_priv_key_body,o=e.cts_pub_key_id,s=e.cts_priv_key_id,i=e.cts_pub_key_body,c=e.cts_priv_key_body,u.prev=1,!t){u.next=5;break}return u.next=5,(0,y.put)(E.userPublicKeyFetched({id:t,kind:"rts",body:r},"rts"));case 5:if(!t){u.next=8;break}return u.next=8,(0,y.put)(E.userPrivateKeyFetched({id:n,kind:"rts",body:a,public_key_id:t},"rts"));case 8:if(!o){u.next=11;break}return u.next=11,(0,y.put)(E.userPublicKeyFetched({id:o,kind:"cts",body:i},"cts"));case 11:if(!o){u.next=14;break}return u.next=14,(0,y.put)(E.userPrivateKeyFetched({id:s,kind:"cts",body:c,public_key_id:o},"cts"));case 14:u.next=19;break;case 16:u.prev=16,u.t0=u.catch(1),Object({PRODUCTION:1,NODE_ENV:"production"}).TEST||console.error("saveUserKeys error: ".concat(u.t0.message));case 19:case"end":return u.stop()}},M,this,[[1,16]])}function h(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,[(0,y.takeLatest)(E.UPLOAD_USER_KEY,u),(0,y.takeLatest)(E.DECRYPT_USER_PRIVATE_KEYS,l),(0,y.takeLatest)(E.LOAD_SERVER_PUBLIC_KEYS,f)];case 2:case"end":return e.stop()}},N,this)}Object.defineProperty(t,"__esModule",{value:!0}),t.uploadCtsPublicKey=s,t.fetchMissingPublicKeys=i,t.fetchUserKeys=c,t.uploadUserKeysSaga=u,t.decryptUserPrivateKeysSaga=l,t.fetchCtsWebKeys=d,t.uploadCtsWebKeys=p,t.loadServerPublicKeysSaga=f,t.saveUserKeys=m,t.rootEncryptionKeysSaga=h,t.getPublicKeys=t.getEncryptionKeys=t.getUser=void 0;var y=n("./node_modules/redux-saga/es/effects.js"),_=n("./node_modules/lodash/lodash.js"),b=r(n("./app/api/kdc.js")),v=r(n("./app/modules/user.js")),g=r(n("./app/modules/ui.js")),E=r(n("./app/modules/encryptionKeys.js")),S=n("./lib/encryption.js"),O=regeneratorRuntime.mark(s),C=regeneratorRuntime.mark(i),w=regeneratorRuntime.mark(c),j=regeneratorRuntime.mark(u),k=regeneratorRuntime.mark(l),P=regeneratorRuntime.mark(d),T=regeneratorRuntime.mark(p),x=regeneratorRuntime.mark(f),M=regeneratorRuntime.mark(m),N=regeneratorRuntime.mark(h),A=function(e){return e.user};t.getUser=A;var R=function(e){return e.encryptionKeys};t.getEncryptionKeys=R;var I=function(e){return e.encryptionKeys.publicKeys};t.getPublicKeys=I},"./app/sagas/eventsQueue.js":function(e,t,n){"use strict";function r(e,t,n){var r,a;return regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return a=new Promise(function(e){r=e}),s.next=3,(0,i.put)(d.pushEventsQueue({type:e,event:t,resolve:r}));case 3:return s.next=5,(0,i.fork)(o);case 5:if(!n){s.next=9;break}return s.next=8,(0,i.call)(function(e){return e},a);case 8:return s.abrupt("return",s.sent);case 9:return s.abrupt("return",null);case 10:case"end":return s.stop()}},p,this)}function a(e){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(1===e.length&&(h=!1),!e.length){t.next=4;break}return t.next=4,(0,i.put)(d.pullEventsQueue());case 4:case"end":return t.stop()}},f,this)}function o(e){var t,n,r,s,d,p,f,_,b;return regeneratorRuntime.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,(0,i.select)(y);case 2:if(t=m.sent,(!h||e)&&t.length){m.next=5;break}return m.abrupt("return");case 5:h=!0,n=t[0],r=n.type,s=n.event,d=n.resolve,p=s||{},f=p.payload,_=p.channel,m.t0=r,m.next="message_new"===m.t0?11:"chat_position_report"===m.t0?15:20;break;case 11:return m.next=13,(0,i.call)(u.sendMessage,s);case 13:return b=m.sent,m.abrupt("break",24);case 15:return m.next=17,(0,i.call)(l.push,_,r,f,!0);case 17:return b=m.sent,b.error&&"event_not_found_error"!==b.error&&(b=!1),m.abrupt("break",24);case 20:return m.next=22,(0,i.call)(l.push,_,r,f);case 22:return b=m.sent,m.abrupt("break",24);case 24:if(!b){m.next=30;break}return m.next=27,(0,i.call)(a,t);case 27:d(b),m.next=32;break;case 30:return m.next=32,(0,i.call)(c.delay,1e3);case 32:return m.next=34,(0,i.select)(y);case 34:if(t=m.sent,!t.length){m.next=38;break}return m.next=38,(0,i.call)(o,!0);case 38:case"end":return m.stop()}},m,this)}function s(e){h=e}Object.defineProperty(t,"__esModule",{value:!0}),t.push=r,t.pull=a,t.processQueue=o,t.mockRunning=s,t.getEventsQueue=void 0;var i=n("./node_modules/redux-saga/es/effects.js"),c=n("./node_modules/redux-saga/es/index.js"),u=n("./app/sagas/messages.js"),l=n("./app/sagas/channels.js"),d=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./app/modules/eventsQueue.js")),p=regeneratorRuntime.mark(r),f=regeneratorRuntime.mark(a),m=regeneratorRuntime.mark(o),h=!1,y=function(e){return e.eventsQueue};t.getEventsQueue=y},"./app/sagas/index.js":function(e,t,n){"use strict";function r(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,[(0,a.fork)(o.rootAttachmentsSaga),(0,a.fork)(s.rootEncryptionKeysSaga),(0,a.fork)(c.rootSocketsSaga),(0,a.fork)(i.rootChannelsSaga),(0,a.fork)(u.rootMessagesSaga),(0,a.fork)(l.rootUserSaga),(0,a.fork)(d.rootChatsSaga),(0,a.fork)(p.rootPhonebookSaga),(0,a.fork)(f.rootNotifiersSaga),(0,a.fork)(m.rootMembersTypingSaga),(0,a.fork)(h.rootPushSaga),(0,a.fork)(y.rootUiSaga),(0,a.fork)(_.rootDraftsSaga),(0,a.fork)(b.rootVoexSaga),(0,a.fork)(v.rootBotxSaga)];case 2:case"end":return e.stop()}},g,this)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n("./node_modules/redux-saga/es/effects.js"),o=n("./app/sagas/attachments.js"),s=n("./app/sagas/encryptionKeys.js"),i=n("./app/sagas/channels.js"),c=n("./app/sagas/sockets.js"),u=n("./app/sagas/messages.js"),l=n("./app/sagas/user.js"),d=n("./app/sagas/chats.js"),p=n("./app/sagas/phonebook.js"),f=n("./app/sagas/notifiers.js"),m=n("./app/sagas/membersTyping.js"),h=n("./app/sagas/push.js"),y=n("./app/sagas/ui.js"),_=n("./app/sagas/drafts.js"),b=n("./app/sagas/voex.js"),v=n("./app/sagas/botx.js"),g=regeneratorRuntime.mark(r),E=r;t.default=E},"./app/sagas/membersTyping.js":function(e,t,n){"use strict";function r(e,t){var n,r;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,(0,i.select)(b);case 3:if(n=a.sent,!(r=(0,d.getGroupChannel)(e))){a.next=8;break}return a.next=8,(0,i.call)(u.push,r,t,{user_huid:n.huid});case 8:a.next=13;break;case 10:a.prev=10,a.t0=a.catch(0),Object({PRODUCTION:1,NODE_ENV:"production"}).TEST||console.error("Change member typing error ".concat(a.t0.message),e,t);case 13:case"end":return a.stop()}},m,this,[[0,10]])}function a(e){var t,n;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,(0,i.race)({typingMemberRemoved:(0,i.call)(o,e),timeout:(0,i.call)(c.delay,f.TYPING_RELEVANCE_INTERVAL)});case 3:if(t=r.sent,!(n=t.timeout)){r.next=8;break}return r.next=8,(0,i.put)(l.typingMemberRemoved(e.payload));case 8:r.next=13;break;case 10:r.prev=10,r.t0=r.catch(0),console.error("typingMemberAddedSaga error: ".concat(r.t0.message));case 13:case"end":return r.stop()}},h,this,[[0,10]])}function o(e){var t;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:n.prev=0;case 1:return n.next=4,(0,i.take)(l.TYPING_MEMBER_REMOVED);case 4:if(t=n.sent,!(0,p.equal)(e.payload,t.payload)){n.next=7;break}return n.abrupt("break",9);case 7:n.next=1;break;case 9:n.next=14;break;case 11:n.prev=11,n.t0=n.catch(0),console.error("waitForTypingMemberRemoved error: ".concat(n.t0.message));case 14:case"end":return n.stop()}},y,this,[[0,11]])}function s(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,[(0,i.takeEvery)(l.ADD_TYPING_MEMBER,v),(0,i.takeEvery)(l.REMOVE_TYPING_MEMBER,g),(0,i.takeEvery)(l.TYPING_MEMBER_ADDED,a)];case 2:case"end":return e.stop()}},_,this)}Object.defineProperty(t,"__esModule",{value:!0}),t.changeMemberTyping=r,t.typingMemberAddedSaga=a,t.waitForTypingMemberRemoved=o,t.rootMembersTypingSaga=s,t.getUser=void 0;var i=n("./node_modules/redux-saga/es/effects.js"),c=n("./node_modules/redux-saga/es/index.js"),u=n("./app/sagas/channels.js"),l=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./app/modules/membersTyping.js")),d=n("./lib/sockets.js"),p=n("./lib/deepEqual.js"),f=n("./lib/constants.js"),m=regeneratorRuntime.mark(r),h=regeneratorRuntime.mark(a),y=regeneratorRuntime.mark(o),_=regeneratorRuntime.mark(s),b=function(e){return e.user};t.getUser=b;var v=function(e){return r(e.payload,"typing")},g=function(e){return r(e.payload,"stop_typing")}},"./app/sagas/messageKeys.js":function(e,t,n){"use strict";function r(e,t){var n,r;return regeneratorRuntime.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(c.prev=0,n=(0,i.getGroupChannel)(e)){c.next=6;break}return c.next=5,(0,a.call)(o.selectChannel,"",e);case 5:n=c.sent;case 6:return c.next=8,(0,a.call)(o.push,n,"event_info",{sync_ids:t});case 8:return r=c.sent,c.next=11,(0,a.put)(s.fetchMessageKeysSuccess(r.info));case 11:c.next=17;break;case 13:return c.prev=13,c.t0=c.catch(0),c.next=17,(0,a.put)({type:s.FETCH_MESSAGE_KEYS_FAILURE,error:c.t0.message});case 17:case"end":return c.stop()}},c,this,[[0,13]])}Object.defineProperty(t,"__esModule",{value:!0}),t.fetchMessageKeysSaga=r;var a=n("./node_modules/redux-saga/es/effects.js"),o=n("./app/sagas/channels.js"),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./app/modules/messageKeys.js")),i=n("./lib/sockets.js"),c=regeneratorRuntime.mark(r)},"./app/sagas/messages.js":function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}function o(e,t){return c(e)||i(e,t)||s()}function s(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function i(e,t){var n=[],r=!0,a=!1,o=void 0;try{for(var s,i=e[Symbol.iterator]();!(r=(s=i.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==i.return||i.return()}finally{if(a)throw o}}return n}function c(e){if(Array.isArray(e))return e}function u(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){d(e,t,n[t])})}return e}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function p(){new W.Howl({src:[ve.default]}).play()}function f(e){var t,n,r,a,o,s,i,c,d,p,f,m,E,S,O,C,w,j;return regeneratorRuntime.wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return t=e.payload,n=t.chatId,r=t.type,a=t.data,k.prev=1,k.next=4,(0,G.select)(Ve);case 4:return s=k.sent,k.next=7,(0,G.select)(qe,n);case 7:return i=k.sent,c=(0,ue.getUserConnection)(s,i).connType,k.next=11,(0,G.select)(oe.getBottomEvent);case 11:if(d=k.sent,p=z.default.max([null===d||void 0===d?void 0:d.inserted_at,i.last_event_inserted_at,i.sorting_inserted_at,null===(o=i.lastEvent)||void 0===o?void 0:o.inserted_at,i.inserted_at].filter(function(e){return e})),f={keys:[],group_chat_id:n,sync_id:(0,ie.default)(),inserted_at:p.add(1,"ms"),payload:{type:r,msg_id:(0,ie.default)(),from:s.huid,timestamp:(0,de.generateTimestamp)(),group_chat_id:n,lat:0,lng:0},connType:c,kind:c},!(["image","video","document"].includes(r)&&a.size>ge.MAX_ATTACHMENT_SIZE)){k.next=19;break}return m=(0,Q.formatMessage)(et.attachSize,{fileName:a.name,maxSize:(0,fe.bytesToSize)(ge.MAX_ATTACHMENT_SIZE)}),k.next=18,(0,G.put)(ae.showNotifier(m,"error",!0));case 18:return k.abrupt("return");case 19:E=f.payload,k.t0=r,k.next="text"===k.t0?23:"image"===k.t0?25:"video"===k.t0?25:"location"===k.t0?27:"document"===k.t0?29:"link"===k.t0?31:"contact"===k.t0?33:35;break;case 23:return E=h(f.payload,a),k.abrupt("break",36);case 25:return E=y(f.payload,a),k.abrupt("break",36);case 27:return E=_(f.payload,a),k.abrupt("break",36);case 29:return E=b(f.payload,a),k.abrupt("break",36);case 31:return E=v(f.payload,a),k.abrupt("break",36);case 33:return E=g(f.payload,a),k.abrupt("break",36);case 35:return k.abrupt("return");case 36:return k.next=38,(0,G.call)(V.delay);case 38:return k.next=40,(0,G.put)(ee.messageAddedLocally(l({},f,{payload:E})));case 40:return k.next=42,(0,G.select)(Ze,n);case 42:if((S=k.sent)===ne.chatState.initLoading){k.next=48;break}return k.next=46,(0,G.put)(ne.setChatFsmState(n,ne.chatState.sendMessage));case 46:return k.next=48,(0,G.put)(ne.setChatFsmState(n,ne.chatState.idle));case 48:return O=f.inserted_at,C=f.connType,w=f.kind,j=u(f,["inserted_at","connType","kind"]),k.next=51,(0,G.call)(be.push,"message_new",{eventPayload:j,data:a});case 51:k.next=56;break;case 53:k.prev=53,k.t1=k.catch(1),console.error("Error creating local message: ".concat(k.t1.message));case 56:case"end":return k.stop()}},Ee,this,[[1,53]])}function m(e){var t,n,r,a,o,s,i,c,u,d,p,f,m,w,j,k,P,T;return regeneratorRuntime.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return t=e.eventPayload,n=e.data,r=t.group_chat_id,x.prev=2,x.next=5,(0,G.select)(Ve);case 5:return a=x.sent,x.next=8,(0,G.select)(qe,r);case 8:return o=x.sent,x.next=11,(0,G.select)(ze);case 11:return s=x.sent,i=(0,se.getGroupChannel)(r),c=(0,ce.generateSymmetricKey)(),x.next=16,(0,G.call)(C,o,a,s,c);case 16:t.keys=x.sent,u=!1,x.t0=t.payload.type,x.next="text"===x.t0?21:"image"===x.t0?23:"video"===x.t0?23:"location"===x.t0?28:"document"===x.t0?30:"link"===x.t0?35:"contact"===x.t0?41:49;break;case 21:return u=h(t.payload,n),x.abrupt("break",50);case 23:return x.next=25,(0,G.call)(O,t,n,c,o,a);case 25:return d=x.sent,u=y(t.payload,n,d),x.abrupt("break",50);case 28:return u=_(t.payload,n),x.abrupt("break",50);case 30:return x.next=32,(0,G.call)(O,t,n,c,o,a);case 32:return p=x.sent,u=b(t.payload,n,p),x.abrupt("break",50);case 35:return x.next=37,(0,G.race)({metaData:(0,G.call)(he.getMetadata,n.url),_:(0,G.call)(V.delay,ge.URL_PARSING_TIMEOUT)});case 37:return f=x.sent,m=f.metaData,u=v(t.payload,n,m),x.abrupt("break",50);case 41:return x.next=43,(0,G.call)(E,n.contact.avatar);case 43:return w=x.sent,x.next=46,(0,G.call)(S,t,n,c,o,a,w);case 46:return j=x.sent,u=g(t.payload,n,j),x.abrupt("break",50);case 49:return x.abrupt("break",50);case 50:return x.next=52,(0,G.call)(_e.runEncryptionTask,ee.ENCRYPT_MESSAGE_PAYLOAD,ee.ENCRYPT_MESSAGE_PAYLOAD_SUCCESS,{messagePayload:u,symmetricKey:c});case 52:return k=x.sent,P=l({},t,{payload:k}),x.next=56,(0,G.call)(X.push,i,"message_new",P);case 56:return T=x.sent,x.abrupt("return",T);case 60:x.prev=60,x.t1=x.catch(2),Object({PRODUCTION:1,NODE_ENV:"production"}).TEST||console.error("Send message error: ".concat(x.t1.message));case 63:return x.abrupt("return",null);case 64:case"end":return x.stop()}},Se,this,[[2,60]])}function h(e,t){return l({},e,{body:t})}function y(e,t,n){return l({},e,{payload:{file_preview:n?n.preview_url:t.preview_file,file_preview_width:t.preview_width,file_preview_height:t.preview_height,file_blur_preview:t.blur_preview_file,file:(null===n||void 0===n?void 0:n.url)||t.file,file_name:t.name,file_size:t.size,file_mime_type:t.type,chunk_size:ge.CHUNK_SIZE}})}function _(e,t){return l({},e,{payload:t})}function b(e,t,n){return l({},e,{payload:{file:n?n.url:t.file,file_name:t.name,file_size:t.size,file_mime_type:t.type,chunk_size:ge.CHUNK_SIZE}})}function v(e,t,n){return n&&n.url?l({},e,{payload:l({},n),body:t.message}):l({},e,{payload:{url:t.url},body:t.message})}function g(e,t,n){return l({},e,{payload:{contact_name:t.contact.name,contact_file:n?n.vcard:t.vcard,contact_image:n?n.image:t.contact.avatar}})}function E(e){var t,n,r,a,o,s;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(e){i.next=2;break}return i.abrupt("return",null);case 2:return t=e.match(/^.*\/([^\/^?]+)[^\/]*$/),n=(null===t||void 0===t?void 0:t.length)>1&&t[1],r=null===n||void 0===n?void 0:n.match(/\.(.*)$/)[1],i.next=7,(0,G.call)(me.fetchBinaryData,e);case 7:return a=i.sent,o=new Blob([a.buffer],{type:"image/*"}),s=Object({PRODUCTION:1,NODE_ENV:"production"}).TEST?"image.png":URL.createObjectURL(o),i.abrupt("return",{name:n,type:"image/".concat(r),file:a,url:s});case 11:case"end":return i.stop()}},Oe,this)}function S(e,t,n,r,a,o){var s,i;return regeneratorRuntime.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return s=null,c.next=3,(0,G.call)(O,e,t.vcard,n,r,a);case 3:if(i=c.sent,!o){c.next=8;break}return c.next=7,(0,G.call)(O,e,o,n,r,a);case 7:s=c.sent;case 8:return c.abrupt("return",{vcard:i.url,image:s&&s.url});case 9:case"end":return c.stop()}},Ce,this)}function O(e,t,n,r,a){var o,s,i,c,u,d,p,f,m,h;return regeneratorRuntime.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return o=(0,ue.getUserConnection)(a,r),s=o.host,i=o.token,y.next=3,(0,G.call)(_e.runEncryptionTask,ee.ENCRYPT_FILE,ee.ENCRYPT_FILE_SUCCESS,{file:t.file,symmetricKey:n});case 3:if(c=y.sent,u={chat_id:e.group_chat_id,sync_id:e.sync_id,filename:t.name,preview_file:!1,mimetype:t.type,filedata:c},!t.preview_file){y.next=15;break}return d=(0,ce.fromBase64)(t.preview_file.split(",")[1]),y.next=9,(0,G.call)(_e.runEncryptionTask,ee.ENCRYPT_FILE,ee.ENCRYPT_FILE_SUCCESS,{file:d,symmetricKey:n});case 9:return p=y.sent,f=l({},u,{preview_file:!0,mimetype:t.preview_type,filedata:p}),y.next=13,[(0,G.call)(me.saveChatFile,s,i,u),(0,G.call)(me.saveChatFile,s,i,f)];case 13:return m=y.sent,y.abrupt("return",{url:m[0].result.url,preview_url:m[1].result.url});case 15:return y.next=17,(0,G.call)(me.saveChatFile,s,i,u);case 17:return h=y.sent,y.abrupt("return",{url:h.result.url});case 19:case"end":return y.stop()}},we,this)}function C(e,t,n,r){var a,o,s,i,c,u,l,d,p;return regeneratorRuntime.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:f.prev=0,a=(0,le.chatMemberConnType)(e,t),o=(0,ce.fromBase64)(n.user.privateKeys[a].body),s=[],i=!0,c=!1,u=void 0,f.prev=7,l=regeneratorRuntime.mark(function e(){var t,a,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=p.value,a=(0,ce.fromBase64)((0,Y.find)(n.publicKeys,function(e){return e.id===t}).body),e.next=4,(0,G.call)(_e.runEncryptionTask,re.ENCRYPT_SYMMETRIC_KEY,re.ENCRYPT_SYMMETRIC_KEY_SUCCESS,{symmetricKey:r,publicKey:a,privateKey:o});case 4:i=e.sent,s.push({key_id:t,key:i,algo:"xsalsa20:chacha20"});case 6:case"end":return e.stop()}},e,this)}),d=e.keys[Symbol.iterator]();case 10:if(i=(p=d.next()).done){f.next=15;break}return f.delegateYield(l(),"t0",12);case 12:i=!0,f.next=10;break;case 15:f.next=21;break;case 17:f.prev=17,f.t1=f.catch(7),c=!0,u=f.t1;case 21:f.prev=21,f.prev=22,i||null==d.return||d.return();case 24:if(f.prev=24,!c){f.next=27;break}throw u;case 27:return f.finish(24);case 28:return f.finish(21);case 29:return f.abrupt("return",s);case 32:return f.prev=32,f.t2=f.catch(0),console.error("compose message keys error: ".concat(f.t2.message)),f.abrupt("return",!1);case 36:case"end":return f.stop()}},je,this,[[0,32],[7,17,21,29],[22,,24,28]])}function w(e){var t,n,r,a,o,s;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return t=(0,Y.last)(e),i.prev=1,n=["message_new","app_event"],r=e.filter(function(e){return n.includes(e.event_type)}),a=e.filter(function(e){return!n.includes(e.event_type)}),i.next=7,(0,G.call)(P,r);case 7:return o=i.sent,i.next=10,(0,G.fork)(R,o);case 10:return s=(0,Y.sortBy)(o.concat(a),["inserted_at"]),i.next=13,[(0,G.put)(ee.decryptHistorySuccess(s)),(0,G.fork)($.fetchProfiles,(0,de.uniqEventSendersHuids)(s)),(0,G.fork)(T,o)];case 13:i.next=20;break;case 15:return i.prev=15,i.t0=i.catch(1),console.error(i.t0.message),i.next=20,(0,G.put)(ee.decryptHistoryFailure(e,i.t0.message));case 20:if(i.prev=20,e&&!(e.length<=1)){i.next=24;break}return i.next=24,(0,G.put)(ne.setChatLoadedFullHistory(t.group_chat_id));case 24:if(!t){i.next=27;break}return i.next=27,(0,G.put)(ne.setChatFsmState(t.group_chat_id,ne.chatState.idle));case 27:return i.finish(20);case 28:case"end":return i.stop()}},ke,this,[[1,15,20,28]])}function j(e){var t,n,r,a,o,s,i,c,u,l,d,f;return regeneratorRuntime.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return t=e.payload,m.prev=1,m.next=4,(0,G.fork)(J.unhideChat,t.group_chat_id);case 4:return m.next=6,(0,G.fork)(k,t);case 6:return m.next=8,(0,G.select)(Xe,t.group_chat_id);case 8:return r=m.sent,a=r.appInFocus,o=r.playNotificationSound,s=r.dnd,m.next=14,(0,G.select)(Ve);case 14:if(i=m.sent,a||!o||s||t.sender===i.huid){m.next=18;break}return m.next=18,(0,G.call)(p);case 18:if(!a||t.sender!==i.huid){m.next=21;break}return m.next=21,(0,G.fork)(J.pushChatPositionReport,t);case 21:return m.next=23,(0,G.select)($e);case 23:if(c=m.sent,u=(0,pe.matchChatId)(c)){m.next=27;break}return m.abrupt("return");case 27:return m.next=29,(0,G.select)(qe,u);case 29:if(l=m.sent,d=t.group_chat_id===u,f=(null===l||void 0===l?void 0:l.position_event_sync_id)===(null===l||void 0===l?void 0:null===(n=l.lastEvent)||void 0===n?void 0:n.sync_id),!(d&&f&&a)){m.next=35;break}return m.next=35,(0,G.put)(te.chatPositionReportUpdated(u,t));case 35:m.next=40;break;case 37:m.prev=37,m.t0=m.catch(1),console.error("receiveMessageNewSaga error: ".concat(m.t0.message));case 40:case"end":return m.stop()}},Pe,this,[[1,37]])}function k(e){var t,n,r;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,(0,G.call)(P,[e]);case 3:return t=a.sent,a.next=6,(0,G.fork)(R,t);case 6:if(n=t[0],!n.payload){a.next=21;break}return a.next=10,(0,G.select)(Ve);case 10:if(r=a.sent,n.payload.from===r.huid){a.next=14;break}return a.next=14,(0,G.put)(te.incUnreadCounter(n.group_chat_id));case 14:return a.next=16,[(0,G.put)(ee.decryptNewMessageSuccess(n)),(0,G.fork)(T,t,!0)];case 16:if(n.sender===r.huid){a.next=19;break}return a.next=19,(0,G.put)(ee.receiveMessageNewReports({from:r.huid,sync_id:[n.sync_id]}));case 19:a.next=23;break;case 21:return a.next=23,(0,G.put)(ee.decryptNewMessageFailure(l({},e,{payload:!1})));case 23:a.next=29;break;case 25:return a.prev=25,a.t0=a.catch(0),a.next=29,(0,G.put)(ee.decryptNewMessageFailure(l({},e,{payload:!1})));case 29:return a.prev=29,a.next=32,(0,G.fork)(Z.setChatFsmStateOnChatEvent,e.group_chat_id);case 32:return a.finish(29);case 33:case"end":return a.stop()}},Te,this,[[0,25,29,33]])}function P(e){var t,n;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,(0,G.call)(ye.fetchMissingPublicKeys,(0,Y.map)(e,"sender_key_id"));case 2:return r.next=4,(0,G.select)(ze);case 4:return t=r.sent,r.next=7,(0,G.call)(_e.runEncryptionTask,ee.DECRYPT_MESSAGE_PAYLOADS,ee.DECRYPT_MESSAGE_PAYLOADS_SUCCESS,{messages:e,encryptionKeys:t});case 7:return n=r.sent,r.abrupt("return",n.map(de.renameHuidToUserHuid));case 9:case"end":return r.stop()}},xe,this)}function T(e,t){var n,r;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return n=e.reduce(function(e,t){return["image","video","contact"].includes(t.payload.type)&&e.push(t),e},[]),a.next=3,(0,G.call)(x,n);case 3:if(r=a.sent,0!==r.length){a.next=6;break}return a.abrupt("return");case 6:if(!t){a.next=11;break}return a.next=9,(0,G.put)(ee.decryptNewMessagePreviewSuccess(r[0]));case 9:a.next=13;break;case 11:return a.next=13,(0,G.put)(ee.decryptMessagesPreviewSuccess(r));case 13:case"end":return a.stop()}},Me,this)}function x(e){var t,n,r;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(0!==e.length){a.next=2;break}return a.abrupt("return",[]);case 2:return a.next=4,(0,G.select)(ze);case 4:return t=a.sent,n=e.map(function(e){return(0,G.call)(M,e,t)}),a.next=8,(0,G.all)(n);case 8:return r=a.sent,a.abrupt("return",r);case 10:case"end":return a.stop()}},Ne,this)}function M(e,t){var n,r;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,(0,G.call)(_e.runEncryptionTask,ee.DECRYPT_SYMMETRIC_KEY,ee.DECRYPT_SYMMETRIC_KEY_SUCCESS,{message:e,encryptionKeys:t});case 2:return n=a.sent,a.next=5,(0,G.call)(N,e,n);case 5:return r=a.sent,a.abrupt("return",r);case 7:case"end":return a.stop()}},Ae,this)}function N(e,t){var n,r,a,o,s;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(-1!==["image","video","contact"].indexOf(e.payload.type)){i.next=2;break}return i.abrupt("return",e);case 2:return i.next=4,(0,G.select)(Ve);case 4:if(n=i.sent,r="cts"===e.connType?n.ctsServer:n.rtsHost,a="contact"===e.payload.type?e.payload.payload.contact_image:e.payload.payload.file_preview){i.next=9;break}return i.abrupt("return",e);case 9:return i.next=11,(0,G.call)(_e.runEncryptionTask,ee.DECRYPT_FILE,ee.DECRYPT_FILE_SUCCESS,{url:a,host:r,symmetricKey:t,mimeType:"image/png",chunkSize:e.payload.payload.chunk_size});case 11:return o=i.sent,s="contact"===e.payload.type?l({},e.payload.payload,{contact_image:o}):l({},e.payload.payload,{file_preview:o}),i.abrupt("return",l({},e,{payload:l({},e.payload,{payload:s})}));case 14:case"end":return i.stop()}},Re,this)}function A(e){var t,n,r,a,o,s,i,c,u,l,d,p;return regeneratorRuntime.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return t=e.payload,f.prev=1,f.next=4,(0,G.select)(Qe);case 4:if(n=f.sent,r=(0,Y.find)(n,function(e){return e.payload.msg_id===t}),!r.payload.attachmentLoaded){f.next=8;break}return f.abrupt("return");case 8:return f.next=10,(0,G.select)(Ve);case 10:return a=f.sent,o="cts"===r.connType?a.ctsServer:a.rtsHost,s="contact"===r.payload.type?r.payload.payload.contact_file:r.payload.payload.file,f.next=15,(0,G.select)(ze);case 15:return i=f.sent,c=r.key,u=r.sender_key_id,f.next=19,(0,G.call)(_e.runEncryptionTask,ee.DECRYPT_SYMMETRIC_KEY,ee.DECRYPT_SYMMETRIC_KEY_SUCCESS,{message:{key:c,sender_key_id:u},encryptionKeys:i});case 19:return l=f.sent,f.next=22,(0,G.call)(_e.runEncryptionTask,ee.DECRYPT_FILE,ee.DECRYPT_FILE_SUCCESS,{url:s,host:o,symmetricKey:l,mimeType:r.payload.payload.file_mime_type,chunkSize:r.payload.payload.chunk_size});case 22:return d=f.sent,p="contact"===r.payload.type?"contact_file":"file",r.payload.payload[p]=d,f.next=27,(0,G.put)(ee.loadMessageFileSuccess(r));case 27:f.next=33;break;case 29:return f.prev=29,f.t0=f.catch(1),f.next=33,(0,G.put)({type:ee.LOAD_MESSAGE_FILE_FAILURE,payload:f.t0.message});case 33:case"end":return f.stop()}},Ie,this,[[1,29]])}function R(e){var t,n,r,a;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(o.prev=0,null===e||void 0===e?void 0:e.length){o.next=3;break}return o.abrupt("return");case 3:return t=e[0].group_chat_id,o.next=6,(0,G.select)(Ve);case 6:return n=o.sent,r=e.filter(function(e){var t;return!(null===(t=e.received_by)||void 0===t?void 0:t.find(function(e){return e.user_huid===n.huid}))&&e.payload.from!==n.huid}),a=r.map(function(e){return e.sync_id}),o.next=11,(0,G.fork)(D,"message_new_report",n.huid,t,a);case 11:o.next=16;break;case 13:o.prev=13,o.t0=o.catch(0),Object({PRODUCTION:1,NODE_ENV:"production"}).TEST||console.error("send message_new reports error: ".concat(o.t0.message));case 16:case"end":return o.stop()}},De,this,[[0,13]])}function I(e){var t,n,r,a,s,i,c,u,l;return regeneratorRuntime.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return t=e.payload,d.prev=1,d.next=4,(0,G.select)(Je);case 4:if(n=d.sent,(null===t||void 0===t?void 0:t.length)&&n){d.next=7;break}return d.abrupt("return");case 7:return r=t[0].group_chat_id,d.next=10,(0,G.select)(Ve);case 10:return a=d.sent,s=t.filter(function(e){var t;return!(null===(t=e.read_by)||void 0===t?void 0:t.find(function(e){return e.user_huid===a.huid}))&&e.payload.from!==a.huid}),i=s.map(function(e){return e.sync_id}),d.next=15,[(0,G.put)(te.dropUnreadCounter(r)),(0,G.fork)(D,"message_mark_read_report",a.huid,r,i),(0,G.put)(ee.receiveMessageMarkReadReports({from:a.huid,sync_id:i}))];case 15:if(c=s.slice(-1),u=o(c,1),l=u[0],!l){d.next=19;break}return d.next=19,(0,G.fork)(J.pushChatPositionReport,l);case 19:d.next=24;break;case 21:d.prev=21,d.t0=d.catch(1),Object({PRODUCTION:1,NODE_ENV:"production"}).TEST||console.error("send message_mark_read reports error: ".concat(d.t0.message));case 24:case"end":return d.stop()}},Le,this,[[1,21]])}function D(e,t,n,r){var a;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(r&&r.length){o.next=2;break}return o.abrupt("return");case 2:return o.next=4,(0,G.call)(X.selectChannel,"groupchat",n);case 4:if((a=o.sent)&&a.isJoined()){o.next=7;break}return o.abrupt("return");case 7:return o.next=9,(0,G.call)(be.push,e,{channel:a,payload:{group_chat_id:n,payload:{sync_id:r,from:t}}});case 9:case"end":return o.stop()}},Ue,this)}function L(e){var t,n,r,a;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return t=e.payload,o.prev=1,o.next=4,(0,G.select)(Ve);case 4:if(n=o.sent,"added_to_chat"!==t.event_type||!t.payload.user_huid.includes(n.huid)){o.next=13;break}return r=(0,se.getSocket)(t.connType),a=t.group_chat_id||t.payload.group_chat_id,o.next=10,[(0,G.fork)(X.joinChannel,r,"groupchat:".concat(a),t.connType),(0,G.fork)(J.syncChat,a)];case 10:return o.next=12,(0,G.put)(ee.systemEventAdded(t));case 12:return o.abrupt("return");case 13:if("kicked_by_cts_logout"!==t.event_type||!t.payload.user_huid.includes(n.huid)){o.next=19;break}return o.next=16,(0,G.put)(te.leaveChatSuccess(t.group_chat_id));case 16:return o.next=18,(0,G.put)(ee.systemEventAdded(t));case 18:return o.abrupt("return");case 19:if("routing_changed"!==t.event_type){o.next=25;break}if((0,de.isRoutingChangedDisplayable)(t,n.huid)){o.next=22;break}return o.abrupt("return");case 22:return o.next=24,(0,G.put)(ee.systemEventAdded(l({},t,{payload:{forward:t.payload.forward.filter(function(e){return e.user_huid===n.huid}),backward:null}})));case 24:return o.abrupt("return");case 25:return o.next=27,(0,G.put)(ee.systemEventAdded(t));case 27:o.next=32;break;case 29:o.prev=29,o.t0=o.catch(1),console.error("addSystemEventSaga error: ".concat(o.t0.message));case 32:return o.prev=32,o.next=35,(0,G.fork)(Z.setChatFsmStateOnChatEvent,t.group_chat_id);case 35:return o.finish(32);case 36:case"end":return o.stop()}},Fe,this,[[1,29,32,36]])}function U(e){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.delegateYield(regeneratorRuntime.mark(function t(){var n,r,a,o,s;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=(0,le.sortChats)(e.payload),t.next=3,(0,G.select)(We);case 3:r=t.sent,a=0;case 5:if(!n.length){t.next=16;break}return t.next=8,n.splice(0,10).map(function(e){return(0,G.all)({e:(0,G.call)(F,e,r.find(function(t){return t.group_chat_id===e.group_chat_id})),_:(0,G.call)(V.delay,2e3*a)})});case 8:if(o=t.sent,s=o.map(function(e){var t=e.e;return(0,de.renameHuidToUserHuid)(t)}).filter(function(e){return null===e||void 0===e?void 0:e.payload}),!(null===s||void 0===s?void 0:s.length)){t.next=13;break}return t.next=13,[(0,G.put)(te.lastEventsFetched(s)),(0,G.fork)($.fetchProfiles,(0,de.uniqEventSendersHuids)(s))];case 13:a+=1,t.next=5;break;case 16:case"end":return t.stop()}},t,this)})(),"t0",2);case 2:t.next=7;break;case 4:t.prev=4,t.t1=t.catch(0),Object({PRODUCTION:1,NODE_ENV:"production"}).TEST||console.error("fetchLastEventsSaga error: ".concat(t.t1.message));case 7:case"end":return t.stop()}},He,this,[[0,4]])}function F(e,t){var n,r,a,o,s,i,c,u,l,d,p,f,m,h;return regeneratorRuntime.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(y.prev=0,n=e.lastEvent,(0,le.isLastEventFetchNeeded)(t,e)){y.next=4;break}return y.abrupt("return",!1);case 4:return r=n.sync_id,a=n.inserted_at,o=n.connType,s=e.group_chat_id,y.next=8,(0,G.call)(H,r,o,s);case 8:if(i=y.sent){y.next=11;break}return y.abrupt("return",!1);case 11:if(c=i.event_type,u=i.group_chat_id,l=i.sender,d=["message_new","app_event"],d.includes(i.event_type)){y.next=15;break}return y.abrupt("return",{sync_id:r,inserted_at:a,connType:o,event_type:c,group_chat_id:u,sender:l,payload:i.payload});case 15:return y.next=17,(0,G.call)(ye.fetchMissingPublicKeys,[i.sender_key_id]);case 17:return y.next=19,(0,G.select)(ze);case 19:return p=y.sent,y.next=22,(0,G.call)(_e.runEncryptionTask,ee.DECRYPT_MESSAGE_PAYLOADS,ee.DECRYPT_MESSAGE_PAYLOADS_SUCCESS,{messages:[i],encryptionKeys:p});case 22:if(f=y.sent,m=f[0],null===m||void 0===m?void 0:m.payload){y.next=26;break}return y.abrupt("return",!1);case 26:return h="app_event"===m.event_type&&"call_hangup"===m.payload.event_type?"voex":m.event_type,y.abrupt("return",{sync_id:r,inserted_at:a,connType:o,event_type:h,group_chat_id:u,kind:m.kind,payload:m.payload});case 30:return y.prev=30,y.t0=y.catch(0),console.error("fetchLastEvent error: ".concat(y.t0.message)),y.abrupt("return",!1);case 34:case"end":return y.stop()}},Ke,this,[[0,30]])}function H(e,t,n){var r,a,o,s,i,c;return regeneratorRuntime.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.prev=0,i=(0,se.getSystemChannel)(t),u.next=4,(0,G.call)(X.push,i,"event_info",{group_chat_id:n,sync_ids:[e]});case 4:if(c=u.sent,!(null===(r=c)||void 0===r?void 0:null===(a=r.info)||void 0===a?void 0:a.length)){u.next=7;break}return u.abrupt("return",c.info[0]);case 7:return i=(0,se.getSystemChannel)("rts"===t?"cts":"rts"),u.next=10,(0,G.call)(X.push,i,"event_info",{group_chat_id:n,sync_ids:[e]});case 10:if(c=u.sent,!(null===(o=c)||void 0===o?void 0:null===(s=o.info)||void 0===s?void 0:s.length)){u.next=13;break}return u.abrupt("return",c.info[0]);case 13:return u.abrupt("return",null);case 16:return u.prev=16,u.t0=u.catch(0),console.error("fetchEventTry error: ".concat(u.t0.message)),u.abrupt("return",null);case 20:case"end":return u.stop()}},Be,this,[[0,16]])}function K(e){var t,n,r,a,o,s,i,c,u,d,p,f,m,h;return regeneratorRuntime.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return t=e.payload,n=t.chatId,r=t.type,a=t.data,o=t.params,y.prev=1,y.next=4,(0,G.call)(X.selectChannel,"groupchat",n);case 4:if((s=y.sent)&&s.isJoined()){y.next=7;break}return y.abrupt("return");case 7:return y.next=9,(0,G.select)(qe,n);case 9:return i=y.sent,y.next=12,(0,G.select)(Ve);case 12:return c=y.sent,y.next=15,(0,G.select)(ze);case 15:return u=y.sent,d=(0,ce.generateSymmetricKey)(),y.next=19,(0,G.call)(C,i,c,u,d);case 19:if(p=y.sent,f={keys:p,group_chat_id:n,payload:{event_type:r},sync_id:(0,ie.default)()},m={affect_last_event:!1},a){y.next=26;break}return y.next=25,(0,G.call)(X.push,s,"app_event",{app_event:f,params:l({},m,o)});case 25:return y.abrupt("return");case 26:return console.log("send",a),y.next=29,(0,G.call)(_e.runEncryptionTask,ee.ENCRYPT_MESSAGE_PAYLOAD,ee.ENCRYPT_MESSAGE_PAYLOAD_SUCCESS,{messagePayload:a,symmetricKey:d});case 29:return h=y.sent,y.next=32,(0,G.call)(X.push,s,"app_event",{app_event:l({},f,{payload:l({},f.payload,{event:h})}),params:l({},m,o)});case 32:y.next=37;break;case 34:y.prev=34,y.t0=y.catch(1),Object({PRODUCTION:1,NODE_ENV:"production"}).TEST||console.error("sendAppEventSaga error: ".concat(y.t0.message));case 37:case"end":return y.stop()}},Ge,this,[[1,34]])}function B(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,[(0,G.takeEvery)(ee.SEND_MESSAGE,f),(0,G.takeEvery)(ee.RECEIVE_MESSAGE_NEW,j),(0,G.takeEvery)(ee.LOAD_MESSAGE_FILE,A),(0,G.takeEvery)(ee.SEND_MESSAGE_MARK_READ_REPORTS,I),(0,G.takeEvery)(ee.ADD_SYSTEM_EVENT,L),(0,G.takeEvery)(te.FETCH_CHAT_LIST_SUCCESS,U),(0,G.takeEvery)(ee.SEND_APP_EVENT,K)];case 2:case"end":return e.stop()}},Ye,this)}Object.defineProperty(t,"__esModule",{value:!0}),t.playSound=p,t.addMessageToQueueSaga=f,t.sendMessage=m,t.getImageFile=E,t.uploadContactFiles=S,t.uploadMessageFile=O,t.composeMessageKeys=C,t.decryptHistory=w,t.receiveMessageNewSaga=j,t.decryptNewMessage=k,t.decryptMessages=P,t.loadMessagesPreview=T,t.decryptMessagesPreview=x,t.loadMessageFileSaga=A,t.sendMessageNewReports=R,t.sendMessageMarkReadReportsSaga=I,t.sendReports=D,t.addSystemEventSaga=L,t.fetchLastEventsSaga=U,t.fetchLastEvent=F,t.fetchEventTry=H,t.sendAppEventSaga=K,t.rootMessagesSaga=B,t.getNextLocation=t.getChatFsmState=t.getAppInFocus=t.getChatNotificationSettings=t.getMessages=t.getEncryptionKeys=t.getChat=t.getChats=t.getUser=void 0;var G=n("./node_modules/redux-saga/es/effects.js"),Y=n("./node_modules/lodash/lodash.js"),V=n("./node_modules/redux-saga/es/index.js"),W=n("./node_modules/howler/dist/howler.js"),q=n("./node_modules/react-intl/lib/index.es.js"),z=a(n("./node_modules/moment/moment.js")),Q=n("./lib/reactIntl.js"),X=n("./app/sagas/channels.js"),J=n("./app/sagas/chats.js"),Z=n("./app/sagas/ui.js"),$=n("./app/sagas/profiles.js"),ee=r(n("./app/modules/messages.js")),te=r(n("./app/modules/chats.js")),ne=r(n("./app/modules/ui.js")),re=r(n("./app/modules/encryptionKeys.js")),ae=r(n("./app/modules/notifiers.js")),oe=n("./app/selectors/messagesSelectors.js"),se=n("./lib/sockets.js"),ie=a(n("./lib/uuid5.js")),ce=n("./lib/encryption.js"),ue=n("./app/helpers/userHelpers.js"),le=n("./app/helpers/chatsHelpers.js"),de=n("./app/helpers/messagesHelpers.js"),pe=n("./app/helpers/routing.js"),fe=n("./app/helpers/attachmentHelpers.js"),me=r(n("./app/api/fileService.js")),he=n("./lib/urlMetadata.js"),ye=n("./app/sagas/encryptionKeys.js"),_e=n("./lib/encryptionTaskWrapper.js"),be=n("./app/sagas/eventsQueue.js"),ve=a(n("./app/assets/audio/message.mp3")),ge=n("./lib/constants.js"),Ee=regeneratorRuntime.mark(f),Se=regeneratorRuntime.mark(m),Oe=regeneratorRuntime.mark(E),Ce=regeneratorRuntime.mark(S),we=regeneratorRuntime.mark(O),je=regeneratorRuntime.mark(C),ke=regeneratorRuntime.mark(w),Pe=regeneratorRuntime.mark(j),Te=regeneratorRuntime.mark(k),xe=regeneratorRuntime.mark(P),Me=regeneratorRuntime.mark(T),Ne=regeneratorRuntime.mark(x),Ae=regeneratorRuntime.mark(M),Re=regeneratorRuntime.mark(N),Ie=regeneratorRuntime.mark(A),De=regeneratorRuntime.mark(R),Le=regeneratorRuntime.mark(I),Ue=regeneratorRuntime.mark(D),Fe=regeneratorRuntime.mark(L),He=regeneratorRuntime.mark(U),Ke=regeneratorRuntime.mark(F),Be=regeneratorRuntime.mark(H),Ge=regeneratorRuntime.mark(K),Ye=regeneratorRuntime.mark(B),Ve=function(e){return e.user};t.getUser=Ve;var We=function(e){return e.chats};t.getChats=We;var qe=function(e,t){return e.chats.find(function(e){return e.group_chat_id===t})};t.getChat=qe;var ze=function(e){return e.encryptionKeys};t.getEncryptionKeys=ze;var Qe=function(e){return e.messages};t.getMessages=Qe;var Xe=function(e,t){var n,r=e.chats.find(function(e){return e.group_chat_id===t});return{dnd:null===r||void 0===r?void 0:null===(n=r.chat_settings)||void 0===n?void 0:n.dnd,appInFocus:e.ui.appInFocus,playNotificationSound:e.settings.playNotificationSound}};t.getChatNotificationSettings=Xe;var Je=function(e){return e.ui.appInFocus};t.getAppInFocus=Je;var Ze=function(e,t){var n;return null===(n=e.ui.chats[t])||void 0===n?void 0:n.state};t.getChatFsmState=Ze;var $e=function(e){return e.ui.nextLocation};t.getNextLocation=$e;var et=(0,q.defineMessages)({attachSize:{id:"[attachment] max size",defaultMessage:"File {fileName} exceeds maximum size {maxSize}"}})},"./app/sagas/notifiers.js":function(e,t,n){"use strict";function r(e){var t,n,r,a,u,p;return regeneratorRuntime.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return t=e.payload,n=t.text,r=t.type,a=t.permanent,c.prev=1,c.next=4,(0,o.select)(d);case 4:return u=c.sent,p=u?u.length:0,c.next=8,(0,o.put)(i.showNotifierSuccess(n,r||"notice"));case 8:if(a){c.next=13;break}return c.next=11,(0,o.call)(s.delay,l);case 11:return c.next=13,(0,o.put)(i.dismissNotifier(p));case 13:c.next=18;break;case 15:c.prev=15,c.t0=c.catch(1),Object({PRODUCTION:1,NODE_ENV:"production"}).TEST||console.error("show notifier error: ".concat(c.t0.message));case 18:case"end":return c.stop()}},c,this,[[1,15]])}function a(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,[(0,o.takeEvery)(i.SHOW_NOTIFIER,r)];case 2:case"end":return e.stop()}},u,this)}Object.defineProperty(t,"__esModule",{value:!0}),t.showNotifier=r,t.rootNotifiersSaga=a,t.getNotifiers=t.DISMISS_AFTER=void 0;var o=n("./node_modules/redux-saga/es/effects.js"),s=n("./node_modules/redux-saga/es/index.js"),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./app/modules/notifiers.js")),c=regeneratorRuntime.mark(r),u=regeneratorRuntime.mark(a),l=3e3;t.DISMISS_AFTER=l;var d=function(e){return e.notifiers};t.getNotifiers=d},"./app/sagas/permissions.js":function(e,t,n){"use strict";function r(){var e,t,n;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,e=l(),t=e.permission,r.next=5,(0,a.call)(e.requestPermission);case 5:if((n=r.sent)===t){r.next=9;break}return r.next=9,(0,a.put)(i.showNotifier((0,s.formatMessage)(u.notifySettingsMessage)));case 9:r.next=14;break;case 11:r.prev=11,r.t0=r.catch(0),Object({PRODUCTION:1,NODE_ENV:"production"}).TEST||console.error("check notifications permission error: ".concat(r.t0.message));case 14:case"end":return r.stop()}},c,this,[[0,11]])}Object.defineProperty(t,"__esModule",{value:!0}),t.checkNotificationsPermission=r,t.notificationWrap=void 0;var a=n("./node_modules/redux-saga/es/effects.js"),o=n("./node_modules/react-intl/lib/index.es.js"),s=n("./lib/reactIntl.js"),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./app/modules/notifiers.js")),c=regeneratorRuntime.mark(r),u=(0,o.defineMessages)({notifySettingsMessage:{id:"[settings notify] notification setting",defaultMessage:"You can change your notifications behavior in browser settings"}}),l=function(){var e;return(null===(e=window)||void 0===e?void 0:e.Notification)?window.Notification:{requestPermission:function(){return Promise.resolve({})},permission:"default"}};t.notificationWrap=l},"./app/sagas/phonebook.js":function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){o(e,t,n[t])})}return e}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){return u(e)||c(e,t)||i()}function i(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function c(e,t){var n=[],r=!0,a=!1,o=void 0;try{for(var s,i=e[Symbol.iterator]();!(r=(s=i.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==i.return||i.return()}finally{if(a)throw o}}return n}function u(e){if(Array.isArray(e))return e}function l(e){var t,n,r,a,o,s,i,c,u,l,d,p,f,y,b,v,E,j,k;return regeneratorRuntime.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return t=e.connType,n=e.forceProfileHuids,r=e.timeout,a=void 0===r?0:r,w.prev=1,w.next=4,(0,m.call)(h.delay,a);case 4:return w.next=6,(0,m.select)(T);case 6:if(o=w.sent,s=o.huid,i=o.rtsHost,c=o.ctsServer,u=o.authToken,l=o.ctsAuthToken,d=o.authStatus,p="cts"===t?c:i,f="cts"===t?l:u,d!==S.authStatusEnum.unregistered&&p&&f){w.next=17;break}return w.abrupt("return");case 17:return w.next=19,(0,m.select)(x);case 19:return y=w.sent,b=y.versions[t],v="cts"===t&&0!==parseInt(b,10),w.next=25,(0,m.call)(C.getPhonebook,p,f,b,t,v);case 25:if(E=w.sent,null===E||void 0===E?void 0:E.phonebook){w.next=28;break}return w.abrupt("return");case 28:return j=E.phonebook.filter(function(e){return!e.contacts.find(function(e){return e.user_huid===s})}),k=n||(0,O.flattenPhonebookContacts)(j).map(function(e){return e.user_huid}),w.next=32,[(0,m.put)(g.fetchPhonebookSuccess(j,t,E.phonebook_version)),(0,m.fork)(_.fetchProfiles,k,!!n)];case 32:w.next=37;break;case 34:w.prev=34,w.t0=w.catch(1),Object({PRODUCTION:1,NODE_ENV:"production"}).TEST||console.error("fetch phonebook saga error: ".concat(w.t0.message));case 37:case"end":return w.stop()}},w,this,[[1,34]])}function d(e){var t,n,r,o,i,c,u,l,d,p,f;return regeneratorRuntime.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return t=e.payload,n=t.name,r=t.phone,h.prev=1,h.next=4,(0,m.select)(T);case 4:return o=h.sent,i=o.rtsHost,c=o.authToken,u=(0,b.getSystemChannel)("rts"),h.next=10,(0,m.call)(C.postContacts,i,c,{contact_type:"phone",contact:r});case 10:return l=h.sent,h.next=13,(0,m.call)(C.postPhonebook,i,c,{name:n,entry_id:(0,v.default)(),contacts:l.map(function(e){return e.id_uuid})});case 13:return d=h.sent,p=s(d.phonebook,1),f=p[0],h.next=17,(0,m.fork)(y.push,u,"users_status_list");case 17:return h.next=19,[(0,m.put)(g.uploadPhonebookSuccess(a({},f,{contacts:l}),d.phonebook_version)),(0,m.fork)(_.fetchProfiles,l.map(function(e){return e.user_huid}))];case 19:h.next=25;break;case 21:return h.prev=21,h.t0=h.catch(1),h.next=25,(0,m.put)(E.showNotifier("Add contact error","error"));case 25:case"end":return h.stop()}},j,this,[[1,21]])}function p(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,[(0,m.fork)(l,{connType:"rts"}),(0,m.fork)(l,{connType:"cts"})];case 2:case"end":return e.stop()}},k,this)}function f(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,[(0,m.takeLatest)(g.UPLOAD_PHONEBOOK,d)];case 2:return e.next=4,[(0,m.takeLatest)(g.FETCH_PHONEBOOK,p)];case 4:case"end":return e.stop()}},P,this)}Object.defineProperty(t,"__esModule",{value:!0}),t.fetchPhonebook=l,t.uploadPhonebookSaga=d,t.rootPhonebookSaga=f,t.getPhonebook=t.getUser=void 0;var m=n("./node_modules/redux-saga/es/effects.js"),h=n("./node_modules/redux-saga/es/index.js"),y=n("./app/sagas/channels.js"),_=n("./app/sagas/profiles.js"),b=n("./lib/sockets.js"),v=function(e){return e&&e.__esModule?e:{default:e}}(n("./lib/uuid5.js")),g=r(n("./app/modules/phonebook.js")),E=r(n("./app/modules/notifiers.js")),S=r(n("./app/modules/user.js")),O=n("./app/helpers/phonebookHelpers.js"),C=r(n("./app/api/phonebook.js")),w=regeneratorRuntime.mark(l),j=regeneratorRuntime.mark(d),k=regeneratorRuntime.mark(p),P=regeneratorRuntime.mark(f),T=function(e){return e.user};t.getUser=T;var x=function(e){return e.phonebook};t.getPhonebook=x},"./app/sagas/profiles.js":function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}function a(e,t,n){var r,a,d,p,f,m,h;return regeneratorRuntime.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(c.prev=0,null===e||void 0===e?void 0:e.length){c.next=3;break}return c.abrupt("return");case 3:return c.next=5,(0,o.select)(l);case 5:return r=c.sent,c.next=8,(0,o.select)(u);case 8:if(a=c.sent,d=a.rtsHost,p=a.authToken,d&&p){c.next=13;break}return c.abrupt("return");case 13:f=e.filter(function(e){if(!e)return!1;var a=r.find(function(t){return t.user_huid===e});return t||!a||a&&!a.cts_profile&&"cts"===n});case 14:if(!f.length){c.next=24;break}return m=f.splice(0,20),c.next=18,(0,o.call)(i.fetchProfiles,d,p,m,"rts");case 18:if(h=c.sent,!(null===h||void 0===h?void 0:h.length)){c.next=22;break}return c.next=22,(0,o.put)(s.profilesFetched(h));case 22:c.next=14;break;case 24:c.next=29;break;case 26:c.prev=26,c.t0=c.catch(0),console.error("fetchProfiles error: ".concat(c.t0.message));case 29:case"end":return c.stop()}},c,this,[[0,26]])}Object.defineProperty(t,"__esModule",{value:!0}),t.fetchProfiles=a,t.getProfiles=t.getUser=void 0;var o=n("./node_modules/redux-saga/es/effects.js"),s=r(n("./app/modules/profiles.js")),i=r(n("./app/api/phonebook.js")),c=regeneratorRuntime.mark(a),u=function(e){return e.user};t.getUser=u;var l=function(e){return e.profiles};t.getProfiles=l},"./app/sagas/push.js":function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}function a(){var e,t,n,r,a,o;return regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,(0,d.call)(_.registerServiceWorker);case 3:return e=s.sent,s.next=6,(0,d.call)(_.getPushSubscription,e);case 6:return t=s.sent,n=(0,_.getGcmTokenFromSubscription)(t),r=(0,_.getKeys)(t),a=r.encryptionKey,o=r.authKey,s.abrupt("return",{gcmToken:n,encryptionKey:a,authKey:o});case 12:s.prev=12,s.t0=s.catch(0),console.log(s.t0.message);case 15:return s.abrupt("return",{});case 16:case"end":return s.stop()}},b,this,[[0,12]])}function o(){var e,t,n,r,o,s,i,c,u,l,p,y,_,b;return regeneratorRuntime.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.prev=0,v.next=3,(0,d.select)(O);case 3:return e=v.sent,v.next=6,(0,d.select)(w);case 6:return t=v.sent,n=e.authToken,r=e.rtsHost,o=e.huid,s=e.udid,i=e.phone,c=e.ctsServer,u=e.ctsAuthToken,v.next=10,(0,d.call)(a);case 10:if(l=v.sent,p=l.gcmToken,y=l.encryptionKey,_=l.authKey,p){v.next=16;break}return v.abrupt("return");case 16:return v.next=18,e.ctsWeb?(0,d.call)(h.uploadPushTokenCtsWeb,c,u,p,o,s,t,y,_):(0,d.call)(m.registerPushToken,r,i,n,p,o,s,t,y,_);case 18:if(b=v.sent,"ok"!==(null===b||void 0===b?void 0:b.status)){v.next=22;break}return v.next=22,(0,d.put)(f.setUserData({pushToken:p}));case 22:v.next=27;break;case 24:v.prev=24,v.t0=v.catch(0),console.error("Error register push ".concat(v.t0.message));case 27:case"end":return v.stop()}},v,this,[[0,24]])}function s(){var e,t,n,r,a,o,s;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,(0,d.select)(O);case 3:return e=i.sent,t=e.rtsHost,n=e.authToken,r=e.ctsServer,a=e.ctsAuthToken,o=e.pushToken,i.next=7,(0,d.call)(_.registerServiceWorker);case 7:return s=i.sent,i.next=10,(0,d.call)(_.deletePushSubscription,s);case 10:if(!o){i.next=13;break}return i.next=13,e.ctsWeb?(0,d.call)(h.deletePushTokenCtsWeb,r,a,o):(0,d.call)(m.deletePushToken,t,n,o);case 13:i.next=18;break;case 15:i.prev=15,i.t0=i.catch(0),console.error("unregisterPush error: ".concat(i.t0.message));case 18:case"end":return i.stop()}},g,this,[[0,15]])}function i(e){var t=e.payload,n=t.payload;t.port.postMessage({status:"ok"}),(0,l.default)().push("/chats/".concat(n.group_chat_id))}function c(e){var t,n,r;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return t=e.payload,n=t.payload,r=t.port,r.postMessage({status:"ok"}),a.next=4,(0,d.fork)(y.handleVoexPush,n);case 4:case"end":return a.stop()}},E,this)}function u(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,[(0,d.takeEvery)(p.ACTIVATE_CHAT_FROM_PUSH,i),(0,d.takeEvery)(p.ACTIVATE_CALL_FROM_PUSH,c)];case 2:case"end":return e.stop()}},S,this)}Object.defineProperty(t,"__esModule",{value:!0}),t.getGcmSubscription=a,t.registerPush=o,t.unregisterPush=s,t.activateChatFromPushSaga=i,t.activateCallFromPushSaga=c,t.rootPushSaga=u,t.getLocale=t.getAppFocus=t.getUser=void 0;var l=function(e){return e&&e.__esModule?e:{default:e}}(n("./node_modules/history/createHashHistory.js")),d=n("./node_modules/redux-saga/es/effects.js"),p=r(n("./app/modules/push.js")),f=r(n("./app/modules/user.js")),m=r(n("./app/api/push.js")),h=r(n("./app/api/cts.js")),y=n("./app/sagas/voex.js"),_=n("./app/helpers/push.js"),b=regeneratorRuntime.mark(a),v=regeneratorRuntime.mark(o),g=regeneratorRuntime.mark(s),E=regeneratorRuntime.mark(c),S=regeneratorRuntime.mark(u),O=function(e){return e.user};t.getUser=O;var C=function(e){return e.ui.appInFocus};t.getAppFocus=C;var w=function(e){return e.ui.locale};t.getLocale=w},"./app/sagas/sockets.js":function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}function a(e){var t,n,r,a,o,s,i,c,u,l,d;return regeneratorRuntime.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.prev=0,f.next=3,(0,p.select)(j);case 3:return t=f.sent,n=t.authToken,r=t.ctsAuthToken,a=t.rtsHost,o=t.ctsServer,s="rts"===e?n:r,i="rts"===e?a:o,f.next=9,(0,p.select)(P,e);case 9:return c=f.sent,u=(0,b.generateKxPair)(),l={transportEndPoint:"websocket_enc",params:{version:3,token:s,pk:(0,b.toBase64Url)(u.publicKey),features:!1,auto_join:!1},pushTimeouts:{chat_list:2e4}},(null===c||void 0===c?void 0:c.id)&&(l.params.key_id=c.id),f.next=15,(0,p.call)(y.connect,i,e,l,u,k);case 15:return d=f.sent,f.next=18,(0,p.fork)(_.joinChannel,d,"system",e);case 18:f.next=23;break;case 20:f.prev=20,f.t0=f.catch(0),Object({PRODUCTION:1,NODE_ENV:"production"}).TEST||console.log("Error connecting socket ".concat(null===f.t0||void 0===f.t0?void 0:f.t0.message));case 23:case"end":return f.stop()}},g,this,[[0,20]])}function o(e){try{(0,y.disconnect)(e)}catch(e){Object({PRODUCTION:1,NODE_ENV:"production"}).TEST||console.log("disconnectSocket error: ".concat(null===e||void 0===e?void 0:e.message))}}function s(e){try{e.reconnectTimer.reset()}catch(e){console.log("stopReconnecting error: ".concat(e.message))}}function i(e){var t,n,r,a;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(null===e||void 0===e||!e.error||"rts"!==(null===e||void 0===e?void 0:null===(t=e.socket)||void 0===t?void 0:t.connType)){o.next=10;break}return o.next=3,(0,p.select)(j);case 3:return n=o.sent,o.next=6,(0,p.call)(v.checkTokenActive,n.rtsHost,n.authToken);case 6:if(r=o.sent,"error"!==(null===r||void 0===r?void 0:r.status)||"unauthorized"!==(null===r||void 0===r?void 0:r.reason)){o.next=10;break}return o.next=10,(0,p.call)(s,e.socket);case 10:if(a=["rts","cts"].reduce(function(e,t){var n=(0,y.getSocket)(t);return e&&(!n||"open"===(null===n||void 0===n?void 0:n.connectionState()))},!0)){o.next=14;break}return o.next=14,(0,p.put)(h.showStatusMessage(h.systemMessages.connecting));case 14:if(!a){o.next=17;break}return o.next=17,(0,p.put)(h.hideStatusMessage());case 17:case"end":return o.stop()}},E,this)}function c(){var e;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=3,(0,p.take)(k);case 3:return e=t.sent,t.next=6,(0,p.call)(i,e);case 6:t.next=0;break;case 8:case"end":return t.stop()}},S,this)}function u(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,p.call)(i);case 2:case"end":return e.stop()}},O,this)}function l(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,p.put)(h.showStatusMessage(h.systemMessages.connecting));case 2:case"end":return e.stop()}},C,this)}function d(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,[(0,p.takeEvery)(m.NETWORK_ONLINE,u),(0,p.takeEvery)(m.NETWORK_OFFLINE,l),c()];case 2:case"end":return e.stop()}},w,this)}Object.defineProperty(t,"__esModule",{value:!0}),t.connectSocket=a,t.disconnectSocket=o,t.stopReconnecting=s,t.handleConnectionStatus=i,t.rootSocketsSaga=d,t.getUserPublicKey=t.connectionStatusChannel=t.getUser=void 0;var p=n("./node_modules/redux-saga/es/effects.js"),f=n("./node_modules/redux-saga/es/index.js"),m=r(n("./app/modules/socket.js")),h=r(n("./app/modules/ui.js")),y=n("./lib/sockets.js"),_=n("./app/sagas/channels.js"),b=n("./lib/encryption.js"),v=r(n("./app/api/authentication.js")),g=regeneratorRuntime.mark(a),E=regeneratorRuntime.mark(i),S=regeneratorRuntime.mark(c),O=regeneratorRuntime.mark(u),C=regeneratorRuntime.mark(l),w=regeneratorRuntime.mark(d),j=function(e){return e.user};t.getUser=j;var k=(0,f.channel)();t.connectionStatusChannel=k;var P=function(e,t){return e.encryptionKeys.user.publicKeys[t]};t.getUserPublicKey=P},"./app/sagas/ui.js":function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}function o(){var e,t,n,r,a;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,(0,v.fork)(M.watchWindowEvents);case 3:return o.next=5,(0,v.select)(re);case 5:return e=o.sent,t=(navigator.language||navigator.userLanguage||"en").substr(0,2),o.next=9,(0,v.put)(C.setLocale(e||t));case 9:return o.next=11,(0,v.select)(te);case 11:return n=o.sent,r=n.server,o.next=15,(0,v.select)(ee);case 15:if(a=o.sent,r&&r.rts&&(r.cts||!a.ctsAuthToken)){o.next=19;break}return o.next=19,(0,v.put)(k.loadServerPublicKeys());case 19:return o.next=21,(0,v.fork)(N.checkUdid);case 21:return o.next=23,(0,v.fork)(N.establishAuth);case 23:return o.next=25,(0,v.fork)(s);case 25:return o.next=27,(0,v.fork)(I.sendMessageToServiceWorker,"APP_LOADED");case 27:return o.next=29,(0,v.fork)(_);case 29:o.next=34;break;case 31:o.prev=31,o.t0=o.catch(0),console.error("Error init app: ".concat(o.t0.message));case 34:case"end":return o.stop()}},K,this,[[0,31]])}function s(){var e,t;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,e=(0,x.loadKey)("appVersion"),n.next=4,(0,v.call)(T.fetchAppVersion);case 4:if(t=n.sent,e||((0,x.saveKey)("appVersion","1.2.788"),e="1.2.788"),!t||e===t){n.next=9;break}return n.next=9,(0,v.put)(C.hasNewAppVersion(t));case 9:return n.prev=9,n.next=12,(0,v.call)(g.delay,F.CHECK_UPDATES_PERIOD);case 12:return n.next=14,(0,v.fork)(s);case 14:return n.finish(9);case 15:case"end":return n.stop()}},B,this,[[0,,9,15]])}function i(e){var t,n;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return t=e.payload,r.prev=1,r.next=4,(0,v.select)(ne);case 4:return n=r.sent,(0,x.saveKey)("appVersion",n),(0,x.saveKey)("updateApp",!0),r.next=9,(0,v.call)(T.fetchIndex);case 9:if(!t){r.next=12;break}return r.next=12,(0,v.call)(N.logoutRtsSaga);case 12:location.reload(),r.next=18;break;case 15:r.prev=15,r.t0=r.catch(1),console.warn("Error begin update app: ".concat(r.t0.message));case 18:case"end":return r.stop()}},G,this,[[1,15]])}function c(e){var t,n,r,a;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if((0,S.default)(E.default),null!==(t=e.payload)){o.next=4;break}return o.abrupt("return");case 4:return o.prev=4,(0,U.setLocale)(t),o.next=8,(0,v.select)(ee);case 8:if(n=o.sent,r=n.authToken,a=n.pushToken,!r||!a){o.next=14;break}return o.next=14,(0,v.fork)(R.registerPush);case 14:u(t),o.next=20;break;case 17:o.prev=17,o.t0=o.catch(4),console.error("setLocaleSaga error: ".concat(o.t0.message));case 20:case"end":return o.stop()}},Y,this,[[4,17]])}function u(e){if(e){var t="[".concat((0,U.formatMessage)(se.yesterday),"]"),n="[".concat((0,U.formatMessage)(se.today),"]"),r=[(0,U.formatMessage)(se.sunday),(0,U.formatMessage)(se.monday),(0,U.formatMessage)(se.tuesday),(0,U.formatMessage)(se.wednesday),(0,U.formatMessage)(se.thursday),(0,U.formatMessage)(se.friday),(0,U.formatMessage)(se.saturday)];E.default.locale(e),E.default.updateLocale(e,{calendar:{lastDay:t,sameDay:n},weekdays:r})}}function l(){var e;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,(0,v.select)(ne);case 3:e=t.sent,(0,x.saveKey)("appVersion",e),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),console.error("Error saving appVersion in storage: ".concat(t.t0.message));case 10:case"end":return t.stop()}},V,this,[[0,7]])}function d(e){var t,n,r,a;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return t=e.payload.pathname,o.next=3,(0,v.select)(oe);case 3:if(n=o.sent,t!==n){o.next=6;break}return o.abrupt("return");case 6:if(r=(0,L.matchChatId)(t),a=(0,L.matchChatId)(n),!r){o.next=11;break}return o.next=11,(0,v.put)(C.setChatFsmState(r,C.chatState.switchChat));case 11:if(!a){o.next=18;break}return o.next=14,(0,v.put)(j.showDraftMessage(a));case 14:return o.next=16,(0,v.call)(g.delay,500);case 16:return o.next=18,(0,v.put)(w.chatPositionReportUpdated(a,null));case 18:case"end":return o.stop()}},W,this)}function p(e){var t;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,(0,v.select)(ae,e);case 3:return t=n.sent,n.next=6,(0,v.put)(C.setChatFsmState(e,C.chatState.receiveMessage));case 6:return n.next=8,(0,v.put)(C.setChatFsmState(e,t));case 8:n.next=13;break;case 10:n.prev=10,n.t0=n.catch(0),console.error("setChatFsmStateOnChatEvent error: ".concat(n.t0.message));case 13:case"end":return n.stop()}},q,this,[[0,10]])}function f(e){var t;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(t=e.payload,n.prev=1,!t){n.next=5;break}return n.next=5,(0,v.call)(I.sendMessageToServiceWorker,"CLOSE_ALL_NOTIFICATIONS");case 5:return n.next=7,(0,v.put)(C.setSilentMode(t));case 7:n.next=12;break;case 9:n.prev=9,n.t0=n.catch(1),console.error("appInFocusSaga error: ".concat(n.t0.message));case 12:case"end":return n.stop()}},z,this,[[1,9]])}function m(e){var t,n,r,a;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:t=e.payload.type,o.prev=1,n="1.2.788",r=e.payload.version,a=(0,D.isVersionHigher)(n,r),o.t0=t,o.next="must_update"===o.t0?8:"must_clear_data"===o.t0?12:"must_update_and_clear_data"===o.t0?15:18;break;case 8:if(!a){o.next=11;break}return o.next=11,(0,v.put)(C.showUiAlert(e.payload));case 11:return o.abrupt("break",19);case 12:return o.next=14,(0,v.put)(C.showUiAlert({type:t}));case 14:return o.abrupt("break",19);case 15:return o.next=17,(0,v.put)(C.showUiAlert({type:a?"must_update_and_clear_data":"must_clear_data",version:r}));case 17:case 18:return o.abrupt("break",19);case 19:o.next=24;break;case 21:o.prev=21,o.t1=o.catch(1),console.error("uiAlertSaga error: ".concat(o.t1.message));case 24:case"end":return o.stop()}},Q,this,[[1,21]])}function h(e){var t;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return t=e.payload.appInFocus,n.prev=1,n.next=4,(0,v.call)(g.delay,500);case 4:return n.next=6,[(0,v.fork)(y,t,"rts"),(0,v.fork)(y,t,"cts")];case 6:n.next=11;break;case 8:n.prev=8,n.t0=n.catch(1),console.error("setSilentModeSaga error: ".concat(n.t0.message));case 11:case"end":return n.stop()}},X,this,[[1,8]])}function y(e,t){var n;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,!(n=(0,H.getSystemChannel)(t))){r.next=5;break}return r.next=5,(0,v.call)(A.push,n,e?"silent_on":"silent_off");case 5:r.next=10;break;case 7:r.prev=7,r.t0=r.catch(0),console.error("pushSilent error: ".concat(r.t0.message));case 10:case"end":return r.stop()}},J,this,[[0,7]])}function _(){var e,t,n,r,a,o;return regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(e="R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs=",t=new Blob([atob(e)],{type:"image/gif"}),n=URL.createObjectURL(t),r=new Image,document.body.appendChild(r),r.src=n,a=window.getComputedStyle(r),o=a.display,document.body.removeChild(r),"none"!==o){s.next=11;break}return s.next=11,(0,v.put)(P.showNotifier((0,U.formatMessage)(se.adblock),"error",!0));case 11:case"end":return s.stop()}},Z,this)}function b(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,[(0,v.takeLatest)(C.INIT_APP,o),(0,v.takeLatest)(C.UPDATE_APP,i),(0,v.takeLatest)(C.SET_LOCALE,c),(0,v.takeLatest)(C.HIDE_UPDATE_DIALOG,l),(0,v.takeEvery)(C.SET_APP_IN_FOCUS,f),(0,v.takeEvery)("@@router/LOCATION_CHANGE",d),(0,v.takeEvery)(C.UI_ALERT_RECEIVED,m),(0,v.takeLatest)(C.SET_SILENT_MODE,h)];case 2:case"end":return e.stop()}},$,this)}Object.defineProperty(t,"__esModule",{value:!0}),t.initAppSaga=o,t.checkNewAppVersion=s,t.setMomentLocale=u,t.locationChangeSaga=d,t.setChatFsmStateOnChatEvent=p,t.appInFocusSaga=f,t.uiAlertSaga=m,t.setSilentModeSaga=h,t.pushSilent=y,t.checkAdblock=_,t.rootUiSaga=b,t.getPrevLocation=t.getChatFsmState=t.getLocale=t.getEncryptionKeys=t.getUser=void 0;var v=n("./node_modules/redux-saga/es/effects.js"),g=n("./node_modules/redux-saga/es/index.js"),E=a(n("./node_modules/moment/moment.js")),S=a(n("./node_modules/moment-duration-format/lib/moment-duration-format.js")),O=n("./node_modules/react-intl/lib/index.es.js"),C=r(n("./app/modules/ui.js")),w=r(n("./app/modules/chats.js")),j=r(n("./app/modules/drafts.js")),k=r(n("./app/modules/encryptionKeys.js")),P=r(n("./app/modules/notifiers.js")),T=n("./app/api/update.js"),x=n("./lib/localStorage.js"),M=n("./app/sagas/windowEvents.js"),N=n("./app/sagas/user.js"),A=n("./app/sagas/channels.js"),R=n("./app/sagas/push.js"),I=n("./app/helpers/push.js"),D=n("./app/helpers/appHelpers.js"),L=n("./app/helpers/routing.js"),U=n("./lib/reactIntl.js"),F=n("./lib/constants.js"),H=n("./lib/sockets.js"),K=regeneratorRuntime.mark(o),B=regeneratorRuntime.mark(s),G=regeneratorRuntime.mark(i),Y=regeneratorRuntime.mark(c),V=regeneratorRuntime.mark(l),W=regeneratorRuntime.mark(d),q=regeneratorRuntime.mark(p),z=regeneratorRuntime.mark(f),Q=regeneratorRuntime.mark(m),X=regeneratorRuntime.mark(h),J=regeneratorRuntime.mark(y),Z=regeneratorRuntime.mark(_),$=regeneratorRuntime.mark(b),ee=function(e){return e.user};t.getUser=ee;var te=function(e){return e.encryptionKeys};t.getEncryptionKeys=te;var ne=function(e){return e.ui.availableAppVersion},re=function(e){return e.ui.locale};t.getLocale=re;var ae=function(e,t){return(e.ui.chats[t]||{}).state||C.chatState.uninitialized};t.getChatFsmState=ae;var oe=function(e){return e.ui.prevLocation};t.getPrevLocation=oe;var se=(0,O.defineMessages)({yesterday:{id:"[days] yesterday",defaultMessage:"yesterday"},today:{id:"[days] today",defaultMessage:"today"},sunday:{id:"[days] sunday",defaultMessage:"sunday"},monday:{id:"[days] monday",defaultMessage:"monday"},tuesday:{id:"[days] tuesday",defaultMessage:"tuesday"},wednesday:{id:"[days] wednesday",defaultMessage:"wednesday"},thursday:{id:"[days] thursday",defaultMessage:"thursday"},friday:{id:"[days] friday",defaultMessage:"friday"},saturday:{id:"[days] saturday",defaultMessage:"saturday"},adblock:{id:"[notification] adblock",defaultMessage:"Adblock detected. You must disable Adblock to see images."}})},"./app/sagas/user.js":function(e,t,n){"use strict";(function(e){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){s(e,t,n[t])})}return e}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e){return{wrong_confirmation_code:(0,U.formatMessage)(Le.wrongConfirmationCode),activation_not_found:(0,U.formatMessage)(Le.activationNotFound),user_already_confirmed:(0,U.formatMessage)(Le.userAlreadyConfirmed),confirmation_limit_exceeded:(0,U.formatMessage)(Le.confirmationLimitExceeded),sms_limit_exceeded:(0,U.formatMessage)(Le.smsLimitExceeded),sms_error:(0,U.formatMessage)(Le.smsError)}[e]}function c(){var e,t;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,(0,A.select)(Ae);case 3:return e=n.sent,t=e.udid||(0,q.default)(),n.next=7,(0,A.put)(G.checkUdidSuccess(t));case 7:n.next=12;break;case 9:n.prev=9,n.t0=n.catch(0),console.error("check udid saga error: ".concat(n.t0.message));case 12:case"end":return n.stop()}},se,this,[[0,9]])}function u(e){var t,n,r,a,o,s;return regeneratorRuntime.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return t=e.payload,n=t.host,r=t.phone,l.prev=1,l.next=4,[(0,A.fork)(c),(0,A.take)(G.CHECK_UDID_SUCCESS),(0,A.put)(V.setAuthFetching(!0))];case 4:return l.next=6,(0,A.select)(Ae);case 6:return a=l.sent,o=a.udid,l.next=10,(0,A.call)(B.register,n,r,o);case 10:if(s=l.sent,"ok"!==s.status||s.result!==G.authStatusEnum.registered){l.next=16;break}return l.next=14,(0,A.put)(G.authStatusChanged(G.authStatusEnum.confirm,{phone:r}));case 14:return l.next=16,(0,A.put)(G.setUserData({registerTimestamp:(0,ee.generateTimestamp)()}));case 16:if("error"!==s.status||"sms_limit_exceeded"!==s.reason){l.next=21;break}return l.next=19,(0,A.put)(G.setUserData({udid:(0,q.default)()}));case 19:return l.next=21,(0,A.fork)(u,e);case 21:if("error"!==s.status||"sms_error"!==s.reason){l.next=24;break}return l.next=24,(0,A.put)(Y.showNotifier(i(s.reason),"error",!0));case 24:l.next=29;break;case 26:l.prev=26,l.t0=l.catch(1),Object({PRODUCTION:1,NODE_ENV:"production"}).TEST||console.error("register auth saga error: ".concat(l.t0.message));case 29:return l.prev=29,l.next=32,(0,A.put)(V.setAuthFetching(!1));case 32:return l.finish(29);case 33:case"end":return l.stop()}},ie,this,[[1,26,29,33]])}function l(e){var t,n,r,a,o;return regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return t=e.payload,n=t.host,r=t.phone,s.prev=1,s.next=4,(0,A.select)(Ae);case 4:return a=s.sent,s.next=7,(0,A.call)(B.resend,n,r,a.udid);case 7:return o=s.sent,s.next=10,(0,A.put)(G.setUserData({confirmationLimitExceeded:!1}));case 10:if("ok"!==o.status){s.next=15;break}return s.next=13,(0,A.put)(G.authStatusChanged(G.authStatusEnum.confirm,{phone:r}));case 13:return s.next=15,(0,A.put)(G.setUserData({registerTimestamp:(0,ee.generateTimestamp)()}));case 15:if("error"!==o.status||!["sms_limit_exceeded","confirmation_limit_exceeded"].includes(o.reason)){s.next=20;break}return s.next=18,(0,A.put)(G.setUserData({udid:(0,q.default)()}));case 18:return s.next=20,(0,A.fork)(l,e);case 20:s.next=27;break;case 22:return s.prev=22,s.t0=s.catch(1),Object({PRODUCTION:1,NODE_ENV:"production"}).TEST||console.error("resend confirmation code saga error: ".concat(s.t0.message)),s.next=27,(0,A.put)(G.authStatusChanged(G.authStatusEnum.unregistered));case 27:case"end":return s.stop()}},ce,this,[[1,22]])}function d(e){var t,n,r,a,o,s,c,u,l,d,p,f,m,h,y,_,b,v,g,E,S;return regeneratorRuntime.wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return n=e.payload,r=n.host,a=n.code,o=n.forceCtsLogout,O.prev=1,O.next=4,(0,A.select)(Ae);case 4:return s=O.sent,O.next=7,(0,A.call)(B.confirm,r,s.phone,a,s.udid,o);case 7:if(c=O.sent,"error"!==c.status){O.next=36;break}l=(null===(u=c.reason)||void 0===u?void 0:u.reason)||c.reason,O.t0=l,O.next="user_is_logged_in_cts"===O.t0?13:"logout_not_approved"===O.t0?16:"activation_not_found"===O.t0?22:"confirmation_limit_exceeded"===O.t0?27:32;break;case 13:return O.next=15,(0,A.put)(G.authStatusChanged(G.authStatusEnum.ctsRegular,{code:a,huid:c.error_data.user_huid,wasOnCts:!0}));case 15:return O.abrupt("break",35);case 16:return d=(null===(t=c.reason.error_data)||void 0===t?void 0:t.admin_info)||c.error_data.admin_info,O.next=19,(0,A.put)(G.requestLogoutCtsSuccess(d));case 19:return O.next=21,(0,A.put)(G.authStatusChanged(G.authStatusEnum.ctsRegular));case 21:return O.abrupt("break",35);case 22:return O.next=24,(0,A.put)(G.authStatusChanged(G.authStatusEnum.unregistered));case 24:return O.next=26,(0,A.put)(Y.showNotifier(i(c.reason),"error"));case 26:return O.abrupt("break",35);case 27:return O.next=29,(0,A.put)(G.setUserData({confirmationLimitExceeded:!0}));case 29:return O.next=31,(0,A.put)(Y.showNotifier(i(c.reason),"error"));case 31:return O.abrupt("break",35);case 32:return O.next=34,(0,A.put)(Y.showNotifier(i(c.reason),"error"));case 34:return O.abrupt("break",35);case 35:return O.abrupt("return");case 36:if(p=s.phone,f=s.rtsHost,m=c.auth_token,h=c.expires_at,y=c.user_huid,_=c.active,b=c.key_id,v=c.server_id,g={active:_,authToken:m,expiresAt:h,huid:y,phone:p,keyId:b,rtsHost:f,rtsServerId:v},_){O.next=44;break}return O.next=42,(0,A.put)(G.authStatusChanged(G.authStatusEnum.emptyKeysPass,g));case 42:O.next=50;break;case 44:return O.next=46,(0,A.call)(z.fetchUserKeys,f,m,y,"rts");case 46:return E=O.sent,S="ok"===E?G.authStatusEnum.keysPassDecrypt:G.authStatusEnum.emptyKeysPass,O.next=50,(0,A.put)(G.authStatusChanged(S,g));case 50:O.next=57;break;case 52:return O.prev=52,O.t1=O.catch(1),Object({PRODUCTION:1,NODE_ENV:"production"}).TEST||console.error("confirm saga error: ".concat(O.t1.message)),O.next=57,(0,A.put)(Y.showNotifier((0,U.formatMessage)(Le.serverError),"error",!0));case 57:case"end":return O.stop()}},ue,this,[[1,52]])}function p(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,A.call)(R.delay,ae.PUSH_REGISTER_DELAY);case 2:return e.next=4,(0,A.fork)(J.registerPush);case 4:return e.next=6,(0,A.call)(X.checkNotificationsPermission);case 6:case"end":return e.stop()}},le,this)}function f(){var e,t,n,r,a,o,s,i,c,u,l;return regeneratorRuntime.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.prev=0,d.next=3,(0,A.select)(Ae);case 3:return e=d.sent,t=e.authToken,n=e.ctsAuthToken,r=e.ctsServer,a=e.rtsHost,o=e.authStatus,d.next=11,(0,A.select)(Re);case 11:if(s=d.sent,i=[G.authStatusEnum.unregistered,G.authStatusEnum.confirm,G.authStatusEnum.emptyKeysPass,G.authStatusEnum.newKeysPass,G.authStatusEnum.keysPassDecrypt,G.authStatusEnum.profile,G.authStatusEnum.ctsRegular],t&&!i.includes(o)){d.next=15;break}return d.abrupt("return");case 15:return d.next=17,(0,A.fork)(B.activation,a,t,"1.2.788",s);case 17:if(c=!!n&&!!r){d.next=22;break}return d.next=21,[(0,A.fork)(Z.connectSocket,"rts"),(0,A.fork)(h),(0,A.fork)(m),(0,A.fork)(p)];case 21:return d.abrupt("return");case 22:return d.next=24,(0,A.call)(F.checkTokenActive,r,n);case 24:if(u=d.sent,!(l=401===(null===u||void 0===u?void 0:u.status))){d.next=29;break}return d.next=29,[(0,A.put)(G.logoutCts()),(0,A.put)(G.authStatusChanged(G.authStatusEnum.registered))];case 29:return d.next=31,(0,A.fork)(Z.connectSocket,"rts");case 31:if(l){d.next=34;break}return d.next=34,(0,A.fork)(Z.connectSocket,"cts");case 34:return d.next=36,[(0,A.fork)(h),(0,A.fork)(m),(0,A.fork)(p)];case 36:d.next=41;break;case 38:d.prev=38,d.t0=d.catch(0),console.error("check credentials saga error: ".concat(d.t0.message));case 41:case"end":return d.stop()}},de,this,[[0,38]])}function m(){var e,t,n,r;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,(0,A.select)(Ae);case 3:return e=a.sent,t=e.rtsHost,n=e.authToken,a.next=8,(0,A.call)(H.fetchSelfProfile,t,n,"rts");case 8:return r=a.sent,a.next=11,(0,A.put)(G.fetchProfileSuccess(r.profile));case 11:a.next=16;break;case 13:a.prev=13,a.t0=a.catch(0),Object({PRODUCTION:1,NODE_ENV:"production"}).TEST||console.error("fetch profile error: ".concat(a.t0.message));case 16:case"end":return a.stop()}},pe,this,[[0,13]])}function h(){var e,t;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,(0,A.select)(Ae);case 3:return e=n.sent,n.next=6,(0,A.call)(K.fetchUserSettings,e.rtsHost,e.huid,e.authToken);case 6:return t=n.sent,n.next=9,(0,A.put)(G.fetchSettingsSuccess(t));case 9:n.next=14;break;case 11:n.prev=11,n.t0=n.catch(0),Object({PRODUCTION:1,NODE_ENV:"production"}).TEST||console.error("fetch settings error: ".concat(n.t0.message));case 14:case"end":return n.stop()}},fe,this,[[0,11]])}function y(){var e;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,(0,A.select)(Re);case 3:return e=t.sent,t.next=6,[(0,A.fork)(Z.disconnectSocket,"rts"),(0,A.fork)(Z.disconnectSocket,"cts"),(0,A.fork)(J.unregisterPush),(0,A.fork)($.cancelAllSelectChannelPromises)];case 6:return t.next=8,(0,A.put)(G.logoutRtsSuccess());case 8:return t.next=10,(0,A.put)(V.setLocale(e));case 10:return t.next=12,(0,A.put)(G.setUserData({registerTimestamp:null}));case 12:return t.next=14,(0,A.put)(W.loadServerPublicKeys());case 14:t.next=19;break;case 16:t.prev=16,t.t0=t.catch(0),Object({PRODUCTION:1,NODE_ENV:"production"}).TEST||console.error("logout rts saga error: ".concat(t.t0.message));case 19:case"end":return t.stop()}},me,this,[[0,16]])}function _(e){var t,n,r,a,o,s,i,c,u,l,d,p,f;return regeneratorRuntime.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return t=e.payload,n=t.server,r=t.login,a=t.password,o=t.domain,m.prev=1,m.next=4,(0,A.put)(V.setAuthFetching(!0));case 4:return m.next=6,(0,A.select)(Ae);case 6:return s=m.sent,i=s.huid,c=s.udid,m.next=11,(0,A.call)(F.authenticate,n,i,c,r,a,o);case 11:if(u=m.sent,null===u||void 0===u?void 0:u.status){m.next=18;break}return m.next=15,(0,A.put)(V.setAuthFetching(!1));case 15:return m.next=17,(0,A.put)(Y.showNotifier((0,U.formatMessage)(Le.corporateServerLoginError),"error",!0));case 17:return m.abrupt("return",m.sent);case 18:if("error"!==(null===u||void 0===u?void 0:u.status)){m.next=24;break}return m.next=21,(0,A.put)(V.setAuthFetching(!1));case 21:return m.next=23,(0,A.put)(Y.showNotifier((0,te.getErrorText)(u.reason),"error"));case 23:return m.abrupt("return",m.sent);case 24:return m.next=26,(0,A.put)(G.loginCtsSuccess({token:u.access_token,server:n,login:r,corpAvatar:u.corp_avatar,ctsServerId:u.server_id}));case 26:return m.next=28,(0,A.select)(Ae);case 28:if(l=m.sent,d=l.authStatus,p=l.authToken,f=[G.authStatusEnum.ctsOffer,G.authStatusEnum.ctsMultidevice,G.authStatusEnum.ctsRequestLogout,G.authStatusEnum.ctsForce],!f.includes(d)||!p){m.next=35;break}return m.next=35,(0,A.put)(G.authStatusChanged(G.authStatusEnum.registered));case 35:return m.next=37,(0,A.put)(W.loadServerPublicKeys());case 37:return m.next=39,[(0,A.fork)(Z.connectSocket,"cts"),(0,A.call)(z.uploadCtsPublicKey)];case 39:return m.abrupt("return",m.sent);case 42:return m.prev=42,m.t0=m.catch(1),Object({PRODUCTION:1,NODE_ENV:"production"}).TEST||console.error("login cts saga error: ".concat(m.t0.message)),m.next=47,(0,A.put)(V.setAuthFetching(!1));case 47:return m.next=49,(0,A.put)(Y.showNotifier((0,U.formatMessage)(Le.corporateServerLoginError),"error",!0));case 49:return m.abrupt("return",m.sent);case 50:case"end":return m.stop()}},he,this,[[1,42]])}function b(e){var t,n,r,a,o,s,i,c,u;return regeneratorRuntime.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return t=e.payload,n=t.server,r=t.login,a=t.password,l.prev=1,l.next=4,(0,A.select)(Ae);case 4:return o=l.sent,s=o.udid,l.next=8,(0,A.call)(F.authenticateCtsWeb,n,s,r,a);case 8:if(i=l.sent,null===i||void 0===i?void 0:i.result){l.next=13;break}return l.next=12,(0,A.put)(Y.showNotifier((0,U.formatMessage)(Le.corporateServerLoginError),"error",!0));case 12:return l.abrupt("return",l.sent);case 13:if("authorized_on_ad"===(null===i||void 0===i?void 0:i.result)){l.next=17;break}return l.next=16,(0,A.put)(Y.showNotifier((0,te.getErrorText)(i.reason),"error"));case 16:return l.abrupt("return",l.sent);case 17:return l.next=19,(0,A.call)(z.fetchCtsWebKeys,n,i.user_huid,i.access_token);case 19:if(c=l.sent){l.next=24;break}return l.next=23,(0,A.put)(Y.showNotifier((0,U.formatMessage)(Le.corporateServerLoginError),"error",!0));case 23:return l.abrupt("return",l.sent);case 24:if("ok"===c.status){l.next=32;break}return l.next=27,(0,A.call)(z.uploadCtsWebKeys,n,i.user_huid,i.access_token);case 27:if((u=l.sent)&&"error"!==u.status){l.next=32;break}return l.next=31,(0,A.put)((0,U.formatMessage)(Le.corporateServerLoginError),"error",!0);case 31:return l.abrupt("return",l.sent);case 32:return l.next=34,(0,A.put)(G.loginCtsWebSuccess({huid:i.user_huid,token:i.access_token,ctsServerId:i.server_id,server:n,login:r,corpAvatar:i.corp_avatar,keyId:i.key_id}));case 34:return l.next=36,(0,A.fork)(Z.connectSocket,"cts");case 36:return l.abrupt("return",l.sent);case 39:return l.prev=39,l.t0=l.catch(1),Object({PRODUCTION:1,NODE_ENV:"production"}).TEST||console.error("loginCtsWebSaga error: ".concat(l.t0.message)),l.next=44,(0,A.put)(Y.showNotifier((0,U.formatMessage)(Le.corporateServerLoginError),"error",!0));case 44:return l.abrupt("return",l.sent);case 45:case"end":return l.stop()}},ye,this,[[1,39]])}function v(){var e,t,n,r,a,o,s;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,(0,A.select)(Ae);case 3:if(t=i.sent,t.ctsServer&&t.ctsAuthToken){i.next=12;break}return i.next=7,(0,A.call)(B.checkTokenActive,t.rtsHost,t.authToken);case 7:if(n=i.sent,"ok"!==(null===n||void 0===n?void 0:n.status)){i.next=11;break}return i.next=11,[(0,A.put)(G.logoutCts()),(0,A.put)(G.authStatusChanged(G.authStatusEnum.registered)),(0,A.fork)(ne.syncAllChats),(0,A.fork)(re.fetchPhonebook,{connType:"rts"})];case 11:return i.abrupt("return");case 12:return i.next=14,(0,A.call)(F.logout,t.ctsServer,t.ctsAuthToken);case 14:if(r=i.sent,a=(null===(e=r.reason)||void 0===e?void 0:e.reason)||r.reason,"error"!==r.status||"logout_not_approved"!==a){i.next=20;break}return s=(null===r||void 0===r?void 0:null===(o=r.error_data)||void 0===o?void 0:o.admin_info)||{emails:[]},i.next=20,[(0,A.fork)(Z.disconnectSocket,"cts"),(0,A.put)(G.requestLogoutCtsSuccess(s)),(0,A.put)(G.authStatusChanged(G.authStatusEnum.ctsRequestLogout))];case 20:i.next=25;break;case 22:i.prev=22,i.t0=i.catch(0),Object({PRODUCTION:1,NODE_ENV:"production"}).TEST||console.error("requestLogoutCtsSaga error: ".concat(i.t0.message));case 25:case"end":return i.stop()}},_e,this,[[0,22]])}function g(e){var t,n,r,a,o,s,i,c,u,l,d,p,f;return regeneratorRuntime.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return t=e.payload,n=t.newName,r=t.newAvatar,m.prev=1,m.next=4,(0,A.put)(V.setAuthFetching(!0));case 4:return m.next=6,(0,A.select)(Ae);case 6:return a=m.sent,o=a.authToken,s=a.rtsHost,i=a.authStatus,m.next=10,(0,A.call)(H.uploadProfile,s,n,r,o,"rts");case 10:return c=m.sent,u=c.profile,l=u.name,d=u.avatar,m.next=14,(0,A.put)(G.profileUploaded({name:l,avatar:d}));case 14:if(i!==G.authStatusEnum.registered){m.next=19;break}return m.next=17,(0,A.put)(Y.showNotifier((0,U.formatMessage)(Le.profileUploaded)));case 17:m.next=29;break;case 19:return m.next=21,(0,A.call)(B.checkTokenActive,s,o);case 21:if(p=m.sent,"error"!==p.status||"need_cts_login"!==p.reason){m.next=27;break}return m.next=25,(0,A.call)(O,{payload:null===(f=p.error_data)||void 0===f?void 0:f.endpoint});case 25:m.next=29;break;case 27:return m.next=29,(0,A.put)(G.authStatusChanged(G.authStatusEnum.registered));case 29:m.next=35;break;case 31:return m.prev=31,m.t0=m.catch(1),m.next=35,(0,A.put)(Y.showNotifier(m.t0.message,"error"));case 35:return m.prev=35,m.next=38,(0,A.put)(V.setAuthFetching(!1));case 38:return m.finish(35);case 39:case"end":return m.stop()}},be,this,[[1,31,35,39]])}function E(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,A.put)(G.multideviceLogout());case 2:case"end":return e.stop()}},ve,this)}function S(){var e,t,n;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,(0,A.select)(Ae);case 3:return e=r.sent,t=e.ctsServer,n=e.ctsAuthToken,r.next=8,[(0,A.put)(G.logoutCts()),(0,A.put)(G.authStatusChanged(G.authStatusEnum.registered))];case 8:return r.next=10,(0,A.call)(Z.disconnectSocket,"cts");case 10:return r.next=12,[(0,A.fork)(ne.syncAllChats),(0,A.fork)(re.fetchPhonebook,{connType:"rts"}),(0,A.fork)(F.confirmCtsLogout,t,n)];case 12:return r.next=14,(0,A.put)(Y.showNotifier((0,U.formatMessage)(Le.loggedOutCts),"notice",!0));case 14:r.next=20;break;case 16:return r.prev=16,r.t0=r.catch(0),r.next=20,(0,A.put)(Y.showNotifier(r.t0.message,"error"));case 20:case"end":return r.stop()}},ge,this,[[0,16]])}function O(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,A.put)(G.multideviceLogout());case 2:case"end":return e.stop()}},Ee,this)}function C(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,A.put)(V.showLoadingOverlay());case 3:return e.next=5,(0,A.call)(R.delay,3e3);case 5:return e.next=7,(0,A.call)(Z.disconnectSocket,"cts");case 7:return e.next=9,[(0,A.put)(G.logoutCts()),(0,A.put)(G.authStatusChanged(G.authStatusEnum.registered)),(0,A.fork)(ne.syncAllChats),(0,A.fork)(re.fetchPhonebook,{connType:"rts"})];case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),Object({PRODUCTION:1,NODE_ENV:"production"}).TEST||console.error("handleCtsLogout error: ".concat(e.t0.message));case 14:return e.prev=14,e.next=17,(0,A.put)(V.hideLoadingOverlay());case 17:return e.finish(14);case 18:case"end":return e.stop()}},Se,this,[[0,11,14,18]])}function w(e){var t;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,(0,A.select)(Ae);case 3:if(t=n.sent,t.huid!==e||t.ctsServer||t.ctsAuthToken){n.next=8;break}return n.next=7,(0,A.put)(G.authStatusChanged(G.authStatusEnum.ctsMultidevice));case 7:Me.push("/auth");case 8:n.next=13;break;case 10:n.prev=10,n.t0=n.catch(0),Object({PRODUCTION:1,NODE_ENV:"production"}).TEST||console.error("handleCtsLogin error: ".concat(n.t0.message));case 13:case"end":return n.stop()}},Oe,this,[[0,10]])}function j(){var e,t,n,r;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,(0,A.put)(V.showLoadingOverlay());case 3:return a.next=5,(0,A.call)(R.delay,500);case 5:return a.next=7,(0,A.select)(Ae);case 7:return e=a.sent,t=e.udid,n=e.authStatus,a.next=12,(0,A.select)(Re);case 12:if(r=a.sent,n!==G.authStatusEnum.qrMultidevice){a.next=15;break}return a.abrupt("return");case 15:return a.next=17,[(0,A.fork)(Z.disconnectSocket,"rts"),(0,A.fork)(Z.disconnectSocket,"cts"),(0,A.fork)(J.unregisterPush),(0,A.fork)($.cancelAllSelectChannelPromises),(0,A.put)(G.logoutRtsSuccess()),(0,A.put)(G.authStatusChanged(G.authStatusEnum.qrMultidevice,{registerTimestamp:null,udid:t})),(0,A.put)(V.setLocale(r))];case 17:a.next=22;break;case 19:a.prev=19,a.t0=a.catch(0),console.error("multideviceLogoutSaga error: ".concat(a.t0.message));case 22:return a.prev=22,a.next=25,(0,A.put)(V.hideLoadingOverlay());case 25:return a.finish(22);case 26:case"end":return a.stop()}},Ce,this,[[0,19,22,26]])}function k(){var e,t,n;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,(0,A.select)(Ae);case 2:return e=r.sent,t=e.wasOnCts,n=G.authStatusEnum.registered,r.next=7,(0,A.put)(G.authStatusChanged(n));case 7:return r.next=9,(0,A.call)(f);case 9:case"end":return r.stop()}},we,this)}function P(){var e,t,n;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,(0,A.select)(Ae);case 3:return e=r.sent,t=e.authStatus,n=e.wasOnCts,r.next=8,(0,A.fork)(f);case 8:if(t!==G.authStatusEnum.emptyKeysPass){r.next=11;break}return r.next=11,(0,A.put)(G.authStatusChanged(G.authStatusEnum.profile));case 11:if(t!==G.authStatusEnum.newKeysPass||!n){r.next=14;break}return r.next=14,(0,A.put)(G.authStatusChanged(G.authStatusEnum.registered));case 14:if(t!==G.authStatusEnum.newKeysPass||n){r.next=17;break}return r.next=17,(0,A.put)(G.authStatusChanged(G.authStatusEnum.registered));case 17:r.next=22;break;case 19:r.prev=19,r.t0=r.catch(0),Object({PRODUCTION:1,NODE_ENV:"production"}).TEST||console.error("userPublicKeyUploadedSaga error: ".concat(r.t0.message));case 22:case"end":return r.stop()}},je,this,[[0,19]])}function T(){var e,t,n;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,(0,A.select)(Ae);case 3:if(e=r.sent,t=e.authStatus,n=e.keysDecryptAttempts,t!==G.authStatusEnum.keysPassDecrypt||n){r.next=9;break}return r.next=9,[(0,A.put)(V.setAuthFetching(!1)),(0,A.put)(G.authStatusChanged(G.authStatusEnum.newKeysPass))];case 9:r.next=14;break;case 11:r.prev=11,r.t0=r.catch(0),Object({PRODUCTION:1,NODE_ENV:"production"}).TEST||console.error("keysDecryptAttemptUsedSaga error: ".concat(r.t0.message));case 14:case"end":return r.stop()}},ke,this,[[0,11]])}function x(){var e,t,n,r,a,o,s,i;return regeneratorRuntime.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.prev=0,c.next=3,(0,A.select)(Ie);case 3:if(e=c.sent,null===e||void 0===e?void 0:e.rts){c.next=7;break}return c.next=7,(0,A.call)(z.loadServerPublicKeysSaga);case 7:return c.next=9,(0,A.select)(Ae);case 9:return t=c.sent,n=t.rtsHost,r=t.authStatus,a=t.udid,o=(0,q.default)(),s=(0,Q.generateKxPair)(),c.next=17,(0,A.put)(G.setUserData({registrationId:o,udid:r===G.authStatusEnum.qrMultidevice?a:(0,q.default)()}));case 17:return c.next=19,(0,A.put)(W.setQrRequestKeys(s));case 19:return c.next=21,(0,A.call)(B.registerRequest,n,o,ae.REGISTER_REQUEST_LONG_POOL_TIMEOUT);case 21:if(i=c.sent,"ok"!==i.status){c.next=26;break}return c.next=25,(0,A.call)(M,i.result);case 25:return c.abrupt("return");case 26:if("error"!==i.status||"cts_registration_not_supported"!==i.reason){c.next=30;break}return c.next=29,[(0,A.put)(G.authStatusChanged(G.authStatusEnum.unregistered)),(0,A.put)(Y.showNotifier((0,U.formatMessage)(Le.registerRequestNotSupported),"notice",!0))];case 29:return c.abrupt("return");case 30:if("error"!==i.status||!i.reason){c.next=33;break}return c.next=33,(0,A.put)(Y.showNotifier((0,U.formatMessage)(Le.registerRequestError),"error"));case 33:c.next=38;break;case 35:c.prev=35,c.t0=c.catch(0),Object({PRODUCTION:1,NODE_ENV:"production"}).TEST||console.error("qrRegisterRequestSaga error: ".concat(c.t0.message));case 38:case"end":return c.stop()}},Pe,this,[[0,35]])}function M(e){var t,n,r,a,s,i,c,u,l,d,p,m,h,y,_,b,v,g,E,S,O,C;return regeneratorRuntime.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.prev=0,t=e.registration_id,n=e.registration_data,r=e.rts_registration_token,a=e.cts_registration_token,s=e.rts_pub_key,w.next=4,(0,A.select)(De);case 4:return i=w.sent,c=(0,Q.rsaDecrypt)((0,Q.fromBase64)(n),(0,Q.fromBase64)(s),i.private),u=new Ne("utf-8").decode(c),l=JSON.parse(u),w.next=10,(0,A.fork)(z.saveUserKeys,l);case 10:return d=l.cts_host,p=l.cts_login,m=l.region,h=l.phone,w.next=13,(0,A.select)(Ae);case 13:return y=w.sent,_=y.udid,w.next=17,(0,A.select)(Re);case 17:return b=w.sent,v=oe.default.regions[m].host,g=null===d||void 0===d?void 0:d.replace(/^(?:https?:\/\/)?([^\/]+).*/,"$1"),w.next=22,(0,A.call)(z.loadServerPublicKeysSaga,{payload:{rtsHost:v,ctsServer:g}});case 22:return w.next=24,(0,A.call)(B.registerConfirm,v,t,r,h,_,b);case 24:if(E=w.sent,"ok"===(null===E||void 0===E?void 0:E.status)){w.next=27;break}throw Error();case 27:if(!a){w.next=33;break}return w.next=30,(0,A.call)(F.registerConfirm,g,t,a,_);case 30:if(S=w.sent,"ok"===(null===(O=S)||void 0===O?void 0:O.status)){w.next=33;break}throw Error();case 33:return C={active:E.result.active,authToken:E.result.auth_token,expiresAt:E.result.expires_at,huid:E.result.user_huid,phone:h,keyId:E.result.key_id,rtsHost:v,rtsServerId:E.result.server_id,region:m},w.next=36,(0,A.put)(G.authStatusChanged("registered",a?o({},C,{ctsAuthToken:S.result.access_token,ctsServerId:S.result.server_id,corpAvatar:S.result.corp_avatar,ctsServer:g,ctsLogin:p}):C));case 36:return w.next=38,(0,A.fork)(f);case 38:w.next=45;break;case 40:return w.prev=40,w.t0=w.catch(0),w.next=44,[(0,A.put)(Y.showNotifier((0,U.formatMessage)(Le.qrAuthError),"error")),(0,A.put)(G.authStatusChanged(G.authStatusEnum.unregistered))];case 44:Object({PRODUCTION:1,NODE_ENV:"production"}).TEST||console.error("handleQrRegisterRequestResponse error: ".concat(w.t0.message));case 45:case"end":return w.stop()}},Te,this,[[0,40]])}function N(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,[(0,A.takeLatest)(G.LOGOUT_RTS,y),(0,A.takeLatest)(G.REGISTER,u),(0,A.takeLatest)(G.CONFIRM,d),(0,A.takeLatest)(G.LOGIN_CTS,_),(0,A.takeLatest)(G.LOGIN_CTSWEB,b),(0,A.takeLatest)(G.REQUEST_LOGOUT_CTS,v),(0,A.takeLatest)(G.UPLOAD_PROFILE,g),(0,A.takeLatest)(G.RESEND_CONFIRMATION_CODE,l),(0,A.takeLatest)(G.REGISTERED_ON_CTS,E),(0,A.takeLatest)(G.REGISTERED_ON_OTHER_CTS,E),(0,A.takeLatest)(G.LOGGED_OUT_CTS,S),(0,A.takeLatest)(G.NEED_CTS_LOGIN,O),(0,A.takeLatest)(W.USER_PRIVATE_KEYS_DECRYPTED,k),(0,A.takeLatest)(W.USER_PUBLIC_KEY_UPLOADED,P),(0,A.takeLatest)(G.KEYS_DECRYPT_ATTEMPT_USED,T),(0,A.takeLatest)(G.QR_REGISTER_REQUEST,x),(0,A.takeLatest)(G.MULTIDEVICE_LOGOUT,j)];case 2:case"end":return e.stop()}},xe,this)}Object.defineProperty(t,"__esModule",{value:!0}),t.checkUdid=c,t.registerSaga=u,t.resendConfirmationCodeSaga=l,t.confirmSaga=d,t.checkNotifications=p,t.establishAuth=f,t.fetchProfile=m,t.fetchSettings=h,t.logoutRtsSaga=y,t.loginCtsSaga=_,t.loginCtsWebSaga=b,t.requestLogoutCtsSaga=v,t.uploadProfileSaga=g,t.registeredOnCtsSaga=E,t.loggedOutCtsSaga=S,t.needCtsLoginSaga=O,t.handleCtsLogout=C,t.handleCtsLogin=w,t.multideviceLogoutSaga=j,t.privateKeysDecryptedSaga=k,t.userPublicKeyUploadedSaga=P,t.keysDecryptAttemptUsedSaga=T,t.qrRegisterRequestSaga=x,t.handleQrRegisterRequestResponse=M,t.rootUserSaga=N,t.getQrKeys=t.getServerEncryptionKeys=t.getLocale=t.getUser=void 0;var A=n("./node_modules/redux-saga/es/effects.js"),R=n("./node_modules/redux-saga/es/index.js"),I=a(n("./node_modules/history/createHashHistory.js")),D=n("./node_modules/react-intl/lib/index.es.js"),L=r(n("./node_modules/text-encoding/index.js")),U=n("./lib/reactIntl.js"),F=r(n("./app/api/cts.js")),H=r(n("./app/api/phonebook.js")),K=r(n("./app/api/settings.js")),B=r(n("./app/api/authentication.js")),G=r(n("./app/modules/user.js")),Y=r(n("./app/modules/notifiers.js")),V=r(n("./app/modules/ui.js")),W=r(n("./app/modules/encryptionKeys.js")),q=a(n("./lib/uuid5.js")),z=n("./app/sagas/encryptionKeys.js"),Q=n("./lib/encryption.js"),X=n("./app/sagas/permissions.js"),J=n("./app/sagas/push.js"),Z=n("./app/sagas/sockets.js"),$=n("./app/sagas/channels.js"),ee=n("./app/helpers/userHelpers.js"),te=n("./app/helpers/appHelpers.js"),ne=n("./app/sagas/chats.js"),re=n("./app/sagas/phonebook.js"),ae=n("./lib/constants.js"),oe=a(n("./lib/config.js")),se=regeneratorRuntime.mark(c),ie=regeneratorRuntime.mark(u),ce=regeneratorRuntime.mark(l),ue=regeneratorRuntime.mark(d),le=regeneratorRuntime.mark(p),de=regeneratorRuntime.mark(f),pe=regeneratorRuntime.mark(m),fe=regeneratorRuntime.mark(h),me=regeneratorRuntime.mark(y),he=regeneratorRuntime.mark(_),ye=regeneratorRuntime.mark(b),_e=regeneratorRuntime.mark(v),be=regeneratorRuntime.mark(g),ve=regeneratorRuntime.mark(E),ge=regeneratorRuntime.mark(S),Ee=regeneratorRuntime.mark(O),Se=regeneratorRuntime.mark(C),Oe=regeneratorRuntime.mark(w),Ce=regeneratorRuntime.mark(j),we=regeneratorRuntime.mark(k),je=regeneratorRuntime.mark(P),ke=regeneratorRuntime.mark(T),Pe=regeneratorRuntime.mark(x),Te=regeneratorRuntime.mark(M),xe=regeneratorRuntime.mark(N),Me=(0,I.default)(),Ne=e.TextDecoder||L.TextDecoder,Ae=function(e){return e.user};t.getUser=Ae;var Re=function(e){return e.ui.locale};t.getLocale=Re;var Ie=function(e){return e.encryptionKeys.server};t.getServerEncryptionKeys=Ie;var De=function(e){return e.encryptionKeys.qrRequest};t.getQrKeys=De;var Le=(0,D.defineMessages)({wrongConfirmationCode:{id:"[notifications] wrongConfirmationCode",defaultMessage:"Wrong confirmation code"},activationNotFound:{id:"[notifications] activationNotFound",defaultMessage:"Activation not found"},userAlreadyConfirmed:{id:"[notifications] userAlreadyConfirmed",defaultMessage:"User already confirmed"},confirmationLimitExceeded:{id:"[notifications] confirmationLimitExceeded",defaultMessage:"Confirmation limit exceeded"},smsLimitExceeded:{id:"[notifications] smsLimitExceeded",defaultMessage:"SMS limit exceeded"},serverError:{id:"[notifications] serverError",defaultMessage:"Server error, try again later"},corporateServerLoginError:{id:"[notifications] corporateServerLoginError",defaultMessage:"Corporate server login error"},loggedOutCts:{id:"[notifications] loggedOutCts",defaultMessage:"You are logged out from CTS server"},profileUploaded:{id:"[notifications] profileUploaded",defaultMessage:"Profile successfully uploaded"},smsError:{id:"[notifications] smsError",defaultMessage:"Sms gate error, please try later"},registerRequestError:{id:"[notifications] QR register request error",defaultMessage:"Error processing register request"},registerRequestNotSupported:{id:"[notifications] QR register request not supported",defaultMessage:"Corporate Server doesnt support QR-code registration. Please, register by phone number and active directory credentials"},qrAuthError:{id:"[notifications] QR auth error",defaultMessage:"Authorization error, try again later"}})}).call(t,n("./node_modules/webpack/buildin/global.js"))},"./app/sagas/voex.js":function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}function o(e,t){return c(e)||i(e,t)||s()}function s(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function i(e,t){var n=[],r=!0,a=!1,o=void 0;try{for(var s,i=e[Symbol.iterator]();!(r=(s=i.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==i.return||i.return()}finally{if(a)throw o}}return n}function c(e){if(Array.isArray(e))return e}function u(){new I.Howl({src:[J.default]}).play()}function l(e){var t,n,r,a,s,i,c,u,l,d,p,f,m;return regeneratorRuntime.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.prev=0,h.next=3,(0,x.select)(be);case 3:if(t=h.sent,e.sender!==t.huid||["call_answer","call_hangup","call_busy"].includes(e.payload.event_type)){h.next=6;break}return h.abrupt("return");case 6:return h.next=8,(0,x.call)(W.decryptMessages,[e]);case 8:return n=h.sent,r=o(n,1),a=r[0],s=a.payload,h.next=14,(0,x.select)(Oe);case 14:if(i=h.sent,c=i.answerId,u=i.status,l=i.callId,d=i.isBusy,e.sender!==t.huid||"call_answer"!==e.payload.event_type){h.next=24;break}if(s.event.answer_id===c){h.next=23;break}return h.next=23,(0,x.put)(H.callHangupSent());case 23:return h.abrupt("return");case 24:console.log("recv",s),h.t0=s.event_type,h.next="call_offer"===h.t0?28:"call_offer_received"===h.t0?49:"call_already_answered"===h.t0?57:"call_answer"===h.t0?61:"call_hangup"===h.t0?64:"call_ice"===h.t0?69:"call_sdp"===h.t0?72:"call_busy"===h.t0?75:80;break;case 28:if(u===H.callStatusEnum.idle){h.next=34;break}return h.next=31,(0,x.call)(M.delay,1e3);case 31:return h.next=33,(0,x.put)(F.sendAppEvent(e.group_chat_id,"call_busy",{call_id:s.event.call_id}));case 33:return h.abrupt("return");case 34:return h.next=36,(0,x.select)(ve,e.group_chat_id);case 36:return p=h.sent,f=(0,Y.getVoexSessionEndpoint)(p,t),h.next=40,(0,x.call)(S,f.host,f.token,f.connType,s.event.call_id,s.event.offer_secret);case 40:if(m=h.sent){h.next=44;break}return _e.push("/chats/".concat(e.group_chat_id)),h.abrupt("return");case 44:return h.next=46,(0,x.put)(F.sendAppEvent(e.group_chat_id,"call_offer_received",{call_id:s.event.call_id,device_udid:t.udid}));case 46:return h.next=48,(0,x.put)(H.callOfferReceived(e.group_chat_id,s.event.media,s.event.call_id,s.event.offer_secret,f.connType,s.event.call_offer_sender));case 48:return h.abrupt("break",81);case 49:if(l!==s.event.call_id){h.next=56;break}if(u!==H.callStatusEnum.answer&&!d){h.next=54;break}return h.next=53,(0,x.put)(F.sendAppEvent(e.group_chat_id,"call_already_answered",{call_id:s.event.call_id,request_device_udid:s.event.device_udid}));case 53:return h.abrupt("return");case 54:return h.next=56,(0,x.put)(H.callDelivered());case 56:return h.abrupt("break",81);case 57:if(l!==s.event.call_id||t.udid!==s.event.request_device_udid){h.next=60;break}return h.next=60,(0,x.put)(H.callHangupSent());case 60:return h.abrupt("break",81);case 61:return h.next=63,(0,x.put)(H.callAnswerReceived());case 63:return h.abrupt("break",81);case 64:return h.next=66,(0,x.fork)(V.unhideChat,e.group_chat_id);case 66:return h.next=68,[(0,x.put)(H.callHangupReceived(a)),(0,x.fork)(U.setChatFsmStateOnChatEvent,e.group_chat_id)];case 68:return h.abrupt("break",81);case 69:return h.next=71,(0,x.call)(b,s.event);case 71:return h.abrupt("break",81);case 72:return h.next=74,(0,x.call)(v,s.event);case 74:return h.abrupt("break",81);case 75:if(s.event.call_id===l){h.next=77;break}return h.abrupt("return");case 77:return h.next=79,e.sender===t.huid?(0,x.put)(H.callHangupSent()):(0,x.put)(H.setBusy(!0));case 79:case 80:return h.abrupt("break",81);case 81:h.next=86;break;case 83:h.prev=83,h.t1=h.catch(0),console.error("handleVoexEvent error: ".concat(h.t1.message));case 86:case"end":return h.stop()}},Z,this,[[0,83]])}function d(e){var t,n,r,a,o,s,i,c;return regeneratorRuntime.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(u.prev=0,t=e.payload,n=t.huid,r=t.media,n&&r){u.next=4;break}return u.abrupt("return");case 4:return u.next=6,(0,x.select)(be);case 6:return a=u.sent,u.next=9,(0,x.select)(ge,n);case 9:if(o=u.sent){u.next=14;break}return u.next=13,(0,x.call)(V.createChat,{members:[a.huid,n],chat_type:"chat",name:"personal chat"});case 13:o=u.sent;case 14:if(o){u.next=16;break}return u.abrupt("return");case 16:return s=(0,Y.getVoexSessionEndpoint)(o,a),u.next=19,(0,x.call)(S,s.host,s.token,s.connType);case 19:if(i=u.sent){u.next=24;break}return u.next=23,[(0,x.put)(H.callHangupSent()),(0,x.put)(K.showNotifier((0,D.formatMessage)(Ce.callError),"error"))];case 23:return u.abrupt("return");case 24:return u.prev=24,u.next=27,(0,x.call)(q.getMediaStream,r);case 27:return c=u.sent,u.next=30,(0,x.put)(H.localStream(c));case 30:u.next=37;break;case 32:return u.prev=32,u.t0=u.catch(24),u.next=36,[(0,x.put)(H.callHangupSent()),(0,x.put)(K.showNotifier((0,D.formatMessage)(Ce.allowMediaDevice),"error"))];case 36:return u.abrupt("return");case 37:return u.next=39,(0,x.put)(F.sendAppEvent(o.group_chat_id,"call_offer",{media:r,call_id:i.call_id,offer_secret:i.offer_secret,call_offer_sender:a.huid},{notification_opts:{send:!0,force_dnd:!0}}));case 39:return u.next=41,(0,x.put)(H.callOfferSent(o.group_chat_id,r,i.call_id,a.huid,s.connType));case 41:u.next=46;break;case 43:u.prev=43,u.t1=u.catch(0),console.error("sendCallOfferSaga error: ".concat(u.t1.message));case 46:case"end":return u.stop()}},$,this,[[0,43],[24,32]])}function p(e){var t,n,r,a,o;return regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,(0,x.call)(M.delay,X.HANGUP_CALL_AFTER);case 3:return s.next=5,(0,x.select)(Oe);case 5:if(t=s.sent,n=t.isAnswered,r=t.status,a=t.isBusy,o=t.callId,e.payload.callId===o){s.next=12;break}return s.abrupt("return");case 12:if(n&&r!==H.callStatusEnum.offer||a){s.next=15;break}return s.next=15,(0,x.put)(H.sendCallHangup());case 15:s.next=20;break;case 17:s.prev=17,s.t0=s.catch(0),console.error("waitForAnswer error: ".concat(s.t0.message));case 20:case"end":return s.stop()}},ee,this,[[0,17]])}function f(e){var t,n,r;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,(0,x.call)(M.delay,X.VOEX_CONNECTION_TIMEOUT);case 3:return a.next=5,(0,x.select)(Oe);case 5:if(t=a.sent,n=t.remoteStream,r=t.answerId,e.payload===r){a.next=10;break}return a.abrupt("return");case 10:if(n){a.next=13;break}return a.next=13,(0,x.put)(H.sendCallHangup());case 13:a.next=18;break;case 15:a.prev=15,a.t0=a.catch(0),console.error("waitForConnection error: ".concat(a.t0.message));case 18:case"end":return a.stop()}},te,this,[[0,15]])}function m(){var e,t,n,r,a,o,s;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,(0,x.select)(Oe);case 3:return e=i.sent,t=e.chatId,n=e.callId,r=e.connection,i.prev=7,i.next=10,(0,x.select)(Se);case 10:return a=i.sent,i.next=13,(0,x.call)(q.getMediaStream,a);case 13:return o=i.sent,i.next=16,(0,x.put)(H.localStream(o));case 16:i.next=23;break;case 18:return i.prev=18,i.t0=i.catch(7),i.next=22,[(0,x.put)(H.callHangupSent()),(0,x.put)(K.showNotifier((0,D.formatMessage)(Ce.allowMediaDevice),"error"))];case 22:return i.abrupt("return");case 23:return s=(0,Q.default)(),i.next=26,[(0,x.put)(F.sendAppEvent(t,"call_answer",{call_id:n,answer_id:s})),(0,x.put)(H.callAnswerSent(s))];case 26:return i.next=28,(0,x.call)(q.connect,!1,r);case 28:i.next=33;break;case 30:i.prev=30,i.t1=i.catch(0),console.error("sendCallAnswerSaga error: ".concat(i.t1.message));case 33:case"end":return i.stop()}},ne,this,[[0,30],[7,18]])}function h(){var e,t;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,(0,x.select)(Oe);case 3:if(e=n.sent,t=e.connection){n.next=7;break}return n.abrupt("return");case 7:return n.next=9,(0,x.call)(q.connect,!0,t);case 9:n.next=14;break;case 11:n.prev=11,n.t0=n.catch(0),console.error("callAnswerReceivedSaga error: ".concat(n.t0.message));case 14:case"end":return n.stop()}},re,this,[[0,11]])}function y(e){var t,n,r,a;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return t=e.payload,o.prev=1,o.next=4,(0,x.select)(Oe);case 4:return n=o.sent,r=n.chatId,a=n.callId,o.next=9,(0,x.put)(F.sendAppEvent(r,"call_ice",{ice:t,call_id:a}));case 9:o.next=14;break;case 11:o.prev=11,o.t0=o.catch(1),console.error("localIceCandidateSaga error: ".concat(o.t0.message));case 14:case"end":return o.stop()}},ae,this,[[1,11]])}function _(e){var t,n,r,a;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return t=e.payload,o.prev=1,o.next=4,(0,x.select)(Oe);case 4:return n=o.sent,r=n.chatId,a=n.callId,o.next=9,(0,x.put)(F.sendAppEvent(r,"call_sdp",{sdp:t,call_id:a}));case 9:o.next=14;break;case 11:o.prev=11,o.t0=o.catch(1),console.error("localSdpSaga error: ".concat(o.t0.message));case 14:case"end":return o.stop()}},oe,this,[[1,11]])}function b(e){var t,n,r,a;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return t=e.ice,n=e.call_id,o.next=3,(0,x.select)(Oe);case 3:if(r=o.sent,a=r.callId,n&&n!==a){o.next=8;break}return o.next=8,(0,x.call)(q.setRemoteIceCandidate,t);case 8:case"end":return o.stop()}},se,this)}function v(e){var t,n,r,a;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return t=e.sdp,n=e.call_id,o.next=3,(0,x.select)(Oe);case 3:if(r=o.sent,a=r.callId,n&&n!==a){o.next=8;break}return o.next=8,(0,x.call)(q.setRemoteSession,t);case 8:case"end":return o.stop()}},ie,this)}function g(e){var t,n,r,a,o,s,i,c,l,d,p,f;return regeneratorRuntime.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(m.prev=0,!(t=e.payload)){m.next=5;break}return m.next=5,(0,x.call)(u);case 5:return m.next=7,(0,x.call)(O);case 7:if(!(n=m.sent)){m.next=26;break}return m.next=11,(0,x.select)(Oe);case 11:return a=m.sent,o=a.chatId,s=a.startTime,i=a.callId,c=a.callOfferSender,m.next=18,(0,x.select)(be);case 18:return l=m.sent,m.next=21,(0,x.select)(ve,o);case 21:return d=m.sent,p=null===d||void 0===d?void 0:null===(r=d.members)||void 0===r?void 0:r.find(function(e){return e.user_huid!==l.huid}),f=s?(0,N.default)().diff(s,"seconds"):null,m.next=26,(0,x.put)(F.sendAppEvent(o,"call_hangup",{call_id:i,call_offer_sender:c,call_hangup_sender:t?null===p||void 0===p?void 0:p.user_huid:l.huid,duration:f},{save_in_inbox:!0,affect_last_event:!0,affect_sorting:!0}));case 26:return m.next=28,(0,x.call)(q.hangup);case 28:return m.next=30,(0,x.put)(H.callHangupSent());case 30:m.next=35;break;case 32:m.prev=32,m.t0=m.catch(0),console.error("sendCallHangupSaga error: ".concat(m.t0.message));case 35:case"end":return m.stop()}},ce,this,[[0,32]])}function E(e){var t,n,r,a,o,s,i,c,u,l,d;return regeneratorRuntime.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.prev=0,t=e.payload,n=t.group_chat_id,r=t.payload.event,a=r.call_id,o=r.duration,s=r.call_offer_sender,i=r.call_hangup_sender,p.next=4,(0,x.select)(Oe);case 4:if(c=p.sent,(u=c.callId)!==a&&u){p.next=9;break}return p.next=9,(0,x.call)(q.hangup);case 9:return p.next=11,(0,x.select)(be);case 11:if(l=p.sent,d=l.huid,o||[i,s].includes(d)){p.next=16;break}return p.next=16,(0,x.put)(B.incUnreadCounter(n));case 16:p.next=21;break;case 18:p.prev=18,p.t0=p.catch(0),console.error("callHangupReceivedSaga error: ".concat(p.t0.message));case 21:case"end":return p.stop()}},ue,this,[[0,18]])}function S(e,t,n,r,a){var o,s,i,c,u,l;return regeneratorRuntime.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(d.prev=0,!r||!a){d.next=7;break}return d.next=4,(0,x.call)(z.startSession,e,t,n,r,a);case 4:d.t0=d.sent,d.next=10;break;case 7:return d.next=9,(0,x.call)(z.createSession,e,t,n);case 9:d.t0=d.sent;case 10:if(o=d.t0,"ok"===(null===o||void 0===o?void 0:o.status)){d.next=13;break}return d.abrupt("return",!1);case 13:return s=o.result,i=s.login,c=s.password,u=s.stun_server,l=s.turn_server,d.next=16,(0,x.put)(H.callSessionStarted(o.result.call_id,o.result.offer_secret,{host:e,token:t,login:i,password:c,stun_server:u,turn_server:l}));case 16:return d.abrupt("return",o.result);case 19:return d.prev=19,d.t1=d.catch(0),console.error("startCallSession error: ".concat(d.t1.message)),d.abrupt("return",!1);case 23:case"end":return d.stop()}},le,this,[[0,19]])}function O(){var e,t,n,r,a,o,s,i,c;return regeneratorRuntime.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.prev=0,u.next=3,(0,x.select)(Oe);case 3:if(e=u.sent,t=e.callId,n=e.offerSecret,r=e.offerConnType,(a=e.connection)||r){u.next=10;break}return u.abrupt("return",!1);case 10:return u.next=12,(0,x.select)(be);case 12:return o=u.sent,s="rts"===r?o.rtsHost:o.ctsServer,i="rts"===r?o.authToken:o.ctsAuthToken,u.next=17,(0,x.call)(z.stopSession,(null===a||void 0===a?void 0:a.host)||s,(null===a||void 0===a?void 0:a.token)||i,t,n,r);case 17:return c=u.sent,u.abrupt("return","ok"===c.status);case 21:return u.prev=21,u.t0=u.catch(0),console.error("stopCallSession error: ".concat(u.t0.message)),u.abrupt("return",!1);case 25:case"end":return u.stop()}},de,this,[[0,21]])}function C(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,x.call)(q.muteMicrophone);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.error("Error mute microphone error: ".concat(e.t0.message));case 8:case"end":return e.stop()}},pe,this,[[0,5]])}function w(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,x.call)(q.unmuteMicrophone);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.error("Error unmute microphone error: ".concat(e.t0.message));case 8:case"end":return e.stop()}},fe,this,[[0,5]])}function j(e){var t,n,r,a,s;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,(0,x.select)(Oe);case 3:if(t=i.sent,t.status===H.callStatusEnum.idle){i.next=6;break}return i.abrupt("return");case 6:return i.next=8,(0,x.call)(L.selectChannel,"groupchat",e.group_chat_id);case 8:return n=i.sent,i.next=11,(0,x.call)(L.push,n,"event_info",{group_chat_id:e.group_chat_id,sync_ids:[e.sync_id]});case 11:if(r=i.sent,a=o(r.info,1),s=a[0],s){i.next=15;break}return i.abrupt("return");case 15:return i.next=17,(0,x.fork)(l,s);case 17:i.next=22;break;case 19:i.prev=19,i.t0=i.catch(0),console.error("handleVoexPush error: ".concat(i.t0.message));case 22:case"end":return i.stop()}},me,this,[[0,19]])}function k(){return(0,M.eventChannel)(function(e){return q.dispatcher.addEventListener("iceCandidate",function(t){return e(H.localIceCandidate(t))}),q.dispatcher.addEventListener("sessionDescription",function(t){return e(H.localSdp(t))}),q.dispatcher.addEventListener("remoteStream",function(t){return e(H.remoteStream(t))}),q.dispatcher.addEventListener("onIceDisconnect",function(){return e(H.sendCallHangup(!0))}),q.dispatcher.addEventListener("onIceConnect",function(){return e(H.connected())}),function(){}})}function P(){var e,t;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,x.call)(k);case 2:e=n.sent;case 3:return n.next=6,(0,x.take)(e);case 6:return t=n.sent,n.next=9,(0,x.put)(t);case 9:n.next=3;break;case 11:case"end":return n.stop()}},he,this)}function T(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,[(0,x.takeEvery)(H.SEND_CALL_OFFER,d),(0,x.takeEvery)(H.LOCAL_ICE_CANDIDATE,y),(0,x.takeEvery)(H.LOCAL_SDP,_),(0,x.takeEvery)(H.SEND_CALL_ANSWER,m),(0,x.takeEvery)(H.CALL_ANSWER_RECEIVED,h),(0,x.takeEvery)(H.SEND_CALL_HANGUP,g),(0,x.takeEvery)(H.CALL_HANGUP_RECEIVED,E),(0,x.takeEvery)(H.MUTE_MICROPHONE,C),(0,x.takeEvery)(H.UNMUTE_MICROPHONE,w),(0,x.takeEvery)(H.CALL_OFFER_SENT,p),(0,x.takeEvery)(H.CALL_OFFER_RECEIVED,p),(0,x.takeEvery)(H.CALL_ANSWER_SENT,f),P()];case 2:case"end":return e.stop()}},ye,this)}Object.defineProperty(t,"__esModule",{value:!0}),t.playSound=u,t.handleVoexEvent=l,t.sendCallOfferSaga=d,t.waitForAnswer=p,t.waitForConnection=f,t.sendCallAnswerSaga=m,t.callAnswerReceivedSaga=h,t.localIceCandidateSaga=y,t.localSdpSaga=_,t.iceCandidateReceive=b,t.sessionDescriptionReceive=v,t.sendCallHangupSaga=g,t.callHangupReceivedSaga=E,t.startCallSession=S,t.stopCallSession=O,t.muteMicrophoneSaga=C,t.unmuteMicrophoneSaga=w,t.handleVoexPush=j,t.watchVoexEvents=P,t.rootVoexSaga=T,t.getVoex=t.getMedia=t.getOpponentIceCandidates=t.getOneToOneChat=t.getChat=t.getUser=void 0;var x=n("./node_modules/redux-saga/es/effects.js"),M=n("./node_modules/redux-saga/es/index.js"),N=a(n("./node_modules/moment/moment.js")),A=n("./node_modules/react-intl/lib/index.es.js"),R=a(n("./node_modules/history/createHashHistory.js")),I=n("./node_modules/howler/dist/howler.js"),D=n("./lib/reactIntl.js"),L=n("./app/sagas/channels.js"),U=n("./app/sagas/ui.js"),F=r(n("./app/modules/messages.js")),H=r(n("./app/modules/voex.js")),K=r(n("./app/modules/notifiers.js")),B=r(n("./app/modules/chats.js")),G=n("./app/helpers/chatsHelpers.js"),Y=n("./app/helpers/voex.js"),V=n("./app/sagas/chats.js"),W=n("./app/sagas/messages.js"),q=r(n("./lib/voex.js")),z=r(n("./app/api/voex.js")),Q=a(n("./lib/uuid5.js")),X=n("./lib/constants.js"),J=a(n("./app/assets/audio/voex-hangup.mp3")),Z=regeneratorRuntime.mark(l),$=regeneratorRuntime.mark(d),ee=regeneratorRuntime.mark(p),te=regeneratorRuntime.mark(f),ne=regeneratorRuntime.mark(m),re=regeneratorRuntime.mark(h),ae=regeneratorRuntime.mark(y),oe=regeneratorRuntime.mark(_),se=regeneratorRuntime.mark(b),ie=regeneratorRuntime.mark(v),ce=regeneratorRuntime.mark(g),ue=regeneratorRuntime.mark(E),le=regeneratorRuntime.mark(S),de=regeneratorRuntime.mark(O),pe=regeneratorRuntime.mark(C),fe=regeneratorRuntime.mark(w),me=regeneratorRuntime.mark(j),he=regeneratorRuntime.mark(P),ye=regeneratorRuntime.mark(T),_e=(0,R.default)(),be=function(e){return e.user};t.getUser=be;var ve=function(e,t){return e.chats.find(function(e){return e.group_chat_id===t})};t.getChat=ve;var ge=function(e,t){return(0,G.findOneToOneChatByHuid)(e.chats,t)};t.getOneToOneChat=ge;var Ee=function(e){return e.voex.iceCandidates};t.getOpponentIceCandidates=Ee;var Se=function(e){return e.voex.media};t.getMedia=Se;var Oe=function(e){return e.voex};t.getVoex=Oe;var Ce=(0,A.defineMessages)({allowMediaDevice:{id:"[notifications] allowMediaDevice",defaultMessage:"You must allow media device"},callError:{id:"[notifications] callError",defaultMessage:"Call connection error. Please try again later"}})},"./app/sagas/windowEvents.js":function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}function a(){return(0,i.eventChannel)(function(e){return window.addEventListener("offline",function(){return e(c.networkOffline())}),window.addEventListener("online",function(){return e(c.networkOnline())}),window.addEventListener("focus",function(t){return e(u.setAppInFocus(p(t)))}),window.addEventListener("blur",function(t){return e(u.setAppInFocus(p(t)))}),window.document.addEventListener("visibilitychange",function(){return e(u.setAppInFocus(p()))}),window.navigator.serviceWorker&&window.navigator.serviceWorker.addEventListener("message",function(t){var n=t.data,r=n.type,a=n.payload;"MESSAGE_NEW"===r&&e(l.activateChatFromPush(a,t.ports[0])),"CALL_OFFER"===r&&e(l.activateCallFromPush(a,t.ports[0]))}),function(){}})}function o(){var e,t;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,s.call)(a);case 2:e=n.sent;case 3:return n.next=6,(0,s.take)(e);case 6:return t=n.sent,n.next=9,(0,s.put)(t);case 9:n.next=3;break;case 11:case"end":return n.stop()}},d,this)}Object.defineProperty(t,"__esModule",{value:!0}),t.subscribeWindowEvents=a,t.watchWindowEvents=o;var s=n("./node_modules/redux-saga/es/effects.js"),i=n("./node_modules/redux-saga/es/index.js"),c=r(n("./app/modules/socket.js")),u=r(n("./app/modules/ui.js")),l=r(n("./app/modules/push.js")),d=regeneratorRuntime.mark(o),p=function(e){return("focus"===(null===e||void 0===e?void 0:e.type)||document.hasFocus())&&"visible"===document.visibilityState}},"./app/selectors/attachmentsSelectors.js":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeGetCurrentChatAttachments=void 0;var r=n("./node_modules/reselect/lib/index.js"),a=function(e,t){return e.attachments.find(function(e){return e.chat_id===t.match.params.id})},o=function(){return(0,r.createSelector)([a],function(e){return e})};t.makeGetCurrentChatAttachments=o},"./app/selectors/chatsSelectors.js":function(e,t,n){"use strict";function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){a(e,t,n[t])})}return e}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(t,"__esModule",{value:!0}),t.countUnreadChats=t.mapCreatorName=t.getChatList=t.makeGetCurrentChat=void 0;var o=n("./node_modules/reselect/lib/index.js"),s=n("./app/selectors/profilesSelectors.js"),i=n("./app/helpers/chatsHelpers.js"),c=n("./app/helpers/profilesHelpers.js"),u=n("./app/helpers/messagesHelpers.js"),l=n("./lib/reactIntl.js"),d=function(e,t){return e.chats.find(function(e){return e.group_chat_id===t.match.params.id})},p=function(e){return e.chats},f=function(e){return e.statuses},m=function(e){return e.user},h=function(e){return Array.isArray(e.drafts)?e.drafts.filter(function(e){return e.visible}):[]},y=function(e){return e.membersTyping},_=function(){return(0,o.createSelector)([d,s.getProfiles,f,m,h,y],function(e,t,n,r,a,o){var s,i,c,u,l,d,p,f;return e?(f=e,p=g(r)(f),d=E(t)(p),l=w(t,r)(d),u=O(a)(l),c=S(n,r)(u),i=k(o,t,r)(c),s=v(r)(i),j(t,r)(s)):null})};t.makeGetCurrentChat=_;var b=(0,o.createSelector)([p,s.getProfiles,m,h,y,f],function(e,t,n,r,a,o){var s=e.filter(function(e){return!e.chat_settings.hidden}).map(function(e){var s,i,c,u,l,d,p;return p=e,d=g(n)(p),l=E(t)(d),u=w(t,n)(l),c=O(r)(u),i=S(o,n)(c),s=C(t,n)(i),k(a,t,n)(s)});return(0,i.sortChats)(s)});t.getChatList=b;var v=function(e){return function(t){return r({},t,{members:t.left?t.members.filter(function(t){return t.user_huid!==e.huid}):t.members,statuses:t.left?t.statuses.filter(function(t){return t.user_huid!==e.huid}):t.statuses})}},g=function(e){return function(t){return r({},t,{connType:(0,i.chatMemberConnType)(t,e)})}},E=function(e){return function(t){return r({},t,{members:t.members.map(function(t){var n=e.find(function(e){return e.user_huid===t.user_huid});return r({},t,n)})})}},S=function(e,t){return function(n){var a=e.filter(function(e){var t;return null===(t=n.members)||void 0===t?void 0:t.find(function(t){return t.user_huid===e.user_huid})});return(0,i.isOneToOne)(n)?r({},n,{statuses:a.filter(function(e){return e.user_huid!==t.huid})}):r({},n,{statuses:a})}},O=function(e){return function(t){var n=null===e||void 0===e?void 0:e.find(function(e){return e.chatId===t.group_chat_id});return r({},t,{draft:null===n||void 0===n?void 0:n.text})}},C=function(e,t){return function(n){return r({},n,{lastEvent:(0,u.mapEventProfile)(n.lastEvent,e,t)})}},w=function(e,t){return function(n){var a;if((0,i.isOneToOne)(n)){var o,s=null===(o=n.members)||void 0===o?void 0:o.find(function(e){return e.user_huid!==t.huid}),u=e.find(function(e){return(null===e||void 0===e?void 0:e.user_huid)===(null===s||void 0===s?void 0:s.user_huid)})||{},l=(0,c.getFlatProfile)(u,n.members_type);return r({},n,{avatar:l.avatar,name:l.name,opponent:s})}var d="rts"===n.connType?t.rtsHost:t.ctsServer,p=null===(a=n.avatar)||void 0===a?void 0:a.replace(/^\//,"");return r({},n,{avatar:n.avatar&&d?"https://".concat(d,"/").concat(p):null})}},j=function(e,t){return function(n){var a;if(n.creator===t.huid)return r({},n,{creatorName:(0,l.formatMessage)({id:"[app] you",defaultMessage:"You"})});var o=null===(a=n.members.find(function(e){return e.user_huid===n.creator}))||void 0===a?void 0:a.conn_type,s=e.find(function(e){return e.user_huid===n.creator}),i="cts"===o&&(null===s||void 0===s?void 0:s.cts_profile)||(null===s||void 0===s?void 0:s.rts_profile);return r({},n,{creatorName:null===i||void 0===i?void 0:i.name})}};t.mapCreatorName=j;var k=function(e,t,n){return function(a){var o=a.group_chat_id;if((0,i.isOneToOne)(a))return(null===e||void 0===e?void 0:e.find(function(e){return e.group_chat_id===o&&e.user_huid!==n.huid}))?r({},a,{typing:!0}):r({},a,{typing:!1});var s=e.reduce(function(e,r){if(r.group_chat_id===o&&r.user_huid!==n.huid){var s=t.find(function(e){return e.user_huid===r.user_huid}),i=(0,c.getTypingProfile)(s,a.connType);s&&e.push(i.name)}return e},[]);return r({},a,{typing:!!s.length&&s})}},P=(0,o.createSelector)([p],function(e){return e.filter(function(e){return!e.chat_settings.hidden&&e.unreadCounter}).length});t.countUnreadChats=P},"./app/selectors/messagesSelectors.js":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeGetCurrentMessage=t.getBottomEvent=t.getChatEvents=void 0;var r=n("./node_modules/reselect/lib/index.js"),a=function(e){return e&&e.__esModule?e:{default:e}}(n("./node_modules/lodash/orderBy.js")),o=n("./app/selectors/profilesSelectors.js"),s=n("./app/helpers/routing.js"),i=n("./app/helpers/messagesHelpers.js"),c=function(e){return e.messages},u=function(e){return(0,s.matchChatId)(e.routing.location.pathname)},l=function(e){return e.user},d=function(e,t){return e.messages.find(function(e){return e.sync_id===t.match.params.sync})},p=function(e,t){var n,r=t.match.params.id;return null===(n=e.ui.chats[r])||void 0===n?void 0:n.firstVisibleMessageSyncId},f=(0,r.createSelector)([c,u,o.getProfiles,l,p],function(e,t,n,r,a){var o,s,i,c;return c=e,i=y(t)(c),s=v(i),o=b(a)(s),_(n,r)(o)});t.getChatEvents=f;var m=(0,r.createSelector)([c,u],function(e,t){var n=e.filter(function(e){return e.group_chat_id===t});return(0,a.default)(n,"inserted_at","desc")[0]});t.getBottomEvent=m;var h=function(){return(0,r.createSelector)([d,o.getProfiles,l],function(e,t,n){return(0,i.mapEventProfile)(e,t,n)})};t.makeGetCurrentMessage=h;var y=function(e){return function(t){return t.filter(function(t){return t.group_chat_id===e})}},_=function(e,t){return function(n){return n.map(function(n){return(0,i.mapEventProfile)(n,e,t)})}},b=function(e){return function(t){var n=(0,i.getMessageIndexBySyncId)(t,e);return e&&-1!==n?t.slice(n):t}},v=function(e){return(0,a.default)(e,"inserted_at","asc")}},"./app/selectors/phonebookSelectors.js":function(e,t,n){"use strict";function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){a(e,t,n[t])})}return e}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(t,"__esModule",{value:!0}),t.makeGetCurrentPhonebookEntry=t.getActivePhonebookEntryListWithStatuses=t.getPhonebookEntryListWithStatuses=t.getPhonebookEntryList=void 0;var o=n("./node_modules/reselect/lib/index.js"),s=function(e){return e&&e.__esModule?e:{default:e}}(n("./node_modules/lodash/sortBy.js")),i=n("./app/helpers/phonebookHelpers.js"),c=n("./app/helpers/profilesHelpers.js"),u=n("./app/selectors/profilesSelectors.js"),l=function(e){return e.phonebook},d=function(e,t){return t.match.params.id},p=function(e){return e.statuses},f=function(e){return e.user.ctsAuthToken},m=(0,o.createSelector)([l,u.getProfiles,f],function(e,t,n){var a=(0,i.findHybridHuids)(e.rts,e.cts),o=e.rts.reduce(function(e,r){return e.find(function(e){return e.entry_id===r.entry_id})?e:(r.contacts.find(function(e){return a.includes(e.user_huid)})||e.push((0,c.mapProfileToEntry)(r,t,n)),e)},[]),u=e.cts.reduce(function(e,r){return r.contacts.find(function(e){return a.includes(e.user_huid)})||e.push((0,c.mapProfileToEntry)(r,t,n)),e},[]),l=a.reduce(function(a,o){var s=e.rts.filter(function(e){return e.contacts.find(function(e){return e.user_huid===o})}),i=e.cts.find(function(e){return e.contacts.find(function(e){return e.user_huid===o})});return a.concat(s.map(function(e){var a=r({},e,{contacts:e.contacts.concat(i.contacts)});return(0,c.mapProfileToEntry)(a,t,n)}))},[]),d=[].concat(o,u,l);return(0,s.default)(d,"name")});t.getPhonebookEntryList=m;var h=(0,o.createSelector)([m,p],function(e,t){return e.map(function(e){var n=t.find(function(t){return t.user_huid===e.user_huid});return r({},e,n)})});t.getPhonebookEntryListWithStatuses=h;var y=(0,o.createSelector)([h],function(e){return e.filter(function(e){return e.active}).reduce(function(e,t){return"cts"===t.conn_type&&e.find(function(e){return e.user_huid===t.user_huid})||e.push(t),e},[])});t.getActivePhonebookEntryListWithStatuses=y;var _=function(){return(0,o.createSelector)([h,d,u.getProfiles,f],function(e,t,n,r){var a,o,s=e.find(function(e){return e.entry_id===t});return s?(o=s,a=b(n,r)(o),v(a)):null})};t.makeGetCurrentPhonebookEntry=_;var b=function(e,t){return function(n){var a=n.contacts.reduce(function(a,o){var s=e.find(function(e){return e.user_huid===o.user_huid})||{},i=s.rts_profile,c=s.cts_profile;if("user"===o.user_kind&&!a.find(function(e){return"user"===e.user_kind&&e.user_huid===o.user_huid})){var u=t&&"cts"===n.conn_type&&o.user_huid===n.user_huid?"cts":"rts";a.push(r({},o,i,{conn_type:u}))}return"cts_user"===o.user_kind&&t&&c&&a.push(r({},o,c,{conn_type:"cts"})),"unregistered"===o.user_kind&&a.push(r({},o,{conn_type:"rts",user_huid:n.user_huid})),a},[]);return r({},n,{contacts:a})}},v=function(e){var t,n,a,o;return r({},e,{contactsGroups:(o=e.contacts,a=g(o),n=E(e.user_huid)(a),t=S(n),O(t))})},g=function(e){return e.reduce(function(e,t){var n=e.find(function(e){return!!e.find(function(e){return e.user_huid===t.user_huid})});return n||(n=[],e.push(n)),n.push(t),e},[])},E=function(e){return function(t){return t.sort(function(t){var n;return(null===(n=t[0])||void 0===n?void 0:n.user_huid)===e?0:1})}},S=function(e){return e.map(function(e){return e.sort(function(e){return"cts"===e.conn_type?0:1})})},O=function(e){return e.map(function(e){return e.sort(function(e){return"phone"===e.contact_type?0:1})})}},"./app/selectors/profilesSelectors.js":function(e,t,n){"use strict";function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){a(e,t,n[t])})}return e}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function s(e){return u(e)||c(e)||i()}function i(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function c(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function u(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}Object.defineProperty(t,"__esModule",{value:!0}),t.getProfilesGroupByServer=t.getVirtualEntry=t.getProfilesWithStatuses=t.getProfiles=void 0;var l=n("./node_modules/reselect/lib/index.js"),d=n("./node_modules/lodash/lodash.js"),p=n("./app/helpers/routing.js"),f=n("./app/helpers/profilesHelpers.js"),m=function(e){return e.profiles},h=function(e){return e.phonebook},y=function(e){return e.user},_=function(e,t){return e.chats.find(function(e){return e.group_chat_id===t.match.params.id})},b=function(e){return e.chats},v=function(e){return e.statuses||[]},g=function(e,t){return(_(e,t)||{}).servers||[]},E=function(e){return(0,p.matchMemberHuid)(e.routing.location.pathname)},S=function(e){return e.user.ctsAuthToken},O=(0,l.createSelector)([h,y],function(e,t){return s(e.cts).concat(s(e.rts)).reduce(function(e,n){var a=n.contacts,s=o(n,["contacts"]),i=a.map(function(e){return{user_huid:e.user_huid,isMe:e.user_huid===t.huid,isPhonebookUser:!0,phonebook_profile:r({},e,s)}});return e.concat(i)},[])}),C=(0,l.createSelector)([m,O,y],function(e,t,n){var a=s(e).concat(s(t));return(0,d.uniq)(a.map(function(e){return e.user_huid})).map(function(e){var t=a.filter(function(t){return t.user_huid===e}),o=Object.assign.apply(Object,[{}].concat(s(t))),i=w(o);return r({},i,{isPhonebookUser:i.isPhonebookUser||!1,isMe:e===n.huid})})});t.getProfiles=C;var w=function(e){var t=e.phonebook_profile,n=e.rts_profile;return t?r({},e,{phonebook_profile:r({},t,{avatar:n&&n.avatar})}):e},j=(0,l.createSelector)([E,C,v,S],function(e,t,n,r){var a,o,s=t.find(function(t){return t.user_huid===e});return s?(o=s,a=x(r)(o),R(n)(a)):[]});t.getProfilesWithStatuses=j;var k=(0,l.createSelector)([E,b],function(e,t){var n,r=t.find(function(t){return!!t.members.find(function(t){return t.user_huid===e})});return null===r||void 0===r?void 0:null===(n=r.members)||void 0===n?void 0:n.find(function(t){return t.user_huid===e})}),P=(0,l.createSelector)([E,j,k,S],function(e,t,n,a){if(!e)return null;var o=n||t[0],s=(0,f.mapProfileToEntry)({contacts:[o]},t,a),i=I(t,o.cts_id&&a),c=t.find(function(e){return"cts"===e.user_kind})||{},u=c.company_position,l=t.find(function(e){return e.conn_type===s.conn_type})||{};return r({},s,{name:l.name,avatar:l.avatar,contactsGroups:i,company_position:u,connType:s.conn_type})});t.getVirtualEntry=P;var T=(0,l.createSelector)([g,_,v,C],function(e,t,n,r){var a,o,s,i,c;return t?(c=t.members,i=N(r)(c),s=R(n)(i),o=M(s),a=A(e)(o),(0,d.sortBy)(a,["kind","server_id"])):[]});t.getProfilesGroupByServer=T;var x=function(e){return function(t){var n=[r({},t.rts_profile,{conn_type:"rts",user_huid:t.user_huid})];return e&&t.cts_profile&&n.push(r({},t.cts_profile,{conn_type:"cts",user_huid:t.user_huid})),n}},M=function(e){return(0,d.groupBy)(e,function(e){return"rts"===e.conn_type&&e.rts_id?e.rts_id:e.cts_id})},N=function(e){return function(t){return t.map(function(t){var n=e.find(function(e){return e.user_huid===t.user_huid})||{},a=(0,f.getFlatProfile)(n,t.conn_type);return r({},t,a)})}},A=function(e){return function(t){var n=(e||[]).reduce(function(e,t){return e[t.server_id]=t,e},{});return Object.keys(t).map(function(e){var a=t[e],o=a[0].conn_type;return n[e]?r({},n[e],{members:a}):{name:"rts"===o?"Express server":"Corporate server",server_id:e,kind:o,members:a}})}},R=function(e){return function(t){return t.map(function(t){var n=e.find(function(e){return t.user_huid===e.user_huid})||{};return r({},t,n)})}},I=function(e,t){return[e.filter(function(e){return t||"rts"===e.conn_type}).sort(function(e){return"cts"===e.conn_type?0:1}).map(function(e){return r({},e,{contact:"rts"===e.conn_type?e.phone:e.server_name,contact_type:"rts"===e.conn_type?"phone":"ad_server"})})]}},"./app/store/configureStore.dev.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){o(e,t,n[t])})}return e}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e){var t,n,r=(null===(t=window)||void 0===t?void 0:null===(n=t.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__)||void 0===n?void 0:n.call(t,{maxAge:500}))||i.compose,o=(0,d.default)(),s=(0,c.default)(),b=[p.localeMiddleware,o,(0,u.routerMiddleware)(s)],v=r(i.applyMiddleware.apply(void 0,b)),g=(0,i.createStore)(f.default,e,v);return g.subscribe((0,l.default)(function(){var e=g.getState(),t=e.statuses,n=e.user,r=e.encryptionKeys,o=e.phonebook,s=e.drafts,i=e.chats,c=e.profiles,u=e.settings,l=e.ui,d=l.locale,p=l.showUiAlert,f=l.uiAlertType,h=l.uiAlertAppVersion;(0,m.saveState)({statuses:t,user:n,encryptionKeys:r,phonebook:o,drafts:s,chats:i,profiles:c,settings:u,ui:a({},y.initialState,{locale:d,showUiAlert:p,uiAlertType:f,uiAlertAppVersion:h})})},_.DB_SYNC_INTERVAL)),o.run(h.default).done.catch(function(e){return console.error("Saga error",e)}),g}Object.defineProperty(t,"__esModule",{value:!0}),t.default=s;var i=n("./node_modules/redux/es/index.js"),c=r(n("./node_modules/history/createHashHistory.js")),u=n("./node_modules/react-router-redux/es/index.js"),l=r(n("./node_modules/lodash/throttle.js")),d=r(n("./node_modules/redux-saga/es/index.js")),p=(n("./app/store/mockActionsMiddleware.js"),r(n("./app/store/mockFetch.js")),n("./app/store/localeMiddleware.js")),f=r(n("./app/modules/index.js")),m=n("./lib/indexedDb.js"),h=r(n("./app/sagas/index.js")),y=n("./app/modules/ui.js"),_=n("./lib/constants.js")},"./app/store/configureStore.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(n("./app/store/configureStore.prod.js")),o=(r(n("./app/store/configureStore.dev.js")),a.default),s=o;t.default=s},"./app/store/configureStore.prod.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){o(e,t,n[t])})}return e}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e){var t=(0,d.default)(),n=(0,c.default)(),r=(0,i.applyMiddleware)(f.localeMiddleware,t,(0,u.routerMiddleware)(n)),o=(0,i.createStore)(p.default,e,r);return o.subscribe((0,l.default)(function(){var e=o.getState(),t=e.statuses,n=e.user,r=e.encryptionKeys,s=e.phonebook,i=e.drafts,c=e.chats,u=e.profiles,l=e.settings,d=e.ui,p=d.locale,f=d.showUiAlert,h=d.uiAlertType,_=d.uiAlertAppVersion;(0,m.saveState)({statuses:t,user:n,encryptionKeys:r,phonebook:s,drafts:i,chats:c,profiles:u,settings:l,ui:a({},y.initialState,{locale:p,showUiAlert:f,uiAlertType:h,uiAlertAppVersion:_})})},_.DB_SYNC_INTERVAL)),t.run(h.default).done.catch(function(e){return console.error("Saga error",e)}),o}Object.defineProperty(t,"__esModule",{value:!0}),t.default=s;var i=n("./node_modules/redux/es/index.js"),c=r(n("./node_modules/history/createHashHistory.js")),u=n("./node_modules/react-router-redux/es/index.js"),l=r(n("./node_modules/lodash/throttle.js")),d=r(n("./node_modules/redux-saga/es/index.js")),p=r(n("./app/modules/index.js")),f=n("./app/store/localeMiddleware.js"),m=n("./lib/indexedDb.js"),h=r(n("./app/sagas/index.js")),y=n("./app/modules/ui.js"),_=n("./lib/constants.js")},"./app/store/localeMiddleware.js":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.localeMiddleware=void 0;var r=n("./app/modules/ui.js"),a=n("./lib/reactIntl.js"),o=function(){return function(e){return function(t){t.type===r.SET_LOCALE&&t.payload&&(0,a.setLocale)(t.payload),e(t)}}};t.localeMiddleware=o},"./app/store/mockActionsMiddleware.js":function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){o(e,t,n[t])})}return e}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){return u(e)||c(e,t)||i()}function i(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function c(e,t){var n=[],r=!0,a=!1,o=void 0;try{for(var s,i=e[Symbol.iterator]();!(r=(s=i.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==i.return||i.return()}finally{if(a)throw o}}return n}function u(e){if(Array.isArray(e))return e}Object.defineProperty(t,"__esModule",{value:!0}),t.mockActionsMiddleware=void 0;var l=r(n("./app/modules/messages.js")),d=r(n("./app/modules/phonebook.js")),p=function(e){return function(e){return function(t){var n,r,a=(r=t,n=m(r),f(n));e(a)}}};t.mockActionsMiddleware=p;var f=function(e){if(e.type!==l.DECRYPT_HISTORY_SUCCESS)return e;var t=e.payload.slice(-1),n=s(t,1),r=n[0],o=r.group_chat_id,i=r.inserted_at,c=r.payload,u=c.timestamp,d=[{sync_id:"11111111-2222-2222-2222-111111111111",payload:{type:"command_result",timestamp:u,preview:"Command Result",body:"Card #1 card",actions:[{type:"button",label:"Do it",command:"doit #id"},{type:"button",label:"Done",command:"done #id"},{type:"dialog_text",label:"Add comment",command:"comment #id #text"}],metadata:{extended:{board_id:"id"},preview:{id:"#3",list:"Done",url:"https://trello.com/c/hBF4CshN/3-3-card"}}},inserted_at:i,group_chat_id:o,event_type:"message_new"},{sync_id:"11111111-3333-2222-2222-111111111111",payload:{type:"bot_notification",timestamp:u,preview:"Bot Notification",body:"<div>  </div><div> middleware   </div><div>: Done</div>",actions:[{type:"button",label:"Do it",command:"doit #id"},{type:"button",label:"Done",command:"done #id"},{type:"dialog_text",label:"Add comment",command:"comment #id #text"}],metadata:{extended:{board_id:"id"},preview:{id:"#3",list:"Done",url:"https://trello.com/c/hBF4CshN/3-3-card"}}},inserted_at:i,group_chat_id:o,event_type:"message_new"}];return a({},e,{payload:e.payload.concat(d)})},m=function(e){return e.type!==d.FETCH_PHONEBOOK_SUCCESS||"cts"!==e.payload.connType?e:(e.payload.entries.push({entry_id:"trello_bot",name:"Trello Bot",contacts:[{user_huid:"6eea3388-b59b-49cc-a23c-b0a45bdcee8b",active:!0,contact_type:"botx",contact:"trello_bot"}]}),e)}},"./app/store/mockFetch.js":function(e,t,n){"use strict";(function(e){function n(){return new Promise(function(e){var t={status:"error",reason:"must_update",error_data:{must_update_to_version:"1.2.0"}};e({ok:!1,status:401,headers:{get:function(){return"application/json"}},json:function(){return new Promise(function(e){return e(t)})}})})}function r(){return new Promise(function(e){var t={status:"error",reason:"need_cts_login",error_data:{endpoint:"cts1dev.ccsteam.ru"}};e({ok:!1,status:401,headers:{get:function(){return"application/json"}},json:function(){return new Promise(function(e){return e(t)})}})})}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=fetch,o=function(){e.fetch=function(e,t){return/\/phonebook2\/profiles\/self/.test(e)?n():/\/api\/v1\/authentication\/token\/active/.test(e)?r():a(e,t)}};t.default=o}).call(t,n("./node_modules/webpack/buildin/global.js"))},"./app/styles/app.scss":function(e,t){},"./app/workers/encryptionWorker.js":function(e,t,n){e.exports=function(){return new Worker(n.p+"scripts/encryptionWorker-1.2.788.js")}},"./app/workers/pushWorker.js":function(e,t,n){e.exports=function(e){return navigator.serviceWorker.register(n.p+"591551671c7e43fa61a2.serviceworker.js",e)}},"./config/manifest.json":function(e,t,n){e.exports=n.p+"manifest.json"},"./lib/advancedFetch.js":function(e,t,n){"use strict";(function(e){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){o(e,t,n[t])})}return e}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e){E=e}function i(e,t){y.default.push(y.networkStatsTypesEnum.restCalls,e);var n=null,r=a({},d(t),{encrypt:!1}),o=c(t),s=o.userPrivateKey,i=o.userPublicKey,f=o.serverPublicKey,m=u(r,s,i,f);return fetch(e,m).then(function(e){n=e}).then(function(){return l(n,f,s)}).then(function(e){return p(n,e)})}function c(e){if(!e||!e.encrypt)return{};var t=E.getState(),n=t.encryptionKeys,r=n.server[e.connType],a=(0,h.generateKxPair)();return{userPublicKey:a.publicKey,userPrivateKey:a.privateKey,serverPublicKey:r}}function u(e,t,n,r){if(!e||!e.encrypt)return e;if(!e.connType)throw Error("connType is required parameter for encrypted fetch");if(e.headers||(e.headers={}),e.headers=a({},e.headers,{accept:"application/vnd+express.encr+encr",encryption:(0,h.toBase64)(n),"express-crypto-accept":"application/json"}),e.body){if(!r)throw Error("No server public key ".concat(e.connType));var o=new v("utf-8").encode(e.body),s=(0,h.rsaEncrypt)(o,r,t);e.body=s.buffer,e.headers=a({},e.headers,{"express-crypto-content-type":e.headers["content-type"]||"application/json; charset=utf-8"})}return["POST","PUT","PATCH"].includes(e.method)&&(e.headers=a({},e.headers,{"content-type":"application/vnd+express.encr+encr"})),e}function l(e,t,n){var r=e.headers.get("content-type");if(!r.startsWith("application/vnd+express.encr+encr")&&!e.ok)return Promise.reject(e);if(r.startsWith("application/json"))return e.json();if(r.startsWith("text/html"))return e.text();if(!r.startsWith("application/vnd+express.encr+encr"))return e;if(!t)throw Error("No server public key");return e.arrayBuffer().then(function(r){var a=(0,h.rsaDecrypt)(new Uint8Array(r),t,n);if(!a)throw Error("Error decrypt REST response from ".concat(e.url," with server public ").concat((0,h.toBase64)(t)));var o=new g("utf-8").decode(a);return JSON.parse(o)})}function d(e){if(!e.authToken)return e;var t=a({},e.headers,{authorization:"Bearer ".concat(e.authToken)});return e.method&&"GET"!==e.method&&(t["content-type"]=t["content-type"]||"application/json"),a({},e,{headers:t})}function p(e,t){var n="unauthorized"!==t.reason?t.reason:t.error_data,r=[].concat(_,b),a=401===e.status&&r.includes(n);return e.ok||a?(a&&f(t,n),t):Promise.reject(t)}function f(e,t){var n;if("registered_on_cts"===t&&E.dispatch({type:"REGISTERED_ON_CTS"}),"registered_on_other_cts"===t&&E.dispatch({type:"REGISTERED_ON_OTHER_CTS"}),"logged_out_cts"===t&&E.dispatch({type:"LOGGED_OUT_CTS"}),"need_cts_login"===t&&E.dispatch({type:"NEED_CTS_LOGIN",payload:null===(n=e.error_data)||void 0===n?void 0:n.endpoint}),b.includes(t)){var r,a=null===(r=e.error_data)||void 0===r?void 0:r.must_update_to_version;E.dispatch({type:"UI_ALERT_RECEIVED",payload:{type:t,version:a}})}}Object.defineProperty(t,"__esModule",{value:!0}),t.setStore=s,t.advancedFetch=i;var m=r(n("./node_modules/text-encoding/index.js")),h=n("./lib/encryption.js"),y=r(n("./lib/networkStats.js")),_=["registered_on_cts","registered_on_other_cts","logged_out_cts","need_cts_login"],b=["must_update","must_update_and_clear_data","must_clear_data"],v=e.TextEncoder||m.TextEncoder,g=e.TextDecoder||m.TextDecoder,E={}}).call(t,n("./node_modules/webpack/buildin/global.js"))},"./lib/config.js":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(){if(Object({PRODUCTION:1,NODE_ENV:"production"}).TEST){var e="string"==typeof Object({PRODUCTION:1,NODE_ENV:"production"}).CONFIG?JSON.parse(Object({PRODUCTION:1,NODE_ENV:"production"}).CONFIG):Object({PRODUCTION:1,NODE_ENV:"production"}).CONFIG,t=e.plugins.find(function(e){return e.definitions&&e.definitions["process.env"]});return JSON.parse(t.definitions["process.env"].CONFIG)}return window.CONFIG}();t.default=r},"./lib/constants.js":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MAX_VISIBLE_MESSAGES=t.CORS_API_URL=t.URL_PARSING_TIMEOUT=t.INDEXED_DB_MAX_WRITE_COUNT=t.TYPING_RELEVANCE_INTERVAL=t.DB_SYNC_INTERVAL=t.MAX_PASSWORD_LENGTH=t.REGISTER_REQUEST_LONG_POOL_TIMEOUT=t.UNCHUNKED_DECRYPTION_SIZE_LIMIT=t.MAX_ATTACHMENT_SIZE=t.CHUNK_SIZE=t.VOEX_CONNECTION_TIMEOUT=t.HANGUP_CALL_AFTER=t.PUSH_REGISTER_DELAY=t.CHECK_UPDATES_PERIOD=t.FF_PEER_CONNECTION_DISCONNECTED_TIMEOUT=t.PEER_CONNECTION_BANDWITH=t.AVATAR_UPLOADER_HEIGHT=t.AVATAR_UPLOADER_WIDTH=t.VIDEO_ACCEPT=t.IMAGE_ACCEPT=t.DOCUMENT_DECLINE=t.BLUR_PREVIEW_MAX_HEIGHT=t.BLUR_PREVIEW_MAX_WIDTH=t.PREVIEW_MAX_HEIGHT=t.PREVIEW_MAX_WIDTH=t.CONFIRMATION_CODE_LENGTH=t.RESEND_SMS_DELAY=t.STILL_TYPING_TIMEOUT=t.CHAT_SCROLL_FROM_BOTTOM_OFFSET=t.CHAT_BEGIN_LOADING_OFFSET=t.UNREAD_AFOREGOING_NUMBER=t.HISTORY_LIMIT=t.PRIVATE_KEYS_DECRYPT_ATTEMPTS=void 0;t.PRIVATE_KEYS_DECRYPT_ATTEMPTS=5;t.HISTORY_LIMIT=50;t.UNREAD_AFOREGOING_NUMBER=5;t.CHAT_BEGIN_LOADING_OFFSET=500;t.CHAT_SCROLL_FROM_BOTTOM_OFFSET=100;t.STILL_TYPING_TIMEOUT=3e3;t.RESEND_SMS_DELAY=7e4;t.CONFIRMATION_CODE_LENGTH=4;t.PREVIEW_MAX_WIDTH=300;t.PREVIEW_MAX_HEIGHT=300;t.BLUR_PREVIEW_MAX_WIDTH=50;t.BLUR_PREVIEW_MAX_HEIGHT=50;var r=["application/vnd.microsoft.portable-executable","application/x-msdos-program","application/x-ms-dos-executable","application/x-executable","application/x-msi","application/x-debian-package","application/vnd.debian.binary-package","application/x-redhat-package-manager","application/x-apple-diskimage","application/mac-binhex40","application/javascript","application/x-javascript","application/x-oz-application","application/x-sh","application/x-shellscript","application/x-shockwave-flash","application/x-java-archive","application/java-archive","application/x-xpinstall","text/html","text/iuls"];t.DOCUMENT_DECLINE=r;t.IMAGE_ACCEPT="image/*";var a=["video/mp4","video/x-m4v","video/*","video/x-msvideo","video/x-ms-wmv","video/quicktime","video/webm","video/mpeg","video/ogg","video/mkv","video/x-matroska"].join(",");t.VIDEO_ACCEPT=a;t.AVATAR_UPLOADER_WIDTH=400;t.AVATAR_UPLOADER_HEIGHT=400;t.PEER_CONNECTION_BANDWITH=200;t.FF_PEER_CONNECTION_DISCONNECTED_TIMEOUT=1;t.CHECK_UPDATES_PERIOD=432e5;t.PUSH_REGISTER_DELAY=3e4;t.HANGUP_CALL_AFTER=3e4;t.VOEX_CONNECTION_TIMEOUT=1e4;t.CHUNK_SIZE=2097152;t.MAX_ATTACHMENT_SIZE=104857600;t.UNCHUNKED_DECRYPTION_SIZE_LIMIT=4194304;t.REGISTER_REQUEST_LONG_POOL_TIMEOUT=6e4;t.MAX_PASSWORD_LENGTH=128;t.DB_SYNC_INTERVAL=500;t.TYPING_RELEVANCE_INTERVAL=12e4;t.INDEXED_DB_MAX_WRITE_COUNT=100;t.URL_PARSING_TIMEOUT=5e3;t.CORS_API_URL="https://cors-anywhere.herokuapp.com/";t.MAX_VISIBLE_MESSAGES=50},"./lib/deepEqual.js":function(e,t,n){"use strict";function r(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(e===t)return!0;var n,s=Array.isArray(e),i=Array.isArray(t);if(s&&i){if(e.length!==t.length)return!1;for(n=0;n<e.length;n++)if(!o(e[n],t[n]))return!1;return!0}if(s!==i)return!1;if(e&&t&&"object"===a(e)&&"object"===a(t)){var c=Object.keys(e);if(c.length!==Object.keys(t).length)return!1;var u=r(e,Date),l=r(t,Date);if(u&&l)return e.getTime()===t.getTime();if(u!==l)return!1;for(n=0;n<c.length;n++)if(!Object.prototype.hasOwnProperty.call(t,c[n]))return!1;if(e.$$typeof&&"Symbol(react.element)"===e.$$typeof.toString()&&t.$$typeof&&"Symbol(react.element)"===t.$$typeof.toString())return(e.type&&e.type.name)===(t.type&&t.type.name)&&o(e.props,t.props);for(n=0;n<c.length;n++)if(!o(e[c[n]],t[c[n]]))return!1;return!0}return!1}Object.defineProperty(t,"__esModule",{value:!0}),t.equal=o},"./lib/dispatcher.js":function(e,t,n){"use strict";function r(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function a(e,t){if(!r(e,t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=function(e){return e&&e.__esModule?e:{default:e}}(n("./lib/uuid5.js")),c=function(){function e(){a(this,e),this.listeners=[],this.waitPromises={}}return s(e,[{key:"addEventListener",value:function(e,t){"function"==typeof t&&this.listeners.push({type:e,callback:t})}},{key:"removeEventListener",value:function(e,t){var n=this.listeners.findIndex(function(n){return n.type===e&&n.callback===t});-1!==n&&this.listeners.splice(n,1)}},{key:"dispatchEvent",value:function(e,t){this.listeners.filter(function(t){return t.type===e}).forEach(function(e){return e.callback(t)})}},{key:"waitEvent",value:function(e,t){var n=this;return new Promise(function(r,a){var o=null,s=function t(a){r(a),n.removeEventListener(e,t),o&&clearTimeout(o)};n.addEventListener(e,s),o=setTimeout(function(){a("Timeout waiting event",e),n.removeEventListener(e,s)},t)})}},{key:"waitEventInfinite",value:function(e,t){var n=this;return new Promise(function(r,a){var o=(0,i.default)(),s=function a(s){t&&s!==t||(n.waitPromises[o]&&delete n.waitPromises[o],r(s),n.removeEventListener(e,a))};n.addEventListener(e,s),n.waitPromises[o]={resolve:r,reject:a}})}},{key:"cancelAllWaitEvents",value:function(){var e=this;Object.keys(this.waitPromises).forEach(function(t){e.waitPromises[t].reject(),delete e.waitPromises[t]})}}]),e}();t.default=c},"./lib/encryption.js":function(e,t,n){"use strict";function r(e){return s(e)||o(e)||a()}function a(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function o(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function s(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}function i(e,t){var n=x.default.randombytes_buf(x.default.crypto_secretbox_NONCEBYTES);return k(x.default.crypto_secretbox_easy(JSON.stringify(e),n,t),n)}function c(e,t){var n=e.slice(0,x.default.crypto_secretbox_NONCEBYTES),r=e.slice(x.default.crypto_secretbox_NONCEBYTES),a=!1;try{a=x.default.crypto_secretbox_open_easy(r,n,t,"text")}finally{return JSON.parse(a)}}function u(e,t){var n,r=x.default.randombytes_buf(x.default.crypto_secretbox_NONCEBYTES),a=new Uint8Array(e.byteLength+d(e.byteLength,M.CHUNK_SIZE)),o=0;for(n=0;n<e.byteLength;n+=M.CHUNK_SIZE){var s=e.slice(n,n+M.CHUNK_SIZE),i=x.default.crypto_secretbox_easy(s,r,t);a.set(i,o),o+=i.byteLength}return k(a,r)}function l(e,t,n){var r=e.slice(0,x.default.crypto_secretbox_NONCEBYTES),a=e.slice(x.default.crypto_secretbox_NONCEBYTES),o=!1;if(!n)try{o=x.default.crypto_secretbox_open_easy(a,r,t)}finally{return o}try{o=new Uint8Array(a.byteLength-d(a.byteLength,n));var s,i=0;for(s=0;s<a.byteLength;s+=n+x.default.crypto_secretbox_MACBYTES){var c=a.slice(s,s+n+x.default.crypto_secretbox_MACBYTES),u=x.default.crypto_secretbox_open_easy(c,r,t);o.set(u,i),i+=u.byteLength}}finally{return o}}function d(e,t){return Math.ceil(e/t)*x.default.crypto_secretbox_MACBYTES}function p(){return{rts:x.default.crypto_box_keypair(),cts:x.default.crypto_box_keypair()}}function f(e,t){var n=x.default.randombytes_buf(x.default.crypto_secretbox_NONCEBYTES),r=x.default.crypto_generichash(x.default.crypto_generichash_KEYBYTES,t);return k(x.default.crypto_secretbox_easy(e,n,r),n)}function m(e,t){var n=x.default.crypto_generichash(x.default.crypto_generichash_KEYBYTES,t),r=e.slice(0,x.default.crypto_secretbox_NONCEBYTES),a=e.slice(x.default.crypto_secretbox_NONCEBYTES),o=!1;try{o=x.default.crypto_secretbox_open_easy(a,r,n)}finally{return h(o)}}function h(e){return 32===e.byteLength?e:w(String.fromCharCode.apply(String,r(e)))}function y(){return x.default.randombytes_buf(x.default.crypto_secretbox_KEYBYTES)}function _(e,t,n){return T(e,t,n)}function b(e,t,n){return P(e,t,n)}function v(){return x.default.crypto_kx_keypair()}function g(e,t,n){return x.default.crypto_kx_client_session_keys(e,t,n)}function E(e,t){var n=x.default.randombytes_buf(x.default.crypto_secretbox_NONCEBYTES);return k(x.default.crypto_secretbox_easy(e,n,t),n)}function S(e,t){var n=!1;try{var r=e.slice(0,x.default.crypto_secretbox_NONCEBYTES),a=e.slice(x.default.crypto_secretbox_NONCEBYTES);n=x.default.crypto_secretbox_open_easy(a,r,t,"text")}finally{return n}}function O(e){return x.default.to_base64(e)}function C(e){return x.default.to_base64(e).replace(/\+/g,"-").replace(/\//g,"_")}function w(e){return x.default.from_base64(e)}function j(e){return x.default.from_base64(e.replace(/\-/g,"+").replace(/\_/g,"/"))}function k(e,t){var n=new Uint8Array(t.byteLength+e.byteLength);return n.set(new Uint8Array(t),0),n.set(new Uint8Array(e),t.byteLength),n}function P(e,t,n){var r=!1,a=e.slice(0,x.default.crypto_box_NONCEBYTES),o=e.slice(x.default.crypto_box_NONCEBYTES);try{r=x.default.crypto_box_open_easy(o,a,t,n)}catch(e){console.warn("Error decrypt message: ".concat(e.message))}return r}function T(e,t,n){var r=x.default.randombytes_buf(x.default.crypto_box_NONCEBYTES);return k(x.default.crypto_box_easy(e,r,t,n),r)}Object.defineProperty(t,"__esModule",{value:!0}),t.encryptPayload=i,t.decryptPayload=c,t.encryptFile=u,t.decryptFile=l,t.generateRtsCtsKeyPairs=p,t.encryptPrivateKey=f,t.decryptPrivateKey=m,t.generateSymmetricKey=y,t.encryptSymmetricKeyWithPub=_,t.decryptSymmetricKeyWithPub=b,t.generateKxPair=v,t.generateSessionPair=g,t.encryptSocket=E,t.decryptSocket=S,t.toBase64=O,t.toBase64Url=C,t.fromBase64=w,t.fromBase64Url=j,t.rsaDecrypt=P,t.rsaEncrypt=T;var x=function(e){return e&&e.__esModule?e:{default:e}}(n("./node_modules/libsodium-wrappers/dist/modules/libsodium-wrappers.js")),M=n("./lib/constants.js")},"./lib/encryptionTask.js":function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){o(e,t,n[t])})}return e}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t,n){switch(e){case"ENCRYPT_FILE":return i(n);case"DECRYPT_FILE":return c(n);case"ENCRYPT_MESSAGE_PAYLOAD":return u(n);case"DECRYPT_MESSAGE_PAYLOADS":return l(n);case"ENCRYPT_SYMMETRIC_KEY":return d(n);case"DECRYPT_SYMMETRIC_KEY":return p(n)}return null}function i(e){var t=e.file,n=e.symmetricKey,r=f.encryptFile(t,n);return new Blob([r.buffer])}function c(e){var t=e.url,n=e.host,r=e.symmetricKey,a=e.mimeType,o=e.chunkSize;return m.fetchBinaryData(t,n).then(function(e){var t=!o&&e.length>y.UNCHUNKED_DECRYPTION_SIZE_LIMIT?new Uint8Array:f.decryptFile(e,r,o),n=new Blob([t.buffer],{type:a});return URL.createObjectURL(n)})}function u(e){var t=e.messagePayload,n=e.symmetricKey;return f.toBase64(f.encryptPayload(t,n))}function l(e){var t=e.messages,n=e.encryptionKeys;return t.reduce(function(e,t){var r;if(!t||!t.payload||"app_event"===t.event_type&&!t.payload.event)return t;var o=null===(r=n.publicKeys.find(function(e){return e.id===t.sender_key_id}))||void 0===r?void 0:r.kind;if(!o)return e;var s=(0,h.decryptMessageSymmetricKey)(t,n),i="app_event"===t.event_type?t.payload.event:t.payload,c=f.decryptPayload(f.fromBase64(i),s),u="app_event"===t.event_type?a({},t,{kind:o,payload:a({},t.payload,{event:c})}):a({},t,{kind:o,payload:c});return e.push(u),e},[])}function d(e){var t=e.symmetricKey,n=e.publicKey,r=e.privateKey;return f.toBase64(f.encryptSymmetricKeyWithPub(t,n,r))}function p(e){var t=e.message,n=e.encryptionKeys;return(0,h.decryptMessageSymmetricKey)(t,n)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=s;var f=r(n("./lib/encryption.js")),m=r(n("./app/api/fileService.js")),h=n("./app/helpers/messagesHelpers.js"),y=n("./lib/constants.js")},"./lib/encryptionTaskWrapper.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.runEncryptionTask=void 0;var a=r(n("./node_modules/bowser/src/bowser.js")),o=r(n("./lib/encryptionTask.js")),s=n("./lib/encryptionWorker.js"),i=function(e,t,n){return a.default.msie||a.default.msedge?new Promise(function(r){var a=(0,o.default)(e,t,n);(null===a||void 0===a?void 0:a.then)&&"function"==typeof a.then?a.then(function(e){return r(e)}):r(a)}):(0,s.runEncryptionTaskInWorker)(e,t,n)};t.runEncryptionTask=i},"./lib/encryptionWorker.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.runEncryptionTaskInWorker=void 0;var a=r(n("./node_modules/bowser/src/bowser.js")),o=r(n("./lib/uuid5.js")),s=a.default.msie||a.default.msedge,i=[],c=s?{}:new(n("./app/workers/encryptionWorker.js"));c.onmessage=function(e){var t=e.data,n=t.type,r=t.payload,a=i.find(function(e){return e.type===n});if(a){var o=i.indexOf(a);i.splice(o,1),a.resolve(r)}};var u=function(e,t,n){var r=(0,o.default)(),a="".concat(e,":").concat(r),s="".concat(t,":").concat(r);return new Promise(function(e){c.postMessage({type:a,responseType:s,payload:n}),i.push({type:s,resolve:e})})};t.runEncryptionTaskInWorker=u},"./lib/hasher.js":function(e,t,n){"use strict";function r(e){return M(C(x(e),e.length*N))}function a(e,t){return t?g(e):E(e)}function o(e,t,n){return n?S(e,t):O(e,t)}function s(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function i(e,t){return e<<t|e>>>32-t}function c(e,t,n,r,a,o){return s(i(s(s(t,e),s(r,o)),a),n)}function u(e,t,n,r,a,o,s){return c(t&n|~t&r,e,t,a,o,s)}function l(e,t,n,r,a,o,s){return c(t&r|n&~r,e,t,a,o,s)}function d(e,t,n,r,a,o,s){return c(t^n^r,e,t,a,o,s)}function p(e,t,n,r,a,o,s){return c(n^(t|~r),e,t,a,o,s)}function f(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var n,r,a,o,i=1732584193,c=-271733879,f=-1732584194,m=271733878,h=0;h<e.length;h+=16)n=i,r=c,a=f,o=m,i=u(i,c,f,m,e[h],7,-680876936),m=u(m,i,c,f,e[h+1],12,-389564586),f=u(f,m,i,c,e[h+2],17,606105819),c=u(c,f,m,i,e[h+3],22,-1044525330),i=u(i,c,f,m,e[h+4],7,-176418897),m=u(m,i,c,f,e[h+5],12,1200080426),f=u(f,m,i,c,e[h+6],17,-1473231341),c=u(c,f,m,i,e[h+7],22,-45705983),i=u(i,c,f,m,e[h+8],7,1770035416),m=u(m,i,c,f,e[h+9],12,-1958414417),f=u(f,m,i,c,e[h+10],17,-42063),c=u(c,f,m,i,e[h+11],22,-1990404162),i=u(i,c,f,m,e[h+12],7,1804603682),m=u(m,i,c,f,e[h+13],12,-40341101),f=u(f,m,i,c,e[h+14],17,-1502002290),c=u(c,f,m,i,e[h+15],22,1236535329),i=l(i,c,f,m,e[h+1],5,-165796510),m=l(m,i,c,f,e[h+6],9,-1069501632),f=l(f,m,i,c,e[h+11],14,643717713),c=l(c,f,m,i,e[h],20,-373897302),i=l(i,c,f,m,e[h+5],5,-701558691),m=l(m,i,c,f,e[h+10],9,38016083),f=l(f,m,i,c,e[h+15],14,-660478335),c=l(c,f,m,i,e[h+4],20,-405537848),i=l(i,c,f,m,e[h+9],5,568446438),m=l(m,i,c,f,e[h+14],9,-1019803690),f=l(f,m,i,c,e[h+3],14,-187363961),c=l(c,f,m,i,e[h+8],20,1163531501),i=l(i,c,f,m,e[h+13],5,-1444681467),m=l(m,i,c,f,e[h+2],9,-51403784),f=l(f,m,i,c,e[h+7],14,1735328473),c=l(c,f,m,i,e[h+12],20,-1926607734),i=d(i,c,f,m,e[h+5],4,-378558),m=d(m,i,c,f,e[h+8],11,-2022574463),f=d(f,m,i,c,e[h+11],16,1839030562),c=d(c,f,m,i,e[h+14],23,-35309556),i=d(i,c,f,m,e[h+1],4,-1530992060),m=d(m,i,c,f,e[h+4],11,1272893353),f=d(f,m,i,c,e[h+7],16,-155497632),c=d(c,f,m,i,e[h+10],23,-1094730640),i=d(i,c,f,m,e[h+13],4,681279174),m=d(m,i,c,f,e[h],11,-358537222),f=d(f,m,i,c,e[h+3],16,-722521979),c=d(c,f,m,i,e[h+6],23,76029189),i=d(i,c,f,m,e[h+9],4,-640364487),m=d(m,i,c,f,e[h+12],11,-421815835),f=d(f,m,i,c,e[h+15],16,530742520),c=d(c,f,m,i,e[h+2],23,-995338651),i=p(i,c,f,m,e[h],6,-198630844),m=p(m,i,c,f,e[h+7],10,1126891415),f=p(f,m,i,c,e[h+14],15,-1416354905),c=p(c,f,m,i,e[h+5],21,-57434055),i=p(i,c,f,m,e[h+12],6,1700485571),m=p(m,i,c,f,e[h+3],10,-1894986606),f=p(f,m,i,c,e[h+10],15,-1051523),c=p(c,f,m,i,e[h+1],21,-2054922799),i=p(i,c,f,m,e[h+8],6,1873313359),m=p(m,i,c,f,e[h+15],10,-30611744),f=p(f,m,i,c,e[h+6],15,-1560198380),c=p(c,f,m,i,e[h+13],21,1309151649),i=p(i,c,f,m,e[h+4],6,-145523070),m=p(m,i,c,f,e[h+11],10,-1120210379),f=p(f,m,i,c,e[h+2],15,718787259),c=p(c,f,m,i,e[h+9],21,-343485551),i=s(i,n),c=s(c,r),f=s(f,a),m=s(m,o);return[i,c,f,m]}function m(e){for(var t="",n=32*e.length,r=0;r<n;r+=8)t+=String.fromCharCode(e[r>>5]>>>r%32&255);return t}function h(e){var t=[],n=8*e.length;t[(e.length>>2)-1]=void 0;for(var r=0;r<t.length;r+=1)t[r]=0;for(var a=0;a<n;a+=8)t[a>>5]|=(255&e.charCodeAt(a/8))<<a%32;return t}function y(e){return m(f(h(e),8*e.length))}function _(e,t){var n=h(e),r=[],a=[];r[15]=a[15]=void 0,n.length>16&&(n=f(n,8*e.length));for(var o=0;o<16;o+=1)r[o]=909522486^n[o],a[o]=1549556828^n[o];var s=f(r.concat(h(t)),512+8*t.length);return m(f(a.concat(s),640))}function b(e){for(var t="0123456789abcdef",n="",r=0;r<e.length;r+=1){var a=e.charCodeAt(r);n+=t.charAt(a>>>4&15)+t.charAt(15&a)}return n}function v(e){return unescape(encodeURIComponent(e))}function g(e){return y(v(e))}function E(e){return b(g(e))}function S(e,t){return _(e,t)}function O(e,t){return b(S(e,t))}function C(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var n=1732584193,r=-271733879,a=-1732584194,o=271733878,i=0;i<e.length;i+=16){var c=n,u=r,l=a,d=o;n=j(n,r,a,o,e[i+0],3),o=j(o,n,r,a,e[i+1],7),a=j(a,o,n,r,e[i+2],11),r=j(r,a,o,n,e[i+3],19),n=j(n,r,a,o,e[i+4],3),o=j(o,n,r,a,e[i+5],7),a=j(a,o,n,r,e[i+6],11),r=j(r,a,o,n,e[i+7],19),n=j(n,r,a,o,e[i+8],3),o=j(o,n,r,a,e[i+9],7),a=j(a,o,n,r,e[i+10],11),r=j(r,a,o,n,e[i+11],19),n=j(n,r,a,o,e[i+12],3),o=j(o,n,r,a,e[i+13],7),a=j(a,o,n,r,e[i+14],11),r=j(r,a,o,n,e[i+15],19),n=k(n,r,a,o,e[i+0],3),o=k(o,n,r,a,e[i+4],5),a=k(a,o,n,r,e[i+8],9),r=k(r,a,o,n,e[i+12],13),n=k(n,r,a,o,e[i+1],3),o=k(o,n,r,a,e[i+5],5),a=k(a,o,n,r,e[i+9],9),r=k(r,a,o,n,e[i+13],13),n=k(n,r,a,o,e[i+2],3),o=k(o,n,r,a,e[i+6],5),a=k(a,o,n,r,e[i+10],9),r=k(r,a,o,n,e[i+14],13),n=k(n,r,a,o,e[i+3],3),o=k(o,n,r,a,e[i+7],5),a=k(a,o,n,r,e[i+11],9),r=k(r,a,o,n,e[i+15],13),n=P(n,r,a,o,e[i+0],3),o=P(o,n,r,a,e[i+8],9),a=P(a,o,n,r,e[i+4],11),r=P(r,a,o,n,e[i+12],15),n=P(n,r,a,o,e[i+2],3),o=P(o,n,r,a,e[i+10],9),a=P(a,o,n,r,e[i+6],11),r=P(r,a,o,n,e[i+14],15),n=P(n,r,a,o,e[i+1],3),o=P(o,n,r,a,e[i+9],9),a=P(a,o,n,r,e[i+5],11),r=P(r,a,o,n,e[i+13],15),n=P(n,r,a,o,e[i+3],3),o=P(o,n,r,a,e[i+11],9),a=P(a,o,n,r,e[i+7],11),r=P(r,a,o,n,e[i+15],15),n=s(n,c),r=s(r,u),a=s(a,l),o=s(o,d)}return[n,r,a,o]}function w(e,t,n,r,a,o){return s(T(s(s(t,e),s(r,o)),a),n)}function j(e,t,n,r,a,o){return w(t&n|~t&r,e,0,a,o,0)}function k(e,t,n,r,a,o){return w(t&n|t&r|n&r,e,0,a,o,1518500249)}function P(e,t,n,r,a,o){return w(t^n^r,e,0,a,o,1859775393)}function T(e,t){return e<<t|e>>>32-t}function x(e){for(var t=[],n=(1<<N)-1,r=0;r<e.length*N;r+=N)t[r>>5]|=(e.charCodeAt(r/N)&n)<<r%32;return t}function M(e){for(var t="",n=(1<<N)-1,r=0;r<32*e.length;r+=N)t+=String.fromCharCode(e[r>>5]>>>r%32&n);return t}Object.defineProperty(t,"__esModule",{value:!0}),t.md4=r,t.md5=a,t.hmac=o;var N=8},"./lib/indexedDb.js":function(e,t,n){"use strict";function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){a(e,t,n[t])})}return e}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(t,"__esModule",{value:!0}),t.loadState=t.saveState=t.saveStateData=void 0,n("./node_modules/indexeddb-getall-shim/IndexedDB-getAll-shim.js");var o=n("./app/helpers/chatsHelpers.js"),s=n("./lib/constants.js"),i=0,c=function(){return void 0!==window.indexedDB},u=function(){var e=null,t=null,n=new Promise(function(n,r){e=n,t=r});return{resolve:e,reject:t,promise:n}},l=function(){var e=u(),t=e.resolve,n=e.reject,r=e.promise,a=indexedDB.open("reduxState");return a.onsuccess=function(e){return t(e.target.result)},a.onerror=function(){return n((void 0).error)},a.onupgradeneeded=function(e){return e.target.result.createObjectStore("items",{})},r},d=function(){return new Promise(function(e){var t=indexedDB.deleteDatabase("reduxState");t.onerror=function(t){e(),console.warn("Error drop indexedDB",t.message)},t.onsuccess=function(){return e()}})},p=function(e,t){var n=u(),r=n.resolve,a=n.promise;return e.get(t).onsuccess=function(e){return r({key:t,value:e.target.result})},a},f=function(e){l().then(function(t){var n=t.transaction(["items"],"readwrite"),r=n.objectStore("items"),a=y(e);Object.keys(a).forEach(function(e){r.put(a[e],e)}),n.oncomplete=function(){i++,t.close()}})};t.saveStateData=f;var m=function e(t){if(c())return i>s.INDEXED_DB_MAX_WRITE_COUNT?(i=0,void d().then(function(){return e(t)})):void f(t)};t.saveState=m;var h=function(){if(!c())return Promise.resolve({});var e=u(),t=e.resolve,n=e.promise;return l().then(function(e){var n=e.transaction(["items"],"readonly"),r=n.objectStore("items");r.getAllKeys().onsuccess=function(e){var n=e.target.result,a=n.map(function(e){return p(r,e)});Promise.all(a).then(function(e){var n=e.reduce(function(e,t){return e[t.key]=t.value,e},{});t(_(n))})},n.oncomplete=function(){return e.close()}}),n};t.loadState=h;var y=function(e){return r({},e,{chats:e.chats&&e.chats.map(function(e){return(0,o.isoChatTimestamps)(r({},e,{forward:null,backward:null}))})})},_=function(e){return r({},e,{chats:e.chats&&e.chats.map(function(e){return(0,o.convertChatTimestamps)(e)})})}},"./lib/localStorage.js":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.removeKey=t.loadKey=t.saveKey=t.saveState=t.loadState=void 0;var r=function(){try{var e=localStorage.getItem("state");return JSON.parse(e)}catch(e){return}};t.loadState=r;var a=function(e){try{var t=JSON.stringify(e);localStorage.setItem("state",t)}catch(e){console.log(e)}};t.saveState=a;var o=function(e,t){try{var n=JSON.stringify(t);localStorage.setItem(e,n)}catch(e){console.log(e)}};t.saveKey=o;var s=function(e){try{var t=localStorage.getItem(e);return t&&JSON.parse(t)}catch(e){return}};t.loadKey=s;var i=function(e){return window.localStorage&&localStorage.removeItem(e)};t.removeKey=i},"./lib/networkStats.js":function(e,t,n){"use strict";function r(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.networkStatsTypesEnum=void 0;var o={socketCommands:"socketCommands",socketEvents:"socketEvents",restCalls:"restCalls"};t.networkStatsTypesEnum=o;var s={socketCommands:{counter:0},socketEvents:{counter:0},restCalls:{counter:0}},i={push:function(e,t){var n=Number.isInteger(s[e][t])?s[e][t]+1:1;Object.assign(s[e],a({},t,n)),s[e].counter++},get:function(e){var t=s[e];t.counter;return r(t,["counter"])},getCounter:function(e){return s[e].counter}};Object.freeze(i);var c=i;t.default=c},"./lib/ntlm.js":function(e,t,n){"use strict";function r(){var e="NTLMSSP\0";return e+=(0,u.pack)("<I",1),e+=(0,u.pack)("<I",d),e+=(0,u.pack)("<HHI",0,0,0),e+=(0,u.pack)("<HHI",0,0,0),e+="",e+="",e+=(0,u.pack)("<H",2600),e+="\0\0\0",e+=""}function a(e){return e.split("").reduce(function(e,t){return"".concat(e).concat(t,"\0")},"")}function o(e,t,n){return(0,l.hmac)((0,l.md4)(a(n)),a(e.toUpperCase()+t),!0)}function s(){return"".concat(Math.floor((new Date).getTime()/1e3)+11644473600,"0000000")}function i(e,t,n,r,a,i){var c=o(e,t,n),d=o(e,t,n),p=(0,l.hmac)(d,r+a,!0)+a,f=s(),m="\0\0\0\0\0\0".concat((0,u.pack)("<Q",f)).concat(a,"\0\0\0\0").concat(i,"\0\0\0\0");return{lmchallengeresp:p,ntchallengeresp:(0,l.hmac)(c,r+m,!0)+m}}function c(e,t,n,r,o){var s=0;if("NTLMSSP\0"!==r.substring(0,8))throw Object("NTLM SSP signature not found.");s+=8;var c=(0,u.unpack)("<I",r.substring(s,s+4));if(2!==c)throw Object("Not a Type 2 NTLM message. ".concat(c));s+=4;var l=(0,u.unpack)("<H",r.substring(s,s+2))[0],d=(0,u.unpack)("<I",r.substring(s+4,s+8))[0];s+=8;var h=(0,u.unpack)("<I",r.substring(s,s+4))[0];h&p&&l>0&&r.substring(d,d+l),s+=4;var y=r.substring(s,s+8);s+=16;var _="",b=(0,u.unpack)("<H",r.substring(s,s+2)),v=(0,u.unpack)("<I",r.substring(s+4,s+8));b>0&&(_=r.substring(v,v+b));for(var g="",E=0;E<8;E++)g+=String.fromCharCode(Math.floor(255*Math.random()));var S=i(e,t,n,y,g,_),O=S.lmchallengeresp,C=S.ntchallengeresp;r="NTLMSSP\0",r+=(0,u.pack)("<I",3);var w=[];if([O,C,a(t),a(e),a(o)].forEach(function(e){r+=(0,u.pack)("<H",e.length),r+=(0,u.pack)("<H",e.length),w.push({offset:r.length,entry:e}),r+="    "}),h&m)throw Object("NTLMSSP_NEGOTIATE_KEY_EXCH.");r+=(0,u.pack)("<HHI",0,0,0),r+=(0,u.pack)("<I",8422021),h&f&&(r+="",r+="",r+=(0,u.pack)("<H",2600),r+="\0\0\0",r+=""),r+=(0,u.pack)("<IIII",0,0,0,0),r=r.split("");var j="";return w.forEach(function(e){var t=e.offset,n=e.entry;(0,u.pack)("<I",r.length+j.length).split("").forEach(function(e,n){r[t+n]=e}),j+=n}),r=r.join("")+j}Object.defineProperty(t,"__esModule",{value:!0}),t.makeNtlmNegotiate=r,t.tuc=a,t.ntowfv2=o,t.lmntchallengeresponse=i,t.parseNtlmChallenge=c;var u=n("./lib/packer.js"),l=n("./lib/hasher.js"),d=33587847,p=4,f=33554432,m=1073741824},"./lib/packer.js":function(e,t,n){"use strict";function r(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return 0===n.length?0:n[0].split("").reduce(function(e,t,n){return e+(t.charCodeAt()<<8*n)},0)}function a(e){for(var t,n,r=0,a=0,s="",i="",c=0;r<e.length;){for(t=e.charAt(r),n="",r++;r<e.length&&null!==e.charAt(r).match(/[\d*]/);)n+=e.charAt(r),r++;switch(""===n&&(n="1"),t){case"H":if(void 0===(a+1<1||arguments.length<=a+1?void 0:arguments[a+1]))throw new Error("Warning: pack() Type ".concat(t,": not enough args"));if(i=a+1<1||arguments.length<=a+1?void 0:arguments[a+1],"*"===n&&(n=i.length),n>i.length)throw new Error("Warning: pack() Type ".concat(t,": not enough characters in string"));s+=String.fromCharCode(255&i),s+=String.fromCharCode(i>>8),a++;break;case"I":if("*"===n&&(n=(arguments.length<=1?0:arguments.length-1)-a),n>(arguments.length<=1?0:arguments.length-1)-a)throw new Error("Warning:  pack() Type ".concat(t,": too few args"));for(c=0;c<n;c++)s+=String.fromCharCode(255&(a+1<1||arguments.length<=a+1?void 0:arguments[a+1])),s+=String.fromCharCode((a+1<1||arguments.length<=a+1?void 0:arguments[a+1])>>8&255),s+=String.fromCharCode((a+1<1||arguments.length<=a+1?void 0:arguments[a+1])>>16&255),s+=String.fromCharCode((a+1<1||arguments.length<=a+1?void 0:arguments[a+1])>>24&255),a++;break;case"Q":if(n>(arguments.length<=1?0:arguments.length-1)-a)throw new Error("Warning:  pack() Type ".concat(t,": too few args"));s+=o(a+1<1||arguments.length<=a+1?void 0:arguments[a+1]),a++;break;case"<":break;default:throw new Error("Warning:  pack() Type ".concat(t,": unknown format code"))}}if(a<(arguments.length<=1?0:arguments.length-1))throw new Error("Warning: pack(): ".concat((arguments.length<=1?0:arguments.length-1)-a," args unused"));return s}function o(e){for(var t,n=e.toString().split(""),r=[],a=[];n.length;){t=1*n.shift();for(var o=0;t||o<r.length;o++)t+=10*(r[o]||0),r[o]=t%16,t=(t-r[o])/16}for(;r.length;)a.push(r.pop().toString(16));return a.length%2==1&&a.unshift("0"),a.reduce(function(e,t){return e.byte+=t,2===e.byte.length&&(e.text=String.fromCharCode(parseInt(e.byte,16))+e.text,e.byte=""),e},{byte:"",text:""}).text}Object.defineProperty(t,"__esModule",{value:!0}),t.unpack=r,t.pack=a},"./lib/phoenix.js":function(e,t,n){"use strict";function r(e){return s(e)||o(e)||a()}function a(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function o(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function s(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t}function u(e,t){if(!c(e,t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e,t,n){return t&&l(e.prototype,t),n&&l(e,n),e}Object.defineProperty(t,"__esModule",{value:!0}),t.Presence=t.Ajax=t.LongPoll=t.Socket=t.Channel=void 0;var p={connecting:0,open:1,closing:2,closed:3},f=1e4,m={closed:"closed",errored:"errored",joined:"joined",joining:"joining",leaving:"leaving"},h={close:"phx_close",error:"phx_error",join:"phx_join",reply:"phx_reply",leave:"phx_leave"},y={longpoll:"longpoll",websocket:"websocket"},_=function(){function e(t,n,r,a){u(this,e),this.channel=t,this.event=n,this.payload=r||{},this.receivedResp=null,this.timeout=a,this.timeoutTimer=null,this.recHooks=[],this.sent=!1}return d(e,[{key:"resend",value:function(e){this.timeout=e,this.cancelRefEvent(),this.ref=null,this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}},{key:"send",value:function(){this.hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref}))}},{key:"receive",value:function(e,t){return this.hasReceived(e)&&t(this.receivedResp.response),this.recHooks.push({status:e,callback:t}),this}},{key:"matchReceive",value:function(e){var t=e.status,n=e.response;e.ref;this.recHooks.filter(function(e){return e.status===t}).forEach(function(e){return e.callback(n)})}},{key:"cancelRefEvent",value:function(){this.refEvent&&this.channel.off(this.refEvent)}},{key:"cancelTimeout",value:function(){clearTimeout(this.timeoutTimer),this.timeoutTimer=null}},{key:"startTimeout",value:function(){var e=this;this.timeoutTimer||(this.ref=this.channel.socket.makeRef(),this.refEvent=this.channel.replyEventName(this.ref),this.channel.on(this.refEvent,function(t){e.cancelRefEvent(),e.cancelTimeout(),e.receivedResp=t,e.matchReceive(t)}),this.timeoutTimer=setTimeout(function(){e.trigger("timeout",{})},this.timeout))}},{key:"hasReceived",value:function(e){return this.receivedResp&&this.receivedResp.status===e}},{key:"trigger",value:function(e,t){this.channel.trigger(this.refEvent,{status:e,response:t})}}]),e}(),b=function(){function e(t,n,r){var a=this;u(this,e),this.state=m.closed,this.topic=t,this.params=n||{},this.socket=r,this.bindings=[],this.timeout=this.socket.timeout,this.pushTimeouts=this.socket.pushTimeouts,this.joinedOnce=!1,this.joinPush=new _(this,h.join,this.params,this.timeout),this.autoJoin=this.socket.autoJoinEnabled,this.pushBuffer=[],this.rejoinTimer=new O(function(){return a.rejoinUntilConnected()},this.socket.reconnectAfterMs),this.joinPush.receive("ok",function(){a.state=m.joined,a.rejoinTimer.reset(),a.pushBuffer.forEach(function(e){return e.send()}),a.pushBuffer=[]}),this.onClose(function(){a.rejoinTimer.reset(),a.socket.log("channel","close ".concat(a.topic," ").concat(a.joinRef())),a.state=m.closed,a.socket.remove(a)}),this.onError(function(e){a.isLeaving()||a.isClosed()||(a.socket.log("channel","error ".concat(a.topic),e),a.state=m.errored,a.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",function(){a.isJoining()&&(a.socket.log("channel","timeout ".concat(a.topic),a.joinPush.timeout),a.state=m.errored,a.rejoinTimer.scheduleTimeout())}),this.on(h.reply,function(e,t){a.trigger(a.replyEventName(t),e)})}return d(e,[{key:"rejoinUntilConnected",value:function(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this.rejoin()}},{key:"join",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.timeout;if(this.joinedOnce)throw"tried to join multiple times. 'join' can only be called a single time per channel instance";return this.joinedOnce=!0,this.rejoin(e),this.joinPush}},{key:"onClose",value:function(e){this.on(h.close,e)}},{key:"onError",value:function(e){this.on(h.error,function(t){return e(t)})}},{key:"on",value:function(e,t){this.bindings.push({event:e,callback:t})}},{key:"off",value:function(e){this.bindings=this.bindings.filter(function(t){return t.event!==e})}},{key:"canPush",value:function(){return this.socket.isConnected()&&this.isJoined()}},{key:"push",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.pushTimeouts[e]||this.timeout;if(!this.joinedOnce)throw"tried to push '".concat(e,"' to '").concat(this.topic,"' before joining. Use channel.join() before pushing events");var r=new _(this,e,t,n);return this.canPush()?r.send():(r.startTimeout(),this.pushBuffer.push(r)),r}},{key:"leave",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.timeout;this.state=m.leaving;var n=function(){e.socket.log("channel","leave ".concat(e.topic)),e.trigger(h.close,"leave",e.joinRef())},r=new _(this,h.leave,{},t);return r.receive("ok",function(){return n()}).receive("timeout",function(){return n()}),r.send(),this.canPush()||r.trigger("ok",{}),r}},{key:"onMessage",value:function(e,t,n){return t}},{key:"isMember",value:function(e){return this.topic===e}},{key:"joinRef",value:function(){return this.joinPush.ref}},{key:"sendJoin",value:function(e){this.state=m.joining,this.autoJoin?(this.joinPush.startTimeout(),this.joinPush.sent=!0,this.trigger(h.reply,{status:"ok",response:{}},this.joinRef())):this.joinPush.resend(e)}},{key:"rejoin",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.timeout;this.isLeaving()||this.sendJoin(e)}},{key:"trigger",value:function(e,t,n){var r=h.close,a=h.error,o=h.leave,s=h.join;if(!(n&&[r,a,o,s].indexOf(e)>=0&&n!==this.joinRef())){var i=this.onMessage(e,t,n);if(t&&!i)throw"channel onMessage callbacks must return the payload, modified or unmodified";this.bindings.filter(function(t){return t.event===e}).map(function(e){return e.callback(i,n)})}}},{key:"replyEventName",value:function(e){return"chan_reply_".concat(e)}},{key:"isClosed",value:function(){return this.state===m.closed}},{key:"isErrored",value:function(){return this.state===m.errored}},{key:"isJoined",value:function(){return this.state===m.joined}},{key:"isJoining",value:function(){return this.state===m.joining}},{key:"isLeaving",value:function(){return this.state===m.leaving}}]),e}();t.Channel=b;var v=function(){function e(t){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};u(this,e),this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.channels=[],this.sendBuffer=[],this.ref=0,this.timeout=r.timeout||f,this.pushTimeouts=r.pushTimeouts||{},this.transport=r.transport||window.WebSocket||g,this.defaultEncoder=function(e,t){return t(JSON.stringify(e))},this.defaultDecoder=function(e,t){return t(JSON.parse(e))},this.transport!==g?(this.encode=r.encode||this.defaultEncoder,this.decode=r.decode||this.defaultDecoder):(this.encode=this.defaultEncoder,this.decode=this.defaultDecoder),this.heartbeatIntervalMs=r.heartbeatIntervalMs||3e4,this.reconnectAfterMs=r.reconnectAfterMs||function(e){return[1e3,2e3,5e3,1e4][e-1]||1e4},this.logger=r.logger||function(){},this.longpollerTimeout=r.longpollerTimeout||2e4,this.params=r.params||{},this.endPoint="".concat(t,"/").concat(r.transportEndPoint||y.websocket),this.heartbeatTimer=null,this.pendingHeartbeatRef=null,this.reconnectTimer=new O(function(){n.disconnect(function(){return n.connect()})},this.reconnectAfterMs)}return d(e,[{key:"protocol",value:function(){return location.protocol.match(/^https/)?"wss":"ws"}},{key:"endPointURL",value:function(){var e=E.appendParams(E.appendParams(this.endPoint,this.params),{vsn:"1.0.0"});return"/"!==e.charAt(0)?e:"/"===e.charAt(1)?"".concat(this.protocol(),":").concat(e):"".concat(this.protocol(),"://").concat(location.host).concat(e)}},{key:"disconnect",value:function(e,t,n){this.conn&&(this.conn.onclose=function(){},t?this.conn.close(t,n||""):this.conn.close(),this.conn=null),e&&e()}},{key:"connect",value:function(e){var t=this;e&&(console&&console.log("passing params to connect is deprecated. Instead pass :params to the Socket constructor"),this.params=e),this.conn||(this.conn=new this.transport(this.endPointURL()),this.conn.timeout=this.longpollerTimeout,this.conn.binaryType="arraybuffer",this.conn.onopen=function(){return t.onConnOpen()},this.conn.onerror=function(e){return t.onConnError(e)},this.conn.onmessage=function(e){return t.onConnMessage(e)},this.conn.onclose=function(e){return t.onConnClose(e)})}},{key:"log",value:function(e,t,n){this.logger(e,t,n)}},{key:"onOpen",value:function(e){this.stateChangeCallbacks.open.push(e)}},{key:"onClose",value:function(e){this.stateChangeCallbacks.close.push(e)}},{key:"onError",value:function(e){this.stateChangeCallbacks.error.push(e)}},{key:"onMessage",value:function(e){this.stateChangeCallbacks.message.push(e)}},{key:"onConnOpen",value:function(){var e=this;this.log("transport","connected to ".concat(this.endPointURL())),this.flushSendBuffer(),this.reconnectTimer.reset(),this.conn.skipHeartbeat||(clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(function(){return e.sendHeartbeat()},this.heartbeatIntervalMs)),this.stateChangeCallbacks.open.forEach(function(e){return e()})}},{key:"onConnClose",value:function(e){this.log("transport","close",e),this.triggerChanError(),clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(function(t){return t(e)})}},{key:"onConnError",value:function(e){this.log("transport",e),this.triggerChanError(),this.stateChangeCallbacks.error.forEach(function(t){return t(e)})}},{key:"triggerChanError",value:function(){this.channels.forEach(function(e){return e.trigger(h.error)})}},{key:"connectionState",value:function(){switch(this.conn&&this.conn.readyState){case p.connecting:return"connecting";case p.open:return"open";case p.closing:return"closing";default:return"closed"}}},{key:"isConnected",value:function(){return"open"===this.connectionState()}},{key:"remove",value:function(e){this.channels=this.channels.filter(function(t){return t.joinRef()!==e.joinRef()})}},{key:"channel",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=new b(e,t,this);return this.channels.push(n),n}},{key:"push",value:function(e){var t=this,n=e.topic,r=e.event,a=e.payload,o=e.ref,s=function(){t.encode(e,function(e){var n=!1;t.encrypt&&(n=t.encrypt(e,t.sharedTx)),t.conn.send(n||e)})};this.log("push","".concat(n," ").concat(r," (").concat(o,")"),a),this.isConnected()?s():this.sendBuffer.push(s)}},{key:"makeRef",value:function(){var e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}},{key:"sendHeartbeat",value:function(){if(this.isConnected()){if(this.pendingHeartbeatRef)return this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),void this.conn.close(1e3,"hearbeat timeout");this.pendingHeartbeatRef=this.makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef})}}},{key:"flushSendBuffer",value:function(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(function(e){return e()}),this.sendBuffer=[])}},{key:"onConnMessage",value:function(e){var t=this,n=!1;this.decrypt&&(n=this.decrypt(new Uint8Array(e.data),this.sharedRx)),this.decode(n||e.data,function(e){var n=e.topic,r=e.event,a=e.payload,o=e.ref;o&&o===t.pendingHeartbeatRef&&(t.pendingHeartbeatRef=null),t.log("receive","".concat(a.status||""," ").concat(n," ").concat(r," ").concat(o&&"("+o+")"||""),a),t.channels.filter(function(e){return e.isMember(n)}).forEach(function(e){return e.trigger(r,a,o)}),t.stateChangeCallbacks.message.forEach(function(t){return t(e)})})}}]),e}();t.Socket=v;var g=function(){function e(t){u(this,e),this.endPoint=null,this.token=null,this.skipHeartbeat=!0,this.onopen=function(){},this.onerror=function(){},this.onmessage=function(){},this.onclose=function(){},this.pollEndpoint=this.normalizeEndpoint(t),this.readyState=p.connecting,this.poll()}return d(e,[{key:"normalizeEndpoint",value:function(e){return e.replace("ws://","http://").replace("wss://","https://").replace(new RegExp("(.*)/"+y.websocket),"$1/"+y.longpoll)}},{key:"endpointURL",value:function(){return E.appendParams(this.pollEndpoint,{token:this.token})}},{key:"closeAndRetry",value:function(){this.close(),this.readyState=p.connecting}},{key:"ontimeout",value:function(){this.onerror("timeout"),this.closeAndRetry()}},{key:"poll",value:function(){var e=this;this.readyState!==p.open&&this.readyState!==p.connecting||E.request("GET",this.endpointURL(),"application/json",null,this.timeout,this.ontimeout.bind(this),function(t){if(t){var n=t.status,r=t.token,a=t.messages;e.token=r}else var n=0;switch(n){case 200:a.forEach(function(t){return e.onmessage({data:JSON.stringify(t)})}),e.poll();break;case 204:e.poll();break;case 410:e.readyState=p.open,e.onopen(),e.poll();break;case 0:case 500:e.onerror(),e.closeAndRetry();break;default:throw"unhandled poll status ".concat(n)}})}},{key:"send",value:function(e){var t=this;E.request("POST",this.endpointURL(),"application/json",e,this.timeout,this.onerror.bind(this,"timeout"),function(e){e&&200===e.status||(t.onerror(e&&e.status),t.closeAndRetry())})}},{key:"close",value:function(e,t){this.readyState=p.closed,this.onclose()}}]),e}();t.LongPoll=g;var E=function(){function e(){u(this,e)}return d(e,null,[{key:"request",value:function(e,t,n,r,a,o,s){if(window.XDomainRequest){var i=new XDomainRequest;this.xdomainRequest(i,e,t,r,a,o,s)}else{var c=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");this.xhrRequest(c,e,t,n,r,a,o,s)}}},{key:"xdomainRequest",value:function(e,t,n,r,a,o,s){var i=this;e.timeout=a,e.open(t,n),e.onload=function(){var t=i.parseJSON(e.responseText);s&&s(t)},o&&(e.ontimeout=o),e.onprogress=function(){},e.send(r)}},{key:"xhrRequest",value:function(e,t,n,r,a,o,s,i){var c=this;e.open(t,n,!0),e.timeout=o,e.setRequestHeader("Content-Type",r),e.onerror=function(){i&&i(null)},e.onreadystatechange=function(){if(e.readyState===c.states.complete&&i){var t=c.parseJSON(e.responseText);i(t)}},s&&(e.ontimeout=s),e.send(a)}},{key:"parseJSON",value:function(e){if(!e||""===e)return null;try{return JSON.parse(e)}catch(t){return console&&console.log("failed to parse JSON response",e),null}}},{key:"serialize",value:function(e,t){var n=[];for(var r in e)if(e.hasOwnProperty(r)){var a=t?"".concat(t,"[").concat(r,"]"):r,o=e[r];"object"===i(o)?n.push(this.serialize(o,a)):n.push(encodeURIComponent(a)+"="+encodeURIComponent(o))}return n.join("&")}},{key:"appendParams",value:function(e,t){if(0===Object.keys(t).length)return e;var n=e.match(/\?/)?"&":"?";return"".concat(e).concat(n).concat(this.serialize(t))}}]),e}();t.Ajax=E,E.states={complete:4};var S={syncState:function(e,t,n,r){var a=this,o=this.clone(e),s={},i={};return this.map(o,function(e,n){t[e]||(i[e]=n)}),this.map(t,function(e,t){var n=o[e];if(n){var r=t.metas.map(function(e){return e.phx_ref}),c=n.metas.map(function(e){return e.phx_ref}),u=t.metas.filter(function(e){return c.indexOf(e.phx_ref)<0}),l=n.metas.filter(function(e){return r.indexOf(e.phx_ref)<0});u.length>0&&(s[e]=t,s[e].metas=u),l.length>0&&(i[e]=a.clone(n),i[e].metas=l)}else s[e]=t}),this.syncDiff(o,{joins:s,leaves:i},n,r)},syncDiff:function(e,t,n,a){var o=t.joins,s=t.leaves,i=this.clone(e);return n||(n=function(){}),a||(a=function(){}),this.map(o,function(e,t){var a=i[e];if(i[e]=t,a){var o;(o=i[e].metas).unshift.apply(o,r(a.metas))}n(e,a,t)}),this.map(s,function(e,t){var n=i[e];if(n){var r=t.metas.map(function(e){return e.phx_ref});n.metas=n.metas.filter(function(e){return r.indexOf(e.phx_ref)<0}),a(e,n,t),0===n.metas.length&&delete i[e]}}),i},list:function(e,t){return t||(t=function(e,t){return t}),this.map(e,function(e,n){return t(e,n)})},map:function(e,t){return Object.getOwnPropertyNames(e).map(function(n){return t(n,e[n])})},clone:function(e){return JSON.parse(JSON.stringify(e))}};t.Presence=S;var O=function(){function e(t,n){u(this,e),this.callback=t,this.timerCalc=n,this.timer=null,this.tries=0}return d(e,[{key:"reset",value:function(){this.tries=0,clearTimeout(this.timer)}},{key:"scheduleTimeout",value:function(){var e=this;clearTimeout(this.timer),this.timer=setTimeout(function(){e.tries=e.tries+1,e.callback()},this.timerCalc(this.tries+1))}}]),e}()},"./lib/reactIntl.js":function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){o(e,t,n[t])})}return e}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e){_!==e&&(_=e,b.props=a({},b.props,{locale:e,messages:h[e]}),y=b.getChildContext().intl)}function i(){return b.getChildContext().intl.locale}function c(){var e;return y?(e=y).formatMessage.apply(e,arguments):""}function u(){var e;return y?(e=y).formatHTMLMessage.apply(e,arguments):""}function l(e){return h[e]}Object.defineProperty(t,"__esModule",{value:!0}),t.setLocale=s,t.getLocale=i,t.formatMessage=c,t.formatHTMLMessage=u,t.getMessages=l;var d=n("./node_modules/react-intl/lib/index.es.js"),p=r(n("./node_modules/react-intl/locale-data/en.js")),f=r(n("./node_modules/react-intl/locale-data/ru.js")),m=r(n("./translations/locales/ru.json"));(0,d.addLocaleData)(f.default),(0,d.addLocaleData)(p.default);var h={ru:m.default},y=null,_=null,b=new d.IntlProvider({},{})},"./lib/sockets.js":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mockSocket=t.getSocketType=t.getGroupChannel=t.getSystemChannel=t.getSocket=t.disconnect=t.connect=void 0;var r=n("./lib/phoenix.js"),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./lib/encryption.js")),o={rts:null,cts:null},s=function(e,t,n,s,i){if(o[t])return Promise.resolve(o[t]);var c=new r.Socket("wss://".concat(e,"/socket"),n);return c.connType=t,o[t]=c,new Promise(function(e){c.onOpen(function(){return i.put({socket:c})}),c.onClose(function(){return i.put({socket:c})}),c.onMessage(function(t){if("phoenix"===t.topic&&"features"===t.event){t.payload.features.includes("auto_join")&&(c.autoJoinEnabled=!0)}if("session"===t.topic&&"server_pub_key"===t.event){var n=a.generateSessionPair(s.publicKey,s.privateKey,a.fromBase64Url(t.payload.key));c.encrypt=a.encryptSocket,c.sharedTx=n.sharedTx,c.decrypt=a.decryptSocket,c.sharedRx=n.sharedRx,e(c)}}),c.onError(function(e){return i.put({socket:c,error:e})}),c.connect()})};t.connect=s;var i=function(e){var t=o[e];return!!t&&(t.disconnect(),"closed"===t.connectionState()&&(o[e]=null,!0))};t.disconnect=i;var c=function(e){return o[e]};t.getSocket=c;var u=function(e){var t=o[e];if(t)return t.channels.find(function(e){return"system"===e.topic})};t.getSystemChannel=u;var l=function(e){var t=o.rts?o.rts.channels:[],n=o.cts?o.cts.channels:[];return t.concat(n).find(function(t){return t.topic.includes(e)})};t.getGroupChannel=l;var d=function(e){try{return e.channels.find(function(e){return"system"===e.topic}).connType}catch(e){return console.error("get socket type error: ".concat(e.message)),!1}};t.getSocketType=d;var p=function(e,t){Object({PRODUCTION:1,NODE_ENV:"production"}).TEST&&(o[e]=t)};t.mockSocket=p},"./lib/timestamps.js":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.toIsoString=t.convert=void 0;var r=function(e){return e&&e.__esModule?e:{default:e}}(n("./node_modules/moment/moment.js")),a=function(e){return r.default.isMoment(e)||!e?e:(0,r.default)(e.replace("GMT",""))};t.convert=a;var o=function(e){return r.default.isMoment(e)?e.toISOString():e};t.toIsoString=o},"./lib/update.js":function(e,t,n){"use strict";function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){a(e,t,n[t])})}return e}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e){return e?{authStatus:e.authStatus,authToken:e.authToken,ctsAuthToken:e.ctsAuthToken,rtsHost:e.rtsHost,huid:e.huid,ctsServer:e.ctsServer,ctsLogin:e.ctsLogin,corpAvatar:e.corpAvatar,keyId:e.keyId,udid:e.udid,region:e.region,phone:e.phone,registerTimestamp:e.registerTimestamp,code:e.code,pushToken:e.pushToken,rtsServerId:e.rtsServerId,ctsServerId:e.ctsServerId}:{}}function s(e){return e?{user:e.user,server:e.server}:{}}function i(e){return{locale:e.locale}}function c(e){return(null===e||void 0===e?void 0:e.list)?e.list.map(function(e){return r({},e,{visible:!0})}):e}function u(e){var t=(0,d.loadKey)("updateApp"),n=c(e.drafts);if(!t)return r({},e,{drafts:n});(0,d.removeKey)("updateApp"),(0,d.removeKey)("state");var a=(0,l.default)(void 0,{}),u=o(e.user),p=s(e.encryptionKeys),f=i(e.ui);return a.user=r({},a.user,u),a.encryptionKeys=r({},a.encryptionKeys,p),a.ui=r({},a.ui,f),a.drafts=r({},a.drafts,n),a}Object.defineProperty(t,"__esModule",{value:!0}),t.migrateState=u;var l=function(e){return e&&e.__esModule?e:{default:e}}(n("./app/modules/index.js")),d=n("./lib/localStorage.js")},"./lib/urlMetadata.js":function(e,t,n){"use strict";(function(e){function r(e,t){return s(e)||o(e,t)||a()}function a(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function o(e,t){var n=[],r=!0,a=!1,o=void 0;try{for(var s,i=e[Symbol.iterator]();!(r=(s=i.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==i.return||i.return()}finally{if(a)throw o}}return n}function s(e){if(Array.isArray(e))return e}function i(e){return new Promise(function(t){fetch(y.CORS_API_URL+e).then(function(n){return n.headers.get("content-type").includes("image")&&t({url:e,url_preview:e}),n}).then(function(e){return e.blob()}).then(function(e){return d(e)}).then(function(n){return t(m(n,e))}).catch(function(){return t(!1)})})}function c(t,n){if(!t)return"";var a=t.match(/charset\s*=\s*"?\s*([^"^;^\s]*)/)||[],o=r(a,2),s=o[1],i=e.TextDecoder||h.TextDecoder;return/utf-?8/i.test(s)||!s?t:new i(s).decode(n)}function u(e){return new Promise(function(t){var n=new FileReader;n.onload=function(e){return t(e.srcElement.result)},n.readAsText(e)})}function l(e){return new Promise(function(t){var n=new FileReader;n.onload=function(e){return t(e.srcElement.result)},n.readAsArrayBuffer(e)})}function d(e){var t=[u(e),l(e)];return Promise.all(t).then(function(e){var t=r(e,2);return c(t[0],t[1])})}function p(e,t){var n=t.reduce(function(t,n){return t||e.querySelector(n)},null);return n&&(n.innerText||n.getAttribute("content"))}function f(e,t){if(!e||!e.length||!t)return t;if(/^(https?:)?\/\//.test(e))return e;if("/"===e[0]){var n=t.match(/^(https?:)?\/\/([^\/]+)/)||[],a=r(n,3),o=a[1],s=a[2];return"".concat(o,"//").concat(s).concat(e)}return/^(https?:)?\/\/([^\/]+)$/.test(t)?"".concat(t,"/").concat(e):"".concat(r(t.match(/^(.*\/)[^\/]*$/)||[],2)[1]).concat(e)}function m(e,t){var n=new DOMParser,r=n.parseFromString(e,"text/html"),a=p(r,['meta[property="og:title"]','meta[property="twitter:title"]',"title"]),o=p(r,['meta[property="og:image"]','link[rel="image_src"]','link[rel="apple-touch-icon"]']),s=p(r,['meta[property="og:description"]','meta[property="twitter:description"]']);return!!(a&&o&&s)&&{url:t,url_title:a,url_preview:f(o,t),url_text:s}}Object.defineProperty(t,"__esModule",{value:!0}),t.getMetadata=i,t.getAbsoluteUrl=f;var h=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n("./node_modules/text-encoding/index.js")),y=n("./lib/constants.js")}).call(t,n("./node_modules/webpack/buildin/global.js"))},"./lib/uuid5.js":function(e,t,n){"use strict";function r(){return new a.default(5,"ns:DNS",new a.default(4).format()).format()}Object.defineProperty(t,"__esModule",{value:!0}),t.default=r;var a=function(e){return e&&e.__esModule?e:{default:e}}(n("./node_modules/pure-uuid/uuid.js"))},"./lib/voex.js":function(e,t,n){"use strict";function r(e,t){return s(e)||o(e,t)||a()}function a(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function o(e,t){var n=[],r=!0,a=!1,o=void 0;try{for(var s,i=e[Symbol.iterator]();!(r=(s=i.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==i.return||i.return()}finally{if(a)throw o}}return n}function s(e){if(Array.isArray(e))return e}function i(e){return l(e)||u(e)||c()}function c(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function u(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function l(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}function d(e){return navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia(e).then(function(e){P=e}).catch(function(){return navigator.mediaDevices.getUserMedia({audio:!0,video:!1})}).then(function(e){e&&(P=e)}).then(function(){return P}):Promise.reject()}function p(e,t){var n=t.stun_server.map(function(e){return{urls:"stun:".concat(e)}}),r=t.turn_server.map(function(e){return{urls:"turn:".concat(e),username:t.login,credential:t.password}});k=new RTCPeerConnection({iceServers:n.concat(r)}),k.onicecandidate=_,null===k.ontrack?k.ontrack=v:k.onaddstream=b,k.addStream(P),k.oniceconnectionstatechange=function(){e&&k&&"failed"===k.iceConnectionState&&(k.close(),p(e,t)),k&&"disconnected"===k.iceConnectionState&&x.dispatchEvent("onIceDisconnect"),k&&"connected"===k.iceConnectionState&&(x.dispatchEvent("onIceConnect"),navigator.userAgent.toLowerCase().includes("firefox")&&M(k).then(function(){return x.dispatchEvent("onIceDisconnect")}))},e&&k.createOffer().then(y)}function f(){P&&(g(P),P=null),k&&(k.getSenders?(k.getSenders().forEach(function(e){return e.track&&e.track.stop()}),k.getReceivers().forEach(function(e){return e.track&&e.track.stop()})):(k.getRemoteStreams().forEach(g),k.getLocalStreams().forEach(g)),k.close(),k=null)}function m(e){if(!k||!k.remoteDescription.type)return void T.push(e);k.addIceCandidate(new RTCIceCandidate(e)).catch(E)}function h(e){k&&k.setRemoteDescription(new RTCSessionDescription(e)).then(function(){return T.length&&(T.forEach(m),T.splice(0)),"offer"===e.type?k.createAnswer().then(y):Promise.resolve()}).catch(E)}function y(e){e.sdp=S(e.sdp,j.PEER_CONNECTION_BANDWITH),k.setLocalDescription(e).then(function(){return x.dispatchEvent("sessionDescription",k.localDescription.toJSON())}).catch(E)}function _(e){e.candidate&&x.dispatchEvent("iceCandidate",e.candidate.toJSON())}function b(e){x.dispatchEvent("remoteStream",e.stream)}function v(e){x.dispatchEvent("remoteStream",e.streams[0])}function g(e){e.getAudioTracks().forEach(function(e){return e.stop()}),e.getVideoTracks().forEach(function(e){return e.stop()})}function E(e){console.warn(e)}function S(e,t){return e.replace(/(m=video .*\r\nc=IN .*\r\n)(b=.*\r\n)?/,"$1b=AS:".concat(t,"\r\n"))}function O(){var e=P&&P.getAudioTracks()||[],t=r(e,1),n=t[0];n&&(n.enabled=!1)}function C(){var e=P&&P.getAudioTracks()||[],t=r(e,1),n=t[0];n&&(n.enabled=!0)}Object.defineProperty(t,"__esModule",{value:!0}),t.getMediaStream=d,t.connect=p,t.hangup=f,t.setRemoteIceCandidate=m,t.setRemoteSession=h,t.muteMicrophone=O,t.unmuteMicrophone=C,t.dispatcher=void 0;var w=function(e){return e&&e.__esModule?e:{default:e}}(n("./lib/dispatcher.js")),j=n("./lib/constants.js"),k=null,P=null,T=[],x=new w.default;t.dispatcher=x;var M=function(e){return new Promise(function(t){var n=0,r=0,a=setInterval(function(){return e.getStats().then(function(e){var o=e&&i(e.values()).find(function(e){return"inbound-rtp"===e.type&&!e.isRemote}),s=null===o||void 0===o?void 0:o.packetsReceived;r=s-n?j.FF_PEER_CONNECTION_DISCONNECTED_TIMEOUT:r-1,r||t(clearInterval(a)),n=s})},1e3)})}},"./translations/locales/ru.json":function(e,t){e.exports={"[chat presence] members online":"{count, plural, \none {# } \nfew {# } \nother {# }}, {online} ","[chat typing comp] typing":"{loader}","[chat typing comp] is typing":"{typing} {loader}","[chat typing comp] are typing":"{typingNames} {loader}","[chat typing comp] many are typing":"{typingNames}  {others}  {loader}","[main menu] chats":"","[main menu] contacts":"","[main menu] settings":"","[user presence] online":"","[user presence] online from now":" {fromNow}","[attach] photo":"","[attach] video":"","[attach] doc":"","[attach] contact":"","[attach dialog] send contact":" ","[confirm] resend":"   ","[confirm] resend in":"      {count, plural, \none {# } \nfew {# } \nother {# }}","[confirm] code error":"    ","[confirm] desc":"   {number}   SMS-  ","[confirm] enter":" ","[confirm] wrong":"  ?","[cts login] admin contacts":" .  :","[cts login] admin name":":","[cts login] admin phone":":","[cts login] user contacts":"       :","[cts login] previous login warning":"         ({number})     .","[cts login] enter data":"       .","[cts login] encryption warning":"  ,       ,    .","[cts login] skippable login":",     ","[cts login] skip":"","[cts login] logout":"","[auth] url":"URL-","[auth] login":"","[auth] password":"","[auth] url error":"  ,  server.com","[auth] ad_domain":" ( )","[cts login] connect":"","[keysDecrypt] wrong password":" .    {count, plural, \none {# } \nfew {# } \nother {# }}","[keysDecrypt] caption":"     .  ","[keysDecrypt] submit":"","[keysNew] password equal error":"  ","[keysNew] caption generate":"     .   ","[keysNew] caption warning":"      .      !","[keysNew] confirm password":" ","[keysNew] requirements 8 symbols":"    8 ","[keysNew] requirements lowercase":"       ","[keysNew] requirements uppercase":"       ","[keysNew] requirements numeric":"     ","[keysNew] generate":"","[auth] phone":"  ","[auth] region russia":"","[auth] region ae":"  ","[auth] region us":"  ","[auth] invalid phone":"    ","[auth] authenticate":"","[profile] name":"","[profile] caption":"  ","[avatar] upload profile":" <br/>","[profile] create":"","[auth qrcode] title":" ,     Express  :","[auth qrcode] 1 step":"1.   Express   ","[auth qrcode] 2 step":'2.  ""    Express Web',"[auth qrcode] 3 step":"3.  QR- ","[auth qrcode] back to phone":"    ","[avatar] upload":" <br/>","[send contact dlg] send":"","[send contact dlg] placeholder":"  ","[attachment] download":"c","[chat header] bot":"","[chat input] chat with bot":"   ","[chat input] help":"","[chat input] disabled":"       ,       ","[chat input] placeholder":"","[chat entry] groupchat":" ","[message] type image":"","[message] type document":"","[message] type contact":"","[message] type location":"","[message] draft":":","[app] you":"","[message bubble] unread splitter":" ","[message] unsigned":"  !","[message] download":"","[message] contact show":"","[message] contact":"","[message menu] message status":" ","[datetime] today":"","[datetime] yesterday":"","[system event] user added by you":"  {count, plural, \none {} \nfew {} \nother {}} {memberNames}","[system event] you added by user":" {senderName}  ","[system event] user and you added by user":" {senderName}  {count, plural, \none {} \nfew {} \nother {}} {memberNamesWithoutMe}  ","[system event] user added by user":" {senderName}  {count, plural, \none {} \nfew {} \nother {}} {memberNames}","[system event] user removed by you":"  {count, plural, \none {} \nfew {} \nother {}} {memberNames}","[system event] you removed by user":" {senderName}  ","[system event] user removed by user":" {senderName}  {count, plural, \none {} \nfew {} \nother {}} {memberNames}","[system event] user assigned as admin by you":"    {memberNames}","[system event] you assigned as admin by user":" {senderName}   ","[system event] user assigned as admin by user":" {senderName}    {memberNames}","[system event] rc public":"  ","[system event] rc private":"  ","[system event] rc corporate":"  ","[system event] call canceled":" ","[system event] call missed":" ","[system event] call declined":" ","[system event] call incoming":"  ({callDuration})","[system event] call outgoing":"  ({callDuration})","[system event] you left the chat":"  ","[system event] user left the chat":" {memberNames}  ","[system event] you removed from chat by corporate permissions":"          ","[system event] user removed from chat by corporate permissions":" {memberNames}          ","[system event] you changed topic to":"     {chatName}","[system event] user changed topic to":" {memberNames}     {chatName}","[system event] you changed chat avatar":"   ","[system event] user changed chat avatar":" {memberNames}   ","[contact list] phone":"","[contact list] corp server":"   ","[contact list] cts":"CTS ","[entry] begin chat":"","[upload dlg] title":" ","[upload dlg] send":"","[filter] all":"","[filter] corporate":"","[filter] personal":"","[update] caption":"    {availableAppVersion}","[update] submit":"","[auth qrcode] link":"   QR ","[chat] no messages":" ","[chat] dropzone":"  ","[chat] send msg":"","[files] media":"  ","[files] docs":"","[chat] no files":"     ","[chat] send message to chat member":"","[chat message] header":" ","[chat message] received":"","[chat message] read":"","[chat message] signature":" ","[chat message] verified":"","[chat message] not verified":" ","[avatar] upload chat":" <br/>","[chat settings] make admin":" ","[chat settings] admin":"","[chat settings] members":"({count, plural, \none {# } \nfew {# } \nother {# }})","[chat settings] title":" ","[chat settings] save":"","[chat settings] creator":": {name}","[chat settings] created":": {date}","[chat settings] foto":"  ","[chat settings] docs":"","[chat settings] routing":"","[chat settings] push":"","[chat settings] invite":" ","[chat] dnd off":" ","[chat] dnd on":" ","[chats] personal":" ","[chats] groupchat":" ","[chats] choose":"    ","[chats] search placeholder":"","[chats] header":"","[chat create] delete":"","[chat create] add":"","[chat create] chat title":" ","[chat input] search contact":"  ","[chat create] group chat":"  ","[chat create] personal chat":"  ","[chat invite] remove":"","[chat invite] select":"","[chat invite] title":" ","[routing] header":"","[phonebook] choose":"  ","[phonebook] search placeholder":"  ","[phonebook] title":"","[phonebook] registered":",   ","[phonebook] online":" ","[systemStatusMessages] connecting":"","[systemStatusMessages] loading":"","[systemStatusMessages] updating":"","[uialert] upd title":"          ","[uialert] upd btn":"","[uialert] clr title":"      .","[uialert] clr btn":" ","[settings] about":" ","[settings] version":" ","[cts notify] success":"     ","[auth] cts wait logout":"      .   ?","[auth] yes":"","[auth] no":"","[auth] connected":":","[auth] logout":"","[auth] domain":"/","[auth] cts connect":"","[auth] cts settings":" CTS","[dev settings] caption":" ","[dev settings] rts chats":"-   RTS: ","[dev settings] group rts chats":"-   RTS: ","[dev settings] cts chats":"-   CTS: ","[dev settings] group cts chats":"-   CTS: ","[dev settings] hybrid chats":"-  : ","[dev settings] total chats":"  : ","[dev settings] rts contacts":"-   RTS: ","[dev settings] cts contacts":"-   CTS: ","[dev settings] total contacts":" -  : ","[dev settings] phonebook version rts contacts":"  RTS: ","[dev settings] phonebook version cts contacts":"  CTS: ","[dev settings] user":"","[dev settings] rts connection":"RTS : ","[dev settings] not connected":" ","[dev settings] ts connection":"CTS : ","[dev settings] copy state":"   ","[settings notify] notification setting":"      ","[settings notify] notification settings":" ","[settings notify] change desktop notifications":"  ","[settings notify] play sound on new message":"   ","[profile] edit":"","[profile] save":"","[settings] profile":"","[settings] connected":"","[settings] not connected":" ","[settings] lang modal":" ","[settings] title":"","[settings] corporate server":" ","[settings] notifications":" ","[settings] logout":"","[settings] language":"","[settings] logout title":"  ?","[voex status] busy":"","[voex status] connecting":"{loader}","[voex status] incoming":" {loader}","[voex status] outgoing":" {loader}","[voex status] started":" ","[voex status] ended":" ","[errors] invalidCredentials":"    ","[errors] alreadyRegistered":"     .  ","[size] bytes":"","[size] kb":"","[size] mb":"","[size] gb":"","[size] tb":"","[chat error] create":"  ","[chat error] leave":"      ","[attachment] max size":" {fileName}    {maxSize}","[days] yesterday":"","[days] today":"","[days] sunday":"","[days] monday":"","[days] tuesday":"","[days] wednesday":"","[days] thursday":"","[days] friday":"","[days] saturday":"","[notification] adblock":"    ,      ","[notifications] wrongConfirmationCode":"  ","[notifications] activationNotFound":"   ","[notifications] userAlreadyConfirmed":"    ","[notifications] confirmationLimitExceeded":"   ","[notifications] smsLimitExceeded":"    ","[notifications] serverError":" ,   ","[notifications] corporateServerLoginError":"    ","[notifications] loggedOutCts":"    ","[notifications] profileUploaded":" ","[notifications] smsError":"  ,  ","[notifications] QR register request error":"    QR-  ","[notifications] QR register request not supported":"      QR-. ,         ","[notifications] QR auth error":" ,   ","[notifications] allowMediaDevice":"      ","[notifications] callError":"  . ,   "}},0:function(e,t){},10:function(e,t){},11:function(e,t){},2:function(e,t,n){n("./node_modules/@babel/polyfill/lib/index.js"),n("./node_modules/isomorphic-fetch/fetch-npm-browserify.js"),e.exports=n("./app/index.js")},3:function(e,t){},4:function(e,t){},5:function(e,t){},6:function(e,t){},7:function(e,t){},8:function(e,t){},9:function(e,t){}},[2]);
//# sourceMappingURL=bundle-1.2.788.js.map